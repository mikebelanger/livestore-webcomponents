(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const N2=e=>typeof e=="function",w=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(a){return t(a,n,r,s)}};case 5:return function(n,r,s,o,a){return arguments.length>=5?t(n,r,s,o,a):function(u){return t(u,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},se=e=>e,fp=e=>()=>e,mE=fp(!0),ts=fp(!1),rC=fp(void 0),il=rC;function k(e,t,n,r,s,o,a,u,f){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return a(o(s(r(n(t(e))))));case 8:return u(a(o(s(r(n(t(e)))))));case 9:return f(u(a(o(s(r(n(t(e))))))));default:{let h=arguments[0];for(let p=1;p<arguments.length;p++)h=arguments[p](h);return h}}}const fo=e=>(t,n)=>t===n||e(t,n),M2=(e,t)=>e===t,L2=()=>M2,U2=L2(),sC=w(2,(e,t)=>fo((n,r)=>e(t(n),t(r)))),j2=sC(U2,e=>e.getTime()),z2=e=>fo((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0});let B2="3.15.2";const dp=()=>B2,gE=`effect/GlobalValue/globalStoreId/${dp()}`;let bu;const Oe=(e,t)=>(bu||(globalThis[gE]??=new Map,bu=globalThis[gE]),bu.has(e)||bu.set(e,t()),bu.get(e)),H2=e=>e instanceof Set,Pn=e=>typeof e=="string",Fs=e=>typeof e=="number",mi=e=>typeof e=="boolean",hp=e=>typeof e=="bigint",Hd=e=>typeof e=="symbol",Oc=N2,W2=e=>e===void 0,V2=e=>!1,pp=e=>typeof e=="object"&&e!==null,ls=e=>pp(e)||Oc(e),X=w(2,(e,t)=>ls(e)&&t in e),tb=w(2,(e,t)=>X(e,"_tag")&&e._tag===t),ga=e=>e==null,K2=e=>e!=null,G2=e=>e instanceof Uint8Array,oC=e=>e instanceof Date,nb=e=>X(e,Symbol.iterator),Q2=e=>pp(e)&&!Array.isArray(e),iC=e=>X(e,"then")&&Oc(e.then),mp=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let aC=class cC{self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new cC(this.self)}};const J2=335903614,Y2=4150755663,X2=1481765933,Z2=1284865837,eD=9007199254740992,tD=134217728;class nD{_state;constructor(t,n,r,s){return ga(n)&&ga(t)?(n=Math.random()*4294967295>>>0,t=0):ga(n)&&(n=t,t=0),ga(s)&&ga(r)?(s=this._state?this._state[3]:Y2,r=this._state?this._state[2]:J2):ga(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),_E(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*tD+n)/eD}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;rD(this._state,t,n,X2,Z2),_E(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,a=t>>>27,u=(-a>>>0&31)>>>0;return(o>>>a|o<<u)>>>0}}function rD(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,a=(n&65535)*(s>>>16)>>>0,u=(n&65535)*(s&65535)>>>0,f=(n>>>16)*(s>>>16)+((a>>>16)+(o>>>16))>>>0;a=a<<16>>>0,u=u+a>>>0,u>>>0<a>>>0&&(f=f+1>>>0),o=o<<16>>>0,u=u+o>>>0,u>>>0<o>>>0&&(f=f+1>>>0),f=f+Math.imul(n,r)>>>0,f=f+Math.imul(t,s)>>>0,e[0]=f,e[1]=u}function _E(e,t,n,r,s){let o=t+r>>>0;const a=n+s>>>0;a>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=a}const r_=Symbol.for("effect/Utils/YieldWrap");class xc{#e;constructor(t){this.#e=t}[r_](){return this.#e}}function uC(e){if(typeof e=="object"&&e!==null&&r_ in e)return e[r_]();throw new Error(mp("yieldWrapGet"))}const ar=Oe("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),lC={effect_internal_function:e=>e()},sD={effect_internal_function:e=>{try{return e()}finally{}}},oD=lC.effect_internal_function(()=>new Error().stack)?.includes("effect_internal_function")===!0,rt=oD?lC.effect_internal_function:sD.effect_internal_function,iD=function*(){}.constructor,aD=e=>ls(e)&&e.constructor===iD,_g=Oe(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),ge=Symbol.for("effect/Hash"),G=e=>{if(ar.enabled===!0)return 0;switch(typeof e){case"number":return rb(e);case"bigint":return Pt(e.toString(10));case"boolean":return Pt(String(e));case"symbol":return Pt(String(e));case"string":return Pt(e);case"undefined":return Pt("undefined");case"function":case"object":return e===null?Pt("null"):e instanceof Date?G(e.toISOString()):e instanceof URL?G(e.href):cD(e)?e[ge]():gp(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},gp=e=>(_g.has(e)||_g.set(e,rb(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),_g.get(e)),le=e=>t=>t*53^e,_p=e=>e&3221225471|e>>>1&1073741824,cD=e=>X(e,ge),rb=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return _p(t)},Pt=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return _p(t)},uD=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=k(Pt(t[r]),le(G(e[t[r]])));return _p(n)},fC=e=>uD(e,Object.keys(e)),Gl=e=>{let t=6151;for(let n=0;n<e.length;n++)t=k(t,le(G(e[n])));return _p(t)},Xe=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,ge,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,ge,{value(){return t},enumerable:!1}),t},pe=Symbol.for("effect/Equal");function ue(){return arguments.length===1?e=>Wd(e,arguments[0]):Wd(arguments[0],arguments[1])}function Wd(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(Vd(e)&&Vd(t))return G(e)===G(t)&&e[pe](t)?!0:ar.enabled&&ar.tester?ar.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString();if(e instanceof URL&&t instanceof URL)return e.href===t.href}if(ar.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>Wd(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&Wd(e[o],t[o])))return ar.tester?ar.tester(e,t):!1;return!0}}return ar.tester?ar.tester(e,t):!1}}return ar.enabled&&ar.tester?ar.tester(e,t):!1}const Vd=e=>X(e,pe),sb=()=>ue,Je=Symbol.for("nodejs.util.inspect.custom"),wt=e=>{try{if(X(e,"toJSON")&&Oc(e.toJSON)&&e.toJSON.length===0)return e.toJSON();if(Array.isArray(e))return e.map(wt)}catch{return{}}return al(e)},ut=e=>JSON.stringify(e,null,2);let lD=class{[Je](){return this.toJSON()}toString(){return ut(this.toJSON())}};const gi=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?dC(e,t):String(e)}catch{return String(e)}},dC=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&(ai.fiberRefs!==void 0&&hC(o)?o[ob](ai.fiberRefs):o):o,t);return n=void 0,r},ob=Symbol.for("effect/Inspectable/Redactable"),hC=e=>typeof e=="object"&&e!==null&&ob in e,ai=Oe("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),fD=(e,t)=>{const n=ai.fiberRefs;ai.fiberRefs=e;try{return t()}finally{ai.fiberRefs=n}},al=e=>hC(e)&&ai.fiberRefs!==void 0?e[ob](ai.fiberRefs):e,Z=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},Hu="Async",Ql="Commit",rn="Failure",Sd="OnFailure",Kd="OnSuccess",Gd="OnSuccessAndFailure",sn="Success",pC="Sync",dD="Tag",Fc="UpdateRuntimeFlags",Qd="While",Wu="Iterator",mC="WithRuntime",wd="Yield",ib="RevertFlags",hD=Symbol.for("effect/Effect"),s_=Symbol.for("effect/Stream"),pD=Symbol.for("effect/Sink"),mD=Symbol.for("effect/Channel"),_i={_R:e=>e,_E:e=>e,_A:e=>e,_V:dp()},gD={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},_D={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Jl={[hD]:_i,[s_]:_i,[pD]:gD,[mD]:_D,[pe](e){return this===e},[ge](){return Xe(this,gp(this))},[Symbol.iterator](){return new aC(new xc(this))},pipe(){return Z(this,arguments)}},ab={[ge](){return Xe(this,fC(this))},[pe](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&ue(this[r],e[r])))return!1;return!0}},Yl={...Jl,_op:Ql},yD={...Yl,...ab},bD=function(){function e(){}return e.prototype=Yl,e}(),gC=Symbol.for("effect/Option"),_C={...Jl,[gC]:{_A:e=>e},[Je](){return this.toJSON()},toString(){return ut(this.toJSON())}},SD=Object.assign(Object.create(_C),{_tag:"Some",_op:"Some",[pe](e){return cb(e)&&bC(e)&&ue(this.value,e.value)},[ge](){return Xe(this,le(G(this._tag))(G(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:wt(this.value)}}}),wD=G("None"),vD=Object.assign(Object.create(_C),{_tag:"None",_op:"None",[pe](e){return cb(e)&&yC(e)},[ge](){return wD},toJSON(){return{_id:"Option",_tag:this._tag}}}),cb=e=>X(e,gC),yC=e=>e._tag==="None",bC=e=>e._tag==="Some",ub=Object.create(vD),Jd=e=>{const t=Object.create(SD);return t.value=e,t},SC=Symbol.for("effect/Either"),wC={...Jl,[SC]:{_R:e=>e},[Je](){return this.toJSON()},toString(){return ut(this.toJSON())}},ED=Object.assign(Object.create(wC),{_tag:"Right",_op:"Right",[pe](e){return lb(e)&&EC(e)&&ue(this.right,e.right)},[ge](){return le(G(this._tag))(G(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:wt(this.right)}}}),kD=Object.assign(Object.create(wC),{_tag:"Left",_op:"Left",[pe](e){return lb(e)&&vC(e)&&ue(this.left,e.left)},[ge](){return le(G(this._tag))(G(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:wt(this.left)}}}),lb=e=>X(e,SC),vC=e=>e._tag==="Left",EC=e=>e._tag==="Right",TD=e=>{const t=Object.create(kD);return t.left=e,t},CD=e=>{const t=Object.create(ED);return t.right=e,t},ae=CD,ie=TD,ID=e=>{if(Oc(e))try{return ae(e())}catch(t){return ie(t)}else try{return ae(e.try())}catch(t){return ie(e.catch(t))}},kC=lb,Zt=vC,Gr=EC,$D=w(2,(e,{onLeft:t,onRight:n})=>Zt(e)?ie(t(e.left)):ae(n(e.right))),Xl=w(2,(e,t)=>Zt(e)?ie(t(e.left)):ae(e.right)),RD=w(2,(e,t)=>Gr(e)?ae(t(e.right)):ie(e.left)),un=w(2,(e,{onLeft:t,onRight:n})=>Zt(e)?t(e.left):n(e.right)),AD=un({onLeft:se,onRight:se}),TC=w(2,(e,t)=>{if(Gr(e))return e.right;throw t(e.left)}),qD=TC(()=>new Error("getOrThrow called on a Left")),CC=e=>e.length>0,IC=e=>(t,n)=>t===n?0:e(t,n),OD=IC((e,t)=>e<t?-1:1),$C=w(2,(e,t)=>IC((n,r)=>e(t(n),t(r)))),xD=e=>w(2,(t,n)=>e(t,n)===1),W=()=>ub,V=Jd,FD=cb,dt=yC,tt=bC,Qe=w(2,(e,{onNone:t,onSome:n})=>dt(e)?t():n(e.value)),ht=w(2,(e,t)=>dt(e)?t():e.value),Is=w(2,(e,t)=>dt(e)?t():e),PD=w(2,(e,t)=>dt(e)?V(t()):e),Vi=e=>e==null?W():V(e),dr=ht(rC),RC=e=>(...t)=>{try{return V(e(...t))}catch{return W()}},ci=w(2,(e,t)=>dt(e)?W():V(t(e.value))),Pc=w(2,(e,t)=>dt(e)?W():t(e.value)),DD=w(2,(e,t)=>dt(e)?W():Vi(t(e.value))),ND=Pc,MD=w(2,(e,t)=>ND(e,n=>t(n)?Jd(n):ub)),LD=e=>fo((t,n)=>dt(t)?dt(n):dt(n)?!1:e(t.value,n.value)),UD=e=>w(2,(t,n)=>dt(t)?!1:e(t.value,n)),jD=sb(),zD=UD(jD),BD=w(2,(e,t)=>dt(e)?!1:t(e.value)),yE=e=>(t,n)=>dt(t)?n:dt(n)?t:V(e(t.value,n.value)),HD=(...e)=>e,WD=e=>{const n=e[Symbol.iterator]().next();return n.done?W():V(n.value)},o_=e=>{const n=e[Symbol.iterator]().next();if(n.done)throw new Error("unsafeHead: empty iterable");return n.value},VD=w(2,(e,t)=>{let n=0;for(const r of e){const s=t(r,n);if(mi(s)){if(s)return V(r)}else if(tt(s))return s;n++}return W()}),KD={[Symbol.iterator](){return GD}},GD={next(){return{done:!0,value:void 0}}},QD=()=>KD,JD=w(2,(e,t)=>({[Symbol.iterator](){const n=e[Symbol.iterator]();let r=0;return{next(){let s=n.next();for(;!s.done;){if(t(s.value,r++))return{done:!1,value:s.value};s=n.next()}return{done:!0,value:void 0}}}}})),yp=e=>new Array(e),YD=w(2,(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r}),Ke=e=>Array.isArray(e)?e:Array.from(e),fb=e=>Array.isArray(e)?e:[e],XD=w(2,(e,{onEmpty:t,onNonEmpty:n})=>pt(e)?n(e):t()),ZD=w(2,(e,{onEmpty:t,onNonEmpty:n})=>pt(e)?n(On(e),yi(e)):t()),Yd=w(2,(e,t)=>[t,...e]),eN=w(2,(e,t)=>[...e,t]),db=w(2,(e,t)=>Ke(e).concat(Ke(t))),tN=Array.isArray,nN=e=>e.length===0,rN=nN,vd=CC,pt=CC,AC=(e,t)=>e<0||e>=t.length,sN=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),oN=w(2,(e,t)=>{const n=Math.floor(t);return AC(n,e)?W():V(e[n])}),qC=w(2,(e,t)=>{const n=Math.floor(t);if(AC(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),Vu=oN(0),On=qC(0),iN=e=>pt(e)?V(OC(e)):W(),OC=e=>e[e.length-1],yi=e=>e.slice(1),aN=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},xC=w(2,(e,t)=>PC(e,aN(e,t))),cN=w(2,(e,t)=>{const n=Ke(e);return n.slice(sN(t,n),n.length)}),uN=VD,bE=e=>Array.from(e).reverse(),cl=w(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),SE=w(2,(e,t)=>lN(e,t,HD)),lN=w(3,(e,t,n)=>{const r=Ke(e),s=Ke(t);if(pt(r)&&pt(s)){const o=[n(On(r),On(s))],a=Math.min(r.length,s.length);for(let u=1;u<a;u++)o[u]=n(r[u],s[u]);return o}return[]}),fN=e=>w(2,(t,n)=>{for(const r of t)if(e(n,r))return!0;return!1}),FC=sb(),PC=w(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return pt(n)?r>=1?dN(n,r):[[],n]:[n,[]]}),dN=w(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[xu(e),[]]:[Yd(e.slice(1,n),On(e)),e.slice(n)]}),hN=w(2,(e,t)=>xC(e,(n,r)=>!t(n,r))),xu=e=>e.slice(),pN=w(3,(e,t,n)=>{const r=Ke(e),s=Ke(t);return pt(r)?pt(s)?NC(n)(db(r,s)):r:s}),Ed=w(2,(e,t)=>pN(e,t,FC)),mN=e=>{const t=fN(e);return w(2,(n,r)=>Ke(n).filter(s=>t(r,s)))},gN=mN(FC),yo=()=>[],ur=e=>[e],ui=w(2,(e,t)=>e.map(t)),Xd=w(2,(e,t)=>{if(rN(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),_N=Xd(se),DC=w(2,(e,t)=>{const n=Ke(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);tt(o)&&r.push(o.value)}return r}),yN=w(2,(e,t)=>{const n=Ke(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),hb=w(3,(e,t,n)=>Ke(e).reduce((r,s,o)=>n(r,s,o),t)),wE=(e,t)=>{const n=[];let r=e,s;for(;tt(s=t(r));){const[o,a]=s.value;n.push(o),r=a}return n},Zl=z2,NC=w(2,(e,t)=>{const n=Ke(e);if(pt(n)){const r=[On(n)],s=yi(n);for(const o of s)r.every(a=>!t(o,a))&&r.push(o);return r}return[]}),bN=e=>NC(e,sb()),Dc=w(2,(e,t)=>Ke(e).join(t)),MC=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return MC(e,t.from)}},xr=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),pb=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},LC=e=>{try{return e.toISOString()}catch{return String(e)}},yr=(e,t=!0)=>{if(Array.isArray(e))return`[${e.map(n=>yr(n,t)).join(",")}]`;if(oC(e))return LC(e);if(X(e,"toString")&&Oc(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();if(Pn(e))return JSON.stringify(e);if(Fs(e)||e==null||mi(e)||Hd(e))return String(e);if(hp(e))return String(e)+"n";if(nb(e))return`${e.constructor.name}(${yr(Array.from(e),t)})`;try{t&&JSON.stringify(e);const n=`{${xr(e).map(s=>`${Pn(s)?JSON.stringify(s):String(s)}:${yr(e[s],!1)}`).join(",")}}`,r=e.constructor.name;return e.constructor!==Object.prototype.constructor?`${r}(${n})`:n}catch{return"<circular structure>"}},mb=e=>typeof e=="string"?JSON.stringify(e):String(e),UC=e=>Array.isArray(e),SN=e=>!Array.isArray(e),vE=e=>`[${mb(e)}]`,jC=e=>UC(e)?e.map(vE).join(""):vE(e),Hs=(e,t,n,r)=>{let s=e;return n&&pt(n)&&(s+=`
at path: ${jC(n)}`),t!==void 0&&(s+=`
details: ${t}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},zC=(e,t,n)=>Hs("Unsupported schema",e,t,n),wN=(e,t)=>zC("Cannot build an Equivalence",t,e),BC=(e,t,n)=>Hs("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,n),ul=e=>zC(void 0,void 0,e),vN=e=>Hs("Unsupported key schema",void 0,void 0,e),EN=e=>Hs("Unsupported literal",`literal value: ${yr(e)}`),EE=e=>Hs("Duplicate index signature",`${e} index signature`),kN=Hs("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),TN=Hs("Invalid element","A required element cannot follow an optional element. ts(1257)"),kE=e=>Hs("Duplicate property signature transformation",`Duplicate key ${yr(e)}`),HC=e=>Hs("Duplicate property signature",`Duplicate key ${yr(e)}`),CN=Symbol.for("effect/SchemaId/DateFromSelf"),IN=Symbol.for("effect/SchemaId/Int"),$N=Symbol.for("effect/SchemaId/Between"),Za=OD,Zd=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),WC=Symbol.for("effect/annotation/Brand"),RN=Symbol.for("effect/annotation/SchemaId"),VC=Symbol.for("effect/annotation/Message"),gb=Symbol.for("effect/annotation/MissingMessage"),_b=Symbol.for("effect/annotation/Identifier"),fs=Symbol.for("effect/annotation/Title"),Da=Symbol.for("effect/annotation/AutoTitle"),ef=Symbol.for("effect/annotation/Description"),KC=Symbol.for("effect/annotation/Examples"),GC=Symbol.for("effect/annotation/Default"),QC=Symbol.for("effect/annotation/JSONSchema"),JC=Symbol.for("effect/annotation/Arbitrary"),YC=Symbol.for("effect/annotation/Pretty"),yb=Symbol.for("effect/annotation/Equivalence"),AN=Symbol.for("effect/annotation/Documentation"),XC=Symbol.for("effect/annotation/Concurrency"),ZC=Symbol.for("effect/annotation/Batching"),eI=Symbol.for("effect/annotation/ParseIssueTitle"),tI=Symbol.for("effect/annotation/ParseOptions"),nI=Symbol.for("effect/annotation/DecodingFallback"),eh=Symbol.for("effect/annotation/Surrogate"),qN=Symbol.for("effect/annotation/StableFilter"),wn=w(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?V(e.annotations[t]):W()),rI=wn(WC),ON=wn(VC),xN=wn(gb),sI=wn(fs),oI=wn(Da),bp=wn(_b),iI=wn(ef),FN=wn(XC),PN=wn(ZC),DN=wn(eI),NN=wn(tI),MN=wn(nI),Nc=wn(eh),LN=wn(qN),UN=e=>BD(LN(e),t=>t===!0),Sp=Symbol.for("effect/annotation/JSONIdentifier"),jN=wn(Sp),zN=e=>Is(jN(e),()=>bp(e)),BN=Symbol.for("effect/schema/ParseJson");class wp{typeParameters;decodeUnknown;encodeUnknown;annotations;_tag="Declaration";constructor(t,n,r,s={}){this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return ht(ns(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:Qt(this.annotations)}}}const ds=e=>t=>t._tag===e;let th=class{literal;annotations;_tag="Literal";constructor(t,n={}){this.literal=t,this.annotations=n}toString(){return ht(ns(this),()=>yr(this.literal))}toJSON(){return{_tag:this._tag,literal:hp(this.literal)?String(this.literal):this.literal,annotations:Qt(this.annotations)}}};const Ku=ds("Literal"),HN=new th(null);class aI{symbol;annotations;_tag="UniqueSymbol";constructor(t,n={}){this.symbol=t,this.annotations=n}toString(){return ht(ns(this),()=>yr(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:Qt(this.annotations)}}}class WN{annotations;_tag="UndefinedKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const ec=new WN({[fs]:"undefined"});class VN{annotations;_tag="VoidKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const KN=new VN({[fs]:"void"});class GN{annotations;_tag="NeverKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const vp=new GN({[fs]:"never"}),QN=ds("NeverKeyword");class JN{annotations;_tag="UnknownKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const cI=new JN({[fs]:"unknown"});class YN{annotations;_tag="AnyKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const uI=new YN({[fs]:"any"});class XN{annotations;_tag="StringKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const i_=new XN({[fs]:"string",[ef]:"a string"}),a_=ds("StringKeyword");class ZN{annotations;_tag="NumberKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const c_=new ZN({[fs]:"number",[ef]:"a number"}),TE=ds("NumberKeyword");class e3{annotations;_tag="BooleanKeyword";constructor(t={}){this.annotations=t}toString(){return Fo(this)}toJSON(){return{_tag:this._tag,annotations:Qt(this.annotations)}}}const u_=new e3({[fs]:"boolean",[ef]:"a boolean"}),CE=ds("BooleanKeyword"),bb=ds("SymbolKeyword");let tf=class{type;annotations;constructor(t,n={}){this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:Qt(this.annotations)}}toString(){return String(this.type)}};class xo extends tf{isOptional;constructor(t,n,r={}){super(t,r),this.isOptional=n}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:Qt(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Ep=e=>e.map(t=>t.type);class nf{elements;rest;isReadonly;annotations;_tag="TupleType";constructor(t,n,r,s={}){this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,a=!1;for(const u of t)if(u.isOptional)o=!0;else if(o){a=!0;break}if(a||o&&n.length>1)throw new Error(TN)}toString(){return ht(ns(this),()=>t3(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:Qt(this.annotations)}}}const t3=e=>{const t=e.elements.map(String).join(", ");return ZD(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const a=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${a}]`:`readonly [...${o}[], ${a}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class kt extends xo{name;isReadonly;constructor(t,n,r,s,o){super(n,r,o),this.name=t,this.isReadonly=s}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:Qt(this.annotations)}}}const lI=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return lI(e.from)}return!1};class Mc{type;isReadonly;parameter;constructor(t,n,r){if(this.type=n,this.isReadonly=r,lI(t))this.parameter=t;else throw new Error(kN)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class br{annotations;_tag="TypeLiteral";propertySignatures;indexSignatures;constructor(t,n,r={}){this.annotations=r;const s={};for(let a=0;a<t.length;a++){const u=t[a].name;if(Object.prototype.hasOwnProperty.call(s,u))throw new Error(HC(u));s[u]=null}const o={string:!1,symbol:!1};for(let a=0;a<n.length;a++){const u=ll(n[a].parameter);if(a_(u)){if(o.string)throw new Error(EE("string"));o.string=!0}else if(bb(u)){if(o.symbol)throw new Error(EE("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return ht(ns(this),()=>n3(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:Qt(this.annotations)}}}const IE=e=>e.map(String).join("; "),n3=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${IE(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${IE(e.indexSignatures)} }`:"{}"},$E=ds("TypeLiteral"),r3=cl($C(Za,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),s3={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},fI=e=>Xd(e,t=>wb(t)?fI(t.types):[t]),o3=e=>{const t=r3(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[uI];case"UnknownKeyword":return[cI];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const a=typeof o.literal;switch(a){case"string":case"number":case"bigint":case"boolean":{const u=s3[a];!r[u]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n};let tn=class l_{types;annotations;static make=(t,n)=>Sb(t)?new l_(t,n):t.length===1?t[0]:vp;static unify=(t,n)=>l_.make(o3(fI(t)),n);_tag="Union";constructor(t,n={}){this.types=t,this.annotations=n}toString(){return ht(ns(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:Qt(this.annotations)}}};const i3=(e,t)=>e.map(t),Sb=e=>e.length>1,wb=ds("Union"),yg=Oe(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class bi{f;annotations;_tag="Suspend";constructor(t,n={}){this.f=t,this.annotations=n,this.f=pb(t)}toString(){return ns(this).pipe(Is(()=>Pc(RC(this.f)(),t=>ns(t))),ht(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=yg.get(t);return n||(yg.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:Qt(this.annotations)},yg.set(t,n),n)}}let rf=class{from;filter;annotations;_tag="Refinement";constructor(t,n,r={}){this.from=t,this.filter=n,this.annotations=r}toString(){return bp(this).pipe(ht(()=>Qe(yI(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:t=>Na(this.from)?String(this.from)+" & "+t:t})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:Qt(this.annotations)}}};const Na=ds("Refinement"),bg={};let gr=class{from;to;transformation;annotations;_tag="Transformation";constructor(t,n,r,s={}){this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return ht(ns(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:Qt(this.annotations)}}};const a3=ds("Transformation");class dI{decode;encode;_tag="FinalTransformation";constructor(t,n){this.decode=t,this.encode=n}}const c3=e=>t=>t._tag===e;class u3{_tag="ComposeTransformation"}const vb=new u3;let l3=class{from;to;decode;encode;constructor(t,n,r,s){this.from=t,this.to=n,this.decode=r,this.encode=s}};const f3=e=>e.decode===se&&e.encode===se;class nh{propertySignatureTransformations;_tag="TypeLiteralTransformation";constructor(t){this.propertySignatureTransformations=t;const n={},r={};for(const s of t){const o=s.from;if(n[o])throw new Error(kE(o));n[o]=!0;const a=s.to;if(r[a])throw new Error(kE(a));r[a]=!0}}}const f_=c3("TypeLiteralTransformation"),Si=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={...e.annotations,...t},s=Nc(e);return tt(s)&&(r[eh]=Si(s.value,t)),n.annotations.value=r,Object.create(Object.getPrototypeOf(e),n)},d3="[\\s\\S]*",h3="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",hI=(e,t)=>{switch(e._tag){case"Literal":return Zd(String(e.literal));case"StringKeyword":return d3;case"NumberKeyword":return h3;case"TemplateLiteral":return pI(e);case"Union":return e.types.map(n=>hI(n)).join("|")}},p3=(e,t,n,r)=>wb(e)?`(${t})`:t,pI=(e,t,n)=>{let r="";if(e.head!==""){const s=Zd(e.head);r+=s}for(const s of e.spans){const o=hI(s.type);if(r+=p3(s.type,o),s.literal!==""){const a=Zd(s.literal);r+=a}}return r},mI=e=>new RegExp(`^${pI(e)}$`),kd=e=>{const t=Nc(e);if(tt(t))return kd(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.slice();case"Suspend":return kd(e.f());case"Refinement":return kd(e.from)}return Jo(e).map(n=>ti(e,n))},Td=e=>{switch(e._tag){case"TupleType":{let t=!1,n=[];for(const r of e.elements)r.isOptional&&(t=!0),n.push(r.type);return t&&n.push(ec),n=n.concat(Ep(e.rest)),tn.make(n)}case"Refinement":return Td(e.from);case"Union":return tn.make(e.types.map(Td));case"Suspend":return Td(e.f())}throw new Error(ul(e))},gI=(e,t)=>{const n=uN(e.propertySignatures,r=>r.name===t);if(tt(n))return n.value;if(Pn(t)){let r;for(const s of e.indexSignatures){const o=ll(s.parameter);switch(o._tag){case"TemplateLiteral":{if(mI(o).test(t))return new kt(t,s.type,!1,!0);break}case"StringKeyword":r===void 0&&(r=new kt(t,s.type,!1,!0))}}if(r)return r}else if(Hd(t))for(const r of e.indexSignatures){const s=ll(r.parameter);if(bb(s))return new kt(t,r.type,!1,!0)}},ti=(e,t)=>{const n=Nc(e);if(tt(n))return ti(n.value,t);switch(e._tag){case"TypeLiteral":{const r=gI(e,t);if(r)return r;break}case"Union":return new kt(t,tn.make(e.types.map(r=>ti(r,t).type)),!1,!0);case"Suspend":return ti(e.f(),t);case"Refinement":return ti(e.from,t)}throw new Error(ul(e))},Jo=e=>{const t=Nc(e);if(tt(t))return Jo(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.map(n=>n.name);case"Union":return e.types.slice(1).reduce((n,r)=>gN(n,Jo(r)),Jo(e.types[0]));case"Suspend":return Jo(e.f());case"Refinement":return Jo(e.from);case"Transformation":return Jo(e.to)}return[]},RE=(e,t)=>{const n=[],r=[],s=o=>{switch(o._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new Mc(o,t,!0));break;case"Literal":if(Pn(o.literal)||Fs(o.literal))n.push(new kt(o.literal,t,!1,!0));else throw new Error(EN(o.literal));break;case"Enums":{for(const[a,u]of o.enums)n.push(new kt(u,t,!1,!0));break}case"UniqueSymbol":n.push(new kt(o.symbol,t,!1,!0));break;case"Union":o.types.forEach(s);break;default:throw new Error(vN(o))}};return s(e),{propertySignatures:n,indexSignatures:r}},vs=(e,t)=>{const n=Nc(e);if(tt(n))return vs(n.value,t);switch(e._tag){case"TypeLiteral":{const r=[],s={};for(const o of e.propertySignatures)s[o.name]=null,t.includes(o.name)&&r.push(o);for(const o of t)if(!(o in s)){const a=gI(e,o);a&&r.push(a)}return new br(r,[])}case"Union":return new br(t.map(r=>ti(e,r)),[]);case"Suspend":return vs(e.f(),t);case"Refinement":return vs(e.from,t);case"Transformation":switch(e.transformation._tag){case"ComposeTransformation":return new gr(vs(e.from,t),vs(e.to,t),vb);case"TypeLiteralTransformation":{const r=[],s=[];for(const o of t){const a=e.transformation.propertySignatureTransformations.find(u=>u.to===o);a?(r.push(a),s.push(a.from)):s.push(o)}return pt(r)?new gr(vs(e.from,s),vs(e.to,t),new nh(r)):vs(e.from,s)}}}throw new Error(ul(e))},Cd=e=>tn.make([e,ec]),Fu=(e,t)=>{switch(e._tag){case"TupleType":return new nf(e.elements.map(n=>new xo(Cd(n.type),!0)),XD(e.rest,{onEmpty:()=>e.rest,onNonEmpty:n=>[new tf(tn.make([...Ep(n),ec]))]}),e.isReadonly);case"TypeLiteral":return new br(e.propertySignatures.map(n=>new kt(n.name,Cd(n.type),!0,n.isReadonly,n.annotations)),e.indexSignatures.map(n=>new Mc(n.parameter,Cd(n.type),n.isReadonly)));case"Union":return tn.make(e.types.map(n=>Fu(n)));case"Suspend":return new bi(()=>Fu(e.f()));case"Declaration":case"Refinement":throw new Error(ul(e));case"Transformation":{if(f_(e.transformation)&&e.transformation.propertySignatureTransformations.every(f3))return new gr(Fu(e.from),Fu(e.to),e.transformation);throw new Error(ul(e))}}return e},ka=e=>{switch(e._tag){case"TupleType":return e.isReadonly===!1?e:new nf(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{const t=Rn(e.propertySignatures,r=>r.isReadonly===!1?r:new kt(r.name,r.type,r.isOptional,!1,r.annotations)),n=Rn(e.indexSignatures,r=>r.isReadonly===!1?r:new Mc(r.parameter,r.type,!1));return t===e.propertySignatures&&n===e.indexSignatures?e:new br(t,n,e.annotations)}case"Union":{const t=Rn(e.types,ka);return t===e.types?e:tn.make(t,e.annotations)}case"Suspend":return new bi(()=>ka(e.f()),e.annotations);case"Refinement":{const t=ka(e.from);return t===e.from?e:new rf(t,e.filter,e.annotations)}case"Transformation":{const t=ka(e.from),n=ka(e.to);return t===e.from&&n===e.to?e:new gr(t,n,e.transformation,e.annotations)}}return e},_I=e=>t=>{let n;for(const r of e)Object.prototype.hasOwnProperty.call(t.annotations,r)&&(n===void 0&&(n={}),n[r]=t.annotations[r]);return n},m3=e=>t=>{const n={...t.annotations};for(const r of e)delete n[r];return n},g3=_I([KC,GC,QC,JC,YC,yb]),Tt=e=>{switch(e._tag){case"Declaration":{const t=Rn(e.typeParameters,Tt);return t===e.typeParameters?e:new wp(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=Rn(e.elements,s=>{const o=Tt(s.type);return o===s.type?s:new xo(o,s.isOptional)}),n=Ep(e.rest),r=Rn(n,Tt);return t===e.elements&&r===n?e:new nf(t,r.map(s=>new tf(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=Rn(e.propertySignatures,r=>{const s=Tt(r.type);return s===r.type?r:new kt(r.name,s,r.isOptional,r.isReadonly)}),n=Rn(e.indexSignatures,r=>{const s=Tt(r.type);return s===r.type?r:new Mc(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new br(t,n,e.annotations)}case"Union":{const t=Rn(e.types,Tt);return t===e.types?e:tn.make(t,e.annotations)}case"Suspend":return new bi(()=>Tt(e.f()),e.annotations);case"Refinement":{const t=Tt(e.from);return t===e.from?e:new rf(t,e.filter,e.annotations)}case"Transformation":{const t=g3(e);return Tt(t!==void 0?Si(e.to,t):e.to)}}return e},_a=e=>Qe(zN(e),{onNone:()=>{},onSome:t=>({[Sp]:t})});function Rn(e,t){let n=!1;const r=yp(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=t(o);a!==o&&(n=!0),r[s]=a}return n?r:e}const Br=(e,t)=>{switch(e._tag){case"Declaration":{const n=Rn(e.typeParameters,r=>Br(r));return n===e.typeParameters?e:new wp(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=Rn(e.elements,o=>{const a=Br(o.type);return a===o.type?o:new xo(a,o.isOptional)}),r=Ep(e.rest),s=Rn(r,o=>Br(o));return n===e.elements&&s===r?e:new nf(n,s.map(o=>new tf(o)),e.isReadonly,_a(e))}case"TypeLiteral":{const n=Rn(e.propertySignatures,s=>{const o=Br(s.type);return o===s.type?s:new kt(s.name,o,s.isOptional,s.isReadonly)}),r=Rn(e.indexSignatures,s=>{const o=Br(s.type);return o===s.type?s:new Mc(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new br(n,r,_a(e))}case"Union":{const n=Rn(e.types,r=>Br(r));return n===e.types?e:tn.make(n,_a(e))}case"Suspend":return new bi(()=>Br(e.f()),_a(e));case"Refinement":{const n=Br(e.from),r=_a(e);return r?Si(n,r):n}case"Transformation":{const n=_a(e);return Br(n?Si(e.from,n):e.from)}}return e},d_=e=>Br(e),Qt=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},ll=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return ll(e.from)}},_3=(e,t)=>new gr(e,t,vb),Fo=e=>ht(ns(e),()=>e._tag);function y3(e){return Qe(rI(e),{onNone:()=>"",onSome:t=>t.map(n=>` & Brand<${yr(n)}>`).join("")})}const yI=e=>sI(e).pipe(Is(()=>iI(e)),Is(()=>oI(e)),ci(t=>t+y3(e))),ns=e=>Is(bp(e),()=>yI(e)),b3=(e,t,n)=>{switch(e._tag){case"UndefinedKeyword":return vp;case"Union":{const r=[];let s=!1;for(const o of e.types){const a=t(o);a?(s=!0,QN(a)||r.push(a)):r.push(o)}if(s)return tn.make(r);break}case"Suspend":return t(e.f());case"Transformation":return n(e)}},AE=Symbol.for("effect/Brand/Refined"),bI=()=>Object.assign(e=>e,{[AE]:AE,option:e=>V(e),either:e=>ae(e),is:e=>!0}),SI=Symbol.for("effect/Context/Tag"),rh=Symbol.for("effect/Context/Reference"),S3="effect/STM",w3=Symbol.for(S3),Eb={...Jl,_op:"Tag",[w3]:_i,[SI]:{_Service:e=>e,_Identifier:e=>e},toString(){return ut(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[Je](){return this.toJSON()},of(e){return e},context(e){return EI(this,e)}},v3={...Eb,[rh]:rh},E3=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(Eb);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},k3=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,Eb),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},T3=()=>(e,t)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,v3),s.key=e,s.defaultValue=t.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},wI=Symbol.for("effect/Context"),C3={[wI]:{_Services:e=>e},[pe](e){if(vI(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!ue(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[ge](){return Xe(this,rb(this.unsafeMap.size))},pipe(){return Z(this,arguments)},toString(){return ut(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(wt)}},[Je](){return this.toJSON()}},wi=e=>{const t=Object.create(C3);return t.unsafeMap=e,t},I3=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},vI=e=>X(e,wI),$3=e=>X(e,SI),R3=e=>X(e,rh),A3=wi(new Map),q3=()=>A3,EI=(e,t)=>wi(new Map([[e.key,t]])),O3=w(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),wi(r)}),Sg=Oe("effect/Context/defaultValueCache",()=>new Map),kb=e=>{if(Sg.has(e.key))return Sg.get(e.key);const t=e.defaultValue();return Sg.set(e.key,t),t},x3=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):kb(t),kI=w(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(rh in t)return kb(t);throw I3(t)}return e.unsafeMap.get(t.key)}),F3=kI,P3=w(2,(e,t)=>e.unsafeMap.has(t.key)?Jd(e.unsafeMap.get(t.key)):R3(t)?Jd(kb(t)):ub),D3=w(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return wi(n)}),N3=(...e)=>t=>{const n=new Map(t.unsafeMap);for(const r of e)n.delete(r.key);return wi(n)},Nn=E3,M3=vI,Tb=$3,vi=q3,kp=EI,Yn=O3,Zn=F3,Tp=kI,tr=P3,Po=D3,L3=N3,Cb=k3,Cp=T3,TI=Symbol.for("effect/Chunk");function U3(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const CI=[],j3=e=>fo((t,n)=>t.length===n.length&&Sr(t).every((r,s)=>e(r,$s(n,s)))),z3=j3(ue),B3={[TI]:{_A:e=>e},toString(){return ut(this.toJSON())},toJSON(){return{_id:"Chunk",values:Sr(this).map(wt)}},[Je](){return this.toJSON()},[pe](e){return Ip(e)&&z3(this,e)},[ge](){return Xe(this,Gl(Sr(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return CI[Symbol.iterator]();default:return Sr(this)[Symbol.iterator]()}},pipe(){return Z(this,arguments)}},Ot=e=>{const t=Object.create(B3);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=Rr,t.right=Rr;break}case"ISingleton":{t.length=1,t.depth=0,t.left=Rr,t.right=Rr;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=Rr,t.right=Rr;break}}return t},Ip=e=>X(e,TI),Rr=Ot({_tag:"IEmpty"}),ot=()=>Rr,wg=(...e)=>K3(e),mt=e=>Ot({_tag:"ISingleton",a:e}),Ei=e=>Ip(e)?e:Ft(Ke(e)),h_=(e,t,n)=>{switch(e.backing._tag){case"IArray":{U3(e.backing.array,0,t,n,e.length);break}case"IConcat":{h_(e.left,t,n),h_(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=$s(e,r),r+=1,s+=1;break}}},H3=e=>{switch(e.backing._tag){case"IEmpty":return CI;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return h_(e,t,0),e.backing={_tag:"IArray",array:t},e.left=Rr,e.right=Rr,e.depth=0,t}}},Sr=H3,W3=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Ot({_tag:"IArray",array:bE(e.backing.array)});case"IConcat":return Ot({_tag:"IConcat",left:Ps(e.backing.right),right:Ps(e.backing.left)});case"ISlice":return Ft(bE(Sr(e)))}},Ps=W3,V3=w(2,(e,t)=>t<0||t>=e.length?W():V($s(e,t))),Ft=e=>e.length===0?ot():e.length===1?mt(e[0]):Ot({_tag:"IArray",array:e}),K3=e=>Ft(e),$s=w(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?$s(e.left,t):$s(e.right,t-e.left.length);case"ISlice":return $s(e.backing.chunk,t+e.backing.offset)}}),fl=w(2,(e,t)=>ft(e,mt(t))),pn=w(2,(e,t)=>ft(mt(t),e)),tc=w(2,(e,t)=>{if(t<=0)return Rr;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return Ot({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?Ot({_tag:"IConcat",left:e.left,right:tc(e.right,t-e.left.length)}):tc(e.left,t);default:return Ot({_tag:"ISlice",chunk:e,offset:0,length:t})}}),Qr=w(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return Rr;switch(e.backing._tag){case"ISlice":return Ot({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?Qr(e.right,t-e.left.length):Ot({_tag:"IConcat",left:Qr(e.left,t),right:e.right});default:return Ot({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),ft=w(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return Ot({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=ft(e.right,t);return Ot({_tag:"IConcat",left:e.left,right:r})}else{const r=ft(e.right.right,t);if(r.depth===e.depth-3){const s=Ot({_tag:"IConcat",left:e.right.left,right:r});return Ot({_tag:"IConcat",left:e.left,right:s})}else{const s=Ot({_tag:"IConcat",left:e.left,right:e.right.left});return Ot({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=ft(e,t.left);return Ot({_tag:"IConcat",left:r,right:t.right})}else{const r=ft(e,t.left.left);if(r.depth===t.depth-3){const s=Ot({_tag:"IConcat",left:r,right:t.left.right});return Ot({_tag:"IConcat",left:s,right:t.right})}else{const s=Ot({_tag:"IConcat",left:t.left.right,right:t.right});return Ot({_tag:"IConcat",left:r,right:s})}}}),II=w(2,(e,t)=>Ft(DC(e,t))),$p=w(2,(e,t)=>Ft(yN(e,t))),Rp=e=>e.length===0,rs=e=>e.length>0,Ap=V3(0),qp=e=>$s(e,0),Jr=qp,$I=w(2,(e,t)=>e.backing._tag==="ISingleton"?mt(t(e.backing.a,0)):Ft(k(Sr(e),ui((n,r)=>t(n,r))))),RI=w(2,(e,t)=>[tc(e,t),Qr(e,t)]),G3=w(2,(e,t)=>{let n=0;for(const r of Sr(e)){if(t(r))break;n++}return RI(e,n)}),ks=e=>Qr(e,1),Q3=w(2,(e,t)=>Qr(e,e.length-t)),J3=hb,p_=Symbol.for("effect/Duration"),AI=BigInt(0),qE=BigInt(24),td=BigInt(60),m_=BigInt(1e3),OE=BigInt(1e6),xE=BigInt(1e9),Y3=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,nr=e=>{if(qI(e))return e;if(Fs(e))return ki(e);if(hp(e))return vg(e);if(Array.isArray(e)&&e.length===2&&e.every(Fs))return e[0]===-1/0||e[1]===-1/0||Number.isNaN(e[0])||Number.isNaN(e[1])?Ib:e[0]===1/0||e[1]===1/0?tM:vg(BigInt(Math.round(e[0]*1e9))+BigInt(Math.round(e[1])));if(Pn(e)){const t=Y3.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return vg(BigInt(r));case"micro":case"micros":return nM(BigInt(r));case"milli":case"millis":return ki(o);case"second":case"seconds":return sh(o);case"minute":case"minutes":return OI(o);case"hour":case"hours":return rM(o);case"day":case"days":return sM(o);case"week":case"weeks":return oM(o)}}}throw new Error("Invalid DurationInput")},FE={_tag:"Millis",millis:0},X3={_tag:"Infinity"},Z3={[p_]:p_,[ge](){return Xe(this,fC(this.value))},[pe](e){return qI(e)&&dM(this,e)},toString(){return`Duration(${PI(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:aM(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},Bn=e=>{const t=Object.create(Z3);return Fs(e)?isNaN(e)||e<=0?t.value=FE:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=X3:e<=AI?t.value=FE:t.value={_tag:"Nanos",nanos:e},t},qI=e=>X(e,p_),eM=e=>{switch(e.value._tag){case"Millis":return e.value.millis===0;case"Nanos":return e.value.nanos===AI;case"Infinity":return!1}},Ib=Bn(0),tM=Bn(1/0),vg=e=>Bn(e),nM=e=>Bn(e*m_),ki=e=>Bn(e),sh=e=>Bn(e*1e3),OI=e=>Bn(e*6e4),rM=e=>Bn(e*36e5),sM=e=>Bn(e*864e5),oM=e=>Bn(e*6048e5),nc=e=>xI(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),iM=e=>{const t=nr(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},aM=e=>{const t=nr(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/xE),Number(t.value.nanos%xE)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},xI=w(2,(e,t)=>{const n=nr(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),Op=w(3,(e,t,n)=>{const r=nr(e),s=nr(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(nc(r),nc(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),a=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,a)}return n.onMillis(r.value.millis,s.value.millis)}),cM=(e,t)=>Op(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),uM=w(2,(e,t)=>xI(e,{onMillis:n=>Bn(n*t),onNanos:n=>Bn(n*BigInt(t))})),lM=w(2,(e,t)=>Op(e,t,{onMillis:(n,r)=>Bn(n+r),onNanos:(n,r)=>Bn(n+r)})),FI=w(2,(e,t)=>Op(e,t,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),fM=w(2,(e,t)=>Op(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),dM=w(2,(e,t)=>cM(nr(e),nr(t))),hM=e=>{const t=nr(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=iM(t),r=n/OE,s=r/m_,o=s/td,a=o/td,u=a/qE;return{days:Number(u),hours:Number(a%qE),minutes:Number(o%td),seconds:Number(s%td),millis:Number(r%m_),nanos:Number(n%OE)}},PI=e=>{const t=nr(e);if(t.value._tag==="Infinity")return"Infinity";if(eM(t))return"0";const n=hM(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},Ti=5,$b=Math.pow(2,Ti),pM=$b-1,mM=$b/2,gM=$b/4;function _M(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function rc(e,t){return t>>>e&pM}function Ra(e){return 1<<e}function DI(e,t){return _M(e&t-1)}const yM=(e,t)=>({value:e,previous:t});function Ma(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let a=0;a<o;++a)s[a]=r[a]}return s[t]=n,s}function NI(e,t,n){const r=n.length-1;let s=0,o=0,a=n;if(e)s=o=t;else for(a=new Array(r);s<t;)a[o++]=n[s++];for(++s;s<=r;)a[o++]=n[s++];return e&&(a.length=r),a}function bM(e,t,n,r){const s=r.length;if(e){let f=s;for(;f>=t;)r[f--]=r[f];return r[t]=n,r}let o=0,a=0;const u=new Array(s+1);for(;o<t;)u[a++]=r[o++];for(u[t]=n;o<s;)u[++a]=r[o++];return u}class bo{_tag="EmptyNode";modify(t,n,r,s,o,a){const u=r(W());return dt(u)?new bo:(++a.value,new li(t,s,o,u))}}function qr(e){return tb(e,"EmptyNode")}function SM(e){return qr(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function xp(e,t){return qr(e)?!1:t===e.edit}class li{edit;hash;key;value;_tag="LeafNode";constructor(t,n,r,s){this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,a){if(ue(o,this.key)){const f=r(this.value);return f===this.value?this:dt(f)?(--a.value,new bo):xp(this,t)?(this.value=f,this):new li(t,s,o,f)}const u=r(W());return dt(u)?this:(++a.value,MI(t,n,this.hash,this,s,new li(t,s,o,u)))}}class Rb{edit;hash;children;_tag="CollisionNode";constructor(t,n,r){this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,a){if(s===this.hash){const f=xp(this,t),h=this.updateCollisionList(f,t,this.hash,this.children,r,o,a);return h===this.children?this:h.length>1?new Rb(t,this.hash,h):h[0]}const u=r(W());return dt(u)?this:(++a.value,MI(t,n,this.hash,this,s,new li(t,s,o,u)))}updateCollisionList(t,n,r,s,o,a,u){const f=s.length;for(let p=0;p<f;++p){const m=s[p];if("key"in m&&ue(a,m.key)){const T=m.value,C=o(T);return C===T?s:dt(C)?(--u.value,NI(t,p,s)):Ma(t,p,new li(n,r,a,C),s)}}const h=o(W());return dt(h)?s:(++u.value,Ma(t,f,new li(n,r,a,h),s))}}class sc{edit;mask;children;_tag="IndexedNode";constructor(t,n,r){this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,a){const u=this.mask,f=this.children,h=rc(n,s),p=Ra(h),m=DI(u,p),T=u&p,C=xp(this,t);if(!T){const _=new bo().modify(t,n+Ti,r,s,o,a);return _?f.length>=mM?vM(t,h,_,u,f):new sc(t,u|p,bM(C,m,_,f)):this}const A=f[m],D=A.modify(t,n+Ti,r,s,o,a);if(A===D)return this;let y=u,b;if(qr(D)){if(y&=~p,!y)return new bo;if(f.length<=2&&SM(f[m^1]))return f[m^1];b=NI(C,m,f)}else b=Ma(C,m,D,f);return C?(this.mask=y,this.children=b,this):new sc(t,y,b)}}class Ab{edit;size;children;_tag="ArrayNode";constructor(t,n,r){this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,a){let u=this.size;const f=this.children,h=rc(n,s),p=f[h],m=(p||new bo).modify(t,n+Ti,r,s,o,a);if(p===m)return this;const T=xp(this,t);let C;if(qr(p)&&!qr(m))++u,C=Ma(T,h,m,f);else if(!qr(p)&&qr(m)){if(--u,u<=gM)return wM(t,u,h,f);C=Ma(T,h,new bo,f)}else C=Ma(T,h,m,f);return T?(this.size=u,this.children=C,this):new Ab(t,u,C)}}function wM(e,t,n,r){const s=new Array(t-1);let o=0,a=0;for(let u=0,f=r.length;u<f;++u)if(u!==n){const h=r[u];h&&!qr(h)&&(s[o++]=h,a|=1<<u)}return new sc(e,a,s)}function vM(e,t,n,r,s){const o=[];let a=r,u=0;for(let f=0;a;++f)a&1&&(o[f]=s[u++]),a>>>=1;return o[t]=n,new Ab(e,u+1,o)}function EM(e,t,n,r,s,o){if(n===s)return new Rb(e,n,[o,r]);const a=rc(t,n),u=rc(t,s);if(a===u)return f=>new sc(e,Ra(a)|Ra(u),[f]);{const f=a<u?[r,o]:[o,r];return new sc(e,Ra(a)|Ra(u),f)}}function MI(e,t,n,r,s,o){let a,u=t;for(;;){const f=EM(e,u,n,r,s,o);if(typeof f=="function")a=yM(f,a),u=u+Ti;else{let h=f;for(;a!=null;)h=a.value(h),a=a.previous;return h}}}const LI="effect/HashMap",g_=Symbol.for(LI),kM={[g_]:g_,[Symbol.iterator](){return new Fp(this,(e,t)=>[e,t])},[ge](){let e=G(LI);for(const t of this)e^=k(G(t[0]),le(G(t[1])));return Xe(this,e)},[pe](e){if(IM(e)){if(e._size!==this._size)return!1;for(const t of this){const n=k(e,Ob(t[0],G(t[0])));if(dt(n))return!1;if(!ue(t[1],n.value))return!1}return!0}return!1},toString(){return ut(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(wt)}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},qb=(e,t,n,r)=>{const s=Object.create(kM);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class Fp{map;f;v;constructor(t,n){this.map=t,this.f=n,this.v=UI(this.map._root,this.f,void 0)}next(){if(dt(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=oh(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new Fp(this.map,this.f)}}const oh=e=>e?jI(e[0],e[1],e[2],e[3],e[4]):W(),UI=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return tt(e.value)?V({value:t(e.key,e.value.value),cont:n}):oh(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return jI(r.length,r,0,t,n)}default:return oh(n)}},jI=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!qr(o))return UI(o,r,[e,t,n,r,s])}return oh(s)},TM=qb(!1,0,new bo,0),Pp=()=>TM,CM=e=>{const t=BI(Pp());for(const n of e)dl(t,n[0],n[1]);return OM(t)},IM=e=>X(e,g_),$M=e=>e&&qr(e._root),RM=w(2,(e,t)=>Ob(e,t,G(t))),Ob=w(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return ue(t,r.key)?r.value:W();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let a=0,u=o.length;a<u;++a){const f=o[a];if("key"in f&&ue(t,f.key))return f.value}}return W()}case"IndexedNode":{const o=rc(s,n),a=Ra(o);if(r.mask&a){r=r.children[DI(r.mask,a)],s+=Ti;break}return W()}case"ArrayNode":{if(r=r.children[rc(s,n)],r){s+=Ti;break}return W()}default:return W()}}),AM=w(2,(e,t)=>tt(Ob(e,t,G(t)))),dl=w(3,(e,t,n)=>xb(e,t,()=>V(n))),qM=w(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:qb(e._editable,e._edit,t,n)),zI=e=>new Fp(e,t=>t),ih=e=>e._size,BI=e=>qb(!0,e._edit+1,e._root,e._size),OM=e=>(e._editable=!1,e),xb=w(3,(e,t,n)=>xM(e,t,G(t),n)),xM=w(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return k(e,qM(o,s.value))}),PE=w(2,(e,t)=>xb(e,t,W)),FM=w(2,(e,t)=>Dp(e,Pp(),(n,r,s)=>dl(n,s,t(r,s)))),HI=w(2,(e,t)=>Dp(e,void 0,(n,r,s)=>t(r,s))),Dp=w(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return tt(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let a=0,u=o.length;a<u;){const f=o[a++];f&&!qr(f)&&(f._tag==="LeafNode"?tt(f.value)&&(t=n(t,f.value.value,f.key)):s.push(f.children))}return t}),WI="effect/HashSet",__=Symbol.for(WI),PM={[__]:__,[Symbol.iterator](){return zI(this._keyMap)},[ge](){return Xe(this,le(G(this._keyMap))(G(WI)))},[pe](e){return DM(e)?ih(this._keyMap)===ih(e._keyMap)&&ue(this._keyMap,e._keyMap):!1},toString(){return ut(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(wt)}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},Np=e=>{const t=Object.create(PM);return t._keyMap=e,t},DM=e=>X(e,__),NM=Np(Pp()),Mp=()=>NM,MM=e=>{const t=Fb(Mp());for(const n of e)hl(t,n);return Pb(t)},LM=(...e)=>{const t=Fb(Mp());for(const n of e)hl(t,n);return Pb(t)},UM=w(2,(e,t)=>AM(e._keyMap,t)),jM=e=>ih(e._keyMap),Fb=e=>Np(BI(e._keyMap)),Pb=e=>(e._keyMap._editable=!1,e),VI=w(2,(e,t)=>{const n=Fb(e);return t(n),Pb(n)}),hl=w(2,(e,t)=>e._keyMap._editable?(dl(t,!0)(e._keyMap),e):Np(dl(t,!0)(e._keyMap))),KI=w(2,(e,t)=>e._keyMap._editable?(PE(t)(e._keyMap),e):Np(PE(t)(e._keyMap))),zM=w(2,(e,t)=>VI(e,n=>{for(const r of t)KI(n,r)})),BM=w(2,(e,t)=>VI(Mp(),n=>{HM(e,r=>hl(n,r));for(const r of t)hl(n,r)})),HM=w(2,(e,t)=>HI(e._keyMap,(n,r)=>t(r))),WM=w(3,(e,t,n)=>Dp(e._keyMap,t,(r,s,o)=>n(r,o))),Ci=Mp,VM=MM,Lp=LM,Db=UM,Nb=jM,La=hl,Mb=KI,DE=zM,pl=BM,ml=WM,NE=Symbol.for("effect/MutableRef"),KM={[NE]:NE,toString(){return ut(this.toJSON())},toJSON(){return{_id:"MutableRef",current:wt(this.current)}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},Ki=e=>{const t=Object.create(KM);return t.current=e,t},GM=w(3,(e,t,n)=>ue(t,e.current)?(e.current=n,!0):!1),Me=e=>e.current,Gi=w(2,(e,t)=>(e.current=t,e)),Up="effect/FiberId",Ii=Symbol.for(Up),oc="None",y_="Runtime",b_="Composite",QM=Pt(`${Up}-${oc}`);let JM=class{[Ii]=Ii;_tag=oc;id=-1;startTimeMillis=-1;[ge](){return QM}[pe](t){return Ub(t)&&t._tag===oc}toString(){return ut(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[Je](){return this.toJSON()}};class Lb{id;startTimeMillis;[Ii]=Ii;_tag=y_;constructor(t,n){this.id=t,this.startTimeMillis=n}[ge](){return Xe(this,Pt(`${Up}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[pe](t){return Ub(t)&&t._tag===y_&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return ut(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[Je](){return this.toJSON()}}let GI=class{left;right;[Ii]=Ii;_tag=b_;constructor(t,n){this.left=t,this.right=n}_hash;[ge](){return k(Pt(`${Up}-${this._tag}`),le(G(this.left)),le(G(this.right)),Xe(this))}[pe](t){return Ub(t)&&t._tag===b_&&ue(this.left,t.left)&&ue(this.right,t.right)}toString(){return ut(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:wt(this.left),right:wt(this.right)}}[Je](){return this.toJSON()}};const QI=new JM,YM=(e,t)=>new Lb(e,t),XM=(e,t)=>new GI(e,t),Ub=e=>X(e,Ii),JI=w(2,(e,t)=>e._tag===oc?t:t._tag===oc?e:new GI(e,t)),ZM=e=>k(e,ml(QI,(t,n)=>JI(n)(t))),ah=e=>{switch(e._tag){case oc:return Ci();case y_:return Lp(e.id);case b_:return k(ah(e.left),pl(ah(e.right)))}},ME=Oe(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Ki(0)),eL=(e,t)=>new Lb(e,t),jp=e=>Array.from(ah(e)).map(n=>`#${n}`).join(","),tL=()=>{const e=Me(ME);return k(ME,Gi(e+1)),new Lb(e,Date.now())},wr=QI,nL=YM,rL=XM,ho=JI,sL=ZM,jb=ah,YI=eL,oL=jp,XI=tL,zp=Pp,iL=CM,aL=$M,ZI=RM,ch=dl,e$=zI,t$=ih,cL=xb,uL=FM,lL=HI,n$=Dp,gl=Symbol.for("effect/List"),S_=e=>Ke(e),fL=e=>sC(Zl(e),S_),dL=fL(ue),hL={[gl]:gl,_tag:"Cons",toString(){return ut(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:S_(this).map(wt)}},[Je](){return this.toJSON()},[pe](e){return s$(e)&&this._tag===e._tag&&dL(this,e)},[ge](){return Xe(this,Gl(S_(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return Z(this,arguments)}},uh=(e,t)=>{const n=Object.create(hL);return n.head=e,n.tail=t,n},pL=Pt("Nil"),mL={[gl]:gl,_tag:"Nil",toString(){return ut(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[Je](){return this.toJSON()},[ge](){return pL},[pe](e){return s$(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return Z(this,arguments)}},r$=Object.create(mL),s$=e=>X(e,gl),Rs=e=>e._tag==="Nil",zb=e=>e._tag==="Cons",gL=()=>r$,$i=(e,t)=>uh(e,t),ic=gL,Bb=e=>uh(e,r$),_L=w(2,(e,t)=>bL(t,e)),yL=w(2,(e,t)=>$i(t,e)),bL=w(2,(e,t)=>{if(Rs(e))return t;if(Rs(t))return e;{const n=uh(t.head,e);let r=n,s=t.tail;for(;!Rs(s);){const o=uh(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),SL=w(3,(e,t,n)=>{let r=t,s=e;for(;!Rs(s);)r=n(r,s.head),s=s.tail;return r}),wL=e=>{let t=ic(),n=e;for(;!Rs(n);)t=yL(t,n.head),n=n.tail;return t},Bp=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=ab,e}(),vL=Symbol.for("effect/DifferContextPatch");function LE(e){return e}const sf={...Bp.prototype,[vL]:{_Value:LE,_Patch:LE}},EL=Object.assign(Object.create(sf),{_tag:"Empty"}),kL=Object.create(EL),o$=()=>kL,TL=Object.assign(Object.create(sf),{_tag:"AndThen"}),CL=(e,t)=>{const n=Object.create(TL);return n.first=e,n.second=t,n},IL=Object.assign(Object.create(sf),{_tag:"AddService"}),$L=(e,t)=>{const n=Object.create(IL);return n.key=e,n.service=t,n},RL=Object.assign(Object.create(sf),{_tag:"RemoveService"}),AL=e=>{const t=Object.create(RL);return t.key=e,t},qL=Object.assign(Object.create(sf),{_tag:"UpdateService"}),OL=(e,t)=>{const n=Object.create(qL);return n.key=e,n.update=t,n},xL=(e,t)=>{const n=new Map(e.unsafeMap);let r=o$();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const a=n.get(s);n.delete(s),ue(a,o)||(r=Id(OL(s,()=>o))(r))}else n.delete(s),r=Id($L(s,o))(r);for(const[s]of n.entries())r=Id(AL(s))(r);return r},Id=w(2,(e,t)=>CL(e,t)),FL=w(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=mt(e);const s=new Map(t.unsafeMap);for(;rs(r);){const a=Jr(r),u=ks(r);switch(a._tag){case"Empty":{r=u;break}case"AddService":{s.set(a.key,a.service),r=u;break}case"AndThen":{r=pn(pn(u,a.second),a.first);break}case"RemoveService":{s.delete(a.key),r=u;break}case"UpdateService":{s.set(a.key,a.update(s.get(a.key))),n=!0,r=u;break}}}if(!n)return wi(s);const o=new Map;for(const[a]of t.unsafeMap)s.has(a)&&(o.set(a,s.get(a)),s.delete(a));for(const[a,u]of s)o.set(a,u);return wi(o)}),PL=Symbol.for("effect/DifferHashSetPatch");function Eg(e){return e}const Hp={...Bp.prototype,[PL]:{_Value:Eg,_Key:Eg,_Patch:Eg}},DL=Object.assign(Object.create(Hp),{_tag:"Empty"}),NL=Object.create(DL),i$=()=>NL,ML=Object.assign(Object.create(Hp),{_tag:"AndThen"}),LL=(e,t)=>{const n=Object.create(ML);return n.first=e,n.second=t,n},UL=Object.assign(Object.create(Hp),{_tag:"Add"}),jL=e=>{const t=Object.create(UL);return t.value=e,t},zL=Object.assign(Object.create(Hp),{_tag:"Remove"}),BL=e=>{const t=Object.create(zL);return t.value=e,t},HL=(e,t)=>{const[n,r]=ml([e,i$()],([s,o],a)=>Db(a)(s)?[Mb(a)(s),o]:[s,w_(jL(a))(o)])(t);return ml(r,(s,o)=>w_(BL(o))(s))(n)},w_=w(2,(e,t)=>LL(e,t)),WL=w(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=mt(e);for(;rs(r);){const s=Jr(r),o=ks(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=pn(s.first)(pn(s.second)(o));break}case"Add":{n=La(s.value)(n),r=o;break}case"Remove":n=Mb(s.value)(n),r=o}}return n}),VL=Symbol.for("effect/DifferReadonlyArrayPatch");function UE(e){return e}const of={...Bp.prototype,[VL]:{_Value:UE,_Patch:UE}},KL=Object.assign(Object.create(of),{_tag:"Empty"}),GL=Object.create(KL),a$=()=>GL,QL=Object.assign(Object.create(of),{_tag:"AndThen"}),JL=(e,t)=>{const n=Object.create(QL);return n.first=e,n.second=t,n},YL=Object.assign(Object.create(of),{_tag:"Append"}),XL=e=>{const t=Object.create(YL);return t.values=e,t},ZL=Object.assign(Object.create(of),{_tag:"Slice"}),eU=(e,t)=>{const n=Object.create(ZL);return n.from=e,n.until=t,n},tU=Object.assign(Object.create(of),{_tag:"Update"}),nU=(e,t)=>{const n=Object.create(tU);return n.index=e,n.patch=t,n},rU=e=>{let t=0,n=a$();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);ue(o,e.differ.empty)||(n=$d(n,nU(t,o))),t=t+1}return t<e.oldValue.length&&(n=$d(n,eU(0,t))),t<e.newValue.length&&(n=$d(n,XL(cN(t)(e.newValue)))),n},$d=w(2,(e,t)=>JL(e,t)),sU=w(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=ur(e);for(;vd(s);){const o=On(s),a=yi(s);switch(o._tag){case"Empty":{s=a;break}case"AndThen":{a.unshift(o.first,o.second),s=a;break}case"Append":{for(const u of o.values)r.push(u);s=a;break}case"Slice":{r=r.slice(o.from,o.until),s=a;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=a;break}}}return r}),oU=Symbol.for("effect/Differ"),iU={[oU]:{_P:se,_V:se},pipe(){return Z(this,arguments)}},Lc=e=>{const t=Object.create(iU);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},aU=()=>Lc({empty:o$(),combine:(e,t)=>Id(t)(e),diff:(e,t)=>xL(e,t),patch:(e,t)=>FL(t)(e)}),cU=()=>Lc({empty:i$(),combine:(e,t)=>w_(t)(e),diff:(e,t)=>HL(e,t),patch:(e,t)=>WL(t)(e)}),uU=e=>Lc({empty:a$(),combine:(t,n)=>$d(t,n),diff:(t,n)=>rU({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>sU(t,n,e)}),c$=()=>lU((e,t)=>t),lU=e=>Lc({empty:se,combine:(t,n)=>t===se?n:n===se?t:r=>n(t(r)),diff:(t,n)=>ue(t,n)?se:fp(n),patch:(t,n)=>e(n,t(n))}),_l=255,u$=8,v_=e=>e&_l,E_=e=>e>>u$&_l,af=(e,t)=>(e&_l)+((t&e&_l)<<u$),fU=af(0,0),dU=e=>af(e,e),hU=e=>af(e,0),pU=w(2,(e,t)=>af(v_(e)&~t,E_(e))),mU=w(2,(e,t)=>e|t),gU=e=>~e>>>0&_l,_U=0,Uc=1,yU=2,l$=4,k_=16,f$=32,bU=e=>Wp(e,f$),SU=w(2,(e,t)=>e|t),to=e=>d$(e)&&!vU(e),d$=e=>Wp(e,Uc),Wp=w(2,(e,t)=>(e&t)!==0),h$=(...e)=>e.reduce((t,n)=>t|n,0),wU=h$(_U),jE=e=>Wp(e,l$),vU=e=>Wp(e,k_),fi=w(2,(e,t)=>af(e^t,t)),Ua=w(2,(e,t)=>e&(gU(v_(t))|E_(t))|v_(t)&E_(t)),zE=Lc({empty:fU,diff:(e,t)=>fi(e,t),combine:(e,t)=>mU(t)(e),patch:(e,t)=>Ua(t,e)}),EU=dU,p$=hU,BE=pU,m$=(e,t)=>({_tag:"Par",left:e,right:t}),nd=(e,t)=>({_tag:"Seq",left:e,right:t}),kU=e=>{let t=Bb(e),n=ic();for(;;){const[r,s]=SL(t,[g$(),ic()],([o,a],u)=>{const[f,h]=TU(u);return[AU(o,f),_L(a,h)]});if(n=CU(n,r),Rs(s))return wL(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},TU=e=>{let t=e,n=g$(),r=ic(),s=ic();for(;;)switch(t._tag){case"Empty":{if(Rs(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=$i(t.right,r),t=t.left;break}case"Seq":{const o=t.left,a=t.right;switch(o._tag){case"Empty":{t=a;break}case"Par":{const u=o.left,f=o.right;t=m$(nd(u,a),nd(f,a));break}case"Seq":{const u=o.left,f=o.right;t=nd(u,nd(f,a));break}case"Single":{t=o,s=$i(a,s);break}}break}case"Single":{if(n=RU(n,t),Rs(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},CU=(e,t)=>{if(Rs(e))return Bb(kg(t));if(qU(t))return e;const n=NU(e.head),r=OU(t);return n.length===1&&r.length===1&&ue(n[0],r[0])?$i(DU(e.head,kg(t)),e.tail):$i(kg(t),e)},IU=Symbol.for("effect/RequestBlock/RequestBlockParallel"),$U={_R:e=>e};class Hb{map;[IU]=$U;constructor(t){this.map=t}}const g$=()=>new Hb(zp()),RU=(e,t)=>new Hb(cL(e.map,t.dataSource,n=>PD(ci(n,fl(t.blockedRequest)),()=>mt(t.blockedRequest)))),AU=(e,t)=>new Hb(n$(e.map,t.map,(n,r,s)=>ch(n,s,Qe(ZI(n,s),{onNone:()=>r,onSome:o=>ft(r,o)})))),qU=e=>aL(e.map),OU=e=>Array.from(e$(e.map)),kg=e=>PU(uL(e.map,t=>mt(t))),xU=Symbol.for("effect/RequestBlock/RequestBlockSequential"),FU={_R:e=>e};class _${map;[xU]=FU;constructor(t){this.map=t}}const PU=e=>new _$(e),DU=(e,t)=>new _$(n$(t.map,e.map,(n,r,s)=>ch(n,s,Qe(ZI(n,s),{onNone:()=>ot(),onSome:o=>ft(o,r)})))),NU=e=>Array.from(e$(e.map)),MU=e=>Array.from(e.map),jc="Die",Ri="Empty",Qi="Fail",zc="Interrupt",ac="Parallel",cc="Sequential",y$="effect/Cause",b$=Symbol.for(y$),LU={_E:e=>e},Bc={[b$]:LU,[ge](){return k(G(y$),le(G(QU(this))),Xe(this))},[pe](e){return Wb(e)&&GU(this,e)},pipe(){return Z(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:wt(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:wt(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:wt(this.left),right:wt(this.right)}}},toString(){return Do(this)},[Je](){return this.toJSON()}},Ds=(()=>{const e=Object.create(Bc);return e._tag=Ri,e})(),Ai=e=>{const t=Object.create(Bc);return t._tag=Qi,t.error=e,t},xn=e=>{const t=Object.create(Bc);return t._tag=jc,t.defect=e,t},hr=e=>{const t=Object.create(Bc);return t._tag=zc,t.fiberId=e,t},Ns=(e,t)=>{const n=Object.create(Bc);return n._tag=ac,n.left=e,n.right=t,n},Kt=(e,t)=>{const n=Object.create(Bc);return n._tag=cc,n.left=e,n.right=t,n},Wb=e=>X(e,b$),UU=e=>e._tag===Ri,jU=e=>e._tag===Qi,Vb=e=>e._tag===jc,Kb=e=>e._tag===Ri?!0:uc(e,!0,(t,n)=>{switch(n._tag){case Ri:return V(t);case jc:case Qi:case zc:return V(!1);default:return W()}}),Gb=e=>tt(HU(e)),Vp=e=>Qp(void 0,YU)(e),zU=e=>Ps(uc(e,ot(),(t,n)=>n._tag===Qi?V(k(t,pn(n.error))):W())),S$=e=>Ps(uc(e,ot(),(t,n)=>n._tag===jc?V(k(t,pn(n.defect))):W())),Qb=e=>uc(e,Ci(),(t,n)=>n._tag===zc?V(k(t,La(n.fiberId))):W()),w$=e=>Kp(e,t=>t._tag===Qi?V(t.error):W()),Jb=e=>{const t=w$(e);switch(t._tag){case"None":return ae(e);case"Some":return ie(t.value)}},BU=e=>Gp(e,{onEmpty:V(Ds),onFail:ci(Ai),onDie:t=>V(xn(t)),onInterrupt:t=>V(hr(t)),onSequential:yE(Kt),onParallel:yE(Ns)}),HU=e=>Kp(e,t=>t._tag===zc?V(t.fiberId):W()),HE=e=>Gp(e,{onEmpty:Ds,onFail:()=>Ds,onDie:xn,onInterrupt:hr,onSequential:Kt,onParallel:Ns}),WU=e=>Gp(e,{onEmpty:Ds,onFail:xn,onDie:xn,onInterrupt:hr,onSequential:Kt,onParallel:Ns}),VU=w(2,(e,t)=>KU(e,n=>Ai(t(n)))),KU=w(2,(e,t)=>Gp(e,{onEmpty:Ds,onFail:n=>t(n),onDie:n=>xn(n),onInterrupt:n=>hr(n),onSequential:(n,r)=>Kt(n,r),onParallel:(n,r)=>Ns(n,r)})),GU=(e,t)=>{let n=mt(e),r=mt(t);for(;rs(n)&&rs(r);){const[s,o]=k(Jr(n),uc([Ci(),ot()],([f,h],p)=>{const[m,T]=T_(p);return V([k(f,pl(m)),k(h,ft(T))])})),[a,u]=k(Jr(r),uc([Ci(),ot()],([f,h],p)=>{const[m,T]=T_(p);return V([k(f,pl(m)),k(h,ft(T))])}));if(!ue(s,a))return!1;n=o,r=u}return!0},QU=e=>JU(mt(e),ot()),JU=(e,t)=>{for(;;){const[n,r]=k(e,hb([Ci(),ot()],([o,a],u)=>{const[f,h]=T_(u);return[k(o,pl(f)),k(a,ft(h))]})),s=Nb(n)>0?k(t,pn(n)):t;if(Rp(r))return Ps(s);e=r,t=s}throw new Error(mp("Cause.flattenCauseLoop"))},Kp=w(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case cc:case ac:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return W()}),T_=e=>{let t=e;const n=[];let r=Ci(),s=ot();for(;t!==void 0;)switch(t._tag){case Ri:{if(n.length===0)return[r,s];t=n.pop();break}case Qi:{if(r=La(r,wg(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case jc:{if(r=La(r,wg(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case zc:{if(r=La(r,wg(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case cc:{switch(t.left._tag){case Ri:{t=t.right;break}case cc:{t=Kt(t.left.left,Kt(t.left.right,t.right));break}case ac:{t=Ns(Kt(t.left.left,t.right),Kt(t.left.right,t.right));break}default:{s=pn(s,t.right),t=t.left;break}}break}case ac:{n.push(t.right),t=t.left;break}}throw new Error(mp("Cause.evaluateCauseLoop"))},YU={emptyCase:mE,failCase:ts,dieCase:ts,interruptCase:mE,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},WE="SequentialCase",VE="ParallelCase",Gp=w(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:a})=>Qp(e,void 0,{emptyCase:()=>n,failCase:(u,f)=>r(f),dieCase:(u,f)=>t(f),interruptCase:(u,f)=>s(f),sequentialCase:(u,f,h)=>a(f,h),parallelCase:(u,f,h)=>o(f,h)})),uc=w(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const a=n(r,s);switch(r=tt(a)?a.value:r,s._tag){case cc:{o.push(s.right),s=s.left;break}case ac:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),Qp=w(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const a=r.pop();switch(a._tag){case Ri:{s.push(ae(n.emptyCase(t)));break}case Qi:{s.push(ae(n.failCase(t,a.error)));break}case jc:{s.push(ae(n.dieCase(t,a.defect)));break}case zc:{s.push(ae(n.interruptCase(t,a.fiberId)));break}case cc:{r.push(a.right),r.push(a.left),s.push(ie({_tag:WE}));break}case ac:{r.push(a.right),r.push(a.left),s.push(ie({_tag:VE}));break}}}const o=[];for(;s.length>0;){const a=s.pop();switch(a._tag){case"Left":{switch(a.left._tag){case WE:{const u=o.pop(),f=o.pop(),h=n.sequentialCase(t,u,f);o.push(h);break}case VE:{const u=o.pop(),f=o.pop(),h=n.parallelCase(t,u,f);o.push(h);break}}break}case"Right":{o.push(a.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),Do=(e,t)=>Vp(e)?"All fibers interrupted without errors.":Yb(e).map(function(n){return t?.renderErrorCause!==!0||n.cause===void 0?n.stack:`${n.stack} {
${v$(n.cause,"  ")}
}`}).join(`
`),v$=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${v$(e.cause,`${t}  `)}
${t}}`),r};class lh extends globalThis.Error{span=void 0;constructor(t){const n=typeof t=="object"&&t!==null,r=Error.stackTraceLimit;Error.stackTraceLimit=1,super(E$(t),n&&"cause"in t&&typeof t.cause<"u"?{cause:new lh(t.cause)}:void 0),this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=r,this.name=t instanceof Error?t.name:"Error",n&&(lc in t&&(this.span=t[lc]),Object.keys(t).forEach(s=>{s in this||(this[s]=t[s])})),this.stack=ZU(`${this.name}: ${this.message}`,t instanceof Error&&t.stack?t.stack:"",this.span)}}const E$=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(X(e,"toString")&&Oc(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return dC(e)},XU=/\((.*)\)/g,fh=Oe("effect/Tracer/spanToTrace",()=>new WeakMap),ZU=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length;o++){if(s[o].includes(" at new BaseEffectError")||s[o].includes(" at new YieldableError")){o++;continue}if(s[o].includes("Generator.next")||s[o].includes("effect_internal_function"))break;r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,a=0;for(;o&&o._tag==="Span"&&a<10;){const u=fh.get(o);if(typeof u=="function"){const f=u();if(typeof f=="string"){const h=f.matchAll(XU);let p=!1;for(const[,m]of h)p=!0,r.push(`    at ${o.name} (${m})`);p||r.push(`    at ${o.name} (${f.replace(/^at /,"")})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=dr(o.parent),a++}}return r.join(`
`)},lc=Symbol.for("effect/SpanAnnotation"),Yb=e=>Qp(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new lh(n)],failCase:(t,n)=>[new lh(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),cf="Pending",Jp="Done",ej="effect/Deferred",k$=Symbol.for(ej),tj={_E:e=>e,_A:e=>e},nj=e=>({_tag:cf,joiners:e}),T$=e=>({_tag:Jp,effect:e});class Hc{self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new Hc(this.self)}}const C$=(e,t)=>{const n=new Jt("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},rj=e=>{const t=new Jt("RunBlocked");return t.effect_instruction_i0=e,t},qi=Symbol.for("effect/Effect");class sj{patch;op;_op=ib;constructor(t,n){this.patch=t,this.op=n}}class Jt{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[qi]=_i;constructor(t){this._op=t}[pe](t){return this===t}[ge](){return Xe(this,gp(this))}pipe(){return Z(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:wt(this.effect_instruction_i0),effect_instruction_i1:wt(this.effect_instruction_i1),effect_instruction_i2:wt(this.effect_instruction_i2)}}toString(){return ut(this.toJSON())}[Je](){return this.toJSON()}[Symbol.iterator](){return new Hc(new xc(this))}}class I${_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[qi]=_i;constructor(t){this._op=t,this._tag=t}[pe](t){return nm(t)&&t._op==="Failure"&&ue(this.effect_instruction_i0,t.effect_instruction_i0)}[ge](){return k(Pt(this._tag),le(G(this.effect_instruction_i0)),Xe(this))}get cause(){return this.effect_instruction_i0}pipe(){return Z(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return ut(this.toJSON())}[Je](){return this.toJSON()}[Symbol.iterator](){return new Hc(new xc(this))}}class $${_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[qi]=_i;constructor(t){this._op=t,this._tag=t}[pe](t){return nm(t)&&t._op==="Success"&&ue(this.effect_instruction_i0,t.effect_instruction_i0)}[ge](){return k(Pt(this._tag),le(G(this.effect_instruction_i0)),Xe(this))}get value(){return this.effect_instruction_i0}pipe(){return Z(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:wt(this.value)}}toString(){return ut(this.toJSON())}[Je](){return this.toJSON()}[Symbol.iterator](){return new Hc(new xc(this))}}const sr=e=>X(e,qi),Ae=e=>{const t=new Jt(mC);return t.effect_instruction_i0=e,t},Xb=w(3,(e,t,n)=>Dn(r=>U(e,s=>U(Fr(ne(()=>r(t(s)))),o=>ne(()=>n(s,o)).pipe(Hn({onFailure:a=>{switch(o._tag){case rn:return vt(Kt(o.effect_instruction_i0,a));case sn:return vt(a)}},onSuccess:()=>o})))))),zt=w(2,(e,t)=>U(e,()=>H(t))),or=e=>zt(e,void 0),R$=function(){const e=new Jt(Ql);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(mp("you're not supposed to end up here"))}return e},yl=(e,t=wr)=>{const n=new Jt(Hu);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,No(n,s=>sr(r)?r:be)},so=(e,t=wr)=>ne(()=>yl(e,t)),Ms=(e,t=wr)=>R$(e,function(){let n,r;function s(f){n?n(f):r===void 0&&(r=f)}const o=new Jt(Hu);o.effect_instruction_i0=f=>{n=f,r&&f(r)},o.effect_instruction_i1=t;let a,u;return this.effect_instruction_i0.length!==1?(u=new AbortController,a=rt(()=>this.effect_instruction_i0(s,u.signal))):a=rt(()=>this.effect_instruction_i0(s)),a||u?No(o,f=>(u&&u.abort(),a??be)):o}),uf=w(2,(e,t)=>{const n=new Jt(Sd);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),fc=w(2,(e,t)=>ss(e,{onFailure:t,onSuccess:H})),oj=w(3,(e,t,n)=>uf(e,r=>{const s=Jb(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):vt(r);case"Right":return vt(s.right)}})),KE=Symbol.for("effect/OriginalAnnotation"),Zb=(e,t)=>tt(t)?new Proxy(e,{has(n,r){return r===lc||r===KE||r in n},get(n,r){return r===lc?t.value:r===KE?e:n[r]}}):e,bl=e=>ls(e)&&!(lc in e)?Ae(t=>vt(xn(Zb(e,hS(t))))):vt(xn(e)),C_=e=>A$(()=>xn(new Uj(e))),dc=e=>ss(e,{onFailure:t=>H(ie(t)),onSuccess:t=>H(ae(t))}),Fr=e=>q$(e,{onFailure:He,onSuccess:Ve}),lt=e=>ls(e)&&!(lc in e)?Ae(t=>vt(Ai(Zb(e,hS(t))))):vt(Ai(e)),Yp=e=>U(B(e),lt),vt=e=>{const t=new I$(rn);return t.effect_instruction_i0=e,t},A$=e=>U(B(e),vt),lf=Ae(e=>H(e.id())),Ji=e=>Ae(t=>e(t.id())),U=w(2,(e,t)=>{const n=new Jt(Kd);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),ij=w(2,(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return sr(r)?r:iC(r)?yl(s=>{r.then(o=>s(H(o)),o=>s(lt(new aS(o,"An unknown error occurred in Effect.andThen"))))}):H(r)})),aj=e=>{const t=new Jt("OnStep");return t.effect_instruction_i0=e,t},Wc=e=>U(e,se),q$=w(2,(e,t)=>Hn(e,{onFailure:n=>H(t.onFailure(n)),onSuccess:n=>H(t.onSuccess(n))})),Hn=w(2,(e,t)=>{const n=new Jt(Gd);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),ss=w(2,(e,t)=>Hn(e,{onFailure:n=>{if(S$(n).length>0)return vt(WU(n));const s=zU(n);return s.length>0?t.onFailure(qp(s)):vt(n)},onSuccess:t.onSuccess})),Ts=w(2,(e,t)=>ne(()=>{const n=Ke(e),r=yp(n.length);let s=0;return zt(rS({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),Oi=w(2,(e,t)=>ne(()=>{const n=Ke(e);let r=0;return rS({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),Ut=U(lf,e=>eS(e)),eS=e=>vt(hr(e)),hc=e=>{const t=new Jt(Fc);return t.effect_instruction_i0=EU(Uc),t.effect_instruction_i1=()=>e,t},O$=w(2,(e,t)=>Dn(n=>U(Fr(n(e)),r=>H$(t,r)))),fe=w(2,(e,t)=>U(e,n=>B(()=>t(n)))),tS=w(2,(e,t)=>ss(e,{onFailure:n=>Yp(()=>t.onFailure(n)),onSuccess:n=>B(()=>t.onSuccess(n))})),Xp=w(2,(e,t)=>Hn(e,{onFailure:n=>{const r=Jb(n);switch(r._tag){case"Left":return Yp(()=>t(r.left));case"Right":return vt(r.right)}},onSuccess:H})),cj=w(2,(e,t)=>Ls(e,n=>z$(n)?be:t(n.effect_instruction_i0))),Ls=w(2,(e,t)=>Dn(n=>Hn(n(e),{onFailure:r=>{const s=He(r);return Hn(t(s),{onFailure:o=>He(Kt(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=Ve(r);return We(t(s),s)}}))),No=w(2,(e,t)=>Ls(e,rm({onFailure:n=>Vp(n)?or(t(Qb(n))):be,onSuccess:()=>be}))),nS=e=>uj(e,se),uj=w(2,(e,t)=>ss(e,{onFailure:n=>bl(t(n)),onSuccess:H})),H=e=>{const t=new $$(sn);return t.effect_instruction_i0=e,t},ne=e=>{const t=new Jt(Ql);return t.commit=e,t},B=e=>{const t=new Jt(pC);return t.effect_instruction_i0=e,t},Us=w(e=>e.length===3||e.length===2&&!(ls(e[1])&&"onlyEffect"in e[1]),(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return sr(r)?zt(r,n):iC(r)?yl(s=>{r.then(o=>s(H(n)),o=>s(lt(new aS(o,"An unknown error occurred in Effect.tap"))))}):H(n)})),lj=e=>Ae(t=>{const n=t.getFiberRef($_),r=k(n,ht(()=>t.scope()));return e(Yi($_,V(r)))}),Ws=e=>{const t=new Jt(Fc);return t.effect_instruction_i0=p$(Uc),t.effect_instruction_i1=()=>e,t},Dn=e=>R$(e,function(){const t=new Jt(Fc);return t.effect_instruction_i0=p$(Uc),t.effect_instruction_i1=n=>d$(n)?rt(()=>this.effect_instruction_i0(hc)):rt(()=>this.effect_instruction_i0(Ws)),t}),be=H(void 0),fj=e=>{const t=new Jt(Fc);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},Zp=w(2,(e,t)=>U(t,n=>n?k(e,fe(V)):H(W()))),rS=e=>{const t=new Jt(Qd);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},dh=e=>ne(()=>{const t=new Jt(Wu);return t.effect_instruction_i0=e(),t}),dj=function(){const e=arguments.length===1?arguments[0]:arguments[1].bind(arguments[0]);return dh(()=>e(k))},hj=(e,...t)=>Object.defineProperty(t.length===0?function(...n){return dh(()=>e.apply(this,n))}:function(...n){let r=dh(()=>e.apply(this,n));for(const s of t)r=s(r,...n);return r},"length",{value:e.length,configurable:!0}),pj=w(2,(e,t)=>{const n=new Jt(Fc);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),ff=e=>{const t=new Jt(wd);return typeof e?.priority<"u"?qj(t,e.priority):t},x$=w(2,(e,t)=>U(e,n=>fe(t,r=>[n,r]))),po=w(2,(e,t)=>U(e,n=>zt(t,n))),We=w(2,(e,t)=>U(e,()=>t)),F$=w(3,(e,t,n)=>U(e,r=>fe(t,s=>n(r,s)))),mj=so(()=>{const e=setInterval(()=>{},2147483647);return B(()=>clearInterval(e))}),Sl=e=>U(lf,t=>k(e,Cs(t))),Cs=w(2,(e,t)=>U(e.interruptAsFork(t),()=>e.await)),gj={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return Z(this,arguments)}},_j={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return Z(this,arguments)}},yj={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return Z(this,arguments)}},bj={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return Z(this,arguments)}},P$={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return Z(this,arguments)}},D$={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return Z(this,arguments)}},Sj={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return Z(this,arguments)}},wj={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return Z(this,arguments)}},vj="effect/FiberRef",Ej=Symbol.for(vj),kj={_A:e=>e},df=e=>Ae(t=>Ve(t.getFiberRef(e))),Vc=w(2,(e,t)=>U(df(e),t)),hh=w(2,(e,t)=>Tj(e,()=>[void 0,t])),Tj=w(2,(e,t)=>Ae(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),H(r)})),Yi=w(3,(e,t,n)=>Xb(po(df(t),hh(t,n)),()=>e,r=>hh(t,r))),sS=w(3,(e,t,n)=>Vc(t,r=>Yi(e,t,n(r)))),mn=(e,t)=>Kc(e,{differ:c$(),fork:t?.fork??se,join:t?.join}),Cj=e=>{const t=cU();return Kc(e,{differ:t,fork:t.empty})},Ij=e=>{const t=uU(c$());return Kc(e,{differ:t,fork:t.empty})},N$=e=>{const t=aU();return Kc(e,{differ:t,fork:t.empty})},Kc=(e,t)=>({...Yl,[Ej]:kj,initial:e,commit(){return df(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),$j=e=>Kc(e,{differ:zE,fork:zE.empty}),Mr=Oe(Symbol.for("effect/FiberRef/currentContext"),()=>N$(vi())),Xi=Oe(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>mn(0)),M$=Oe(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>mn(2048)),L$=Oe(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>mn(zp())),Rj=Oe(Symbol.for("effect/FiberRef/currentLogLevel"),()=>mn(P$)),Aj=Oe(Symbol.for("effect/FiberRef/currentLogSpan"),()=>mn(ic())),qj=w(2,(e,t)=>Yi(e,Xi,t)),Oj=Oe(Symbol.for("effect/FiberRef/currentConcurrency"),()=>mn("unbounded")),xj=Oe(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>mn(!0)),oS=Oe(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>mn(V(D$))),Fj=w(2,(e,t)=>Yi(e,oS,t)),I_=Oe(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>Ij(yo())),$_=Oe(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>mn(W(),{fork:()=>W(),join:(e,t)=>e})),rd=Oe(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>mn(Ds,{fork:()=>Ds,join:(e,t)=>e})),Pj=Oe(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>mn(!0)),em=Oe(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>mn(!0)),Dj=Oe(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>mn(zp())),Nj=Oe(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>mn(ot())),GE=Symbol.for("effect/Scope"),QE=Symbol.for("effect/CloseableScope"),U$=(e,t)=>e.addFinalizer(()=>or(t)),wl=(e,t)=>e.addFinalizer(t),R_=(e,t)=>e.close(t),tm=(e,t)=>e.fork(t),Mj=e=>Lj(se)(e),Lj=w(2,(e,t)=>{const n=k(e,w$,ci(t));switch(n._tag){case"None":return k(S$(e),Ap,Qe({onNone:()=>{const r=Ke(Qb(e)).flatMap(s=>Ke(jb(s)).map(o=>`#${o}`));return new jj(r?`Interrupted by fibers: ${r.join(", ")}`:void 0)},onSome:se}));case"Some":return n.value}}),iS=function(){class e extends globalThis.Error{commit(){return lt(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[Je](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?Do(Ai(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,yD),e}(),hf=(e,t)=>{class n extends iS{_tag=t}return Object.assign(n.prototype,e),n.prototype.name=t,n},JE=Symbol.for("effect/Cause/errors/RuntimeException"),Uj=hf({[JE]:JE},"RuntimeException"),A_=Symbol.for("effect/Cause/errors/InterruptedException"),jj=hf({[A_]:A_},"InterruptedException"),zj=e=>X(e,A_),YE=Symbol.for("effect/Cause/errors/IllegalArgument"),Bj=hf({[YE]:YE},"IllegalArgumentException"),XE=Symbol.for("effect/Cause/errors/NoSuchElement"),pf=hf({[XE]:XE},"NoSuchElementException"),ZE=Symbol.for("effect/Cause/errors/Timeout"),Hj=hf({[ZE]:ZE},"TimeoutException"),Wj=e=>new Hj(`Operation timed out after '${PI(e)}'`),e0=Symbol.for("effect/Cause/errors/UnknownException"),aS=function(){class e extends iS{_tag="UnknownException";error;constructor(n,r){super(r??"An unknown error occurred",{cause:n}),this.error=n}}return Object.assign(e.prototype,{[e0]:e0,name:"UnknownException"}),e}(),nm=e=>sr(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),j$=e=>e._tag==="Failure",z$=e=>e._tag==="Success",Vj=e=>{switch(e._tag){case rn:return Gb(e.effect_instruction_i0);case sn:return!1}},Rd=w(2,(e,t)=>{switch(e._tag){case rn:return He(e.effect_instruction_i0);case sn:return Ve(t)}}),Tg=e=>Rd(e,void 0),ja=(e,t)=>Jj(e,t?.parallel?Ns:Kt),Aa=e=>He(xn(e)),vl=e=>He(Ai(e)),He=e=>{const t=new I$(rn);return t.effect_instruction_i0=e,t},Kj=w(2,(e,t)=>{switch(e._tag){case rn:return He(e.effect_instruction_i0);case sn:return t(e.effect_instruction_i0)}}),Gj=e=>k(e,Kj(se)),cS=e=>He(hr(e)),Ad=w(2,(e,t)=>{switch(e._tag){case rn:return He(e.effect_instruction_i0);case sn:return Ve(t(e.effect_instruction_i0))}}),rm=w(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case rn:return t(e.effect_instruction_i0);case sn:return n(e.effect_instruction_i0)}}),q_=w(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case rn:return t(e.effect_instruction_i0);case sn:return n(e.effect_instruction_i0)}}),Ve=e=>{const t=new $$(sn);return t.effect_instruction_i0=e,t},ln=Ve(void 0),Qj=w(2,(e,t)=>uS(e,t,{onSuccess:(n,r)=>[n,r],onFailure:Kt})),B$=w(2,(e,t)=>uS(e,t,{onSuccess:(n,r)=>r,onFailure:Kt})),uS=w(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case rn:switch(t._tag){case sn:return He(e.effect_instruction_i0);case rn:return He(n(e.effect_instruction_i0,t.effect_instruction_i0))}case sn:switch(t._tag){case sn:return Ve(r(e.effect_instruction_i0,t.effect_instruction_i0));case rn:return He(t.effect_instruction_i0)}}}),Jj=(e,t)=>{const n=Ei(e);return rs(n)?k(ks(n),hb(k(Jr(n),Ad(mt)),(r,s)=>k(r,uS(s,{onSuccess:(o,a)=>k(o,pn(a)),onFailure:t}))),Ad(Ps),Ad(r=>Sr(r)),V):W()},mf=e=>({...Yl,[k$]:tj,state:Ki(nj([])),commit(){return os(this)},blockingOn:e}),gf=()=>U(lf,e=>Yj(e)),Yj=e=>B(()=>mf(e)),os=e=>so(t=>{const n=Me(e.state);switch(n._tag){case Jp:return t(n.effect);case cf:return n.joiners.push(t),nz(e,t)}},e.blockingOn),Xj=w(2,(e,t)=>O$(t,e)),Gc=w(2,(e,t)=>B(()=>{const n=Me(e.state);switch(n._tag){case Jp:return!1;case cf:{Gi(e.state,T$(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),H$=w(2,(e,t)=>Gc(e,t)),Zj=w(2,(e,t)=>Gc(e,lt(t))),W$=w(2,(e,t)=>Gc(e,vt(t))),ez=e=>U(lf,t=>Gc(e,eS(t))),lS=w(2,(e,t)=>Gc(e,eS(t))),tz=e=>B(()=>Me(e.state)._tag===Jp),_f=w(2,(e,t)=>Gc(e,H(t))),yf=(e,t)=>{const n=Me(e.state);if(n._tag===cf){Gi(e.state,T$(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},nz=(e,t)=>B(()=>{const n=Me(e.state);if(n._tag===cf){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),rz=Ae(e=>Ve(e.currentContext)),Qc=()=>rz,Jc=e=>U(Qc(),e),fS=w(2,(e,t)=>Yi(Mr,t)(e)),dS=w(2,(e,t)=>sS(Mr,n=>Po(n,t))(e)),V$=w(2,(e,t)=>Jc(n=>fS(e,t(n)))),hS=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?V(t):W()},sz={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:ln},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){},addLinks(){}},oz=e=>Object.assign(Object.create(sz),e),Vo=k$,Le=gf,It=os,iz=Xj,Mo=H$,K$=Zj,za=W$,t0=ez,O_=tz,ct=_f,pS=yf,az=nm,Yc=j$,ph=z$,cz=Vj,uz=ja,mh=Aa,bf=vl,Gt=He,lz=Gj,fz=cS,dz=Ad,Yr=rm,Rt=Ve,Wn=ln,n0=Qj,El=B$,r0=Symbol.for("effect/MutableHashMap"),hz={[r0]:r0,[Symbol.iterator](){return new mS(this)},toString(){return ut(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(wt)}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}};class mS{self;referentialIterator;bucketIterator;constructor(t){this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new pz(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new mS(this.self)}}class pz{backing;constructor(t){this.backing=t}currentBucket;next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const mz=()=>{const e=Object.create(hz);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},Yo=w(2,(e,t)=>{if(Vd(t)===!1)return e.referential.has(t)?V(e.referential.get(t)):W();const n=t[ge](),r=e.buckets.get(n);return r===void 0?W():gz(e,r,t)}),gz=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[pe](t[s][0])){const a=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),V(a)}return W()},Su=w(2,(e,t)=>tt(Yo(e,t))),wu=w(3,(e,t,n)=>{if(Vd(t)===!1)return e.referential.set(t,n),e;const r=t[ge](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(_z(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),_z=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[pe](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},s0=Symbol.for("effect/MutableList"),yz={[s0]:s0,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return ut(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(wt)}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},bz=e=>({value:e,removed:!1,prev:void 0,next:void 0}),Sz=()=>{const e=Object.create(yz);return e.head=void 0,e.tail=void 0,e._length=0,e},G$=e=>gS(e)===0,gS=e=>e._length,wz=w(2,(e,t)=>{const n=bz(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),vz=e=>{const t=e.head;if(t!==void 0)return Ez(e,t),t.value},Ez=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},o0=Symbol.for("effect/MutableQueue"),Dt=Symbol.for("effect/mutable/MutableQueue/Empty"),kz={[o0]:o0,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return ut(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(wt)}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},Q$=e=>{const t=Object.create(kz);return t.queue=Sz(),t.capacity=e,t},_S=e=>Q$(e),sm=()=>Q$(void 0),yS=e=>gS(e.queue),di=e=>G$(e.queue),Tz=e=>e.capacity===void 0?1/0:e.capacity,pc=w(2,(e,t)=>{const n=gS(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(wz(t)(e.queue),!0)}),bS=w(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=ot(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=pc(r.value)(e);for(;r!=null&&!r.done;)s=pn(r.value)(s),r=n.next();return Ps(s)}),As=w(2,(e,t)=>G$(e.queue)?t:vz(e.queue)),om=w(2,(e,t)=>{let n=ot(),r=0;for(;r<t;){const s=As(Dt)(e);if(s===Dt)break;n=pn(s)(n),r+=1}return Ps(n)}),Cz="effect/Clock",i0=Symbol.for(Cz),Zi=Nn("effect/Clock"),Iz=2**31-1,a0={unsafeSchedule(e,t){const n=nc(t);if(n>Iz)return ts;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},c0=function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;let t;return()=>(t===void 0&&(t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6))),t+BigInt(Math.round(performance.now()*1e6)))}(),$z=function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return c0;const t=c0()-e.bigint();return()=>t+e.bigint()}();class Rz{[i0]=i0;unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return $z()}currentTimeMillis=B(()=>this.unsafeCurrentTimeMillis());currentTimeNanos=B(()=>this.unsafeCurrentTimeNanos());scheduler(){return H(a0)}sleep(t){return Ms(n=>{const r=a0.unsafeSchedule(()=>n(be),t);return or(B(r))})}}const Az=()=>new Rz,J$="And",Y$="Or",X$="InvalidData",Z$="MissingData",e1="SourceUnavailable",t1="Unsupported",qz="effect/ConfigError",u0=Symbol.for(qz),Xc={_tag:"ConfigError",[u0]:u0},n1=(e,t)=>{const n=Object.create(Xc);return n._op=J$,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},r1=(e,t)=>{const n=Object.create(Xc);return n._op=Y$,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},Oz=(e,t,n={pathDelim:"."})=>{const r=Object.create(Xc);return r._op=X$,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${k(this.path,Dc(n.pathDelim))}: "${this.message}")`}}),r},xi=(e,t,n={pathDelim:"."})=>{const r=Object.create(Xc);return r._op=Z$,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${k(this.path,Dc(n.pathDelim))}: "${this.message}")`}}),r},xz=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(Xc);return s._op=e1,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${k(this.path,Dc(r.pathDelim))}: "${this.message}")`}}),s},Fz=(e,t,n={pathDelim:"."})=>{const r=Object.create(Xc);return r._op=t1,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${k(this.path,Dc(n.pathDelim))}: "${this.message}")`}}),r},ni=w(2,(e,t)=>{switch(e._op){case J$:return n1(ni(e.left,t),ni(e.right,t));case Y$:return r1(ni(e.left,t),ni(e.right,t));case X$:return Oz([...t,...e.path],e.message);case Z$:return xi([...t,...e.path],e.message);case e1:return xz([...t,...e.path],e.message,e.cause);case t1:return Fz([...t,...e.path],e.message)}}),Pz={_tag:"Empty"},Cg=w(2,(e,t)=>{let n=Bb(t),r=e;for(;zb(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=$i(s.first,$i(s.second,n.tail));break}case"MapName":{r=ui(r,s.f),n=n.tail;break}case"Nested":{r=Yd(r,s.name),n=n.tail;break}case"Unnested":{if(k(Vu(r),zD(s.name)))r=yi(r),n=n.tail;else return ie(xi(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return ae(r)}),Dz="Constant",Nz="Fail",Mz="Fallback",Lz="Described",Uz="Lazy",jz="MapOrFail",zz="Nested",Bz="Primitive",Hz="Sequence",Wz="HashMap",Vz="ZipWith";var l0={};const gh=(e,t)=>[...e,...t],Kz="effect/ConfigProvider",f0=Symbol.for(Kz),Gz=Nn("effect/ConfigProvider"),Qz="effect/ConfigProviderFlat",d0=Symbol.for(Qz),Jz=e=>({[f0]:f0,pipe(){return Z(this,arguments)},...e}),Yz=e=>({[d0]:d0,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),Xz=e=>Jz({load:t=>U(cr(e,yo(),t,!1),n=>Qe(Vu(n),{onNone:()=>lt(xi(yo(),`Expected a single value having structure: ${t}`)),onSome:H})),flattened:e}),Zz=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=f=>k(f,Dc(t)),s=f=>f.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof l0=="object"?l0:{};return Xz(Yz({load:(f,h,p=!0)=>{const m=r(f),T=o(),C=m in T?V(T[m]):W();return k(C,Xp(()=>xi(f,`Expected ${m} to exist in the process context`)),U(A=>s4(A,f,h,n,p)))},enumerateChildren:f=>B(()=>{const h=o(),T=Object.keys(h).map(C=>s(C.toUpperCase())).filter(C=>{for(let A=0;A<f.length;A++){const D=k(f,qC(A)),y=C[A];if(y===void 0||D!==y)return!1}return!0}).flatMap(C=>C.slice(f.length,f.length+1));return VM(T)}),patch:Pz}))},e4=(e,t,n,r)=>{const s=wE(n.length,f=>f>=r.length?W():V([e(f),f+1])),o=wE(r.length,f=>f>=n.length?W():V([t(f),f+1])),a=gh(n,s),u=gh(r,o);return[a,u]},t4=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},cr=(e,t,n,r)=>{const s=n;switch(s._tag){case Dz:return H(ur(s.value));case Lz:return ne(()=>cr(e,t,s.config,r));case Nz:return lt(xi(t,s.message));case Mz:return k(ne(()=>cr(e,t,s.first,r)),fc(o=>s.condition(o)?k(cr(e,t,s.second,r),fc(a=>lt(r1(o,a)))):lt(o)));case Uz:return ne(()=>cr(e,t,s.config(),r));case jz:return ne(()=>k(cr(e,t,s.original,r),U(Ts(o=>k(s.mapOrFail(o),Xp(ni(t4(t,s.original))))))));case zz:return ne(()=>cr(e,gh(t,ur(s.name)),s.config,r));case Bz:return k(Cg(t,e.patch),U(o=>k(e.load(o,s,r),U(a=>{if(a.length===0){const u=k(iN(o),ht(()=>"<n/a>"));return lt(xi([],`Expected ${s.description} with name ${u}`))}return H(a)}))));case Hz:return k(Cg(t,e.patch),U(o=>k(e.enumerateChildren(o),U(i4),U(a=>a.length===0?ne(()=>fe(cr(e,t,s.config,!0),ur)):k(Ts(a,u=>cr(e,eN(t,`[${u}]`),s.config,!0)),fe(u=>{const f=_N(u);return f.length===0?ur(yo()):ur(f)}))))));case Wz:return ne(()=>k(Cg(t,e.patch),U(o=>k(e.enumerateChildren(o),U(a=>k(a,Ts(u=>cr(e,gh(o,ur(u)),s.valueConfig,r)),fe(u=>u.length===0?ur(zp()):k(o4(u),ui(f=>iL(SE(Ke(a),f)))))))))));case Vz:return ne(()=>k(cr(e,t,s.left,r),dc,U(o=>k(cr(e,t,s.right,r),dc,U(a=>{if(Zt(o)&&Zt(a))return lt(n1(o.left,a.left));if(Zt(o)&&Gr(a))return lt(o.left);if(Gr(o)&&Zt(a))return lt(a.left);if(Gr(o)&&Gr(a)){const u=k(t,Dc(".")),f=n4(t,u),[h,p]=e4(f,f,k(o.right,ui(ae)),k(a.right,ui(ae)));return k(h,SE(p),Ts(([m,T])=>k(x$(m,T),fe(([C,A])=>s.zip(C,A)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},n4=(e,t)=>n=>ie(xi(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),r4=(e,t)=>e.split(new RegExp(`\\s*${Zd(t)}\\s*`)),s4=(e,t,n,r,s)=>s?k(r4(e,r),Ts(o=>n.parse(o.trim())),Xp(ni(t))):k(n.parse(e),tS({onFailure:ni(t),onSuccess:ur})),o4=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),i4=e=>k(Ts(e,c4),tS({onFailure:()=>yo(),onSuccess:cl(Za)}),dc,fe(AD)),a4=/^(\[(\d+)\])$/,c4=e=>{const t=e.match(a4);if(t!==null){const n=t[2];return k(n!==void 0&&n.length>0?V(n):W(),Pc(u4))}return W()},u4=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?W():V(t)},h0=Symbol.for("effect/Console"),im=Nn("effect/Console"),l4={[h0]:h0,assert(e,...t){return B(()=>{console.assert(e,...t)})},clear:B(()=>{console.clear()}),count(e){return B(()=>{console.count(e)})},countReset(e){return B(()=>{console.countReset(e)})},debug(...e){return B(()=>{console.debug(...e)})},dir(e,t){return B(()=>{console.dir(e,t)})},dirxml(...e){return B(()=>{console.dirxml(...e)})},error(...e){return B(()=>{console.error(...e)})},group(e){return e?.collapsed?B(()=>console.groupCollapsed(e?.label)):B(()=>console.group(e?.label))},groupEnd:B(()=>{console.groupEnd()}),info(...e){return B(()=>{console.info(...e)})},log(...e){return B(()=>{console.log(...e)})},table(e,t){return B(()=>{console.table(e,t)})},time(e){return B(()=>console.time(e))},timeEnd(e){return B(()=>console.timeEnd(e))},timeLog(e,...t){return B(()=>{console.timeLog(e,...t)})},trace(...e){return B(()=>{console.trace(...e)})},warn(...e){return B(()=>{console.warn(...e)})},unsafe:console},f4="effect/Random",p0=Symbol.for(f4),d4=Nn("effect/Random");class h4{seed;[p0]=p0;PRNG;constructor(t){this.seed=t,this.PRNG=new nD(t)}get next(){return B(()=>this.PRNG.number())}get nextBoolean(){return fe(this.next,t=>t>.5)}get nextInt(){return B(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return fe(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return B(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return p4(t,n=>this.nextIntBetween(0,n))}}const p4=(e,t)=>ne(()=>k(B(()=>Array.from(e)),U(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return k(r,Oi(s=>k(t(s),fe(o=>m4(n,s-1,o)))),zt(Ei(n)))}))),m4=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},g4=e=>new h4(G(e)),m0=Symbol.for("effect/Tracer"),s1=e=>({[m0]:m0,...e}),Sf=Nn("effect/Tracer"),is=Nn("effect/ParentSpan"),g0=function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}}();class _4{name;parent;context;startTime;kind;_tag="Span";spanId;traceId="native";sampled=!0;status;attributes;events=[];links;constructor(t,n,r,s,o,a){this.name=t,this.parent=n,this.context=r,this.startTime=o,this.kind=a,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:g0(32),this.spanId=g0(16),this.links=Array.from(s)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}addLinks(t){this.links.push(...t)}}const y4=s1({span:(e,t,n,r,s,o)=>new _4(e,t,n,r,s,o),context:e=>e()}),qs=e=>{if(e?.captureStackTrace===!1)return e;if(e?.captureStackTrace!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},_h=Cp()("effect/Tracer/DisablePropagation",{defaultValue:ts}),b4=k(vi(),Yn(Zi,Az()),Yn(im,l4),Yn(d4,g4(Math.random())),Yn(Gz,Zz()),Yn(Sf,y4)),as=Oe(Symbol.for("effect/DefaultServices/currentServices"),()=>N$(b4)),S4=e=>{const t=nr(e);return am(n=>n.sleep(t))},o1=e=>Ae(t=>e(t.currentDefaultServices)),am=e=>o1(t=>e(t.unsafeMap.get(Zi.key))),w4=am(e=>e.currentTimeMillis),v4=e=>o1(t=>e(t.unsafeMap.get(Sf.key))),i1=S4,E4=w4,k4=am,T4=Zi;function C4(e){return new So(e)}function I4(){return C4(new Map)}const _0=Symbol.for("effect/FiberRefs");class So{locals;[_0]=_0;constructor(t){this.locals=t}pipe(){return Z(this,arguments)}}const $4=(e,t,n,r=!1)=>{const s=e;let o=t,a=n,u=r,f;for(;f===void 0;)if(pt(o)&&pt(a)){const h=On(o)[0],p=yi(o),m=On(a)[0],T=On(a)[1],C=yi(a);h.startTimeMillis<m.startTimeMillis?(a=C,u=!0):h.startTimeMillis>m.startTimeMillis?o=p:h.id<m.id?(a=C,u=!0):h.id>m.id?o=p:f=[T,u]}else f=[s.initial,!0];return f},R4=w(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const a=s[0][1];if(!s[0][0][pe](t)){if(!r.has(o)){if(ue(a,o.initial))return;r.set(o,[[t,o.join(o.initial,a)]]);return}const u=r.get(o),[f,h]=$4(o,u,s);if(h){const p=o.diff(f,a),m=u[0][1],T=o.join(m,o.patch(p)(m));if(!ue(m,T)){let C;const A=u[0][0];A[pe](t)?C=[[A,T],...u.slice(1)]:C=[[t,T],...u],r.set(o,C)}}}}),new So(r)}),A4=w(2,(e,t)=>{const n=new Map;return a1(e,n,t),new So(n)}),a1=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],a=s.patch(s.fork)(o);ue(o,a)?t.set(s,r):t.set(s,[[n,a],...r])})},c1=w(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new So(n)}),u1=w(2,(e,t)=>e.locals.has(t)?V(On(e.locals.get(t))[1]):W()),kl=w(2,(e,t)=>k(u1(e,t),ht(()=>t.initial))),x_=w(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new So(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return F_(s,t,n,r),new So(s)}),F_=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(pt(s)){const[a,u]=On(s);if(a[pe](t)){if(ue(u,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},q4=w(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new So(new Map(t));const r=new Map(e.locals);return n!==void 0&&a1(e,r,n),t.forEach(([s,o])=>{o.length===1?F_(r,o[0][0],s,o[0][1]):o.forEach(([a,u])=>{F_(r,a,s,u)})}),new So(r)}),y0=u1,SS=kl,O4=q4,x4=I4,F4=gj,P4=_j,l1=yj,f1=bj,D4=P$,wS=D$,N4=Sj,M4=wj,L4=k(Za,$C(e=>e.ordinal)),U4=xD(L4),j4=e=>{switch(e){case"All":return F4;case"Debug":return wS;case"Error":return l1;case"Fatal":return P4;case"Info":return D4;case"Trace":return N4;case"None":return M4;case"Warning":return f1}},d1=e=>e.replace(/[\s="]/g,"_"),vS=e=>t=>`${d1(t.label)}=${e-t.startTime}ms`,z4=Jl,B4=bD;let hs=class extends B4{};const wo=Symbol.for("effect/Readable"),ES=Symbol.for("effect/Ref"),kS={_A:e=>e};class H4 extends hs{ref;commit(){return this.get}[ES]=kS;[wo]=wo;constructor(t){super(),this.ref=t,this.get=B(()=>Me(this.ref))}get;modify(t){return B(()=>{const n=Me(this.ref),[r,s]=t(n);return n!==s&&Gi(s)(this.ref),r})}}const h1=e=>new H4(Ki(e)),yh=e=>B(()=>h1(e)),mo=e=>e.get,Tl=w(2,(e,t)=>e.modify(()=>[void 0,t])),p1=w(2,(e,t)=>e.modify(t)),P_=w(2,(e,t)=>e.modify(n=>[void 0,t(n)])),W4=ES,cm=yh,Gu=mo,vu=p1,TS=Tl,V4=P_,m1=is,g1=s1,K4=v4,_1="Empty",y1="Add",b1="Remove",S1="Update",w1="AndThen",G4={_tag:_1},v1=(e,t)=>{const n=new Map(e.locals);let r=G4;for(const[s,o]of t.locals.entries()){const a=On(o)[1],u=n.get(s);if(u!==void 0){const f=On(u)[1];ue(f,a)||(r=Ig({_tag:S1,fiberRef:s,patch:s.diff(f,a)})(r))}else r=Ig({_tag:y1,fiberRef:s,value:a})(r);n.delete(s)}for(const[s]of n.entries())r=Ig({_tag:b1,fiberRef:s})(r);return r},Ig=w(2,(e,t)=>({_tag:w1,first:e,second:t})),E1=w(3,(e,t,n)=>{let r=n,s=ur(e);for(;pt(s);){const o=On(s),a=yi(s);switch(o._tag){case _1:{s=a;break}case y1:{r=x_(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=a;break}case b1:{r=c1(r,o.fiberRef),s=a;break}case S1:{const u=kl(r,o.fiberRef);r=x_(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(u)}),s=a;break}case w1:{s=Yd(o.first)(Yd(o.second)(a));break}}}return r}),k1="effect/MetricLabel",D_=Symbol.for(k1);class Q4{key;value;[D_]=D_;_hash;constructor(t,n){this.key=t,this.value=n,this._hash=Pt(k1+this.key+this.value)}[ge](){return this._hash}[pe](t){return Y4(t)&&this.key===t.key&&this.value===t.value}pipe(){return Z(this,arguments)}}const J4=(e,t)=>new Q4(e,t),Y4=e=>X(e,D_),X4=w(e=>sr(e[0]),function(){const e=arguments;return sS(e[0],L$,typeof e[1]=="string"?ch(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>ch(n,r,s),t))}),Z4=e=>fe(e,V),eB=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),ne(()=>{try{return H(rt(t))}catch(r){return lt(n?rt(()=>n(r)):new aS(r,"An unknown error occurred in Effect.try"))}})},tB=w(2,(e,t)=>uf(e,n=>{const r=Kp(n,s=>Vb(s)?V(s):W());switch(r._tag){case"None":return vt(n);case"Some":return t(r.value.defect)}})),nB=w(2,(e,t)=>Hn(e,{onFailure:n=>{const r=t(n);switch(r._tag){case"None":return vt(n);case"Some":return r.value}},onSuccess:H})),rB=w(e=>sr(e[0]),(e,...t)=>{const n=t[t.length-1];let r;return t.length===2?r=tb(t[0]):r=s=>{const o=X(s,"_tag")?s._tag:void 0;if(!o)return!1;for(let a=0;a<t.length-1;a++)if(t[a]===o)return!0;return!1},oj(e,r,n)}),sB=k4,oB=sB(H),T1=w(2,(e,t)=>We(i1(t),e)),iB=e=>mB(e,aB,v1),C1=w(2,(e,t)=>ss(e,{onFailure:n=>H(t.onFailure(n)),onSuccess:n=>H(t.onSuccess(n))})),CS=e=>{const t=U(U(e,()=>ff()),()=>t);return t},aB=Ae(e=>H(e.getFiberRefs())),I1=e=>C1(e,{onFailure:il,onSuccess:il}),cB=e=>Hn(e,{onFailure:t=>$1(t,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>be}),um=e=>(...t)=>{const n=Vi(e);let r;for(let s=0,o=t.length;s<o;s++){const a=t[s];Wb(a)&&(r!==void 0?r=Kt(r,a):r=a,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=Ds),Ae(s=>(s.log(t,r,n),be))},uB=um(),$1=um(wS),lB=um(f1),fB=um(l1),b0=w(2,(e,t)=>Hn(e,{onFailure:n=>A$(()=>t(n)),onSuccess:H})),dB=e=>fe(e,t=>!t),hB=e=>bB((t,n)=>k(e,E1(t,n))),pB=e=>e.length>=1?Ms((t,n)=>{try{e(n).then(r=>t(Ve(r)),r=>t(Aa(r)))}catch(r){t(Aa(r))}}):Ms(t=>{try{e().then(n=>t(Ve(n)),n=>t(Aa(n)))}catch(n){t(Aa(n))}}),Cl=w(3,(e,t,n)=>Jc(r=>fS(e,Yn(r,t,n)))),IS=i1,Il=H(W()),mB=w(3,(e,t,n)=>U(t,r=>U(e,s=>fe(t,o=>[n(r,o),s])))),gB=w(2,(e,t)=>Hn(e,{onFailure:n=>We(t(n),vt(n)),onSuccess:H})),_B=K4,yB=_B(H),bB=e=>Ae(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),be)),SB=w(2,(e,t)=>ne(()=>t()?fe(e,V):H(W()))),wB=e=>fe(Qc(),tr(e)),vB=function(){const e=arguments;return I1(U(R1,t=>B(()=>{if(typeof e[0]=="string")t.attribute(e[0],e[1]);else for(const n in e[0])t.attribute(n,e[0][n])})))},R1=U(Qc(),e=>{const t=e.unsafeMap.get(is.key);return t!==void 0&&t._tag==="Span"?H(t):lt(new pf)}),A1=BigInt(0),q1=Pc(e=>Zn(e.context,_h)?e._tag==="Span"?q1(e.parent):W():V(e)),$S=(e,t,n)=>{const r=!e.getFiberRef(Pj)||n.context&&Zn(n.context,_h),s=e.getFiberRef(Mr),o=n.parent?V(n.parent):n.root?W():q1(tr(s,is));let a;if(r)a=oz({name:t,parent:o,context:Yn(n.context??vi(),_h,!0)});else{const u=e.getFiberRef(as),f=Zn(u,Sf),h=Zn(u,T4),p=e.getFiberRef(em),m=e.getFiberRefs(),T=y0(m,Dj),C=y0(m,Nj),A=C._tag==="Some"?n.links!==void 0?[...Sr(C.value),...n.links??[]]:Sr(C.value):n.links??yo();a=f.span(t,o,n.context??vi(),A,p?h.unsafeCurrentTimeNanos():A1,n.kind??"internal"),T._tag==="Some"&&lL(T.value,(D,y)=>a.attribute(y,D)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([D,y])=>a.attribute(D,y))}return typeof n.captureStackTrace=="function"&&fh.set(a,n.captureStackTrace),a},EB=(e,t)=>(t=qs(t),Ae(n=>H($S(n,e,t)))),bh=(e,t,n,r)=>B(()=>{e.status._tag!=="Ended"&&(j$(t)&&fh.has(e)&&e.attribute("code.stacktrace",fh.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():A1,t))}),S0=(e,...t)=>{const n=qs(t.length===1?void 0:t[0]),r=t[t.length-1];return Ae(s=>{const o=$S(s,e,n),a=s.getFiberRef(em),u=Zn(s.getFiberRef(as),Zi);return Ls(r(o),f=>bh(o,f,u,a))})},N_=w(2,(e,t)=>Cl(e,is,t)),kB=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=qs(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return S0(t,n,s=>N_(r,s))}return r=>S0(t,n,s=>N_(r,s))},O1="Sequential",x1="Parallel",TB="ParallelN",wf={_tag:O1},CB={_tag:x1},IB=e=>({_tag:TB,parallelism:e}),$B=e=>e._tag===O1,RB=e=>e._tag===x1,Sh=wf,M_=CB,L_=IB,$l=v1,Rl=E1,lm="effect/FiberStatus",Fi=Symbol.for(lm),wh="Done",w0="Running",v0="Suspended",AB=Pt(`${lm}-${wh}`);let qB=class{[Fi]=Fi;_tag=wh;[ge](){return AB}[pe](t){return RS(t)&&t._tag===wh}};class OB{runtimeFlags;[Fi]=Fi;_tag=w0;constructor(t){this.runtimeFlags=t}[ge](){return k(G(lm),le(G(this._tag)),le(G(this.runtimeFlags)),Xe(this))}[pe](t){return RS(t)&&t._tag===w0&&this.runtimeFlags===t.runtimeFlags}}class xB{runtimeFlags;blockingOn;[Fi]=Fi;_tag=v0;constructor(t,n){this.runtimeFlags=t,this.blockingOn=n}[ge](){return k(G(lm),le(G(this._tag)),le(G(this.runtimeFlags)),le(G(this.blockingOn)),Xe(this))}[pe](t){return RS(t)&&t._tag===v0&&this.runtimeFlags===t.runtimeFlags&&ue(this.blockingOn,t.blockingOn)}}const FB=new qB,PB=e=>new OB(e),DB=(e,t)=>new xB(e,t),RS=e=>X(e,Fi),NB=e=>e._tag===wh,MB=FB,F1=PB,LB=DB,UB=NB,jB=Symbol.for("effect/Micro"),vh=Symbol.for("effect/Micro/MicroExit"),E0=Symbol.for("effect/Micro/MicroCause"),zB={_E:se};class P1 extends globalThis.Error{_tag;traces;[E0];constructor(t,n,r){const s=`MicroCause.${t}`;let o,a,u;if(n instanceof globalThis.Error){o=`(${s}) ${n.name}`,a=n.message;const f=a.split(`
`).length;u=n.stack?`(${s}) ${n.stack.split(`
`).slice(0,f+3).join(`
`)}`:`${o}: ${a}`}else o=s,a=gi(n,0),u=`${o}: ${a}`;r.length>0&&(u+=`
    ${r.join(`
    `)}`),super(a),this._tag=t,this.traces=r,this[E0]=zB,this.name=o,this.stack=u}pipe(){return Z(this,arguments)}toString(){return this.stack}[Je](){return this.stack}}class BB extends P1{defect;constructor(t,n=[]){super("Die",t,n),this.defect=t}}const HB=(e,t=[])=>new BB(e,t);class WB extends P1{constructor(t=[]){super("Interrupt","interrupted",t)}}const VB=(e=[])=>new WB(e),KB=e=>e._tag==="Interrupt",k0=Symbol.for("effect/Micro/MicroFiber"),GB={_A:se,_E:se};class QB{context;interruptible;[k0];_stack=[];_observers=[];_exit;_children;currentOpCount=0;constructor(t,n=!0){this.context=t,this.interruptible=n,this[k0]=GB}getRef(t){return x3(this.context,t)}addObserver(t){return this._exit?(t(this._exit),il):(this._observers.push(t),()=>{const n=this._observers.indexOf(t);n>=0&&this._observers.splice(n,1)})}_interrupted=!1;unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(FS))}unsafePoll(){return this._exit}evaluate(t){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(t);if(n===sd)return;const r=T0.interruptChildren&&T0.interruptChildren(this);if(r!==void 0)return this.evaluate(kh(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(t){let n=!1,r=t;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(PS).shouldYield(this)){n=!0;const s=r;r=kh(e6,()=>s)}if(r=r[U_](this),r===sd){const s=this._yielded;return vh in s?(this._yielded=void 0,s):sd}}}catch(s){return X(r,U_)?j_(s):j_(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(t){for(;;){const n=this._stack.pop();if(!n)return;const r=n[Eh]&&n[Eh](this);if(r)return{[t]:r};if(n[t])return n}}_yielded=void 0;yieldWith(t){return this._yielded=t,sd}children(){return this._children??=new Set}}const T0=Oe("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),D1=Symbol.for("effect/Micro/identifier"),nn=Symbol.for("effect/Micro/args"),U_=Symbol.for("effect/Micro/evaluate"),mc=Symbol.for("effect/Micro/successCont"),Ba=Symbol.for("effect/Micro/failureCont"),Eh=Symbol.for("effect/Micro/ensureCont"),sd=Symbol.for("effect/Micro/Yield"),JB={_A:se,_E:se,_R:se},YB={...z4,_op:"Micro",[jB]:JB,pipe(){return Z(this,arguments)},[Symbol.iterator](){return new aC(new xc(this))},toJSON(){return{_id:"Micro",op:this[D1],...nn in this?{args:this[nn]}:void 0}},toString(){return ut(this)},[Je](){return ut(this)}};function XB(e){return j_("Micro.evaluate: Not implemented")}const fm=e=>({...YB,[D1]:e.op,[U_]:e.eval??XB,[mc]:e.contA,[Ba]:e.contE,[Eh]:e.ensure}),AS=e=>{const t=fm(e);return function(){const n=Object.create(t);return n[nn]=e.single===!1?arguments:arguments[0],n}},N1=e=>{const t={...fm(e),[vh]:vh,_tag:e.op,get[e.prop](){return this[nn]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[nn]}},[pe](n){return r6(n)&&n._tag===e.op&&ue(this[nn],n[nn])},[ge](){return Xe(this,le(Pt(e.op))(G(this[nn])))}};return function(n){const r=Object.create(t);return r[nn]=n,r[mc]=void 0,r[Ba]=void 0,r[Eh]=void 0,r}},qS=N1({op:"Success",prop:"value",eval(e){const t=e.getCont(mc);return t?t[mc](this[nn],e):e.yieldWith(this)}}),M1=N1({op:"Failure",prop:"cause",eval(e){let t=e.getCont(Ba);for(;KB(this[nn])&&t&&e.interruptible;)t=e.getCont(Ba);return t?t[Ba](this[nn],e):e.yieldWith(this)}}),ZB=AS({op:"Yield",eval(e){let t=!1;return e.getRef(PS).scheduleTask(()=>{t||e.evaluate(s6)},this[nn]??0),e.yieldWith(()=>{t=!0})}}),e6=ZB(0),t6=qS(void 0),OS=AS({op:"WithMicroFiber",eval(e){return this[nn](e)}}),kh=w(2,(e,t)=>{const n=Object.create(n6);return n[nn]=e,n[mc]=t,n}),n6=fm({op:"OnSuccess",eval(e){return e._stack.push(this),this[nn]}}),r6=e=>X(e,vh),L1=qS,xS=M1,FS=xS(VB()),j_=e=>xS(HB(e)),s6=L1(void 0),o6="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class U1{tasks=[];running=!1;scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,o6(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return t.currentOpCount>=t.getRef(c6)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const i6=w(2,(e,t)=>OS(n=>{const r=n.context;return n.context=t(r),f6(e,()=>(n.context=r,t6))})),a6=w(2,(e,t)=>i6(e,Po(t)));class c6 extends Cp()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class PS extends Cp()("effect/Micro/currentScheduler",{defaultValue:()=>new U1}){}const u6=w(2,(e,t)=>{const n=Object.create(l6);return n[nn]=e,n[mc]=t.onSuccess,n[Ba]=t.onFailure,n}),l6=fm({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[nn]}}),f6=w(2,(e,t)=>h6(n=>u6(n(e),{onFailure:r=>kh(t(xS(r)),()=>M1(r)),onSuccess:r=>kh(t(L1(r)),()=>qS(r))}))),j1=AS({op:"SetInterruptible",ensure(e){if(e.interruptible=this[nn],e._interrupted&&e.interruptible)return()=>FS}}),d6=e=>OS(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(j1(!1)),t._interrupted?FS:e)),h6=e=>OS(t=>t.interruptible?(t.interruptible=!1,t._stack.push(j1(!0)),e(d6)):e(se)),p6=(e,t)=>{const n=new QB(PS.context(new U1));return n.evaluate(e),n};class z1{buckets=[];scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class m6{maxNextTickBeforeTimer;running=!1;tasks=new z1;constructor(t){this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(M$)?t.getFiberRef(Xi):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const B1=Oe(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new m6(2048));class H1{tasks=new z1;deferred=!1;scheduleTask(t,n){this.deferred?B1.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(M$)?t.getFiberRef(Xi):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const dm=Oe(Symbol.for("effect/FiberRef/currentScheduler"),()=>mn(B1)),W1=Oe(Symbol.for("effect/FiberRef/currentRequestMap"),()=>mn(new Map)),C0=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return Vc(Oj,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},DS="InterruptSignal",NS="Stateful",MS="Resume",LS="YieldNow",$g=e=>({_tag:DS,cause:e}),qd=e=>({_tag:NS,onFiber:e}),ya=e=>({_tag:MS,effect:e}),g6=()=>({_tag:LS}),_6="effect/FiberScope",Th=Symbol.for(_6);class y6{[Th]=Th;fiberId=wr;roots=new Set;add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}class b6{fiberId;parent;[Th]=Th;constructor(t,n){this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(qd(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const S6=e=>new b6(e.id(),e),vf=Oe(Symbol.for("effect/FiberScope/Global"),()=>new y6),w6="effect/Fiber",v6=Symbol.for(w6),E6={_E:e=>e,_A:e=>e},k6="effect/Fiber",T6=Symbol.for(k6),V1=e=>e.await,C6=e=>e.inheritAll,I6=w(2,(e,t)=>k(Oi(e,K1(t)),We(k(e,Oi(V1))))),K1=w(2,(e,t)=>e.interruptAsFork(t)),gc=e=>po(Wc(e.await),e.inheritAll);({...Yl});const eo="effect/FiberCurrent",$6=()=>Vi(globalThis[eo]),R6="effect/Logger",A6=Symbol.for(R6),q6={_Message:e=>e,_Output:e=>e},Ef=e=>({[A6]:q6,log:e,pipe(){return Z(this,arguments)}}),O6=/^[^\s"=]*$/,x6=(e,t)=>({annotations:n,cause:r,date:s,fiberId:o,logLevel:a,message:u,spans:f})=>{const h=A=>A.match(O6)?A:e(A),p=(A,D)=>`${d1(A)}=${h(D)}`,m=(A,D)=>" "+p(A,D);let T=p("timestamp",s.toISOString());T+=m("level",a.label),T+=m("fiber",jp(o));const C=fb(u);for(let A=0;A<C.length;A++)T+=m("message",gi(C[A],t));UU(r)||(T+=m("cause",Do(r,{renderErrorCause:!0})));for(const A of f)T+=" "+vS(s.getTime())(A);for(const[A,D]of n)T+=m(A,gi(D,t));return T},F6=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,P6=Ef(x6(F6)),G1=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return wt(e)}},D6=(e,...t)=>{let n="";for(let r=0;r<t.length;r++)n+=`\x1B[${t[r]}m`;return n+e+"\x1B[0m"},N6=(e,...t)=>e,lr={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},M6={None:[],All:[],Trace:[lr.gray],Debug:[lr.blue],Info:[lr.green],Warning:[lr.yellow],Error:[lr.red],Fatal:[lr.bgBrightRed,lr.black]},L6={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},U6=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,Q1=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null,j6=Q1&&process.stdout.isTTY===!0,z6=Q1||"Deno"in globalThis,B6=e=>{const t=e?.mode??"auto",r=(t==="auto"?z6?"tty":"browser":t)==="browser",s=typeof e?.colors=="boolean"?e.colors:j6||r,o=e?.formatDate??U6;return r?W6({colors:s,formatDate:o}):H6({colors:s,formatDate:o,stderr:e?.stderr===!0})},H6=e=>{const t=typeof process=="object"&&"isBun"in process&&process.isBun===!0,n=e.colors?D6:N6;return Ef(({annotations:r,cause:s,context:o,date:a,fiberId:u,logLevel:f,message:h,spans:p})=>{const m=SS(o,as),T=Zn(m,im).unsafe,C=e.stderr===!0?T.error:T.log,A=fb(h);let D=n(`[${e.formatDate(a)}]`,lr.white)+` ${n(f.label,...M6[f._tag])} (${jp(u)})`;if(zb(p)){const b=a.getTime(),_=vS(b);for(const E of p)D+=" "+_(E)}D+=":";let y=0;if(A.length>0){const b=G1(A[0]);typeof b=="string"&&(D+=" "+n(b,lr.bold,lr.cyan),y++)}if(C(D),t||T.group(),Kb(s)||C(Do(s,{renderErrorCause:!0})),y<A.length)for(;y<A.length;y++)C(al(A[y]));if(t$(r)>0)for(const[b,_]of r)C(n(`${b}:`,lr.bold,lr.white),al(_));t||T.groupEnd()})},W6=e=>{const t=e.colors?"%c":"";return Ef(({annotations:n,cause:r,context:s,date:o,fiberId:a,logLevel:u,message:f,spans:h})=>{const p=SS(s,as),m=Zn(p,im).unsafe,T=fb(f);let C=`${t}[${e.formatDate(o)}]`;const A=[];if(e.colors&&A.push("color:gray"),C+=` ${t}${u.label}${t} (${jp(a)})`,e.colors&&A.push(L6[u._tag],""),zb(h)){const y=o.getTime(),b=vS(y);for(const _ of h)C+=" "+b(_)}C+=":";let D=0;if(T.length>0){const y=G1(T[0]);typeof y=="string"&&(C+=` ${t}${y}`,e.colors&&A.push("color:deepskyblue"),D++)}if(m.groupCollapsed(C,...A),Kb(r)||m.error(Do(r,{renderErrorCause:!0})),D<T.length)for(;D<T.length;D++)m.log(al(T[D]));if(t$(n)>0)for(const[y,b]of n){const _=al(b);e.colors?m.log(`%c${y}:`,"color:gray",_):m.log(`${y}:`,_)}m.groupEnd()})},J1="effect/MetricBoundaries",z_=Symbol.for(J1);class V6{values;[z_]=z_;constructor(t){this.values=t,this._hash=k(Pt(J1),le(Gl(this.values)))}_hash;[ge](){return this._hash}[pe](t){return K6(t)&&ue(this.values,t.values)}pipe(){return Z(this,arguments)}}const K6=e=>X(e,z_),G6=e=>{const t=k(e,db(mt(Number.POSITIVE_INFINITY)),bN);return new V6(t)},Q6=e=>k(YD(e.count-1,t=>e.start*Math.pow(e.factor,t)),Ft,G6),J6="effect/MetricKeyType",Y1=Symbol.for(J6),X1="effect/MetricKeyType/Counter",B_=Symbol.for(X1),Y6="effect/MetricKeyType/Frequency",X6=Symbol.for(Y6),Z6="effect/MetricKeyType/Gauge",eH=Symbol.for(Z6),Z1="effect/MetricKeyType/Histogram",H_=Symbol.for(Z1),tH="effect/MetricKeyType/Summary",nH=Symbol.for(tH),eR={_In:e=>e,_Out:e=>e};class rH{incremental;bigint;[Y1]=eR;[B_]=B_;constructor(t,n){this.incremental=t,this.bigint=n,this._hash=Pt(X1)}_hash;[ge](){return this._hash}[pe](t){return tR(t)}pipe(){return Z(this,arguments)}}class sH{boundaries;[Y1]=eR;[H_]=H_;constructor(t){this.boundaries=t,this._hash=k(Pt(Z1),le(G(this.boundaries)))}_hash;[ge](){return this._hash}[pe](t){return nR(t)&&ue(this.boundaries,t.boundaries)}pipe(){return Z(this,arguments)}}const oH=e=>new rH(e?.incremental??!1,e?.bigint??!1),iH=e=>new sH(e),tR=e=>X(e,B_),aH=e=>X(e,X6),cH=e=>X(e,eH),nR=e=>X(e,H_),uH=e=>X(e,nH),lH="effect/MetricKey",rR=Symbol.for(lH),fH={_Type:e=>e},dH=Zl(ue);class US{name;keyType;description;tags;[rR]=fH;constructor(t,n,r,s=[]){this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=k(Pt(this.name+this.description),le(G(this.keyType)),le(Gl(this.tags)))}_hash;[ge](){return this._hash}[pe](t){return hH(t)&&this.name===t.name&&ue(this.keyType,t.keyType)&&ue(this.description,t.description)&&dH(this.tags,t.tags)}pipe(){return Z(this,arguments)}}const hH=e=>X(e,rR),pH=(e,t)=>new US(e,oH(t),Vi(t?.description)),mH=(e,t,n)=>new US(e,iH(t),Vi(n)),gH=w(2,(e,t)=>t.length===0?e:new US(e.name,e.keyType,e.description,Ed(e.tags,t))),_H="effect/MetricState",kf=Symbol.for(_H),sR="effect/MetricState/Counter",W_=Symbol.for(sR),oR="effect/MetricState/Frequency",V_=Symbol.for(oR),iR="effect/MetricState/Gauge",K_=Symbol.for(iR),aR="effect/MetricState/Histogram",G_=Symbol.for(aR),cR="effect/MetricState/Summary",Q_=Symbol.for(cR),Tf={_A:e=>e};class yH{count;[kf]=Tf;[W_]=W_;constructor(t){this.count=t}[ge](){return k(G(sR),le(G(this.count)),Xe(this))}[pe](t){return RH(t)&&this.count===t.count}pipe(){return Z(this,arguments)}}const bH=Zl(ue);class SH{occurrences;[kf]=Tf;[V_]=V_;constructor(t){this.occurrences=t}_hash;[ge](){return k(Pt(oR),le(Gl(Ke(this.occurrences.entries()))),Xe(this))}[pe](t){return AH(t)&&bH(Ke(this.occurrences.entries()),Ke(t.occurrences.entries()))}pipe(){return Z(this,arguments)}}class wH{value;[kf]=Tf;[K_]=K_;constructor(t){this.value=t}[ge](){return k(G(iR),le(G(this.value)),Xe(this))}[pe](t){return qH(t)&&this.value===t.value}pipe(){return Z(this,arguments)}}class vH{buckets;count;min;max;sum;[kf]=Tf;[G_]=G_;constructor(t,n,r,s,o){this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[ge](){return k(G(aR),le(G(this.buckets)),le(G(this.count)),le(G(this.min)),le(G(this.max)),le(G(this.sum)),Xe(this))}[pe](t){return OH(t)&&ue(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return Z(this,arguments)}}class EH{error;quantiles;count;min;max;sum;[kf]=Tf;[Q_]=Q_;constructor(t,n,r,s,o,a){this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=a}[ge](){return k(G(cR),le(G(this.error)),le(G(this.quantiles)),le(G(this.count)),le(G(this.min)),le(G(this.max)),le(G(this.sum)),Xe(this))}[pe](t){return xH(t)&&this.error===t.error&&ue(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return Z(this,arguments)}}const kH=e=>new yH(e),TH=e=>new SH(e),CH=e=>new wH(e),IH=e=>new vH(e.buckets,e.count,e.min,e.max,e.sum),$H=e=>new EH(e.error,e.quantiles,e.count,e.min,e.max,e.sum),RH=e=>X(e,W_),AH=e=>X(e,V_),qH=e=>X(e,K_),OH=e=>X(e,G_),xH=e=>X(e,Q_),FH="effect/MetricHook",PH=Symbol.for(FH),DH={_In:e=>e,_Out:e=>e},Cf=e=>({[PH]:DH,pipe(){return Z(this,arguments)},...e}),I0=BigInt(0),NH=e=>{let t=e.keyType.bigint?I0:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=I0:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return Cf({get:()=>kH(t),update:r,modify:r})},MH=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return Cf({get:()=>TH(t),update:n,modify:n})},LH=(e,t)=>{let n=t;return Cf({get:()=>CH(n),update:r=>{n=r},modify:r=>{n=n+r}})},UH=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,a=0,u=Number.MAX_VALUE,f=Number.MIN_VALUE;k(t,cl(Za),ui((m,T)=>{s[T]=m}));const h=m=>{let T=0,C=n;for(;T!==C;){const A=Math.floor(T+(C-T)/2),D=s[A];m<=D?C=A:T=A,C===T+1&&(m<=s[T]?C=T:T=C)}r[T]=r[T]+1,o=o+1,a=a+m,m<u&&(u=m),m>f&&(f=m)},p=()=>{const m=yp(n);let T=0;for(let C=0;C<n;C++){const A=s[C],D=r[C];T=T+D,m[C]=[A,T]}return m};return Cf({get:()=>IH({buckets:p(),count:o,min:u,max:f,sum:a}),update:h,modify:h})},jH=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=k(s,cl(Za)),a=yp(r);let u=0,f=0,h=0,p=Number.MAX_VALUE,m=Number.MIN_VALUE;const T=A=>{const D=[];let y=0;for(;y!==r-1;){const b=a[y];if(b!=null){const[_,E]=b,v=ki(A-_);fM(v,Ib)&&FI(v,n)&&D.push(E)}y=y+1}return zH(t,o,cl(D,Za))},C=(A,D)=>{if(r>0){u=u+1;const y=u%r;a[y]=[D,A]}f=f+1,h=h+A,A<p&&(p=A),A>m&&(m=A)};return Cf({get:()=>$H({error:t,quantiles:T(Date.now()),count:f,min:p,max:m,sum:h}),update:([A,D])=>C(A,D),modify:([A,D])=>C(A,D)})},zH=(e,t,n)=>{const r=n.length;if(!pt(t))return yo();const s=t[0],o=t.slice(1),a=$0(e,r,W(),0,s,n),u=ur(a);return o.forEach(f=>{u.push($0(e,r,a.value,a.consumed,f,a.rest))}),ui(u,f=>[f.quantile,f.value])},$0=(e,t,n,r,s,o)=>{let a=e,u=t,f=n,h=r,p=s,m=o,T=e,C=t,A=n,D=r,y=s,b=o;for(;;){if(!pt(m))return{quantile:p,value:W(),consumed:h,rest:[]};if(p===1)return{quantile:p,value:V(OC(m)),consumed:h+m.length,rest:[]};const _=On(m),E=xC(m,N=>N===_),v=p*u,R=a/2*v,q=h+E[0].length,x=Math.abs(q-v);if(q<v-R){T=a,C=u,A=Vu(m),D=q,y=p,b=E[1],a=T,u=C,f=A,h=D,p=y,m=b;continue}if(q>v+R){const N=dt(f)?V(_):f;return{quantile:p,value:N,consumed:h,rest:m}}switch(f._tag){case"None":{T=a,C=u,A=Vu(m),D=q,y=p,b=E[1],a=T,u=C,f=A,h=D,p=y,m=b;continue}case"Some":{const N=Math.abs(v-f.value);if(x<N){T=a,C=u,A=Vu(m),D=q,y=p,b=E[1],a=T,u=C,f=A,h=D,p=y,m=b;continue}return{quantile:p,value:V(f.value),consumed:h,rest:m}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},BH="effect/MetricPair",HH=Symbol.for(BH),WH={_Type:e=>e},VH=(e,t)=>({[HH]:WH,metricKey:e,metricState:t,pipe(){return Z(this,arguments)}}),KH="effect/MetricRegistry",R0=Symbol.for(KH);class GH{[R0]=R0;map=mz();snapshot(){const t=[];for(const[n,r]of this.map)t.push(VH(n,r.get()));return t}get(t){const n=k(this.map,Yo(t),dr);if(n==null){if(tR(t.keyType))return this.getCounter(t);if(cH(t.keyType))return this.getGauge(t);if(aH(t.keyType))return this.getFrequency(t);if(nR(t.keyType))return this.getHistogram(t);if(uH(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=k(this.map,Yo(t),dr);if(n==null){const r=NH(t);k(this.map,Su(t))||k(this.map,wu(t,r)),n=r}return n}getFrequency(t){let n=k(this.map,Yo(t),dr);if(n==null){const r=MH(t);k(this.map,Su(t))||k(this.map,wu(t,r)),n=r}return n}getGauge(t){let n=k(this.map,Yo(t),dr);if(n==null){const r=LH(t,t.keyType.bigint?BigInt(0):0);k(this.map,Su(t))||k(this.map,wu(t,r)),n=r}return n}getHistogram(t){let n=k(this.map,Yo(t),dr);if(n==null){const r=UH(t);k(this.map,Su(t))||k(this.map,wu(t,r)),n=r}return n}getSummary(t){let n=k(this.map,Yo(t),dr);if(n==null){const r=jH(t);k(this.map,Su(t))||k(this.map,wu(t,r)),n=r}return n}}const QH=()=>new GH,JH="effect/Metric",YH=Symbol.for(JH),XH={_Type:e=>e,_In:e=>e,_Out:e=>e},A0=Oe(Symbol.for("effect/Metric/globalMetricRegistry"),()=>QH()),uR=function(e,t,n,r){const s=Object.assign(o=>Us(o,a=>n5(s,a)),{[YH]:XH,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return Z(this,arguments)}});return s},hm=(e,t)=>lR(pH(e,t)),lR=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=A0.get(e)),t;let o=n.get(s);return o!==void 0||(o=A0.get(gH(e,s)),n.set(s,o)),o};return uR(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},ZH=(e,t,n)=>lR(mH(e,t,n)),e5=w(3,(e,t,n)=>t5(e,[J4(t,n)])),t5=w(2,(e,t)=>uR(e.keyType,(n,r)=>e.unsafeUpdate(n,Ed(t,r)),n=>e.unsafeValue(Ed(t,n)),(n,r)=>e.unsafeModify(n,Ed(t,r)))),n5=w(2,(e,t)=>Vc(I_,n=>B(()=>e.unsafeUpdate(t,n)))),r5="effect/Request",s5=Symbol.for(r5),o5={_E:e=>e,_A:e=>e},i5={...ab,[s5]:o5},a5=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=i5,e}(),c5=w(2,(e,t)=>Vc(W1,n=>B(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,yf(r.result,t))}}))),u5="effect/Supervisor",pm=Symbol.for(u5),jS={_T:e=>e};class mm{underlying;value0;[pm]=jS;constructor(t,n){this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new mm(this,k(this.value,fe(t)))}zip(t){return new gm(this,t)}}class gm{left;right;_tag="Zip";[pm]=jS;constructor(t,n){this.left=t,this.right=n}get value(){return x$(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new mm(this,k(this.value,fe(t)))}zip(t){return new gm(this,t)}}const fR=e=>X(e,pm)&&tb(e,"Zip");class l5{effect;[pm]=jS;constructor(t){this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new mm(this,k(this.value,fe(t)))}zip(t){return new gm(this,t)}onRun(t,n){return t()}}const f5=e=>new l5(e),_m=Oe("effect/Supervisor/none",()=>f5(be)),d5=Lc,dR="Empty",hR="AddSupervisor",pR="RemoveSupervisor",mR="AndThen",Qu={_tag:dR},Od=(e,t)=>({_tag:mR,first:e,second:t}),h5=(e,t)=>p5(t,mt(e)),p5=(e,t)=>{let n=e,r=t;for(;rs(r);){const s=Jr(r);switch(s._tag){case dR:{r=ks(r);break}case hR:{n=n.zip(s.supervisor),r=ks(r);break}case pR:{n=J_(n,s.supervisor),r=ks(r);break}case mR:{r=pn(s.first)(pn(s.second)(ks(r)));break}}}return n},J_=(e,t)=>ue(e,t)?_m:fR(e)?J_(e.left,t).zip(J_(e.right,t)):e,Ch=e=>ue(e,_m)?Ci():fR(e)?k(Ch(e.left),pl(Ch(e.right))):Lp(e),m5=(e,t)=>{if(ue(e,t))return Qu;const n=Ch(e),r=Ch(t),s=k(r,DE(n),ml(Qu,(a,u)=>Od(a,{_tag:hR,supervisor:u}))),o=k(n,DE(r),ml(Qu,(a,u)=>Od(a,{_tag:pR,supervisor:u})));return Od(s,o)},g5=d5({empty:Qu,patch:h5,combine:Od,diff:m5}),_5=hm("effect_fiber_started",{incremental:!0}),q0=hm("effect_fiber_active"),y5=hm("effect_fiber_successes",{incremental:!0}),b5=hm("effect_fiber_failures",{incremental:!0}),S5=e5(ZH("effect_fiber_lifetimes",Q6({start:.5,factor:2,count:35})),"time_unit","milliseconds"),Eu="Continue",w5="Done",O0="Yield",v5={_E:e=>e,_A:e=>e},od=e=>{throw new Error(`BUG: FiberRuntime - ${gi(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},_s=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),ys=Oe("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),ku={[Kd]:(e,t,n)=>rt(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>Ve(Ve(n)),[Gd]:(e,t,n)=>rt(()=>t.effect_instruction_i2(n)),[ib]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),to(e.currentRuntimeFlags)&&e.isInterrupted()?He(e.getInterruptedCause()):Ve(n)),[Qd]:(e,t,n)=>(rt(()=>t.effect_instruction_i2(n)),rt(()=>t.effect_instruction_i0())?(e.pushStack(t),rt(()=>t.effect_instruction_i1())):be),[Wu]:(e,t,n)=>{const r=rt(()=>t.effect_instruction_i0.next(n));return r.done?Ve(r.value):(e.pushStack(t),uC(r.value))}},E5={[DS]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),to(t)?He(r.cause):n),[MS]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[NS]:(e,t,n,r)=>(r.onFiber(e,F1(t)),n),[LS]:(e,t,n,r)=>U(ff(),()=>n)},k5=e=>Oi(kU(e),t=>Os(MU(t),([n,r])=>{const s=new Map,o=[];for(const u of r){o.push(Sr(u));for(const f of u)s.set(f.request,f)}const a=o.flat();return Yi(V5(n.runAll(o),a,()=>a.forEach(u=>{u.listeners.interrupted=!0})),W1,s)},!1,!1)),T5=dp();class gR extends hs{[v6]=E6;[T6]=v5;_fiberRefs;_fiberId;_queue=new Array;_children=null;_observers=new Array;_running=!1;_stack=[];_asyncInterruptor=null;_asyncBlockingOn=null;_exitValue=null;_steps=[];_isYielding=!1;currentRuntimeFlags;currentOpCount=0;currentSupervisor;currentScheduler;currentTracer;currentSpan;currentContext;currentDefaultServices;constructor(t,n,r){if(super(),this.currentRuntimeFlags=r,this._fiberId=t,this._fiberRefs=n,jE(r)){const s=this.getFiberRef(I_);_5.unsafeUpdate(1,s),q0.unsafeUpdate(1,s)}this.refreshRefCache()}commit(){return gc(this)}id(){return this._fiberId}resume(t){this.tell(ya(t))}get status(){return this.ask((t,n)=>n)}get runtimeFlags(){return this.ask((t,n)=>UB(n)?t.currentRuntimeFlags:n.runtimeFlags)}scope(){return S6(this)}get children(){return this.ask(t=>Array.from(t.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(rd)}fiberRefs(){return this.ask(t=>t.getFiberRefs())}ask(t){return ne(()=>{const n=mf(this._fiberId);return this.tell(qd((r,s)=>{yf(n,B(()=>t(r,s)))})),os(n)})}tell(t){this._queue.push(t),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Ms(t=>{const n=r=>t(H(r));return this.tell(qd((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),B(()=>this.tell(qd((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return Ae((t,n)=>{const r=t.id(),s=t.getFiberRefs(),o=n.runtimeFlags,a=this.getFiberRefs(),u=R4(s,r,a);t.setFiberRefs(u);const f=t.getFiberRef(D0),h=k(fi(o,f),BE(Uc),BE(k_));return fj(h)})}get poll(){return B(()=>Vi(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(t){return B(()=>this.tell($g(hr(t))))}unsafeInterruptAsFork(t){this.tell($g(hr(t)))}addObserver(t){this._exitValue!==null?t(this._exitValue):this._observers.push(t)}removeObserver(t){this._observers=this._observers.filter(n=>n!==t)}getFiberRefs(){return this.setFiberRef(D0,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(t){this._fiberRefs=c1(this._fiberRefs,t)}getFiberRef(t){return this._fiberRefs.locals.has(t)?this._fiberRefs.locals.get(t)[0][1]:t.initial}setFiberRef(t,n){this._fiberRefs=x_(this._fiberRefs,{fiberId:this._fiberId,fiberRef:t,value:n}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(as),this.currentTracer=this.currentDefaultServices.unsafeMap.get(Sf.key),this.currentSupervisor=this.getFiberRef(H5),this.currentScheduler=this.getFiberRef(dm),this.currentContext=this.getFiberRef(Mr),this.currentSpan=this.currentContext.unsafeMap.get(is.key)}setFiberRefs(t){this._fiberRefs=t,this.refreshRefCache()}addChild(t){this.getChildren().add(t)}removeChild(t){this.getChildren().delete(t)}transferChildren(t){const n=this._children;if(this._children=null,n!==null&&n.size>0)for(const r of n)r._exitValue===null&&t.add(this.currentRuntimeFlags,r)}drainQueueOnCurrentThread(){let t=!0;for(;t;){let n=Eu;const r=globalThis[eo];globalThis[eo]=this;try{for(;n===Eu;)n=this._queue.length===0?w5:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[eo]=r}this._queue.length>0&&!this._running?(this._running=!0,n===O0?(this.drainQueueLaterOnExecutor(),t=!1):t=!0):t=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(Xi))}drainQueueWhileRunning(t,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=E5[s._tag](this,t,r,s)}return r}isInterrupted(){return!Kb(this.getFiberRef(rd))}addInterruptedCause(t){const n=this.getFiberRef(rd);this.setFiberRef(rd,Kt(n,t))}processNewInterruptSignal(t){this.addInterruptedCause(t),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let t=!1;for(const n of this._children)n.tell($g(hr(this.id()))),t=!0;return t}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const t=this._children.values();this._children=null;let n=!1;return rS({while:()=>!n,body:()=>{const s=t.next();return s.done?B(()=>{n=!0}):or(s.value.await)},step:()=>{}})}return null}reportExitValue(t){if(jE(this.currentRuntimeFlags)){const n=this.getFiberRef(I_),r=this.id().startTimeMillis,s=Date.now();switch(S5.unsafeUpdate(s-r,n),q0.unsafeUpdate(-1,n),t._tag){case sn:{y5.unsafeUpdate(1,n);break}case rn:{b5.unsafeUpdate(1,n);break}}}if(t._tag==="Failure"){const n=this.getFiberRef(oS);!Vp(t.cause)&&n._tag==="Some"&&this.log("Fiber terminated with an unhandled error",t.cause,n)}}setExitValue(t){this._exitValue=t,this.reportExitValue(t);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](t);this._observers=[]}getLoggers(){return this.getFiberRef(ym)}log(t,n,r){const s=tt(r)?r.value:this.getFiberRef(Rj),o=this.getFiberRef(_R);if(U4(o,s))return;const a=this.getFiberRef(Aj),u=this.getFiberRef(L$),f=this.getLoggers(),h=this.getFiberRefs();if(Nb(f)>0){const p=Zn(this.getFiberRef(as),Zi),m=new Date(p.unsafeCurrentTimeMillis());fD(h,()=>{for(const T of f)T.log({fiberId:this.id(),logLevel:s,message:t,cause:n,context:h,spans:a,annotations:u,date:m})})}}evaluateMessageWhileSuspended(t){switch(t._tag){case LS:return O0;case DS:return this.processNewInterruptSignal(t.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(He(t.cause)),this._asyncInterruptor=null),Eu;case MS:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(t.effect),Eu;case NS:return t.onFiber(this,this._exitValue!==null?MB:LB(this.currentRuntimeFlags,this._asyncBlockingOn)),Eu;default:return od(t)}}evaluateEffect(t){this.currentSupervisor.onResume(this);try{let n=to(this.currentRuntimeFlags)&&this.isInterrupted()?He(this.getInterruptedCause()):t;for(;n!==null;){const r=n,s=this.runLoop(r);if(s===_s){const o=ys.currentOp;ys.currentOp=null,o._op===wd?bU(this.currentRuntimeFlags)?(this.tell(g6()),this.tell(ya(ln)),n=null):n=ln:o._op===Hu&&(n=null)}else{this.currentRuntimeFlags=k(this.currentRuntimeFlags,SU(k_));const o=this.interruptAllChildren();o!==null?n=U(o,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(ya(s)),n=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(t){if(this._running)this.tell(ya(t));else{this._running=!0;const n=globalThis[eo];globalThis[eo]=this;try{this.evaluateEffect(t)}finally{this._running=!1,globalThis[eo]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(t){this.tell(ya(t))}patchRuntimeFlags(t,n){const r=Ua(t,n);return globalThis[eo]=this,this.currentRuntimeFlags=r,r}initiateAsync(t,n){let r=!1;const s=o=>{r||(r=!0,this.tell(ya(o)))};to(t)&&(this._asyncInterruptor=s);try{n(s)}catch(o){s(vt(xn(o)))}}pushStack(t){this._stack.push(t),t._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const t=this._stack.pop();if(t)return t._op==="OnStep"&&this._steps.pop(),t}getNextSuccessCont(){let t=this.popStack();for(;t;){if(t._op!==Sd)return t;t=this.popStack()}}getNextFailCont(){let t=this.popStack();for(;t;){if(t._op!==Kd&&t._op!==Qd&&t._op!==Wu)return t;t=this.popStack()}}[dD](t){return B(()=>Tp(this.currentContext,t))}Left(t){return lt(t.left)}None(t){return lt(new pf)}Right(t){return Ve(t.right)}Some(t){return Ve(t.value)}Micro(t){return yl(n=>{let r=n;const s=p6(a6(t,this.currentContext));return s.addObserver(o=>{if(o._tag==="Success")return r(Ve(o.value));switch(o.cause._tag){case"Interrupt":return r(He(hr(wr)));case"Fail":return r(lt(o.cause.error));case"Die":return r(bl(o.cause.defect))}}),yl(o=>{r=a=>{o(be)},s.unsafeInterrupt()})})}[pC](t){const n=rt(()=>t.effect_instruction_i0()),r=this.getNextSuccessCont();return r!==void 0?(r._op in ku||od(r),ku[r._op](this,r,n)):(ys.currentOp=Ve(n),_s)}[sn](t){const n=t,r=this.getNextSuccessCont();return r!==void 0?(r._op in ku||od(r),ku[r._op](this,r,n.effect_instruction_i0)):(ys.currentOp=n,_s)}[rn](t){const n=t.effect_instruction_i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case Sd:case Gd:return to(this.currentRuntimeFlags)&&this.isInterrupted()?He(HE(n)):rt(()=>r.effect_instruction_i1(n));case"OnStep":return to(this.currentRuntimeFlags)&&this.isInterrupted()?He(HE(n)):Ve(He(n));case ib:return this.patchRuntimeFlags(this.currentRuntimeFlags,r.patch),to(this.currentRuntimeFlags)&&this.isInterrupted()?He(Kt(n,this.getInterruptedCause())):He(n);default:od(r)}else return ys.currentOp=He(n),_s}[mC](t){return rt(()=>t.effect_instruction_i0(this,F1(this.currentRuntimeFlags)))}Blocked(t){const n=this.getFiberRefs(),r=this.currentRuntimeFlags;if(this._steps.length>0){const s=[],o=this._steps[this._steps.length-1];let a=this.popStack();for(;a&&a._op!=="OnStep";)s.push(a),a=this.popStack();this.setFiberRefs(o.refs),this.currentRuntimeFlags=o.flags;const u=$l(o.refs,n),f=fi(o.flags,r);return Ve(C$(t.effect_instruction_i0,Ae(h=>{for(;s.length>0;)h.pushStack(s.pop());return h.setFiberRefs(Rl(h.id(),h.getFiberRefs())(u)),h.currentRuntimeFlags=Ua(f)(h.currentRuntimeFlags),t.effect_instruction_i1})))}return Dn(s=>U(yc(rj(t.effect_instruction_i0)),()=>s(t.effect_instruction_i1)))}RunBlocked(t){return k5(t.effect_instruction_i0)}[Fc](t){const n=t.effect_instruction_i0,r=this.currentRuntimeFlags,s=Ua(r,n);if(to(s)&&this.isInterrupted())return He(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,n),t.effect_instruction_i1){const o=fi(s,r);return this.pushStack(new sj(o,t)),rt(()=>t.effect_instruction_i1(r))}else return ln}[Kd](t){return this.pushStack(t),t.effect_instruction_i0}OnStep(t){return this.pushStack(t),t.effect_instruction_i0}[Sd](t){return this.pushStack(t),t.effect_instruction_i0}[Gd](t){return this.pushStack(t),t.effect_instruction_i0}[Hu](t){return this._asyncBlockingOn=t.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,t.effect_instruction_i0),ys.currentOp=t,_s}[wd](t){return this._isYielding=!1,ys.currentOp=t,_s}[Qd](t){const n=t.effect_instruction_i0,r=t.effect_instruction_i1;return n()?(this.pushStack(t),r()):ln}[Wu](t){return ku[Wu](this,t,void 0)}[Ql](t){return rt(()=>t.commit())}runLoop(t){let n=t;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&yU)!==0&&this.currentSupervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this.currentRuntimeFlags,n)),!this._isYielding){this.currentOpCount+=1;const r=this.currentScheduler.shouldYield(this);if(r!==!1){this._isYielding=!0,this.currentOpCount=0;const s=n;n=U(ff({priority:r}),()=>s)}}try{if(n=this.currentTracer.context(()=>T5!==n[qi]._V?C_(`Cannot execute an Effect versioned ${n[qi]._V} with a Runtime of version ${dp()}`):this[n._op](n),this),n===_s){const r=ys.currentOp;return r._op===wd||r._op===Hu?_s:(ys.currentOp=null,r._op===sn||r._op===rn?r:He(xn(r)))}}catch(r){n!==_s&&!X(n,"_op")||!(n._op in this)?n=C_(`Not a valid effect: ${gi(n)}`):zj(r)?n=He(Kt(xn(r),hr(wr))):n=bl(r)}}}run=()=>{this.drainQueueOnCurrentThread()}}const _R=Oe("effect/FiberRef/currentMinimumLogLevel",()=>mn(j4("Info"))),C5=e=>Ef(t=>{const n=SS(t.context,as);Zn(n,im).unsafe.log(e.log(t))}),yR=Oe(Symbol.for("effect/Logger/defaultLogger"),()=>C5(P6)),bR=Oe(Symbol.for("effect/Logger/tracerLogger"),()=>Ef(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const a=tr(kl(n,Mr),is);if(a._tag==="None"||a.value._tag==="ExternalSpan")return;const u=Tp(kl(n,as),Zi),f={};for(const[h,p]of e)f[h]=p;f["effect.fiberId"]=oL(r),f["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(f["effect.cause"]=Do(t,{renderErrorCause:!0})),a.value.event(gi(Array.isArray(o)?o[0]:o),u.unsafeCurrentTimeNanos(),f)})),ym=Oe(Symbol.for("effect/FiberRef/currentLoggers"),()=>Cj(Lp(yR,bR))),zS=w(e=>sr(e[0]),(e,t)=>Ws(Us(e,n=>SR(r=>t(n,r))))),SR=e=>Ae(t=>{const n=t.getFiberRefs(),r=t.currentRuntimeFlags;return U(ER,s=>wl(s,o=>Ae(a=>{const u=a.getFiberRefs(),f=a.currentRuntimeFlags,h=$l(u,n),p=fi(f,r),m=$l(n,u);return a.setFiberRefs(Rl(h,a.id(),n)),bc(pj(e(o),p),B(()=>{a.setFiberRefs(Rl(m,a.id(),a.getFiberRefs()))}))})))}),I5=e=>{if(Array.isArray(e)||nb(e))return[e,W()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),V(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},$5=(e,t,n)=>{const r=[];for(const s of e)r.push(dc(s));return U(_c(r,se,{concurrency:n?.concurrency,batching:n?.batching,concurrentFinalizers:n?.concurrentFinalizers}),s=>{const o=W(),a=s.length,u=new Array(a),f=new Array(a);let h=!1;for(let p=0;p<a;p++){const m=s[p];m._tag==="Left"?(u[p]=V(m.left),h=!0):(f[p]=m.right,u[p]=o)}return h?t._tag==="Some"?lt(t.value(u)):lt(u):n?.discard?be:t._tag==="Some"?H(t.value(f)):H(f)})},R5=(e,t,n)=>{const r=[];for(const s of e)r.push(dc(s));return n?.discard?_c(r,se,{concurrency:n?.concurrency,batching:n?.batching,discard:!0,concurrentFinalizers:n?.concurrentFinalizers}):fe(_c(r,se,{concurrency:n?.concurrency,batching:n?.batching,concurrentFinalizers:n?.concurrentFinalizers}),s=>t._tag==="Some"?t.value(s):s)},bm=(e,t)=>{const[n,r]=I5(e);return t?.mode==="validate"?$5(n,r,t):t?.mode==="either"?R5(n,r,t):t?.discard!==!0&&r._tag==="Some"?fe(_c(n,se,t),r.value):_c(n,se,t)},A5=w(2,(e,t)=>Array.from({length:t},()=>e)),q5=w(e=>sr(e[0]),(e,t,n)=>bm(A5(e,t),n)),_c=w(e=>nb(e[0]),(e,t,n)=>Ae(r=>{const s=n?.batching===!0||n?.batching==="inherit"&&r.getFiberRef(xj);return n?.discard?C0(n.concurrency,()=>ba(Sh,n?.concurrentFinalizers)(o=>s?Os(e,(a,u)=>o(t(a,u)),!0,!1,1):Oi(e,(a,u)=>o(t(a,u)))),()=>ba(M_,n?.concurrentFinalizers)(o=>Os(e,(a,u)=>o(t(a,u)),s,!1)),o=>ba(L_(o),n?.concurrentFinalizers)(a=>Os(e,(u,f)=>a(t(u,f)),s,!1,o))):C0(n?.concurrency,()=>ba(Sh,n?.concurrentFinalizers)(o=>s?Y_(e,1,(a,u)=>o(t(a,u)),!0):Ts(e,(a,u)=>o(t(a,u)))),()=>ba(M_,n?.concurrentFinalizers)(o=>BS(e,(a,u)=>o(t(a,u)),s)),o=>ba(L_(o),n?.concurrentFinalizers)(a=>Y_(e,o,(u,f)=>a(t(u,f)),s)))})),BS=(e,t,n)=>ne(()=>{const r=Ke(e),s=new Array(r.length);return We(Os(r,(a,u)=>U(t(a,u),f=>B(()=>s[u]=f)),n,!1),H(s))}),Os=(e,t,n,r,s)=>Dn(o=>lj(a=>Ae(u=>{let f=Array.from(e).reverse(),h=f.length;if(h===0)return be;let p=0,m=!1;const T=s?Math.min(f.length,s):f.length,C=new Set,A=new Array,D=()=>C.forEach(N=>{N.currentScheduler.scheduleTask(()=>{N.unsafeInterruptAsFork(u.id())},0)}),y=new Array,b=new Array,_=new Array,E=()=>{const N=A.filter(({exit:j})=>j._tag==="Failure").sort((j,P)=>j.index<P.index?-1:j.index===P.index?0:1).map(({exit:j})=>j);return N.length===0&&N.push(ln),N},v=(N,j=!1)=>{const P=Ws(a(N)),L=x5(P,u,u.currentRuntimeFlags,vf);return u.currentScheduler.scheduleTask(()=>{j&&L.unsafeInterruptAsFork(u.id()),L.resume(P)},0),L},R=()=>{r||(h-=f.length,f=[]),m=!0,D()},q=n?aj:Fr,x=v(Ms(N=>{const j=(L,Q)=>{L._op==="Blocked"?_.push(L):(A.push({index:Q,exit:L}),L._op==="Failure"&&!m&&R())},P=()=>{if(f.length>0){const L=f.pop();let Q=p++;const oe=()=>{const nt=f.pop();return Q=p++,U(ff(),()=>U(q(o(t(nt,Q))),J))},J=nt=>f.length>0&&(j(nt,Q),f.length>0)?oe():H(nt),De=U(q(o(t(L,Q))),J),qe=v(De);y.push(qe),C.add(qe),m&&qe.currentScheduler.scheduleTask(()=>{qe.unsafeInterruptAsFork(u.id())},0),qe.addObserver(nt=>{let gt;if(nt._op==="Failure"?gt=nt:gt=nt.effect_instruction_i0,b.push(qe),C.delete(qe),j(gt,Q),A.length===h)N(H(ht(ja(E(),{parallel:!0}),()=>ln)));else if(_.length+A.length===h){const Mn=E(),Jf=_.map(we=>we.effect_instruction_i0).reduce(m$);N(H(C$(Jf,Os([ht(ja(Mn,{parallel:!0}),()=>ln),..._.map(we=>we.effect_instruction_i1)],we=>we,n,!0,s))))}else P()})}};for(let L=0;L<T;L++)P()}));return or(Ls(Wc(o(gc(x))),rm({onFailure:N=>{R();const j=_.length+1,P=Math.min(typeof s=="number"?s:_.length,_.length),L=Array.from(_);return Ms(Q=>{let oe=0,J=0;const De=(nt,gt)=>Mn=>{oe++,oe===j&&Q(Ve(He(N))),L.length>0&&gt&&qe()},qe=()=>{v(L.pop(),!0).addObserver(De(J,!0)),J++};x.addObserver(De(J,!1)),J++;for(let nt=0;nt<P;nt++)qe()})},onSuccess:()=>Ts(b,N=>N.inheritAll)})))}))),Y_=(e,t,n,r)=>ne(()=>{const s=Ke(e),o=new Array(s.length);return We(Os(s,(u,f)=>fe(n(u,f),h=>o[f]=h),r,!1,t),H(o))}),O5=e=>Ae((t,n)=>H(HS(e,t,n.runtimeFlags))),yc=e=>F5(e,vf),HS=(e,t,n,r=null)=>{const s=Ih(e,t,n,r);return s.resume(e),s},x5=(e,t,n,r=null)=>Ih(e,t,n,r),Ih=(e,t,n,r=null)=>{const s=XI(),o=t.getFiberRefs(),a=A4(o,s),u=new gR(s,a,n),f=kl(a,Mr),h=u.currentSupervisor;return h.onStart(f,e,V(t),u),u.addObserver(m=>h.onEnd(m,u)),(r!==null?r:k(t.getFiberRef($_),ht(()=>t.scope()))).add(n,u),u},F5=(e,t)=>Ae((n,r)=>H(HS(e,n,r.runtimeFlags,t))),x0=e=>Jc(t=>Qe(tr(t,Lr),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return U(tm(n,M_),r=>ea(e,r))}}})),F0=e=>t=>Jc(n=>Qe(tr(n,Lr),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:U(tm(r,L_(e)),s=>ea(t,s))})),ba=(e,t)=>n=>Jc(r=>Qe(tr(r,Lr),{onNone:()=>n(se),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?x0:e._tag==="Sequential"?P0:F0(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(x0));case"Sequential":return o(n(P0));case"ParallelN":return o(n(F0(s.strategy.parallelism)))}}else return n(se)}})),wR=e=>U(Lr,e),vR=e=>U(Zc(),t=>Ls(e(t),n=>t.close(n))),P5=e=>U(Zc(),t=>j5(e,t)),P0=e=>Jc(t=>Qe(tr(t,Lr),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return U(tm(n,Sh),r=>ea(e,r))}}})),D5=w(e=>sr(e[1]),(e,t,n)=>If(e,t,(r,s)=>[r,s],n)),N5=w(e=>sr(e[1]),(e,t,n)=>n?.concurrent!==!0&&(n?.batching===void 0||n.batching===!1)?po(e,t):If(e,t,(r,s)=>r,n)),M5=w(e=>sr(e[1]),(e,t,n)=>n?.concurrent!==!0&&(n?.batching===void 0||n.batching===!1)?We(e,t):If(e,t,(r,s)=>s,n)),If=w(e=>sr(e[1]),(e,t,n,r)=>fe(bm([e,t],{concurrency:r?.concurrent?2:1,batching:r?.batching,concurrentFinalizers:r?.concurrentFinalizers}),([s,o])=>n(s,o))),Lr=Nn("effect/Scope"),ER=Lr,L5=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.set({},t)},U5={[GE]:GE,[QE]:QE,pipe(){return Z(this,arguments)},fork(e){return B(()=>{const t=kR(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n={},r=s=>t.close(s);return this.state.finalizers.set(n,r),L5(t,s=>B(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return ne(()=>{if(this.state._tag==="Closed")return be;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?be:$B(this.strategy)?k(Ts(t,n=>Fr(n(e))),U(n=>k(ja(n),ci(Tg),ht(()=>ln)))):RB(this.strategy)?k(BS(t,n=>Fr(n(e)),!1),U(n=>k(ja(n,{parallel:!0}),ci(Tg),ht(()=>ln)))):k(Y_(t,this.strategy.parallelism,n=>Fr(n(e)),!1),U(n=>k(ja(n,{parallel:!0}),ci(Tg),ht(()=>ln))))})},addFinalizer(e){return ne(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.set({},e),be))}},kR=(e=wf)=>{const t=Object.create(U5);return t.strategy=e,t.state={_tag:"Open",finalizers:new Map},t},Zc=(e=wf)=>B(()=>kR(e)),ea=w(2,(e,t)=>V$(e,Po(kp(Lr,t)))),j5=w(2,(e,t)=>k(e,ea(t),Ls(n=>t.close(n)))),z5=e=>Kc(e,{differ:g5,fork:Qu}),B5=w(2,(e,t)=>or(zS(U(df(e),n=>zt(hh(e,t),n)),n=>hh(e,n)))),WS=w(2,(e,t)=>Vc(e,n=>B5(e,t(n)))),D0=$j(wU),H5=z5(_m),TR=w(3,(e,t,n)=>IR(e,t,{onSelfWin:(r,s)=>U(r.await,o=>{switch(o._tag){case sn:return U(r.inheritAll,()=>n.onSelfDone(o,s));case rn:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>U(r.await,o=>{switch(o._tag){case sn:return U(r.inheritAll,()=>n.onOtherDone(o,s));case rn:return n.onOtherDone(o,s)}})})),W5=e=>Dn(t=>Ji(n=>U(yc(t(e)),r=>k(t(gc(r)),No(()=>k(r,K1(n))))))),CR=w(2,(e,t)=>Ji(n=>TR(e,t,{onSelfDone:(r,s)=>q_(r,{onFailure:o=>k(gc(s),b0(a=>Ns(o,a))),onSuccess:o=>k(s,Cs(n),zt(o))}),onOtherDone:(r,s)=>q_(r,{onFailure:o=>k(gc(s),b0(a=>Ns(a,o))),onSuccess:o=>k(s,Cs(n),zt(o))})}))),IR=w(3,(e,t,n)=>Ae((r,s)=>{const o=s.runtimeFlags,a=Ki(!0),u=Ih(e,r,o,n.selfScope),f=Ih(t,r,o,n.otherScope);return Ms(h=>{u.addObserver(()=>N0(u,f,n.onSelfWin,a,h)),f.addObserver(()=>N0(f,u,n.onOtherWin,a,h)),u.startFork(e),f.startFork(t)},ho(u.id(),f.id()))})),N0=(e,t,n,r,s)=>{GM(!0,!1)(r)&&s(n(e,t))},bc=w(2,(e,t)=>Dn(n=>Hn(n(e),{onFailure:r=>Hn(t,{onFailure:s=>vt(Kt(r,s)),onSuccess:()=>vt(r)}),onSuccess:r=>zt(t,r)}))),V5=(e,t,n)=>Ji(r=>U(U(yc(hc(e)),s=>Ms(o=>{const a=t.map(h=>h.listeners.count),u=()=>{a.every(h=>h===0)&&t.every(h=>h.result.state.current._tag==="Pending"?!0:!!(h.result.state.current._tag==="Done"&&nm(h.result.state.current.effect)&&h.result.state.current.effect._tag==="Failure"&&Gb(h.result.state.current.effect.cause)))&&(f.forEach(h=>h()),n?.(),o(Sl(s)))};s.addObserver(h=>{f.forEach(p=>p()),o(h)});const f=t.map((h,p)=>{const m=T=>{a[p]=T,u()};return h.listeners.addObserver(m),()=>h.listeners.removeObserver(m)});return u(),B(()=>{f.forEach(h=>h())})})),()=>ne(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return Oi(s,o=>c5(o.request,cS(r)))}))),M0=(e,t)=>(t=qs(t),Ws(Ae(n=>{const r=Tp(n.getFiberRef(Mr),Lr),s=$S(n,e,t),o=n.getFiberRef(em),a=Zn(n.getFiberRef(as),Zi);return zt(wl(r,u=>bh(s,u,a,o)),s)}))),K5=e=>WS(as,Yn(Sf,e)),G5=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=qs(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return U(M0(t,qs(n)),s=>Cl(r,is,s))}return r=>U(M0(t,qs(n)),s=>Cl(r,is,s))},Q5=Ds,ta=Ai,Pi=xn,Sm=hr,J5=Ns,Y5=Kt,X5=Wb,$R=jU,Z5=Vb,RR=Gb,go=Vp,eW=Qb,wm=Jb,tW=BU,VS=VU,L0=Mj,AR=Qp,nW=Bj,vm=pf,$h=Do,rW=Yb,sW="effect/ScheduleInterval",Rh=Symbol.for(sW),qR={[Rh]:Rh,startMillis:0,endMillis:0},KS=(e,t)=>e>t?qR:{[Rh]:Rh,startMillis:e,endMillis:t},oW=w(2,(e,t)=>iW(e,t)===e),iW=w(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),aW=e=>e.startMillis>=e.endMillis,cW=w(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return KS(n,r)}),uW=e=>ki(e.endMillis-e.startMillis),lW=e=>KS(e,Number.POSITIVE_INFINITY),U0=KS,OR=qR,fW=oW,dW=aW,hW=cW,pW=uW,X_=lW,mW="effect/ScheduleIntervals",j0=Symbol.for(mW),xR=e=>({[j0]:j0,intervals:e}),gW=w(2,(e,t)=>_W(e.intervals,t.intervals,ot())),_W=(e,t,n)=>{let r=e,s=t,o=n;for(;rs(r)&&rs(s);){const a=k(Jr(r),hW(Jr(s))),u=dW(a)?o:k(o,pn(a));k(Jr(r),fW(Jr(s)))?r=ks(r):s=ks(s),o=u}return xR(Ps(o))},Z_=e=>k(e.intervals,Ap,ht(()=>OR)).startMillis,yW=e=>k(e.intervals,Ap,ht(()=>OR)).endMillis,FR=w(2,(e,t)=>Z_(e)<Z_(t)),bW=e=>rs(e.intervals),SW=w(2,(e,t)=>FR(e,t)?t:e),wW=xR,vW=gW,ey=Z_,ty=yW,EW=FR,kW=bW,TW=SW,GS="Continue",PR="Done",CW=e=>({_tag:GS,intervals:e}),IW=e=>({_tag:GS,intervals:wW(mt(e))}),$W={_tag:PR},RW=e=>e._tag===GS,AW=e=>e._tag===PR,DR=CW,Ah=IW,Di=$W,z0=RW,vo=AW,qW=Lr,Eo=U$,OW=wl,Vt=R_,$f=ea,NR=tm,Rf=Zc,xW=Bp,MR=function(){const e=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends iS{constructor(n){super(n?.message,n?.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}.BaseEffectError}(),FW=e=>{const t={BaseEffectError:class extends MR{_tag=e}};return t.BaseEffectError.prototype.name=e,t.BaseEffectError},PW="effect/Schedule",LR=Symbol.for(PW),UR=e=>X(e,LR),DW="effect/ScheduleDriver",NW=Symbol.for(DW),MW={_Out:e=>e,_In:e=>e,_R:e=>e},LW={_Out:e=>e,_In:e=>e,_R:e=>e};class UW{initial;step;[LR]=MW;constructor(t,n){this.initial=t,this.step=n}pipe(){return Z(this,arguments)}}class jW{schedule;ref;[NW]=LW;constructor(t,n){this.schedule=t,this.ref=n}get state(){return fe(mo(this.ref),t=>t[1])}get last(){return U(mo(this.ref),([t,n])=>{switch(t._tag){case"None":return Yp(()=>new pf);case"Some":return H(t.value)}})}get reset(){return Tl(this.ref,[W(),this.schedule.initial])}next(t){return k(fe(mo(this.ref),n=>n[1]),U(n=>k(E4,U(r=>k(ne(()=>this.schedule.step(r,t,n)),U(([s,o,a])=>{const u=Tl(this.ref,[V(o),s]);if(vo(a))return We(u,lt(W()));const f=ey(a.intervals)-r;return f<=0?zt(u,o):k(u,We(IS(ki(f))),zt(o))}))))))}}const Vs=(e,t)=>new UW(e,t),jR=w(2,(e,t)=>zW(e,n=>B(()=>t(n)))),zW=w(2,(e,t)=>JW(e,(n,r)=>fe(t(n),s=>lM(r,nr(s))))),BW=w(2,(e,t)=>Vs([e.initial,t.initial,!0],(n,r,s)=>s[2]?U(e.step(n,r,s[0]),([o,a,u])=>vo(u)?fe(t.step(n,r,s[1]),([f,h,p])=>[[o,f,!1],ae(h),p]):H([[o,s[1],!0],ie(a),u])):fe(t.step(n,r,s[1]),([o,a,u])=>[[s[0],o,!1],ae(a),u]))),HW=w(2,(e,t)=>QS(e,(n,r)=>B(()=>t(n,r)))),QS=w(2,(e,t)=>Vs(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>vo(u)?H([o,a,Di]):fe(t(r,a),f=>f?[o,a,u]:[o,a,Di])))),WW=w(2,(e,t)=>Vs([e.initial,t.initial],(n,r,s)=>U(e.step(n,r,s[0]),([o,a,u])=>fe(t.step(n,a,s[1]),([f,h,p])=>vo(u)?[[o,f],h,Di]:vo(p)?[[o,f],h,Di]:[[o,f],h,DR(k(u.intervals,TW(p.intervals)))])))),VW=e=>jR(e,t=>t),zR=e=>k(yh([W(),e.initial]),fe(t=>new jW(e,t))),KW=(e,t=2)=>{const n=nr(e);return VW(HR(Af,r=>uM(n,Math.pow(t,r))))},BR=w(2,(e,t)=>GW(e,t,vW)),GW=w(3,(e,t,n)=>Vs([e.initial,t.initial],(r,s,o)=>k(F$(e.step(r,s,o[0]),t.step(r,s,o[1]),(a,u)=>[a,u]),U(([[a,u,f],[h,p,m]])=>z0(f)&&z0(m)?ny(e,t,s,a,u,f.intervals,h,p,m.intervals,n):H([[a,h],[u,p],Di]))))),ny=(e,t,n,r,s,o,a,u,f,h)=>{const p=h(o,f);return kW(p)?H([[r,a],[s,u],DR(p)]):k(o,EW(f))?U(e.step(ty(o),n,r),([m,T,C])=>vo(C)?H([[m,a],[T,u],Di]):ny(e,t,n,m,T,C.intervals,a,u,f,h)):U(t.step(ty(f),n,a),([m,T,C])=>vo(C)?H([[r,m],[s,T],Di]):ny(e,t,n,r,s,o,m,T,C.intervals,h))},HR=w(2,(e,t)=>QW(e,n=>B(()=>t(n)))),QW=w(2,(e,t)=>Vs(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>fe(t(a),f=>[o,f,u])))),JW=w(2,(e,t)=>Vs(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>{if(vo(u))return H([o,a,u]);const f=u.intervals,h=pW(U0(n,ey(f)));return fe(t(a,h),p=>{const m=nr(p),T=ey(f),C=n+nc(m),A=C-T,D=Math.max(0,ty(f)+A),y=U0(C,D);return[o,a,Ah(y)]})}))),YW=e=>Vs(e.initial,(t,n,r)=>k(e.step(t,n,r),fe(([s,o,a])=>[s,n,a]))),WR=e=>GR(Af,t=>t<e),XW=e=>jR(Af,()=>e),ZW=(e,t)=>Vs(e,(n,r,s)=>B(()=>[t(s),s,Ah(X_(n))])),VR=w(2,(e,t)=>QS(e,(n,r)=>dB(t(n)))),KR=w(2,(e,t)=>QS(e,(n,r)=>t(n))),GR=w(2,(e,t)=>HW(e,(n,r)=>t(r))),xd=Symbol.for("effect/Schedule/ScheduleDefect");class eV{error;[xd];constructor(t){this.error=t,this[xd]=xd}}const tV=e=>X(e,xd),qh=e=>fc(e,t=>bl(new eV(t))),QR=e=>uf(e,t=>Qe(Kp(t,n=>Vb(n)&&tV(n.defect)?V(n.defect):W()),{onNone:()=>vt(t),onSome:n=>lt(n.error)})),B0=w(2,(e,t)=>rV(e,t,(n,r)=>lt(n))),nV=w(2,(e,t)=>{if(UR(t))return B0(e,t);const n=t.schedule??YW(Af),r=t.while?KR(n,a=>{const u=t.while(a);return typeof u=="boolean"?H(u):qh(u)}):n,s=t.until?VR(r,a=>{const u=t.until(a);return typeof u=="boolean"?H(u):qh(u)}):r,o=t.times?BR(s,WR(t.times)).pipe(HR(a=>a[0])):s;return QR(B0(e,o))}),rV=w(3,(e,t,n)=>U(zR(t),r=>ss(e,{onFailure:s=>n(s,W()),onSuccess:s=>JR(e,r,n,s)}))),JR=(e,t,n,r)=>ss(t.next(r),{onFailure:()=>nS(t.last),onSuccess:s=>ss(e,{onFailure:o=>n(o,V(s)),onSuccess:o=>JR(e,t,n,o)})}),H0=w(2,(e,t)=>oV(e,t,(n,r)=>lt(n))),sV=w(2,(e,t)=>{if(UR(t))return H0(e,t);const n=t.schedule??Af,r=t.while?KR(n,a=>{const u=t.while(a);return typeof u=="boolean"?H(u):qh(u)}):n,s=t.until?VR(r,a=>{const u=t.until(a);return typeof u=="boolean"?H(u):qh(u)}):r,o=t.times?BR(s,WR(t.times)):s;return QR(H0(e,o))}),oV=w(3,(e,t,n)=>U(zR(t),r=>YR(e,r,n))),YR=(e,t,n)=>fc(e,r=>ss(t.next(r),{onFailure:()=>k(t.last,nS,U(s=>n(r,s))),onSuccess:()=>YR(e,t,n)})),iV=Vs(W(),(e,t,n)=>{switch(n._tag){case"None":return H([V(e),Ib,Ah(X_(e))]);case"Some":return H([V(n.value),ki(e-n.value),Ah(X_(e))])}}),Af=ZW(0,e=>e+1);class aV{permits;waiters=new Set;taken=0;constructor(t){this.permits=t}get free(){return this.permits-this.taken}take=t=>so(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(H(t)))};return this.waiters.add(r),B(()=>{this.waiters.delete(r)})}return this.taken+=t,n(H(t))});updateTaken=t=>Ae(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(dm).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(Xi)),H(this.free)));release=t=>this.updateTaken(n=>n-t);releaseAll=this.updateTaken(t=>0);withPermits=t=>n=>Dn(r=>U(r(this.take(t)),s=>bc(r(n),this.release(s))));withPermitsIfAvailable=t=>n=>Dn(r=>ne(()=>this.free<t?Il:(this.taken+=t,bc(r(Z4(n)),this.release(t)))))}const Ju=e=>new aV(e),cV=e=>B(()=>Ju(e));class uV extends hs{isOpen;waiters=[];scheduled=!1;constructor(t){super(),this.isOpen=t}commit(){return this.await}unsafeSchedule(t){return this.scheduled||this.waiters.length===0||(this.scheduled=!0,t.currentScheduler.scheduleTask(this.flushWaiters,t.getFiberRef(Xi))),be}flushWaiters=()=>{this.scheduled=!1;const t=this.waiters;this.waiters=[];for(let n=0;n<t.length;n++)t[n](ln)};open=Ae(t=>this.isOpen?be:(this.isOpen=!0,this.unsafeSchedule(t)));unsafeOpen(){this.isOpen||(this.isOpen=!0,this.flushWaiters())}release=Ae(t=>this.isOpen?be:this.unsafeSchedule(t));await=so(t=>this.isOpen?t(be):(this.waiters.push(t),B(()=>{const n=this.waiters.indexOf(t);n!==-1&&this.waiters.splice(n,1)})));unsafeClose(){this.isOpen=!1}close=B(()=>{this.isOpen=!1});whenOpen=t=>We(this.await,t)}const XR=e=>new uV(e??!1),lV=e=>B(()=>XR(e)),Oh=w(2,(e,t)=>Ae((n,r)=>{const s=t,o=HS(e,n,r.runtimeFlags,vf);if(s.state._tag==="Open"){const a=()=>Ji(f=>ue(f,o.id())?be:or(Sl(o))),u={};s.state.finalizers.set(u,a),o.addObserver(()=>{s.state._tag!=="Closed"&&s.state.finalizers.delete(u)})}else o.unsafeInterruptAsFork(n.id());return H(o)})),fV=e=>wR(t=>Oh(e,t)),dV=w(2,(e,t)=>k(Fr(e),CR(Fr(t)),n=>Wc(n))),hV=w(2,(e,t)=>pV(e,{onTimeout:()=>Wj(t),duration:t})),pV=w(2,(e,{duration:t,onTimeout:n})=>Wc(mV(e,{onTimeout:()=>Yp(n),onSuccess:H,duration:t}))),mV=w(2,(e,{duration:t,onSuccess:n,onTimeout:r})=>Ji(s=>Dn(o=>IR(o(e),hc(IS(t)),{onSelfWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>zt(Cs(u,s),n(f.value))):U(Cs(u,s),()=>He(f.cause))),onOtherWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>zt(Cs(u,s),r())):U(Cs(u,s),()=>He(f.cause))),otherScope:vf})))),gV="effect/Ref/SynchronizedRef",ZR=Symbol.for(gV),eA={_A:e=>e};class _V extends hs{ref;withLock;[ZR]=eA;[ES]=kS;[wo]=wo;constructor(t,n){super(),this.ref=t,this.withLock=n,this.get=mo(this.ref)}get;commit(){return this.get}modify(t){return this.modifyEffect(n=>H(t(n)))}modifyEffect(t){return this.withLock(k(U(mo(this.ref),t),U(([n,r])=>zt(Tl(this.ref,r),n))))}}const yV=e=>B(()=>tA(e)),tA=e=>{const t=h1(e),n=Ju(1);return new _V(t,n.withPermits(1))},bV=Symbol.for("effect/ManagedRuntime"),SV="Fold",wV="Fresh",vV="FromEffect",EV="Scoped",kV="Suspend",TV="Provide",nA="ProvideMerge",CV="ZipWith",rA=V1,IV=$6,W0=C6,er=Sl,Em=Cs,$V=I6,oo=gc,eu=e=>function(){if(arguments.length===1){const t=arguments[0];return(n,...r)=>e(t,n,...r)}return e.apply(this,arguments)},qf=eu((e,t,n)=>{const r=XI(),s=[[Mr,[[r,e.context]]]];n?.scheduler&&s.push([dm,[[r,n.scheduler]]]);let o=O4(e.fiberRefs,{entries:s,forkAs:r});n?.updateRefs&&(o=n.updateRefs(o,r));const a=new gR(r,o,e.runtimeFlags);let u=t;n?.scope&&(u=U(NR(n.scope,wf),h=>We(U$(h,Ji(p=>ue(p,a.id())?be:Cs(a,p))),Ls(t,p=>Vt(h,p)))));const f=a.currentSupervisor;return f!==_m&&(f.onStart(e.context,u,W(),a),a.addObserver(h=>f.onEnd(h,a))),vf.add(e.runtimeFlags,a),n?.immediate===!1?a.resume(u):a.start(u),a}),sA=eu((e,t,n={})=>{const r=qf(e,t,n);return n.onExit&&r.addObserver(s=>{n.onExit(s)}),(s,o)=>sA(e)(k(r,Em(s??wr)),{...o,onExit:o?.onExit?a=>o.onExit(lz(a)):void 0})}),RV=eu((e,t)=>{const n=xV(e)(t);if(n._tag==="Failure")throw oA(n.effect_instruction_i0);return n.effect_instruction_i0});class AV extends Error{fiber;_tag="AsyncFiberException";constructor(t){super(`Fiber #${t.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`),this.fiber=t,this.name=this._tag,this.stack=this.message}}const qV=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new AV(e);return Error.stackTraceLimit=t,n},Rg=Symbol.for("effect/Runtime/FiberFailure"),id=Symbol.for("effect/Runtime/FiberFailure/Cause");class OV extends Error{[Rg];[id];constructor(t){const n=Yb(t)[0];super(n?.message||"An error has occurred"),this[Rg]=Rg,this[id]=t,this.name=n?`(FiberFailure) ${n.name}`:"FiberFailure",n?.stack&&(this.stack=n.stack)}toJSON(){return{_id:"FiberFailure",cause:this[id].toJSON()}}toString(){return"(FiberFailure) "+Do(this[id],{renderErrorCause:!0})}[Je](){return this.toString()}}const oA=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new OV(e);return Error.stackTraceLimit=t,n},iA=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return vl(t.left);case"Right":return Ve(t.right);case"Some":return Ve(t.value);case"None":return vl(pf())}},xV=eu((e,t)=>{const n=iA(t);if(n)return n;const r=new H1,s=qf(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||Aa(Zb(qV(s),hS(s)))}),FV=eu((e,t,n)=>PV(e,t,n).then(r=>{switch(r._tag){case sn:return r.effect_instruction_i0;case rn:throw oA(r.effect_instruction_i0)}})),PV=eu((e,t,n)=>new Promise(r=>{const s=iA(t);s&&r(s);const o=qf(e)(t);o.addObserver(a=>{r(a)}),n?.signal!==void 0&&(n.signal.aborted?o.unsafeInterruptAsFork(o.id()):n.signal.addEventListener("abort",()=>{o.unsafeInterruptAsFork(o.id())},{once:!0}))}));class aA{context;runtimeFlags;fiberRefs;constructor(t,n,r){this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return Z(this,arguments)}}const cA=e=>new aA(e.context,e.runtimeFlags,e.fiberRefs),DV=()=>Ae((e,t)=>H(new aA(e.getFiberRef(Mr),t.runtimeFlags,e.getFiberRefs()))),NV=h$(Uc,f$,l$),Sc=cA({context:vi(),runtimeFlags:NV,fiberRefs:x4()}),MV=w(2,(e,t)=>cA({context:t(e.context),runtimeFlags:e.runtimeFlags,fiberRefs:e.fiberRefs})),LV=sA(Sc),UV=qf(Sc),jV=FV(Sc),zV=RV(Sc),BV=w(2,(e,t)=>e.modifyEffect(t)),HV="effect/Layer",uA=Symbol.for(HV),WV={_RIn:e=>e,_E:e=>e,_ROut:e=>e},ko={[uA]:WV,pipe(){return Z(this,arguments)}},VV="effect/Layer/MemoMap",Ag=Symbol.for(VV),KV=Cp()("effect/Layer/CurrentMemoMap",{defaultValue:()=>YV()}),GV=e=>X(e,uA),QV=e=>e._op_layer===wV;class lA{ref;[Ag];constructor(t){this.ref=t,this[Ag]=Ag}getOrElseMemoize(t,n){return k(BV(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,a]=s,u=k(o,U(([f,h])=>k(hB(f),zt(h))),Ls(rm({onFailure:()=>be,onSuccess:()=>wl(n,a)})));return H([u,r])}return k(yh(0),U(o=>k(gf(),U(a=>k(yh(()=>be),fe(u=>{const f=Dn(p=>k(Zc(),U(m=>k(p(U(dA(t,m,!0),T=>iB(T(this)))),Fr,U(T=>{switch(T._tag){case rn:return k(W$(a,T.effect_instruction_i0),We(R_(m,T)),We(vt(T.effect_instruction_i0)));case sn:return k(Tl(u,C=>k(R_(m,C),Zp(p1(o,A=>[A===1,A-1])),or)),We(P_(o,C=>C+1)),We(wl(n,C=>k(B(()=>r.delete(t)),We(mo(u)),U(A=>A(C))))),We(_f(a,T.effect_instruction_i0)),zt(T.effect_instruction_i0[1]))}}))))),h=[k(os(a),Ls(q_({onFailure:()=>be,onSuccess:()=>P_(o,p=>p+1)}))),p=>k(mo(u),U(m=>m(p)))];return[f,QV(t)?r:r.set(t,h)]}))))))}),Wc)}}const JV=ne(()=>fe(yV(new Map),e=>new lA(e))),YV=()=>new lA(tA(new Map)),fA=w(2,(e,t)=>U(JV,n=>XV(e,n,t))),XV=w(3,(e,t,n)=>U(dA(e,n),r=>Cl(r(t),KV,t))),dA=(e,t,n=!1)=>{const r=e;switch(r._op_layer){case"Locally":return B(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return B(()=>s=>wR(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return B(()=>s=>k(s.getOrElseMemoize(r.layer,t),Hn({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return B(()=>s=>k(r.layer,fA(t)));case"FromEffect":return B(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return B(()=>s=>k(s.getOrElseMemoize(r.first,t),U(o=>k(s.getOrElseMemoize(r.second,t),fS(o)))));case"Scoped":return B(n?()=>s=>ea(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return B(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return B(()=>s=>k(s.getOrElseMemoize(r.first,t),F$(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return B(()=>s=>k(s.getOrElseMemoize(r.first,t),If(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},ZV=()=>km(Qc()),eK=e=>hA(ta(e)),hA=e=>km(vt(e)),JS=w(2,(e,t)=>nK(e,{onFailure:eK,onSuccess:t})),pA=w(2,(e,t)=>{const n=Tb(e),r=n?e:t;return km(fe(n?t:e,o=>kp(r,o)))});function km(e){const t=Object.create(ko);return t._op_layer=vV,t.effect=e,t}const tK=w(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(ko);return r._op_layer=SV,r.layer=e,r.failureK=t,r.successK=n,r}),nK=w(2,(e,{onFailure:t,onSuccess:n})=>tK(e,{onFailure:r=>{const s=wm(r);switch(s._tag){case"Left":return t(s.left);case"Right":return hA(s.right)}},onSuccess:n})),mA=w(2,(e,t)=>iK(e,t,(n,r)=>Po(n,r))),gA=(...e)=>{let t=e[0];for(let n=1;n<e.length;n++)t=mA(t,e[n]);return t},rK=w(2,(e,t)=>{const n=Tb(e),r=n?e:t;return _A(fe(n?t:e,o=>kp(r,o)))}),YS=e=>_A(k(e,zt(vi()))),_A=e=>{const t=Object.create(ko);return t._op_layer=EV,t.effect=e,t},sK=w(2,(e,t)=>{const n=Tb(e);return km(H(kp(n?e:t,n?t:e)))}),yA=e=>{const t=Object.create(ko);return t._op_layer=kV,t.evaluate=e,t},bA=w(2,(e,t)=>yA(()=>{const n=Object.create(ko);return n._op_layer=TV,n.first=Object.create(ko,{_op_layer:{value:nA,enumerable:!0},first:{value:ZV(),enumerable:!0},second:{value:Array.isArray(t)?gA(...t):t},zipK:{value:(r,s)=>k(r,Po(s))}}),n.second=e,n})),oK=w(2,(e,t)=>{const n=Object.create(ko);return n._op_layer=nA,n.first=t,n.second=bA(e,t),n.zipK=(r,s)=>k(r,Po(s)),n}),iK=w(3,(e,t,n)=>yA(()=>{const r=Object.create(ko);return r._op_layer=CV,r.first=e,r.second=t,r.zipK=n,r})),aK=e=>{const t=Nn("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return JS(pA(t,e),n=>Zn(n,t))},cK=e=>{const t=Nn("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return JS(rK(t,e),n=>Zn(n,t))},V0=w(2,(e,t)=>vR(n=>U(fA(t,n),r=>dS(e,r)))),K0=w(2,(e,t)=>{const n=$l(Sc.fiberRefs,t.fiberRefs),r=fi(Sc.runtimeFlags,t.runtimeFlags);return Dn(s=>Ae(o=>{const a=o.getFiberRef(Mr),u=o.getFiberRefs(),f=Rl(o.id(),u)(n),h=o.currentRuntimeFlags,p=Ua(r)(h),m=$l(f,u),T=fi(p,h);return o.setFiberRefs(f),o.currentRuntimeFlags=p,bc(dS(s(e),Po(a,t.context)),Ae(C=>(C.setFiberRefs(Rl(C.id(),C.getFiberRefs())(m)),C.currentRuntimeFlags=Ua(T)(C.currentRuntimeFlags),be)))}))}),uK=w(2,(e,t)=>Array.isArray(t)?V0(e,gA(...t)):GV(t)?V0(e,t):M3(t)?dS(e,t):bV in t?U(t.runtimeEffect,n=>K0(e,n)):K0(e,t)),lK=a5,G0=qi,Lo=sr,Tm=bm,fn=_c,XS=Ms,wc=Ae,Ni=lt,vr=vt,Al=bl,fK=C_,K=dj,ZS=mj,Mi=pB,Nt=H,$t=ne,me=B,ve=be,dK=ff,ew=fc,tu=uf,SA=tB,qg=nB,Of=rB,hK=I1,tw=cB,Cm=sV,xf=eB,pK=W5,no=Ut,St=hc,mK=No,qa=Ws,nu=Dn,xs=zt,nw=or,Pe=fe,gK=tS,na=Xp,Ct=zS,rw=Xb,yn=SR,Oa=bc,_K=cj,wA=ER,ry=vR,vc=P5,vA=Ji,sw=O5,EA=yc,Un=Oh,yt=fV,yK=oB,ow=IS,Ec=hV,bK=Qc,bn=uK,iw=Cl,SK=wB,Sa=dc,Mt=Fr,Im=O$,wK=SB,he=U,ql=ij,ro=Wc,Og=CR,kA=dV,TA=TR,jn=Us,Xr=gB,kc=CS,Q0=nV,vK=sS,EK=C1,xh=q$,Vr=Hn,kK=ss,aw=uB,An=$1,Or=lB,Ol=fB,_o=X4,TK=Fj,pr=nS,ra=DV,$m=cV,J0=lV,ps=UV,CK=LV,Ff=jV,fr=zV,sy=D5,cw=N5,st=M5,Rm=If,IK=yB,oy=vB,uw=R1,$K=EB,Ne=kB,lw=G5,xa=N_,Am=function(e,...t){const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;if(Error.stackTraceLimit=n,typeof e!="string")return Y0(e.length,function(...a){const u=Error.stackTraceLimit;Error.stackTraceLimit=2;const f=new Error;return Error.stackTraceLimit=u,X0({self:this,body:e,args:a,pipeables:t,spanName:"<anonymous>",spanOptions:{context:_h.context(!0)},errorDef:r,errorCall:f})});const s=e,o=t[0];return(a,...u)=>Y0(a.length,{[s](...f){const h=Error.stackTraceLimit;Error.stackTraceLimit=2;const p=new Error;return Error.stackTraceLimit=h,X0({self:this,body:a,args:f,pipeables:u,spanName:s,spanOptions:o,errorDef:r,errorCall:p})}}[s])};function Y0(e,t){return Object.defineProperty(t,"length",{value:e,configurable:!0})}function X0(e){let t,n;if(aD(e.body))t=dh(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(a){n=a,t=Al(a)}if(e.pipeables.length>0)try{for(const a of e.pipeables)t=a(t,...e.args)}catch(a){t=n?vr(Kt(xn(n),xn(a))):Al(a)}let r=!1;const s=()=>{if(r!==!1)return r;if(e.errorCall.stack){const a=e.errorDef.stack.trim().split(`
`),u=e.errorCall.stack.trim().split(`
`);let f=a.slice(2).join(`
`).trim();f.includes("(")||(f=f.replace(/at (.*)/,"at ($1)"));let h=u.slice(2).join(`
`).trim();return h.includes("(")||(h=h.replace(/at (.*)/,"at ($1)")),r=`${f}
${h}`,r}},o=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:s,...e.spanOptions};return Ne(t,e.spanName,o)}const RK=hj,AK=df,qK=Vc,CA=Mr,OK=Xi,xK=ym,IA=dm,FK=em,PK=w(2,(e,t)=>Yi(_R,t)(e)),DK=e=>YS(WS(ym,La(e))),NK=e=>YS(WS(ym,Mb(e))),MK=w(2,(e,t)=>JS(NK(e),()=>DK(t))),LK=e=>YS(K5(e)),UK=pA,jK=mA,Pf=sK,zK=bA,BK=oK,$A=aK,HK=cK,RA=LK,WK="effect/QueueEnqueue",AA=Symbol.for(WK),VK="effect/QueueDequeue",fw=Symbol.for(VK),KK="effect/QueueStrategy",dw=Symbol.for(KK),GK="effect/BackingQueue",QK=Symbol.for(GK),hw={_A:e=>e},JK={_A:e=>e},qA={_In:e=>e},pw={_Out:e=>e};class YK extends hs{queue;takers;shutdownHook;shutdownFlag;strategy;[AA]=qA;[fw]=pw;constructor(t,n,r,s,o){super(),this.queue=t,this.takers=n,this.shutdownHook=r,this.shutdownFlag=s,this.strategy=o}pipe(){return Z(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return ne(()=>fc(this.unsafeSize(),()=>Ut))}unsafeSize(){return Me(this.shutdownFlag)?W():V(this.queue.length()-yS(this.takers)+this.strategy.surplusSize())}get isEmpty(){return fe(this.size,t=>t<=0)}get isFull(){return fe(this.size,t=>t>=this.capacity())}get shutdown(){return Ws(Ae(t=>(k(this.shutdownFlag,Gi(!0)),k(Os(Ha(this.takers),n=>lS(n,t.id()),!1,!1),We(this.strategy.shutdown),Zp(_f(this.shutdownHook,void 0)),or))))}get isShutdown(){return B(()=>Me(this.shutdownFlag))}get awaitShutdown(){return os(this.shutdownHook)}isActive(){return!Me(this.shutdownFlag)}unsafeOffer(t){if(Me(this.shutdownFlag))return!1;let n;if(this.queue.length()===0){const s=k(this.takers,As(Dt));s!==Dt?(hi(s,t),n=!0):n=!1}else n=!1;if(n)return!0;const r=this.queue.offer(t);return ri(this.strategy,this.queue,this.takers),r}offer(t){return ne(()=>{if(Me(this.shutdownFlag))return Ut;let n;if(this.queue.length()===0){const s=k(this.takers,As(Dt));s!==Dt?(hi(s,t),n=!0):n=!1}else n=!1;if(n)return H(!0);const r=this.queue.offer(t);return ri(this.strategy,this.queue,this.takers),r?H(!0):this.strategy.handleSurplus([t],this.queue,this.takers,this.shutdownFlag)})}offerAll(t){return ne(()=>{if(Me(this.shutdownFlag))return Ut;const n=Ke(t),r=this.queue.length()===0?Ke(_8(this.takers,n.length)):yo,[s,o]=k(n,PC(r.length));for(let u=0;u<r.length;u++){const f=r[u],h=s[u];hi(f,h)}if(o.length===0)return H(!0);const a=this.queue.offerAll(o);return ri(this.strategy,this.queue,this.takers),Rp(a)?H(!0):this.strategy.handleSurplus(a,this.queue,this.takers,this.shutdownFlag)})}get take(){return Ae(t=>{if(Me(this.shutdownFlag))return Ut;const n=this.queue.poll(Dt);if(n!==Dt)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),H(n);{const r=mf(t.id());return k(ne(()=>(k(this.takers,pc(r)),ri(this.strategy,this.queue,this.takers),Me(this.shutdownFlag)?Ut:os(r))),No(()=>B(()=>y8(this.takers,r))))}})}get takeAll(){return ne(()=>Me(this.shutdownFlag)?Ut:B(()=>{const t=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),Ei(t)}))}takeUpTo(t){return ne(()=>Me(this.shutdownFlag)?Ut:B(()=>{const n=this.queue.pollUpTo(t);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),Ei(n)}))}takeBetween(t,n){return ne(()=>OA(this,t,n,ot()))}}const OA=(e,t,n,r)=>n<t?H(r):k(l8(e,n),U(s=>{const o=t-s.length;return o===1?k(iy(e),fe(a=>k(r,ft(s),fl(a)))):o>1?k(iy(e),U(a=>OA(e,o-1,n-s.length-1,k(r,ft(s),fl(a))))):H(k(r,ft(s)))})),XK=e=>k(B(()=>_S(e)),U(t=>qm(Om(t),d8()))),ZK=e=>k(B(()=>_S(e)),U(t=>qm(Om(t),xA()))),e8=e=>k(B(()=>_S(e)),U(t=>qm(Om(t),h8()))),mw=()=>k(B(()=>sm()),U(e=>qm(Om(e),xA()))),t8=(e,t,n,r,s)=>new YK(e,t,n,r,s),qm=(e,t)=>k(gf(),fe(n=>t8(e,sm(),n,Ki(!1),t)));class n8{mutable;[QK]=JK;constructor(t){this.mutable=t}poll(t){return As(this.mutable,t)}pollUpTo(t){return om(this.mutable,t)}offerAll(t){return bS(this.mutable,t)}offer(t){return pc(this.mutable,t)}capacity(){return Tz(this.mutable)}length(){return yS(this.mutable)}}const Om=e=>new n8(e),r8=e=>e.size,s8=e=>e.isShutdown,o8=e=>e.awaitShutdown,i8=e=>e.shutdown,a8=w(2,(e,t)=>e.offer(t)),c8=w(2,(e,t)=>e.offerAll(t)),iy=e=>e.take,u8=e=>e.takeAll,l8=w(2,(e,t)=>e.takeUpTo(t)),f8=w(3,(e,t,n)=>e.takeBetween(t,n)),d8=()=>new p8,xA=()=>new m8,h8=()=>new g8;class p8{[dw]=hw;putters=sm();surplusSize(){return yS(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!di(this.putters)&&!di(t);){const n=As(t,void 0),r=As(this.putters,void 0);r[2]&&hi(r[1],!0),hi(n,r[0])}}get shutdown(){return k(lf,U(t=>k(B(()=>Ha(this.putters)),U(n=>Os(n,([r,s,o])=>o?k(lS(s,t),or):be,!1,!1)))))}handleSurplus(t,n,r,s){return Ae(o=>{const a=mf(o.id());return k(ne(()=>(this.unsafeOffer(t,a),this.unsafeOnQueueEmptySpace(n,r),ri(this,n,r),Me(s)?Ut:os(a))),No(()=>B(()=>this.unsafeRemove(a))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=k(this.putters,As(Dt));if(s===Dt)r=!1;else{const o=t.offer(s[0]);o&&s[2]?hi(s[1],!0):o||Fh(this.putters,k(Ha(this.putters),pn(s))),ri(this,t,n)}}}unsafeOffer(t,n){const r=Ke(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?k(this.putters,pc([o,n,!0])):k(this.putters,pc([o,n,!1]))}}unsafeRemove(t){Fh(this.putters,k(Ha(this.putters),$p(([,n])=>n!==t)))}}let m8=class{[dw]=hw;surplusSize(){return 0}get shutdown(){return be}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return H(!1)}unsafeOnQueueEmptySpace(t,n){}};class g8{[dw]=hw;surplusSize(){return 0}get shutdown(){return be}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return B(()=>(this.unsafeOffer(n,t),ri(this,n,r),!0))}unsafeOnQueueEmptySpace(t,n){}unsafeOffer(t,n){const r=n[Symbol.iterator]();let s,o=!0;for(;!(s=r.next()).done&&o;){if(t.capacity()===0)return;t.poll(Dt),o=t.offer(s.value)}}}const hi=(e,t)=>yf(e,H(t)),Fh=(e,t)=>k(e,bS(t)),Ha=e=>k(e,om(Number.POSITIVE_INFINITY)),_8=(e,t)=>k(e,om(t)),y8=(e,t)=>{Fh(e,k(Ha(e),$p(n=>t!==n)))},ri=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=k(n,As(Dt));if(s!==Dt){const o=t.poll(Dt);o!==Dt?(hi(s,o),e.unsafeOnQueueEmptySpace(t,n)):Fh(n,k(Ha(n),pn(s))),r=!0}else r=!1}r&&t.length()===0&&!di(n)&&e.onCompleteTakersWithEmptyQueue(n)},Wr=Symbol.for("effect/PubSub/AbsentValue"),FA=(e,t)=>n=>{n.has(e)||n.set(e,new Set),n.get(e).add(t)},b8=(e,t)=>n=>{if(!n.has(e))return;const r=n.get(e);r.delete(t),r.size===0&&n.delete(e)},S8=e=>ne(()=>{const t=k8(e);return q8(t,new M8)}),w8=e=>e.shutdown,v8=w(2,(e,t)=>e.publish(t)),E8=e=>e.subscribe,k8=e=>new I8(e?.replay?new j8(e.replay):void 0),T8=(e,t,n)=>fe(gf(),r=>C8(e,t,e.subscribe(),sm(),r,Ki(!1),n)),C8=(e,t,n,r,s,o,a)=>new R8(e,t,n,r,s,o,a,e.replayWindow());class I8{replayBuffer;publisherHead={value:Wr,subscribers:0,next:null};publisherTail=this.publisherHead;publisherIndex=0;subscribersIndex=0;capacity=Number.MAX_SAFE_INTEGER;constructor(t){this.replayBuffer=t}replayWindow(){return this.replayBuffer?new z8(this.replayBuffer):B8}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const n=this.publisherTail.subscribers;return n!==0&&(this.publisherTail.next={value:t,subscribers:n,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const n of t)this.publish(n);else this.replayBuffer&&this.replayBuffer.offerAll(t);return ot()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=Wr,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new $8(this,this.publisherTail,this.publisherIndex,!1)}}class $8{self;subscriberHead;subscriberIndex;unsubscribed;constructor(t,n,r,s){this.self=t,this.subscriberHead=n,this.subscriberIndex=r,this.unsubscribed=s}isEmpty(){if(this.unsubscribed)return!0;let t=!0,n=!0;for(;n;)this.subscriberHead===this.self.publisherTail?n=!1:this.subscriberHead.next.value!==Wr?(t=!1,n=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let n=!0,r=t;for(;n;)if(this.subscriberHead===this.self.publisherTail)n=!1;else{const s=this.subscriberHead.next.value;s!==Wr&&(r=s,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Wr,this.self.subscribersIndex+=1),n=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const n=[],r=Wr;let s=0;for(;s!==t;){const o=this.poll(r);o===r?s=t:(n.push(o),s+=1)}return Ei(n)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==Wr&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Wr,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}class R8 extends hs{pubsub;subscribers;subscription;pollers;shutdownHook;shutdownFlag;strategy;replayWindow;[fw]=pw;constructor(t,n,r,s,o,a,u,f){super(),this.pubsub=t,this.subscribers=n,this.subscription=r,this.pollers=s,this.shutdownHook=o,this.shutdownFlag=a,this.strategy=u,this.replayWindow=f}commit(){return this.take}pipe(){return Z(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!Me(this.shutdownFlag)}get size(){return ne(()=>Me(this.shutdownFlag)?Ut:H(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return Me(this.shutdownFlag)?W():V(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return ne(()=>Me(this.shutdownFlag)?Ut:H(this.subscription.size()===this.capacity()))}get isEmpty(){return fe(this.size,t=>t===0)}get shutdown(){return Ws(Ae(t=>(Gi(this.shutdownFlag,!0),k(BS(gw(this.pollers),n=>lS(n,t.id()),!1),We(B(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),Zp(_f(this.shutdownHook,void 0)),or))))}get isShutdown(){return B(()=>Me(this.shutdownFlag))}get awaitShutdown(){return os(this.shutdownHook)}get take(){return Ae(t=>{if(Me(this.shutdownFlag))return Ut;if(this.replayWindow.remaining>0){const r=this.replayWindow.take();return H(r)}const n=di(this.pollers)?this.subscription.poll(Dt):Dt;if(n===Dt){const r=mf(t.id());return k(ne(()=>(k(this.pollers,pc(r)),k(this.subscribers,FA(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),Me(this.shutdownFlag)?Ut:os(r))),No(()=>B(()=>N8(this.pollers,r))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),H(n)})}get takeAll(){return ne(()=>{if(Me(this.shutdownFlag))return Ut;const t=di(this.pollers)?F8(this.subscription):ot();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?H(ft(this.replayWindow.takeAll(),t)):H(t)})}takeUpTo(t){return ne(()=>{if(Me(this.shutdownFlag))return Ut;let n;if(this.replayWindow.remaining>=t){const s=this.replayWindow.takeN(t);return H(s)}else this.replayWindow.remaining>0&&(n=this.replayWindow.takeAll(),t=t-n.length);const r=di(this.pollers)?P8(this.subscription,t):ot();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),H(n?ft(n,r):r)})}takeBetween(t,n){return ne(()=>PA(this,t,n,ot()))}}const PA=(e,t,n,r)=>n<t?H(r):k(e.takeUpTo(n),U(s=>{const o=t-s.length;return o===1?k(e.take,fe(a=>k(r,ft(s),fl(a)))):o>1?k(e.take,U(a=>PA(e,o-1,n-s.length-1,k(r,ft(s),fl(a))))):H(k(r,ft(s)))}));class A8{pubsub;subscribers;scope;shutdownHook;shutdownFlag;strategy;[AA]=qA;[fw]=pw;constructor(t,n,r,s,o,a){this.pubsub=t,this.subscribers=n,this.scope=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=a}capacity(){return this.pubsub.capacity}get size(){return ne(()=>Me(this.shutdownFlag)?Ut:B(()=>this.pubsub.size()))}unsafeSize(){return Me(this.shutdownFlag)?W():V(this.pubsub.size())}get isFull(){return fe(this.size,t=>t===this.capacity())}get isEmpty(){return fe(this.size,t=>t===0)}get awaitShutdown(){return os(this.shutdownHook)}get isShutdown(){return B(()=>Me(this.shutdownFlag))}get shutdown(){return Ws(Ae(t=>(k(this.shutdownFlag,Gi(!0)),k(this.scope.close(cS(t.id())),We(this.strategy.shutdown),Zp(_f(this.shutdownHook,void 0)),or))))}publish(t){return ne(()=>Me(this.shutdownFlag)?Ut:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),H(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,mt(t),this.shutdownFlag))}isActive(){return!Me(this.shutdownFlag)}unsafeOffer(t){return Me(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return ne(()=>{if(Me(this.shutdownFlag))return Ut;const n=D8(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),Rp(n)?H(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,n,this.shutdownFlag)})}get subscribe(){const t=Us(bm([this.scope.fork(wf),T8(this.pubsub,this.subscribers,this.strategy)]),n=>n[0].addFinalizer(()=>n[1].shutdown));return fe(zS(t,(n,r)=>n[0].close(r)),n=>n[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return Z(this,arguments)}}const q8=(e,t)=>U(Zc(),n=>fe(gf(),r=>O8(e,new Map,n,r,Ki(!1),t))),O8=(e,t,n,r,s,o)=>new A8(e,t,n,r,s,o),x8=(e,t)=>{yf(e,H(t))},DA=(e,t)=>k(e,bS(t)),gw=e=>k(e,om(Number.POSITIVE_INFINITY)),F8=e=>e.pollUpTo(Number.POSITIVE_INFINITY),P8=(e,t)=>e.pollUpTo(t),D8=(e,t)=>e.publishAll(t),N8=(e,t)=>{DA(e,k(gw(e),$p(n=>n!==t)))};class M8{get shutdown(){return be}handleSurplus(t,n,r,s){return H(!1)}unsafeOnPubSubEmptySpace(t,n){}unsafeCompletePollers(t,n,r,s){return L8(this,t,n,r,s)}unsafeCompleteSubscribers(t,n){return U8(this,t,n)}}const L8=(e,t,n,r,s)=>{let o=!0;for(;o&&!r.isEmpty();){const a=k(s,As(Dt));if(a===Dt)k(n,b8(r,s)),di(s)?o=!1:k(n,FA(r,s));else{const u=r.poll(Dt);u===Dt?DA(s,k(gw(s),pn(a))):(x8(a,u),e.unsafeOnPubSubEmptySpace(t,n))}}},U8=(e,t,n)=>{for(const[r,s]of n)for(const o of s)e.unsafeCompletePollers(t,n,r,o)};class j8{capacity;constructor(t){this.capacity=t}head={value:Wr,next:null};tail=this.head;size=0;index=0;slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:Wr,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const n of t)this.offer(n)}}class z8{buffer;head;index;remaining;constructor(t){this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return ot();this.index<this.buffer.index&&this.fastForward();const n=Math.min(t,this.remaining),r=new Array(n);for(let s=0;s<n;s++){const o=this.head.value;this.head=this.head.next,r[s]=o}return this.remaining-=n,Ft(r)}takeAll(){return this.takeN(this.remaining)}}const B8={remaining:0,take:()=>{},takeN:()=>ot(),takeAll:()=>ot()},NA=S8,ay=w8,_w=v8,Z0=E8,yw=XK,H8=ZK,W8=e8,Ln=mw,V8=r8,K8=s8,G8=o8,qn=i8,bt=a8,bw=c8,Tc=iy,Q8=u8,MA=f8,LA="Continue",J8="Close",Y8="Yield",X8="effect/ChannelChildExecutorDecision",ek=Symbol.for(X8),Z8={[ek]:ek},UA=e=>{const t=Object.create(Z8);return t._tag=LA,t},Fd="ContinuationK",eG="ContinuationFinalizer",jA=Symbol.for("effect/ChannelContinuation"),zA={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};class Sw{onSuccess;onHalt;_tag=Fd;[jA]=zA;constructor(t,n){this.onSuccess=t,this.onHalt=n}onExit(t){return Yc(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}class tG{finalizer;_tag=eG;[jA]=zA;constructor(t){this.finalizer=t}}const BA="PullAfterNext",nG="PullAfterAllEnqueued",rG="effect/ChannelUpstreamPullStrategy",sG=Symbol.for(rG),oG={_A:e=>e},iG={[sG]:oG},HA=e=>{const t=Object.create(iG);return t._tag=BA,t.emitSeparator=e,t},WA="BracketOut",VA="Bridge",ww="ConcatAll",KA="Emit",GA="Ensuring",QA="Fail",vw="Fold",JA="FromEffect",YA="PipeTo",XA="Provide",ZA="Read",eq="Succeed",tq="SucceedNow",nq="Suspend",aG="effect/Channel",Ph=Symbol.for(aG),cG={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},vn={[Ph]:cG,pipe(){return Z(this,arguments)}},rq=e=>X(e,Ph)||Lo(e),uG=w(2,(e,t)=>{const n=Object.create(vn);return n._tag=WA,n.acquire=()=>e,n.finalizer=t,n}),Ew=w(2,(e,t)=>{const n=Object.create(vn);return n._tag=vw,n.channel=e,n.k=new Sw(sa,t),n}),sq=(e,t,n)=>{const r=Object.create(vn);return r._tag=ww,r.combineInners=t,r.combineAll=n,r.onPull=()=>HA(W()),r.onEmit=()=>UA,r.value=()=>e,r.k=se,r},lG=w(4,(e,t,n,r)=>{const s=Object.create(vn);return s._tag=ww,s.combineInners=n,s.combineAll=r,s.onPull=()=>HA(W()),s.onEmit=()=>UA,s.value=()=>e,s.k=t,s}),kw=w(2,(e,t)=>{const n=Object.create(vn);return n._tag=VA,n.input=t,n.channel=e,n}),oq=w(2,(e,t)=>{const n=Object.create(vn);return n._tag=GA,n.channel=e,n.finalizer=t,n}),ru=e=>Lt(ta(e)),Lt=e=>iq(()=>e),iq=e=>{const t=Object.create(vn);return t._tag=QA,t.error=e,t},Be=w(2,(e,t)=>{const n=Object.create(vn);return n._tag=vw,n.channel=e,n.k=new Sw(t,Lt),n}),en=e=>{const t=Object.create(vn);return t._tag=JA,t.effect=()=>e,t},dn=w(2,(e,t)=>{const n=Object.create(vn);return n._tag=YA,n.left=()=>e,n.right=()=>t,n}),tk=w(2,(e,t)=>{const n=Object.create(vn);return n._tag=XA,n.context=()=>t,n.inner=e,n}),Df=e=>ms({onInput:e.onInput,onFailure:t=>un(wm(t),{onLeft:e.onFailure,onRight:Lt}),onDone:e.onDone}),ms=e=>{const t=Object.create(vn);return t._tag=ZA,t.more=e.onInput,t.done=new Sw(e.onDone,e.onFailure),t},sa=e=>aq(()=>e),cs=e=>{const t=Object.create(vn);return t._tag=tq,t.terminal=e,t},Nf=e=>{const t=Object.create(vn);return t._tag=nq,t.channel=e,t},aq=e=>{const t=Object.create(vn);return t._tag=eq,t.evaluate=e,t},Fn=cs(void 0),Ye=e=>{const t=Object.create(vn);return t._tag=KA,t.out=e,t},Mf="Done",Lf="Emit",su="FromEffect",Uf="Read",fG=Symbol.for("effect/ChannelState"),dG={_E:e=>e,_R:e=>e},xm={[fG]:dG},wa=()=>{const e=Object.create(xm);return e._tag=Mf,e},xg=()=>{const e=Object.create(xm);return e._tag=Lf,e},Tu=e=>{const t=Object.create(xm);return t._tag=su,t.effect=e,t},Fg=(e,t,n,r)=>{const s=Object.create(xm);return s._tag=Uf,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},Dh=e=>e._tag===su,hG=e=>Dh(e)?e.effect:ve,nk=e=>Dh(e)?hK(e.effect):void 0,cq="PullFromChild",cy="PullFromUpstream",uy="DrainChildExecutors",uq="Emit";class ad{childExecutor;parentSubexecutor;onEmit;_tag=cq;constructor(t,n,r){this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?Rm(Mt(n),Mt(r),(s,o)=>k(s,El(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class Xo{upstreamExecutor;createChild;lastDone;activeChildExecutors;combineChildResults;combineWithChildResult;onPull;onEmit;_tag=cy;constructor(t,n,r,s,o,a,u,f){this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u,this.onEmit=f}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?Rm(o,Mt(a),(u,f)=>El(u,f)):o!==void 0?o:a!==void 0?Mt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new Xo(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class Fa{upstreamExecutor;lastDone;activeChildExecutors;upstreamDone;combineChildResults;combineWithChildResult;onPull;_tag=uy;constructor(t,n,r,s,o,a,u){this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?Rm(o,Mt(a),(u,f)=>El(u,f)):o!==void 0?o:a!==void 0?Mt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new Fa(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class Pg{value;next;_tag=uq;constructor(t,n){this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const pG="Pulled",mG="NoUpstream",gG="effect/ChannelUpstreamPullRequest",_G=Symbol.for(gG),yG={_A:e=>e},lq={[_G]:yG},rk=e=>{const t=Object.create(lq);return t._tag=pG,t.value=e,t},bG=e=>{const t=Object.create(lq);return t._tag=mG,t.activeDownstreamCount=e,t};class si{_activeSubexecutor=void 0;_cancelled=void 0;_closeLastSubstream=void 0;_currentChannel;_done=void 0;_doneStack=[];_emitted=void 0;_executeCloseLastSubstream;_input=void 0;_inProgressFinalizer=void 0;_providedEnv;constructor(t,n,r){this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=wa();else switch(Lo(this._currentChannel)&&(this._currentChannel=en(this._currentChannel)),this._currentChannel._tag){case WA:{t=this.runBracketOut(this._currentChannel);break}case VA:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>he(n.awaitRead(),()=>$t(()=>{const o=r.run();switch(o._tag){case Mf:return Yr(r.getDone(),{onFailure:a=>n.error(a),onSuccess:a=>n.done(a)});case Lf:return he(n.emit(r.getEmit()),()=>s());case su:return Vr(o.effect,{onFailure:a=>n.error(a),onSuccess:()=>s()});case Uf:return Tw(o,()=>s(),a=>n.error(a))}}));t=Tu(he(EA(St(s())),o=>me(()=>this.addFinalizer(a=>he(er(o),()=>$t(()=>{const u=this.restorePipe(a,r);return u!==void 0?u:ve}))))))}break}case ww:{const n=new si(this._currentChannel.value(),this._providedEnv,s=>me(()=>{const o=this._closeLastSubstream===void 0?ve:this._closeLastSubstream;this._closeLastSubstream=k(o,st(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new Xo(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case KA:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:Fn,t=xg();break}case GA:{this.runEnsuring(this._currentChannel);break}case QA:{t=this.doneHalt(this._currentChannel.error());break}case vw:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case JA:{const n=this._providedEnv===void 0?this._currentChannel.effect():k(this._currentChannel.effect(),bn(this._providedEnv));t=Tu(Vr(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&Dh(s)?s.effect:ve},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&Dh(s)?s.effect:ve}}));break}case YA:{const n=this._input,r=new si(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:ve}),this._currentChannel=this._currentChannel.right();break}case XA:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>me(()=>{this._providedEnv=n}));break}case ZA:{const n=this._currentChannel;t=Fg(this._input,se,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(mh(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case eq:{t=this.doneSucceed(this._currentChannel.evaluate());break}case tq:{t=this.doneSucceed(this._currentChannel.terminal);break}case nq:{this._currentChannel=this._currentChannel.channel();break}}}catch(n){this._currentChannel=Lt(Pi(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?ve:Ng(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===Fd)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):ve}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=k(r,Oa(me(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=k(o,Oa(me(()=>this.clearInProgressFinalizer()))));const a=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(a===void 0&&n===void 0&&s===void 0))return k(Mt(Dg(a)),sy(Mt(Dg(n))),sy(Mt(Dg(s))),Pe(([[u,f],h])=>k(u,El(f),El(h))),qa,he(u=>$t(()=>u)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=Rt(t),this._currentChannel=void 0,wa();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Fd){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Rt(t),this._currentChannel=void 0,wa();const s=Ng(r.map(a=>a.finalizer),Rt(t));this.storeInProgressFinalizer(s);const o=k(s,Oa(me(()=>this.clearInProgressFinalizer())),qa,he(()=>me(()=>this.doneSucceed(t))));return Tu(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=Gt(t),this._currentChannel=void 0,wa();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Fd){this._doneStack.pop();try{this._currentChannel=n.onHalt(t)}catch(a){this._currentChannel=Lt(Pi(a))}return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Gt(t),this._currentChannel=void 0,wa();const s=Ng(r.map(a=>a.finalizer),Gt(t));this.storeInProgressFinalizer(s);const o=k(s,Oa(me(()=>this.clearInProgressFinalizer())),qa,he(()=>me(()=>this.doneHalt(t))));return Tu(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,wa()}runBracketOut(t){const n=qa(Vr(this.provide(t.acquire()),{onFailure:r=>me(()=>{this._currentChannel=Lt(r)}),onSuccess:r=>me(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=Ye(r)})}));return Tu(n)}provide(t){return this._providedEnv===void 0?t:k(t,bn(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new tG(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case cq:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case cy:return this.pullFromUpstream(t);case uy:return this.drainChildExecutors(t);case uq:return this._emitted=t.value,this._activeSubexecutor=t.next,xg()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=Yr(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?ve:hG(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>k(n,fn(s=>k(me(()=>s(t)),he(o=>o!==void 0?o:ve)),{discard:!0})));const r=k(t,Yr({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case BA:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case nG:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return Fg(t,se,o=>{const a=r(o);switch(a._tag){case LA:break;case J8:{this.finishWithDoneValue(t,n,a.value);break}case Y8:{const u=n.enqueuePullFromChild(s);this.replaceSubexecutor(u);break}}this._activeSubexecutor=new Pg(o,this._activeSubexecutor)},Yr({onFailure:o=>{const a=this.handleSubexecutorFailure(t,n,o);return a===void 0?void 0:nk(a)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case cy:{const o=new Xo(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(Rt(r)),this.replaceSubexecutor(o);break}case uy:{const o=new Fa(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(Rt(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(Gt(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new Xo(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new ad(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return Fg(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?ve:this._closeLastSubstream;return this._closeLastSubstream=void 0,k(this._executeCloseLastSubstream(r),st(n))},n=>{if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,k(this._executeCloseLastSubstream(a),Pe(()=>{const u=new si(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);u._input=this._input;const[f,h]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(rk(n)));this._activeSubexecutor=new ad(u,new Xo(t.upstreamExecutor,t.createChild,t.lastDone,h,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),tt(f)&&(this._activeSubexecutor=new Pg(f.value,this._activeSubexecutor))}))}const r=new si(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(rk(n)));this._activeSubexecutor=new ad(r,new Xo(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),tt(s)&&(this._activeSubexecutor=new Pg(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new Fa(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,k(this._executeCloseLastSubstream(a),Pe(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(k(n,dz(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:nk(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>Nt(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,a=>t.upstreamExecutor.close(a))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,a]=this.applyUpstreamPullStrategy(!0,r,t.onPull(bG(r.reduce((u,f)=>f!==void 0?u+1:u,0))));return this.replaceSubexecutor(new Fa(t.upstreamExecutor,t.lastDone,a,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),tt(o)?(this._emitted=o.value,xg()):void 0}const s=new Fa(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new ad(n.childExecutor,s,n.onEmit))}}const Dg=e=>e!==void 0?e:ve,Ng=(e,t)=>k(fn(e,n=>Mt(n(t))),Pe(n=>k(uz(n),ht(()=>Wn))),he(n=>$t(()=>n))),Tw=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return fK("Unexpected end of input for channel execution");const a=o.upstream.run();switch(a._tag){case Lf:{const u=o.onEmit(o.upstream.getEmit());return r.length===0?u===void 0?$t(t):k(u,Vr({onFailure:n,onSuccess:t})):u===void 0?$t(()=>s()):k(u,Vr({onFailure:n,onSuccess:()=>s()}))}case Mf:{const u=o.onDone(o.upstream.getDone());return r.length===0?u===void 0?$t(t):k(u,Vr({onFailure:n,onSuccess:t})):u===void 0?$t(()=>s()):k(u,Vr({onFailure:n,onSuccess:()=>s()}))}case su:return r.push(o),k(o.onEffect(a.effect),tu(u=>$t(()=>{const f=o.onDone(Gt(u));return f===void 0?ve:f})),Vr({onFailure:n,onSuccess:()=>s()}));case Uf:return r.push(o),r.push(a),$t(()=>s())}};return s()},fq=w(2,(e,t)=>{const n=(r,s,o)=>rw(me(()=>new si(e,void 0,se)),a=>$t(()=>Pd(a.run(),a).pipe(Im(r),st(It(r)),cw(It(s)))),(a,u)=>{const f=a.close(u);return f===void 0?ve:Xr(f,h=>Eo(o,vr(h)))});return nu(r=>Tm([NR(t,Sh),Le(),Le()]).pipe(he(([s,o,a])=>r(n(o,a,s)).pipe(Un(t),he(u=>t.addFinalizer(f=>{const h=Yc(f)?eW(f.cause):void 0;return O_(o).pipe(he(p=>p?ct(a,void 0).pipe(st(rA(u)),st(W0(u))):ct(a,void 0).pipe(st(h&&Nb(h)>0?Em(u,sL(h)):er(u)),st(W0(u)))))}).pipe(st(r(It(o)))))))))}),Pd=(e,t)=>{const n=e;switch(n._tag){case su:return k(n.effect,he(()=>Pd(t.run(),t)));case Lf:return Pd(t.run(),t);case Mf:return $t(()=>t.getDone());case Uf:return Tw(n,()=>Pd(t.run(),t),vr)}},SG="Done",wG="Await",vG="effect/ChannelMergeDecision",EG=Symbol.for(vG),kG={[EG]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},sk=e=>{const t=Object.create(kG);return t._tag=wG,t.f=e,t},dq="BothRunning",hq="LeftDone",pq="RightDone",TG="effect/ChannelMergeState",ok=Symbol.for(TG),Cw={[ok]:ok},Mg=(e,t)=>{const n=Object.create(Cw);return n._tag=dq,n.left=e,n.right=t,n},ik=e=>{const t=Object.create(Cw);return t._tag=hq,t.f=e,t},ak=e=>{const t=Object.create(Cw);return t._tag=pq,t.f=e,t},mq="BackPressure",gq="BufferSliding",CG="effect/ChannelMergeStrategy",ck=Symbol.for(CG),_q={[ck]:ck},IG=e=>{const t=Object.create(_q);return t._tag=mq,t},$G=e=>{const t=Object.create(_q);return t._tag=gq,t},RG=w(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case mq:return t();case gq:return n()}}),Ta="Empty",Pu="Emit",Du="Error",Nu="Done",yq=e=>({_tag:Ta,notifyProducer:e}),Lg=e=>({_tag:Pu,notifyConsumers:e}),AG=e=>({_tag:Du,cause:e}),qG=e=>({_tag:Nu,done:e});class OG{ref;constructor(t){this.ref=t}awaitRead(){return ro(vu(this.ref,t=>t._tag===Ta?[It(t.notifyProducer),t]:[ve,t]))}get close(){return vA(t=>this.error(Sm(t)))}done(t){return ro(vu(this.ref,n=>{switch(n._tag){case Ta:return[It(n.notifyProducer),n];case Pu:return[fn(n.notifyConsumers,r=>ct(r,ie(t)),{discard:!0}),qG(t)];case Du:return[no,n];case Nu:return[no,n]}}))}emit(t){return he(Le(),n=>ro(vu(this.ref,r=>{switch(r._tag){case Ta:return[It(r.notifyProducer),r];case Pu:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[ct(s,ae(t)),o.length===0?yq(n):Lg(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case Du:return[no,r];case Nu:return[no,r]}})))}error(t){return ro(vu(this.ref,n=>{switch(n._tag){case Ta:return[It(n.notifyProducer),n];case Pu:return[fn(n.notifyConsumers,r=>za(r,t),{discard:!0}),AG(t)];case Du:return[no,n];case Nu:return[no,n]}}))}get take(){return this.takeWith(t=>Gt(VS(t,ie)),t=>Rt(t),t=>bf(ae(t)))}takeWith(t,n,r){return he(Le(),s=>ro(vu(this.ref,o=>{switch(o._tag){case Ta:return[st(ct(o.notifyProducer,void 0),xh(It(s),{onFailure:t,onSuccess:un({onLeft:r,onRight:n})})),Lg([s])];case Pu:return[xh(It(s),{onFailure:t,onSuccess:un({onLeft:r,onRight:n})}),Lg([...o.notifyConsumers,s])];case Du:return[Nt(t(o.cause)),o];case Nu:return[Nt(r(o.done)),o]}})))}}const Iw=()=>k(Le(),he(e=>cm(yq(e))),Pe(e=>new OG(e))),ly=(e,t,n)=>Be(en(cm(()=>ve)),r=>k(en(qa(jn(e,s=>TS(r,o=>n(s,o))))),Be(t),oq(s=>he(Gu(r),o=>o(s))))),xG=w(2,(e,t)=>Rw(e,()=>t)),FG=w(2,(e,t)=>Ew(e,n=>un(wm(n),{onLeft:t,onRight:Lt}))),Nh=w(2,(e,t)=>lG(e,t,()=>{},()=>{})),$w=e=>{const t=ms({onInput:()=>t,onFailure:Lt,onDone:sa});return dn(e,t)},bq=w(2,(e,t)=>oq(e,()=>t)),PG=e=>Be(e,se),Fm=e=>Er(e.takeWith(Lt,t=>Be(Ye(t),()=>Fm(e)),sa)),Sq=()=>Df({onInput:e=>Be(Ye(e),()=>Sq()),onFailure:ru,onDone:cs}),Rw=w(2,(e,t)=>Be(e,n=>aq(()=>t(n)))),DG=w(2,(e,t)=>NG(e,VS(t))),NG=w(2,(e,t)=>Ew(e,n=>Lt(t(n)))),Pm=w(2,(e,t)=>{const n=Df({onInput:r=>Be(Ye(t(r)),()=>n),onFailure:ru,onDone:cs});return dn(e,n)}),MG=w(2,(e,t)=>{const n=ms({onInput:r=>k(en(t(r)),Be(Ye),Be(()=>n)),onFailure:Lt,onDone:cs});return dn(e,n)}),LG=w(3,(e,t,n)=>Aw(r=>K(function*(){const s=yield*Iw(),o=Fm(s),a=yield*yw(n);yield*Eo(r,qn(a));const u=yield*Le(),f=n===Number.POSITIVE_INFINITY?m=>se:(yield*$m(n)).withPermits;yield*(yield*o.pipe(dn(e),Wa(r))).pipe(Vr({onFailure:m=>bt(a,vr(m)),onSuccess:un({onLeft:m=>st(St(f(n)(ve)),nw(bt(a,Nt(ie(m))))),onRight:m=>K(function*(){const T=yield*Le(),C=yield*Le();yield*bt(a,Pe(It(T),ae)),yield*ct(C,void 0).pipe(st(nu(A=>Mt(A(It(u))).pipe(kA(Mt(A(t(m)))),he(se))).pipe(Xr(A=>za(u,A)),Im(T))),f(1),Un(r)),yield*It(C)})})}),kc,St,Un(r));const p=Er(xh(ro(Tc(a)),{onFailure:Lt,onSuccess:un({onLeft:cs,onRight:m=>Be(Ye(m),()=>p)})}));return kw(p,s)}))),UG=e=>t=>jG(e)(t,il),jG=({bufferSize:e=16,concurrency:t,mergeStrategy:n=IG()})=>(r,s)=>Aw(o=>K(function*(){const a=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,u=yield*Iw(),f=Fm(u),h=yield*yw(e);yield*Eo(o,qn(h));const p=yield*Ln();yield*Eo(o,qn(p));const m=yield*cm(W()),T=yield*Le(),C=(yield*$m(a)).withPermits,A=yield*Wa(dn(f,r),o);function D(b){return b.pipe(he(un({onLeft:_=>Nt(V(_)),onRight:_=>xs(bt(h,Nt(ae(_))),W())})),Q0({until:_=>tt(_)}),he(_=>V4(m,Qe({onNone:()=>V(_.value),onSome:E=>V(s(E,_.value))}))),tu(_=>RR(_)?vr(_):bt(h,vr(_)).pipe(st(ct(T,void 0)),nw)))}yield*A.pipe(Vr({onFailure:b=>bt(h,vr(b)).pipe(st(Nt(!1))),onSuccess:un({onLeft:b=>TA(St(It(T)),St(C(a)(ve)),{onSelfDone:(_,E)=>xs(er(E),!1),onOtherDone:(_,E)=>st(er(E),Gu(m).pipe(he(Qe({onNone:()=>bt(h,Nt(ie(b))),onSome:v=>bt(h,Nt(ie(s(v,b))))})),xs(!1)))}),onRight:b=>RG(n,{onBackPressure:()=>K(function*(){const _=yield*Le(),E=ry(R=>Wa(dn(f,b),R).pipe(he(q=>Og(Mt(D(q)),Mt(St(It(T))))),he(se)));return yield*ct(_,void 0).pipe(st(E),C(1),Un(o)),yield*It(_),!(yield*O_(T))}),onBufferSliding:()=>K(function*(){const _=yield*Le(),E=yield*Le(),v=yield*V8(p);yield*Tc(p).pipe(he(x=>ct(x,void 0)),wK(()=>v>=a)),yield*bt(p,_);const R=ry(x=>Wa(dn(f,b),x).pipe(he(N=>Mt(D(N)).pipe(Og(Mt(St(It(T)))),Og(Mt(St(It(_)))))),he(se)));return yield*ct(E,void 0).pipe(st(R),C(1),Un(o)),yield*It(E),!(yield*O_(T))})})})}),Q0({while:b=>b}),Un(o));const y=k(Tc(h),ro,xh({onFailure:Lt,onSuccess:un({onLeft:cs,onRight:b=>Be(Ye(b),()=>y)})}),Er);return kw(y,u)})),wq=w(3,(e,t,n)=>UG(n)(Pm(e,t))),zG=w(2,(e,t)=>{function n(r){return K(function*(){const s=yield*Iw(),o=Fm(s),a=yield*Wa(dn(o,e),r),u=yield*Wa(dn(o,t.other),r);function f(p,m,T){return(C,A,D)=>{function y(b){const _=b;return _._tag===SG?Nt(en(st(er(m),_.effect))):Pe(rA(m),Yr({onFailure:E=>en(_.f(Gt(E))),onSuccess:un({onLeft:E=>en(_.f(Rt(E))),onRight:E=>jf(Ye(E),h(D(_.f)))})}))}return Yr(p,{onFailure:b=>y(C(Gt(b))),onSuccess:un({onLeft:b=>y(C(Rt(b))),onRight:b=>Nt(Be(Ye(b),()=>Be(en(Un(St(T),r)),_=>h(A(_,m)))))})})}}function h(p){switch(p._tag){case dq:{const m=St(oo(p.left)),T=St(oo(p.right));return Er(TA(m,T,{onSelfDone:(C,A)=>st(er(A),f(C,p.right,a)(t.onSelfDone,Mg,D=>ik(D))),onOtherDone:(C,A)=>st(er(A),f(C,p.left,u)(t.onOtherDone,(D,y)=>Mg(y,D),D=>ak(D)))}))}case hq:return Er(Pe(Mt(u),Yr({onFailure:m=>en(p.f(Gt(m))),onSuccess:un({onLeft:m=>en(p.f(Rt(m))),onRight:m=>Be(Ye(m),()=>h(ik(p.f)))})})));case pq:return Er(Pe(Mt(a),Yr({onFailure:m=>en(p.f(Gt(m))),onSuccess:un({onLeft:m=>en(p.f(Rt(m))),onRight:m=>Be(Ye(m),()=>h(ak(p.f)))})})))}}return en(wc(p=>{const m=wc(A=>(A.transferChildren(p.scope()),ve)),T=St(a).pipe(Oa(m),Un(r)),C=St(u).pipe(Oa(m),Un(r));return Rm(T,C,(A,D)=>Mg(A,D))})).pipe(Be(h),kw(s))})}return Aw(n)}),BG=w(2,(e,t)=>FG(e,n=>iq(()=>Pi(t(n))))),vq=w(2,(e,t)=>Nf(()=>{let n;const r=Df({onInput:o=>Be(Ye(o),()=>r),onFailure:o=>(n=KG(o),Lt(Pi(n))),onDone:cs}),s=ms({onInput:o=>k(Ye(o),Be(()=>s)),onFailure:o=>Z5(o)&&GG(o.defect)&&ue(o.defect,n)?ru(o.defect.error):Lt(o),onDone:cs});return dn(dn(dn(e,r),t),s)})),HG=e=>ry(t=>fq(e,t)),WG=e=>HG($w(e)),Eq=e=>Er(nu(t=>Pe(Rf(),n=>uG(Xr(t($f(e,n)),r=>Vt(n,Gt(r))),(r,s)=>Vt(n,s))))),kq=e=>Tq(Pe(wA,t=>Be(en(e(t)),Ye))),Wa=w(2,(e,t)=>sy(me(()=>new si(e,void 0,se)),ra()).pipe(jn(([n,r])=>OW(t,s=>{const o=n.close(s);return o!==void 0?bn(o,r):ve})),qa,Pe(([n])=>$t(()=>fy(n.run(),n))))),fy=(e,t)=>{const n=e;switch(n._tag){case Mf:return Yr(t.getDone(),{onFailure:vr,onSuccess:r=>Nt(ie(r))});case Lf:return Nt(ae(t.getEmit()));case su:return k(n.effect,he(()=>fy(t.run(),t)));case Uf:return Tw(n,()=>fy(t.run(),t),r=>vr(r))}},Er=e=>PG(en(e)),Tq=e=>sq(Eq(e),(t,n)=>t,(t,n)=>t),Aw=e=>sq(kq(e),(t,n)=>t,(t,n)=>t),uk=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=qs(e?arguments[2]:arguments[1]),r=Tm([$K(t,n),bK(),yK,AK(FK)]);if(e){const s=arguments[0];return ly(r,([o,a])=>tk(s,Yn(a,is,o)),([o,,a,u],f)=>bh(o,f,a,u))}return s=>ly(r,([o,a])=>tk(s,Yn(a,is,o)),([o,,a,u],f)=>bh(o,f,a,u))},Dm=e=>Cq(0,e.length,e),Cq=(e,t,n)=>e===t?Fn:k(Ye(k(n,$s(e))),Be(()=>Cq(e+1,t,n))),VG=w(e=>rq(e[1]),(e,t,n)=>n?.concurrent?zG(e,{other:t,onSelfDone:r=>sk(s=>$t(()=>n0(r,s))),onOtherDone:r=>sk(s=>$t(()=>n0(s,r)))}):Be(e,r=>Rw(t,s=>[r,s]))),jf=w(e=>rq(e[1]),(e,t,n)=>n?.concurrent?Rw(VG(e,t,{concurrent:!0}),r=>r[1]):Be(e,()=>t)),dy=Symbol.for("effect/Channel/ChannelException"),KG=e=>({_tag:"ChannelException",[dy]:dy,error:e}),GG=e=>X(e,dy),hy=Symbol.for("effect/Sink"),QG={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};class zf{channel;[hy]=QG;constructor(t){this.channel=t}pipe(){return Z(this,arguments)}}const JG=e=>new zf(Nf(()=>qw(e()))),YG=()=>new zf(Iq(ot())),Iq=e=>ms({onInput:t=>Iq(k(e,ft(t))),onFailure:Lt,onDone:()=>sa(e)}),XG=new zf($w(Sq())),ZG=(e,t,n)=>JG(()=>new zf($q(e,t,n))),$q=(e,t,n)=>t(e)?Df({onInput:r=>{const[s,o]=Rq(e,r,t,n,0,r.length);return rs(o)?k(Ye(o),xG(s)):$q(s,t,n)},onFailure:ru,onDone:()=>cs(e)}):cs(e),Rq=(e,t,n,r,s,o)=>{if(s===o)return[e,ot()];const a=r(e,k(t,$s(s)));return n(a)?Rq(a,t,n,r,s+1,o):[a,k(t,Qr(s+1))]},eQ=e=>new zf(en(e)),tQ=()=>ZG(W(),dt,(e,t)=>Qe(e,{onNone:()=>V(t),onSome:()=>e})),qw=e=>Lo(e)?qw(eQ(e)):e.channel,Ow=qf,nQ=MV,rQ=BW,sQ=WW,oQ=iV,Aq=KW,qq=XW,iQ=GR;class Oq{value;constructor(t){this.value=t}}const xq=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),Fq=e=>e.newValue,Pq=(e,t)=>{e.isChanged=!0,e.newValue=t},aQ=e=>{e.ref.versioned=new Oq(e.newValue)},cQ=e=>e.ref.versioned!==e.expected,uQ=e=>e.isChanged,Mh="Invalid",xw="ReadWrite",lQ="ReadOnly",Dq=e=>{for(const t of e)aQ(t[1])},Nq=e=>{let t=lQ;for(const[,n]of e)if(t=cQ(n)?Mh:uQ(n)?xw:t,t===Mh)return t;return t},fQ=e=>{const t=new Map;for(const[,n]of e){for(const r of n.ref.todos)t.set(r[0],r[1]);n.ref.todos=new Map}return t},dQ=e=>{const t=Array.from(e.entries()).sort((n,r)=>n[0]-r[0]);for(const[n,r]of t)r()},hQ=(e,t,n)=>{let r=!1;for(const[,s]of t)s.ref.todos.has(e)||(s.ref.todos.set(e,n),r=!0);return r},Mq="WithSTMRuntime",py="OnFailure",lk="OnRetry",my="OnSuccess",pQ="Provide",Lq="Sync",Uq="Succeed",jq="Retry",zq="Fail",Bq="Die",Hq="Interrupt",Va="Fail",Ka="Die",Ga="Interrupt",pi="Succeed",ou="Retry",Fw="Done",Pw="Suspend",Dd="Done",gy="Interrupted",Lh="Running",Nm="effect/STM/State",Li=Symbol.for(Nm),Dw=e=>X(e,Li),Wq=e=>e._tag===Lh,mQ=e=>e._tag===Dd,cd=e=>({[Li]:Li,_tag:Dd,exit:e,[ge](){return k(G(Nm),le(G(Dd)),le(G(e)),Xe(this))},[pe](t){return Dw(t)&&t._tag===Dd&&ue(e,t.exit)}}),gQ=k(G(Nm),le(G(gy)),le(G("interrupted"))),_Q={[Li]:Li,_tag:gy,[ge](){return gQ},[pe](e){return Dw(e)&&e._tag===gy}},yQ=k(G(Nm),le(G(Lh)),le(G("running"))),bQ={[Li]:Li,_tag:Lh,[ge](){return yQ},[pe](e){return Dw(e)&&e._tag===Lh}},ud=e=>{switch(e._tag){case Va:return cd(bf(e.error));case Ka:return cd(mh(e.defect));case Ga:return cd(fz(e.fiberId));case pi:return cd(Rt(e.value));case ou:throw new Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},iu="effect/TExit",au=Symbol.for(iu),Bf={_A:e=>e,_E:e=>e},Hf=e=>X(e,au),SQ=e=>e._tag===pi,wQ=e=>e._tag===ou,vQ=e=>({[au]:Bf,_tag:Va,error:e,[ge](){return k(G(iu),le(G(Va)),le(G(e)),Xe(this))},[pe](t){return Hf(t)&&t._tag===Va&&ue(e,t.error)}}),EQ=e=>({[au]:Bf,_tag:Ka,defect:e,[ge](){return k(G(iu),le(G(Ka)),le(G(e)),Xe(this))},[pe](t){return Hf(t)&&t._tag===Ka&&ue(e,t.defect)}}),kQ=e=>({[au]:Bf,_tag:Ga,fiberId:e,[ge](){return k(G(iu),le(G(Ga)),le(G(e)),Xe(this))},[pe](t){return Hf(t)&&t._tag===Ga&&ue(e,t.fiberId)}}),fk=e=>({[au]:Bf,_tag:pi,value:e,[ge](){return k(G(iu),le(G(pi)),le(G(e)),Xe(this))},[pe](t){return Hf(t)&&t._tag===pi&&ue(e,t.value)}}),TQ=k(G(iu),le(G(ou)),le(G("retry"))),CQ={[au]:Bf,_tag:ou,[ge](){return TQ},[pe](e){return Hf(e)&&wQ(e)}},IQ=e=>({_tag:Fw,exit:e}),Vq=e=>({_tag:Pw,journal:e}),dk={ref:0},$Q=()=>{const e=dk.ref+1;return dk.ref=e,e},RQ="effect/STM",AQ=Symbol.for(RQ),ld={_R:e=>e,_E:e=>e,_A:e=>e};class Ks{effect_instruction_i0;_op=Ql;effect_instruction_i1=void 0;effect_instruction_i2=void 0;[G0];[s_];[hy];[Ph];get[AQ](){return ld}constructor(t){this.effect_instruction_i0=t,this[G0]=_i,this[s_]=ld,this[hy]=ld,this[Ph]=ld}[pe](t){return this===t}[ge](){return Xe(this,gp(this))}[Symbol.iterator](){return new Hc(new xc(this))}commit(){return qQ(this,il)}pipe(){return Z(this,arguments)}}const qQ=(e,t,n)=>Ae(r=>{const s=r.id(),o=r.getFiberRef(CA),a=r.getFiberRef(IA),u=r.getFiberRef(OK),f=xQ(s,e,o,a,u);switch(f._tag){case Fw:return t(f.exit),f.exit;case Pw:{const h=$Q(),p={value:bQ},m=XS(T=>Kq(s,e,h,p,o,a,u,T));return nu(T=>k(T(m),tu(C=>{let A=p.value;return Wq(A)&&(p.value=_Q),A=p.value,mQ(A)?(t(A.exit),A.exit):vr(C)})))}}}),OQ=(e,t,n,r,s,o)=>{const a=new Map,u=new Gq(t,a,e,r).run(),f=Nq(a);if(f===xw)Dq(a);else if(f===Mh)throw new Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(u._tag){case pi:return n.value=ud(u),io(Rt(u.value),a,s,o);case Va:{n.value=ud(u);const h=ta(u.error);return io(Gt(h),a,s,o)}case Ka:{n.value=ud(u);const h=Pi(u.defect);return io(Gt(h),a,s,o)}case Ga:{n.value=ud(u);const h=Sm(e);return io(Gt(h),a,s,o)}case ou:return Vq(a)}},xQ=(e,t,n,r,s)=>{const o=new Map,a=new Gq(t,o,e,n).run(),u=Nq(o);if(u===xw&&SQ(a))Dq(o);else if(u===Mh)throw new Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(a._tag){case pi:return io(Rt(a.value),o,r,s);case Va:{const f=ta(a.error);return io(Gt(f),o,r,s)}case Ka:{const f=Pi(a.defect);return io(Gt(f),o,r,s)}case Ga:{const f=Sm(e);return io(Gt(f),o,r,s)}case ou:return Vq(o)}},Kq=(e,t,n,r,s,o,a,u)=>{if(Wq(r.value)){const f=OQ(e,t,r,s,o,a);switch(f._tag){case Fw:{FQ(f.exit,u);break}case Pw:{hQ(n,f.journal,()=>Kq(e,t,n,r,s,o,a,u));break}}}},io=(e,t,n,r)=>{const s=fQ(t);return s.size>0&&n.scheduleTask(()=>dQ(s),r),IQ(e)},FQ=(e,t)=>{t(e)};class Gq{self;journal;fiberId;contStack=[];env;constructor(t,n,r,s){this.self=t,this.journal=n,this.fiberId=r,this.env=s}getEnv(){return this.env}pushStack(t){this.contStack.push(t)}popStack(){return this.contStack.pop()}nextSuccess(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==my;)t=this.popStack();return t}nextFailure(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==py;)t=this.popStack();return t}nextRetry(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==lk;)t=this.popStack();return t}run(){let t=this.self,n;for(;n===void 0&&t!==void 0;)try{const r=t;if(r)switch(r._op){case"Tag":{t=Mm((s,o,a)=>Tp(a,r));break}case"Left":{t=_y(r.left);break}case"None":{t=_y(new vm);break}case"Right":{t=Wt(r.right);break}case"Some":{t=Wt(r.value);break}case"Commit":{switch(r.effect_instruction_i0){case Bq:{n=EQ(rt(()=>r.effect_instruction_i1()));break}case zq:{const s=this.nextFailure();s===void 0?n=vQ(rt(()=>r.effect_instruction_i1())):t=rt(()=>s.effect_instruction_i2(rt(()=>r.effect_instruction_i1())));break}case jq:{const s=this.nextRetry();s===void 0?n=CQ:t=rt(()=>s.effect_instruction_i2());break}case Hq:{n=kQ(this.fiberId);break}case Mq:{t=rt(()=>r.effect_instruction_i1(this));break}case my:case py:case lk:{this.pushStack(r),t=r.effect_instruction_i1;break}case pQ:{const s=this.env;this.env=rt(()=>r.effect_instruction_i2(s)),t=k(r.effect_instruction_i1,MQ(Nw(()=>this.env=s)));break}case Uq:{const s=r.effect_instruction_i1,o=this.nextSuccess();o===void 0?n=fk(s):t=rt(()=>o.effect_instruction_i2(s));break}case Lq:{const s=rt(()=>r.effect_instruction_i1()),o=this.nextSuccess();o===void 0?n=fk(s):t=rt(()=>o.effect_instruction_i2(s));break}}break}}}catch(r){t=DQ(r)}return n}}const PQ=w(2,(e,t)=>{const n=new Ks(py);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),DQ=e=>NQ(()=>e),NQ=e=>{const t=new Ks(Bq);return t.effect_instruction_i1=e,t},Mm=e=>Hr(t=>Wt(e(t.journal,t.fiberId,t.getEnv()))),MQ=w(2,(e,t)=>UQ(e,{onFailure:n=>hk(t,_y(n)),onSuccess:n=>hk(t,Wt(n))})),_y=e=>LQ(()=>e),LQ=e=>{const t=new Ks(zq);return t.effect_instruction_i1=e,t},cu=w(2,(e,t)=>{const n=new Ks(my);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),UQ=w(2,(e,{onFailure:t,onSuccess:n})=>k(e,xl(ae),PQ(r=>k(t(r),xl(ie))),cu(r=>{switch(r._tag){case"Left":return Wt(r.left);case"Right":return n(r.right)}}))),Hr=e=>{const t=new Ks(Mq);return t.effect_instruction_i1=e,t},Xs=e=>{const t=new Ks(Hq);return t.effect_instruction_i1=e,t},xl=w(2,(e,t)=>k(e,cu(n=>Nw(()=>t(n))))),Ca=new Ks(jq),Wt=e=>{const t=new Ks(Uq);return t.effect_instruction_i1=e,t},Nw=e=>{const t=new Ks(Lq);return t.effect_instruction_i1=e,t},hk=w(2,(e,t)=>k(e,cu(()=>t))),pk="BackPressure",yy="Dropping",mk="Sliding",jQ=e=>cu(e,se),zQ=(...e)=>BQ(()=>{const n=(e.length===1?e[0]:e[1].bind(e[0]))(k),r=n.next(),s=o=>o.done?Wt(o.value):cu(uC(o.value),a=>s(n.next(a)));return s(r)}),BQ=e=>jQ(Nw(e)),gk=Wt(void 0),HQ="effect/TRef",WQ=Symbol.for(HQ),VQ={_A:e=>e};class KQ{[WQ]=VQ;todos;versioned;constructor(t){this.versioned=new Oq(t),this.todos=new Map}modify(t){return Mm(n=>{const r=Mw(this,n),[s,o]=t(Fq(r));return Pq(r,o),s})}pipe(){return Z(this,arguments)}}const Qq=e=>Mm(t=>{const n=new KQ(e);return t.set(n,xq(n,!0)),n}),GQ=e=>e.modify(t=>[t,t]),QQ=w(2,(e,t)=>e.modify(()=>[void 0,t])),JQ=w(2,(e,t)=>e.modify(n=>[void 0,t(n)])),Mw=(e,t)=>{if(t.has(e))return t.get(e);const n=xq(e,!1);return t.set(e,n),n},bs=w(2,(e,t)=>Fq(Mw(e,t))),Ss=w(3,(e,t,n)=>{const r=Mw(e,n);Pq(r,t)}),YQ="effect/TQueue/TEnqueue",XQ=Symbol.for(YQ),ZQ="effect/TQueue/TDequeue",eJ=Symbol.for(ZQ),tJ={_tag:yy},nJ={_Out:e=>e},rJ={_In:e=>e};class sJ{ref;requestedCapacity;strategy;[eJ]=nJ;[XQ]=rJ;constructor(t,n,r){this.ref=t,this.requestedCapacity=n,this.strategy=r}capacity(){return this.requestedCapacity}size=Hr(t=>{const n=bs(this.ref,t.journal);return n===void 0?Xs(t.fiberId):Wt(n.length)});isFull=xl(this.size,t=>t===this.requestedCapacity);isEmpty=xl(this.size,t=>t===0);shutdown=Hr(t=>(Ss(this.ref,void 0,t.journal),gk));isShutdown=Mm(t=>bs(this.ref,t)===void 0);awaitShutdown=cu(this.isShutdown,t=>t?gk:Ca);offer(t){return Hr(n=>{const r=k(this.ref,bs(n.journal));if(r===void 0)return Xs(n.fiberId);if(r.length<this.requestedCapacity)return r.push(t),Ss(this.ref,r,n.journal),Wt(!0);switch(this.strategy._tag){case pk:return Ca;case yy:return Wt(!1);case mk:return r.length===0||(r.shift(),r.push(t),Ss(this.ref,r,n.journal)),Wt(!0)}})}offerAll(t){return Hr(n=>{const r=Array.from(t),s=bs(this.ref,n.journal);if(s===void 0)return Xs(n.fiberId);if(s.length+r.length<=this.requestedCapacity)return Ss(this.ref,[...s,...r],n.journal),Wt(!0);switch(this.strategy._tag){case pk:return Ca;case yy:{const o=r.slice(0,this.requestedCapacity-s.length);return Ss(this.ref,[...s,...o],n.journal),Wt(!1)}case mk:{const o=r.slice(0,this.requestedCapacity-s.length),a=s.length+o.length-this.requestedCapacity,u=s.slice(a);return Ss(this.ref,[...u,...o],n.journal),Wt(!0)}}})}peek=Hr(t=>{const n=bs(this.ref,t.journal);return n===void 0?Xs(t.fiberId):n.length===0?Ca:Wt(n[0])});peekOption=Hr(t=>{const n=bs(this.ref,t.journal);return n===void 0?Xs(t.fiberId):Wt(Vi(n[0]))});take=Hr(t=>{const n=bs(this.ref,t.journal);if(n===void 0)return Xs(t.fiberId);if(n.length===0)return Ca;const r=n.shift();return Ss(this.ref,n,t.journal),Wt(r)});takeAll=Hr(t=>{const n=bs(this.ref,t.journal);return n===void 0?Xs(t.fiberId):(Ss(this.ref,[],t.journal),Wt(n))});takeUpTo(t){return Hr(n=>{const r=bs(this.ref,n.journal);if(r===void 0)return Xs(n.fiberId);const[s,o]=RI(Ft(r),t);return Ss(this.ref,Array.from(o),n.journal),Wt(Array.from(s))})}}const oJ=w(2,(e,t)=>e.offer(t)),iJ=e=>e.peek,aJ=e=>e.take,cJ=()=>uJ(Number.MAX_SAFE_INTEGER,tJ),uJ=(e,t)=>xl(Qq([]),n=>new sJ(n,e,t)),lJ=oJ,fJ=iJ,dJ=aJ,hJ=cJ,pJ=(e,t)=>{let n=!1,r=[],s=!1;function o(f){if(n)return!1;if(f.length<=5e4)r.push.apply(r,f);else for(let h=0;h<f.length;h++)r.push(f[0]);return s||(s=!0,t.scheduleTask(a,0)),!0}function a(){s=!1,r.length>0&&(e.unsafeOffer(r),r=[])}function u(f){n||(n=!0,f._tag==="Success"&&r.push(f.value),a(),e.unsafeOffer(f._tag==="Success"?Wn:f))}return{single(f){return n?!1:(r.push(f),s||(s=!0,t.scheduleTask(a,0)),!0)},array:o,chunk(f){return o(Sr(f))},done:u,end(){n||(n=!0,a(),e.unsafeOffer(Wn))},halt(f){return u(Gt(f))},fail(f){return u(bf(f))},die(f){return u(mh(f))},dieMessage(f){return u(mh(new Error(f)))}}},mJ="effect/Take",gJ=Symbol.for(mJ),_J={_A:e=>e,_E:e=>e};class Lm{exit;[gJ]=_J;constructor(t){this.exit=t}pipe(){return Z(this,arguments)}}const _k=e=>new Lm(Rt(e)),yk=new Lm(bf(W())),yJ=e=>new Lm(Gt(k(e,VS(V)))),bJ=e=>new Lm(Rt(mt(e))),SJ=()=>Ni(W()),wJ=e=>na(vr(e),V),vJ="effect/Stream",Jq=Symbol.for(vJ),EJ={_R:e=>e,_E:e=>e,_A:e=>e};class it{channel;[Jq]=EJ;constructor(t){this.channel=t}pipe(){return Z(this,arguments)}}const Yq=e=>X(e,Jq)||Lo(e),Lw=4096,kJ=e=>{if(e?.bufferSize==="unbounded"||e?.bufferSize===void 0&&e?.strategy===void 0)return Ln();switch(e?.strategy){case"sliding":return W8(e.bufferSize??16);default:return H8(e?.bufferSize??16)}},Xq=(e,t)=>Ct(kJ(t),qn).pipe(jn(n=>qK(IA,r=>e(pJ(n,r)))),Pe(n=>{const r=Be(Tc(n),s=>az(s)?ph(s)?Fn:Lt(s.cause):jf(Ye(Ft(s)),r));return r}),Tq,eO),TJ=w(2,(e,t)=>CJ(e,n=>un(wm(n),{onLeft:t,onRight:RJ}))),CJ=w(2,(e,t)=>new it(k(et(e),Ew(n=>et(t(n)))))),IJ=w(2,(e,t)=>new it(k(et(e),jf(et(t))))),$J=e=>uu(Al(e)),by=w(2,(e,t)=>new it(k(et(e),bq(t)))),RJ=e=>uu(vr(e)),AJ=w(2,(e,t)=>rO(e,$p(t))),qJ=w(2,(e,t)=>{const n=r=>{const s=r.next();return s.done?ms({onInput:o=>n(o[Symbol.iterator]()),onFailure:Lt,onDone:sa}):k(t(s.value),Pe(o=>o?k(Ye(mt(s.value)),Be(()=>n(r))):n(r)),Er)};return new it(Nf(()=>k(et(e),dn(n(ot()[Symbol.iterator]())))))}),OJ=w(2,(e,t)=>rO(e,II(t))),Um=w(e=>Yq(e[0]),(e,t,n)=>{const r=n?.bufferSize??16;return n?.switch?Sy(n?.concurrency,()=>bk(e,1,r,t),s=>bk(e,s,r,t)):Sy(n?.concurrency,()=>new it(Nh(et(e),s=>k(s,$I(o=>et(t(o))),J3(Fn,(o,a)=>k(o,jf(a)))))),s=>new it(k(et(e),Nh(Dm),wq(o=>et(t(o)),n))))}),Sy=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},bk=w(4,(e,t,n,r)=>new it(k(et(e),Nh(Dm),wq(s=>et(r(s)),{concurrency:t,mergeStrategy:$G(),bufferSize:n})))),jm=w(e=>Yq(e[0]),(e,t)=>Um(e,se,t)),xJ=e=>{const t=ms({onInput:n=>Be(Dm(n),()=>t),onFailure:Lt,onDone:()=>Fn});return new it(k(et(e),dn(t)))},FJ=e=>{const t=(r,s)=>{const[o,a]=k(r,G3(f=>!ph(f))),u=k(Ap(a),Qe({onNone:()=>s,onSome:Yr({onFailure:f=>Qe(tW(f),{onNone:()=>Fn,onSome:Lt}),onSuccess:()=>Fn})}));return k(Ye(k(o,II(f=>ph(f)?V(f.value):W()))),Be(()=>u))},n=ms({onInput:r=>t(r,n),onFailure:r=>Lt(r),onDone:()=>Fn});return new it(k(et(e),dn(n)))},Zq=e=>xJ(FJ(k(e,nO(t=>t.exit)))),eO=e=>new it(e),et=e=>{if("channel"in e)return e.channel;if(Lo(e))return et(uu(e));throw new TypeError("Expected a Stream.")},PJ=e=>new it(Rp(e)?Fn:Ye(e)),uu=e=>k(e,na(V),DJ),DJ=e=>new it(Er(EK(e,{onFailure:Qe({onNone:()=>Fn,onSome:ru}),onSuccess:t=>Ye(mt(t))}))),tO=(e,t)=>{const n=t?.maxChunkSize??Lw;if(t?.scoped){const s=Pe(Z0(e),o=>Fl(o,{maxChunkSize:n,shutdown:!0}));return t.shutdown?Pe(s,by(ay(e))):s}const r=Um(sO(Z0(e)),s=>Fl(s,{maxChunkSize:n}));return t?.shutdown?by(r,ay(e)):r},NJ=e=>jw(()=>Ip(e)?PJ(e):MJ(e[Symbol.iterator]())),MJ=(e,t=Lw)=>k(me(()=>{let n=[];const r=s=>k(me(()=>{let o=s.next();if(t===1)return o.done?Fn:k(Ye(mt(o.value)),Be(()=>r(s)));n=[];let a=0;for(;o.done===!1&&(n.push(o.value),a=a+1,!(a>=t));)o=s.next();return a>0?k(Ye(Ft(n)),Be(()=>r(s))):Fn}),Er);return new it(r(e))}),oO),Fl=(e,t)=>k(MA(e,1,t?.maxChunkSize??Lw),tu(n=>k(K8(e),he(r=>r&&RR(n)?SJ():wJ(n)))),VJ,t?.shutdown?by(qn(e)):se),LJ=(...e)=>NJ(e),nO=w(2,(e,t)=>new it(k(et(e),Pm($I(t))))),rO=w(2,(e,t)=>new it(k(et(e),Pm(t)))),UJ=w(2,(e,t)=>new it(k(et(e),MG(t)))),wy=w(2,(e,t)=>{const n=r=>{const s=r.next();if(s.done)return ms({onInput:o=>n(o[Symbol.iterator]()),onFailure:Lt,onDone:sa});{const o=s.value;return Er(Pe(t(o),a=>Be(Ye(mt(a)),()=>n(r))))}};return new it(k(et(e),dn(Nf(()=>n(ot()[Symbol.iterator]())))))}),jJ=w(3,(e,t,n)=>new it(k(et(e),Nh(Dm),LG(n,t),Pm(mt)))),zJ=w(2,(e,t)=>new it(k(et(e),DG(t)))),BJ=uu(ZS),HJ=e=>k(e,WJ(se)),WJ=w(2,(e,t)=>new it(k(et(e),BG(t)))),VJ=e=>ZJ(e,t=>k(Pe(t,n=>V([n,t])),ew(Qe({onNone:()=>Nt(W()),onSome:Ni})))),Uw=w(2,(e,t)=>et(e).pipe(vq(qw(t)),WG)),KJ=e=>Uw(e,YG()),GJ=e=>Uw(e,XG),QJ=e=>Uw(e,tQ()),sO=e=>new it(bq(Eq(k(e,Pe(mt))),ve)),JJ=e=>new it(kq(t=>e(t).pipe(Pe(mt)))),jw=e=>new it(Nf(()=>et(e()))),YJ=w(2,(e,t)=>{if(!Number.isInteger(t))return $J(new nW(`${t} must be an integer`));const n=r=>Df({onInput:s=>{const o=k(s,tc(Math.min(r,Number.POSITIVE_INFINITY))),a=Math.max(0,r-o.length);return a>0?k(Ye(o),Be(()=>n(a))):Ye(o)},onFailure:ru,onDone:sa});return new it(k(et(e),vq(0<t?n(t):Fn)))}),XJ=w(2,(e,t)=>wy(e,n=>xs(t(n),n))),ZJ=(e,t)=>jw(()=>{const n=r=>Er(Pe(t(r),Qe({onNone:()=>Fn,onSome:([s,o])=>Be(Ye(s),()=>n(o))})));return new it(n(e))}),oO=e=>jm(uu(e)),iO=e=>jm(sO(e)),e7=e=>jm(JJ(t=>e(t))),t7=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=qs(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return new it(uk(et(r),t,n))}return r=>new it(uk(et(r),t,n))},n7=(e,t,n)=>Xq(r=>Ct(me(()=>e.addEventListener(t,r.single,n)),()=>me(()=>e.removeEventListener(t,r.single,n))),{bufferSize:typeof n=="object"?n.bufferSize:void 0}),r7=ly,Sk=Symbol.for("effect/Encoding/errors/Decode"),Ug=(e,t)=>{const n={_tag:"DecodeException",[Sk]:Sk,input:e};return Pn(t)&&(n.message=t),n},s7=new TextEncoder,wk=e=>{const t=e.length;let n="",r;for(r=2;r<t;r+=3)n+=ws[e[r-2]>>2],n+=ws[(e[r-2]&3)<<4|e[r-1]>>4],n+=ws[(e[r-1]&15)<<2|e[r]>>6],n+=ws[e[r]&63];return r===t+1&&(n+=ws[e[r-2]>>2],n+=ws[(e[r-2]&3)<<4],n+="=="),r===t&&(n+=ws[e[r-2]>>2],n+=ws[(e[r-2]&3)<<4|e[r-1]>>4],n+=ws[(e[r-1]&15)<<2],n+="="),n},o7=e=>{const t=i7(e),n=t.length;if(n%4!==0)return ie(Ug(t,`Length must be a multiple of 4, but is ${n}`));const r=t.indexOf("=");if(r!==-1&&(r<n-2||r===n-2&&t[n-1]!=="="))return ie(Ug(t,"Found a '=' character, but it is not at the end"));try{const s=t.endsWith("==")?2:t.endsWith("=")?1:0,o=new Uint8Array(3*(n/4)-s);for(let a=0,u=0;a<n;a+=4,u+=3){const f=fd(t.charCodeAt(a))<<18|fd(t.charCodeAt(a+1))<<12|fd(t.charCodeAt(a+2))<<6|fd(t.charCodeAt(a+3));o[u]=f>>16,o[u+1]=f>>8&255,o[u+2]=f&255}return ae(o)}catch(s){return ie(Ug(t,s instanceof Error?s.message:"Invalid input"))}},i7=e=>e.replace(/[\n\r]/g,"");function fd(e){if(e>=vk.length)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);const t=vk[e];if(t===255)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}const ws=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],vk=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],a7=e=>wk(typeof e=="string"?s7.encode(e):e),c7=e=>o7(e),vy=Symbol.for("effect/FiberHandle"),u7=e=>X(e,vy),l7={[vy]:vy,toString(){return ut(this.toJSON())},toJSON(){return{_id:"FiberHandle",state:this.state}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},f7=e=>{const t=Object.create(l7);return t.state={_tag:"Open",fiber:void 0},t.deferred=e,t},aO=()=>Ct(Pe(Le(),e=>f7(e)),e=>wc(t=>{const n=e.state;return n._tag==="Closed"?ve:(e.state={_tag:"Closed"},n.fiber?Im(nw(Em(n.fiber,ho(t.id(),Yu))),e.deferred):Mo(e.deferred,Wn))})),cO=-1,Yu=YI(cO,0),d7=AR(void 0,{emptyCase:ts,failCase:ts,dieCase:ts,interruptCase:(e,t)=>Db(jb(t),cO),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),h7=w(e=>u7(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(ho(n?.interruptAs??wr,Yu));return}else if(e.state.fiber!==void 0){if(n?.onlyIfMissing===!0){t.unsafeInterruptAsFork(ho(n?.interruptAs??wr,Yu));return}else if(e.state.fiber===t)return;e.state.fiber.unsafeInterruptAsFork(ho(n?.interruptAs??wr,Yu)),e.state.fiber=void 0}e.state.fiber=t,t.addObserver(r=>{e.state._tag==="Open"&&t===e.state.fiber&&(e.state.fiber=void 0),Yc(r)&&(n?.propagateInterruption===!0?!d7(r.cause):!go(r.cause))&&pS(e.deferred,r)})}),p7=e=>nu(t=>wc(n=>e.state._tag==="Closed"||e.state.fiber===void 0?ve:st(t(Em(e.state.fiber,ho(n.id(),Yu))),me(()=>{e.state._tag==="Open"&&(e.state.fiber=void 0)})))),m7=function(){let e;return()=>(e===void 0&&(e=ps(no)),e)}(),Uh=function(){const e=arguments[0];if(Lo(arguments[1]))return Ek(e,arguments[1],arguments[2]);const t=arguments[1];return n=>Ek(e,n,t)},Ek=(e,t,n)=>vA(r=>e.state._tag==="Closed"?no:e.state.fiber!==void 0&&n?.onlyIfMissing===!0?me(m7):jn(EA(t),s=>h7(e,s,{...n,interruptAs:r}))),Ey=Symbol.for("effect/FiberSet"),g7=e=>X(e,Ey),_7={[Ey]:Ey,[Symbol.iterator](){return this.state._tag==="Closed"?QD():this.state.backing[Symbol.iterator]()},toString(){return ut(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Je](){return this.toJSON()},pipe(){return Z(this,arguments)}},y7=(e,t)=>{const n=Object.create(_7);return n.state={_tag:"Open",backing:e},n.deferred=t,n},b7=()=>Ct(Pe(Le(),e=>y7(new Set,e)),e=>wc(t=>{const n=e.state;if(n._tag==="Closed")return ve;e.state={_tag:"Closed"};const r=n.backing;return $V(r,ho(t.id(),lO)).pipe(Im(e.deferred))})),uO=-1,lO=YI(uO,0),S7=AR(void 0,{emptyCase:ts,failCase:ts,dieCase:ts,interruptCase:(e,t)=>Db(jb(t),uO),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),w7=w(e=>g7(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(ho(n?.interruptAs??wr,lO));return}else if(e.state.backing.has(t))return;e.state.backing.add(t),t.addObserver(r=>{e.state._tag!=="Closed"&&(e.state.backing.delete(t),Yc(r)&&(n?.propagateInterruption===!0?!S7(r.cause):!go(r.cause))&&pS(e.deferred,r))})}),v7=e=>It(e.deferred),E7="effect/GroupBy",fO=Symbol.for(E7),k7={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},T7=e=>X(e,fO),C7=w(e=>T7(e[0]),(e,t,n)=>Um(e.grouped,([r,s])=>t(r,Zq(Fl(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:n?.bufferSize??16})),I7=e=>({[fO]:k7,pipe(){return Z(this,arguments)},grouped:e}),$7=w(e=>typeof e[0]!="function",(e,t,n)=>n?.key?C7(R7(e,n.key,{bufferSize:n.bufferSize}),(r,s)=>wy(s,t)):Sy(n?.concurrency,()=>wy(e,t),r=>n?.unordered?Um(e,s=>uu(t(s)),{concurrency:r}):jJ(e,r,t))),R7=w(e=>typeof e[0]!="function",(e,t,n)=>{const r=(s,o)=>ms({onInput:a=>Be(en(fn(A7(a,t),([u,f])=>{const h=s.get(u);return h===void 0?k(yw(n?.bufferSize??16),he(p=>k(me(()=>{s.set(u,p)}),st(bt(o,bJ([u,p]))),st(k(bt(p,_k(f)),qg(m=>go(m)?V(ve):W())))))):qg(bt(h,_k(f)),p=>go(p)?V(ve):W())},{discard:!0})),()=>r(s,o)),onFailure:a=>en(bt(o,yJ(a))),onDone:()=>k(en(k(fn(s.entries(),([a,u])=>k(bt(u,yk),qg(f=>go(f)?V(ve):W())),{discard:!0}),st(bt(o,yk)))))});return I7(e7(s=>K(function*(){const o=new Map,a=yield*Ln();return yield*Eo(s,qn(a)),yield*et(e).pipe(dn(r(o,a)),$w,fq(s),Un(s),xs(Zq(Fl(a,{shutdown:!0}))))})))}),A7=w(2,(e,t)=>{const n=[],r=e[Symbol.iterator](),s=new Map;let o;for(;(o=r.next())&&!o.done;){const a=o.value,u=t(a);if(s.has(u))s.get(u).push(a);else{const f=[a];n.push([u,f]),s.set(u,f)}}return Ft(n.map(a=>[a[0],Ft(a[1])]))});class cn{path;actual;issue;_tag="Pointer";constructor(t,n,r){this.path=t,this.actual=n,this.issue=r}}class kk{actual;message;_tag="Unexpected";constructor(t,n){this.actual=t,this.message=n}}class Cu{ast;message;_tag="Missing";actual=void 0;constructor(t,n){this.ast=t,this.message=n}}class qt{ast;actual;issues;output;_tag="Composite";constructor(t,n,r,s){this.ast=t,this.actual=n,this.issues=r,this.output=s}}class jg{ast;actual;kind;issue;_tag="Refinement";constructor(t,n,r,s){this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class zg{ast;actual;kind;issue;_tag="Transformation";constructor(t,n,r,s){this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class jt{ast;actual;message;_tag="Type";constructor(t,n,r){this.ast=t,this.actual=n,this.message=r}}class Tk{ast;actual;message;_tag="Forbidden";constructor(t,n,r){this.ast=t,this.actual=n,this.message=r}}const ky=Symbol.for("effect/Schema/ParseErrorTypeId"),Ck=e=>X(e,ky);class q7 extends FW("ParseError"){[ky]=ky;get message(){return this.toString()}toString(){return Zu.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[Je](){return this.toJSON()}}const lu=e=>new q7({issue:e}),Pr=ae,To=ie,Ik=ID,Tn=kC,ao=w(2,(e,t)=>Tn(e)?un(e,{onLeft:ie,onRight:t}):he(e,t)),$n=w(2,(e,t)=>Tn(e)?RD(e,t):Pe(e,t)),Xu=w(2,(e,t)=>Tn(e)?Xl(e,t):na(e,t)),O7=w(2,(e,t)=>Tn(e)?$D(e,{onLeft:t.onFailure,onRight:t.onSuccess}):gK(e,t)),dO=w(2,(e,t)=>Tn(e)?un(e,{onLeft:t,onRight:ae}):ew(e,t)),zm=(e,t)=>t===void 0||Fs(t)?e:e===void 0?t:{...e,...t},Bm=(e,t,n)=>{const r=on(e,t);return(s,o)=>r(s,zm(n,o))},zw=(e,t,n)=>{const r=Bm(e,t,n);return(s,o)=>TC(r(s,o),lu)},hO=(e,t,n)=>{const r=on(e,t);return(s,o)=>r(s,{...zm(n,o),isEffectAllowed:!0})},pO=(e,t)=>zw(e.ast,!0,t),x7=(e,t)=>Bm(e.ast,!0,t),fu=(e,t)=>hO(e.ast,!0,t),Bw=(e,t)=>zw(e.ast,!1,t),F7=(e,t)=>Bm(e.ast,!1,t),oa=(e,t)=>hO(e.ast,!1,t),Cc=pO,P7=fu,Hm=(e,t)=>zw(Tt(e.ast),!0,t),D7=(e,t)=>Bm(Tt(e.ast),!0,t),at=(e,t)=>{const n=on(Tt(e.ast),!0);return(r,s)=>Gr(n(r,{exact:!0,...zm(t,s)}))},co=Bw,N7=oa,M7=Oe(Symbol.for("effect/ParseResult/decodeMemoMap"),()=>new WeakMap),L7=Oe(Symbol.for("effect/ParseResult/encodeMemoMap"),()=>new WeakMap),on=(e,t)=>{const n=t?M7:L7,r=n.get(e);if(r)return r;const s=U7(e,t),o=NN(e),a=tt(o)?(h,p)=>s(h,zm(p,o.value)):s,u=MN(e),f=t&&tt(u)?(h,p)=>Lu(dO(a(h,p),u.value),e,h,p):a;return n.set(e,f),f},Bg=e=>dr(FN(e)),Hg=e=>dr(PN(e)),U7=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=on(e.from,!0);return(r,s)=>{s=s??bg;const o=s?.errors==="all",a=ao(dO(n(r,s),u=>{const f=new jg(e,r,"From",u);return o&&UN(e)&&bO(u)?Qe(e.filter(r,s,e),{onNone:()=>ie(f),onSome:h=>ie(new qt(e,r,[f,new jg(e,r,"Predicate",h)]))}):ie(f)}),u=>Qe(e.filter(u,s,e),{onNone:()=>ae(u),onSome:f=>ie(new jg(e,r,"Predicate",f))}));return Lu(a,e,r,s)}}else{const n=on(Tt(e),!0),r=on(gO(e.from),!1);return(s,o)=>Lu(ao(n(s,o),a=>r(a,o)),e,s,o)}case"Transformation":{const n=z7(e.transformation,t),r=t?on(e.from,!0):on(e.to,!1),s=t?on(e.to,!0):on(e.from,!1);return(o,a)=>Lu(ao(Xu(r(o,a),u=>new zg(e,o,t?"Encoded":"Type",u)),u=>ao(Xu(n(u,a??bg,e,o),f=>new zg(e,o,"Transformation",f)),f=>Xu(s(f,a),h=>new zg(e,o,t?"Type":"Encoded",h)))),e,o,a)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>Lu(n(r,s??bg,e),e,r,s)}case"Literal":return Gn(e,n=>n===e.literal);case"UniqueSymbol":return Gn(e,n=>n===e.symbol);case"UndefinedKeyword":return Gn(e,W2);case"NeverKeyword":return Gn(e,V2);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return ae;case"StringKeyword":return Gn(e,Pn);case"NumberKeyword":return Gn(e,Fs);case"BooleanKeyword":return Gn(e,mi);case"BigIntKeyword":return Gn(e,hp);case"SymbolKeyword":return Gn(e,Hd);case"ObjectKeyword":return Gn(e,ls);case"Enums":return Gn(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=mI(e);return Gn(e,r=>Pn(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(h=>on(h.type,t)),r=e.rest.map(h=>on(h.type,t));let s=e.elements.filter(h=>!h.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,a=e.elements.length>0?e.elements.map((h,p)=>p).join(" | "):"never",u=Bg(e),f=Hg(e);return(h,p)=>{if(!tN(h))return ie(new jt(e,h));const m=p?.errors==="all",T=[];let C=0;const A=[],D=h.length;for(let E=D;E<=o-1;E++){const v=new cn(E,h,new Cu(s[E-D]));if(m){T.push([C++,v]);continue}else return ie(new qt(e,h,v,A))}if(e.rest.length===0)for(let E=e.elements.length;E<=D-1;E++){const v=new cn(E,h,new kk(h[E],`is unexpected, expected: ${a}`));if(m){T.push([C++,v]);continue}else return ie(new qt(e,h,v,A))}let y=0,b;for(;y<n.length;y++)if(D<y+1){if(e.elements[y].isOptional)continue}else{const E=n[y],v=E(h[y],p);if(Tn(v)){if(Zt(v)){const R=new cn(y,h,v.left);if(m){T.push([C++,R]);continue}else return ie(new qt(e,h,R,Ir(A)))}A.push([C++,v.right])}else{const R=C++,q=y;b||(b=[]),b.push(({es:x,output:N})=>he(Sa(v),j=>{if(Zt(j)){const P=new cn(q,h,j.left);return m?(x.push([R,P]),ve):ie(new qt(e,h,P,Ir(N)))}return N.push([R,j.right]),ve}))}}if(pt(r)){const[E,...v]=r;for(;y<D-v.length;y++){const R=E(h[y],p);if(Tn(R))if(Zt(R)){const q=new cn(y,h,R.left);if(m){T.push([C++,q]);continue}else return ie(new qt(e,h,q,Ir(A)))}else A.push([C++,R.right]);else{const q=C++,x=y;b||(b=[]),b.push(({es:N,output:j})=>he(Sa(R),P=>{if(Zt(P)){const L=new cn(x,h,P.left);return m?(N.push([q,L]),ve):ie(new qt(e,h,L,Ir(j)))}else return j.push([q,P.right]),ve}))}}for(let R=0;R<v.length;R++)if(y+=R,!(D<y+1)){const q=v[R](h[y],p);if(Tn(q)){if(Zt(q)){const x=new cn(y,h,q.left);if(m){T.push([C++,x]);continue}else return ie(new qt(e,h,x,Ir(A)))}A.push([C++,q.right])}else{const x=C++,N=y;b||(b=[]),b.push(({es:j,output:P})=>he(Sa(q),L=>{if(Zt(L)){const Q=new cn(N,h,L.left);return m?(j.push([x,Q]),ve):ie(new qt(e,h,Q,Ir(P)))}return P.push([x,L.right]),ve}))}}}const _=({es:E,output:v})=>vd(E)?ie(new qt(e,h,Ir(E),Ir(v))):ae(Ir(v));if(b&&b.length>0){const E=b;return $t(()=>{const v={es:xu(T),output:xu(A)};return he(fn(E,R=>R(v),{concurrency:u,batching:f,discard:!0}),()=>_(v))})}return _({output:A,es:T})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return Gn(e,K2);const n=[],r={},s=[];for(const p of e.propertySignatures)n.push([on(p.type,t),p]),r[p.name]=null,s.push(p.name);const o=e.indexSignatures.map(p=>[on(p.parameter,t),on(p.type,t),p.parameter]),a=tn.make(e.indexSignatures.map(p=>p.parameter).concat(s.map(p=>Hd(p)?new aI(p):new th(p)))),u=on(a,t),f=Bg(e),h=Hg(e);return(p,m)=>{if(!Q2(p))return ie(new jt(e,p));const T=m?.errors==="all",C=[];let A=0;const D=m?.onExcessProperty==="error",y=m?.onExcessProperty==="preserve",b={};let _;if(D||y){_=xr(p);for(const q of _){const x=u(q,m);if(Tn(x)&&Zt(x))if(D){const N=new cn(q,p,new kk(p[q],`is unexpected, expected: ${String(a)}`));if(T){C.push([A++,N]);continue}else return ie(new qt(e,p,N,b))}else b[q]=p[q]}}let E;const v=m?.exact===!0;for(let q=0;q<n.length;q++){const x=n[q][1],N=x.name,j=Object.prototype.hasOwnProperty.call(p,N);if(!j){if(x.isOptional)continue;if(v){const Q=new cn(N,p,new Cu(x));if(T){C.push([A++,Q]);continue}else return ie(new qt(e,p,Q,b))}}const P=n[q][0],L=P(p[N],m);if(Tn(L)){if(Zt(L)){const Q=new cn(N,p,j?L.left:new Cu(x));if(T){C.push([A++,Q]);continue}else return ie(new qt(e,p,Q,b))}b[N]=L.right}else{const Q=A++,oe=N;E||(E=[]),E.push(({es:J,output:De})=>he(Sa(L),qe=>{if(Zt(qe)){const nt=new cn(oe,p,j?qe.left:new Cu(x));return T?(J.push([Q,nt]),ve):ie(new qt(e,p,nt,De))}return De[oe]=qe.right,ve}))}}for(let q=0;q<o.length;q++){const x=o[q],N=x[0],j=x[1],P=MC(p,x[2]);for(const L of P){const Q=N(L,m);if(Tn(Q)&&Gr(Q)){const oe=j(p[L],m);if(Tn(oe))if(Zt(oe)){const J=new cn(L,p,oe.left);if(T){C.push([A++,J]);continue}else return ie(new qt(e,p,J,b))}else Object.prototype.hasOwnProperty.call(r,L)||(b[L]=oe.right);else{const J=A++,De=L;E||(E=[]),E.push(({es:qe,output:nt})=>he(Sa(oe),gt=>{if(Zt(gt)){const Mn=new cn(De,p,gt.left);return T?(qe.push([J,Mn]),ve):ie(new qt(e,p,Mn,nt))}else return Object.prototype.hasOwnProperty.call(r,L)||(nt[L]=gt.right),ve}))}}}}const R=({es:q,output:x})=>{if(vd(q))return ie(new qt(e,p,Ir(q),x));if(m?.propertyOrder==="original"){const N=_||xr(p);for(const P of s)N.indexOf(P)===-1&&N.push(P);const j={};for(const P of N)Object.prototype.hasOwnProperty.call(x,P)&&(j[P]=x[P]);return ae(j)}return ae(x)};if(E&&E.length>0){const q=E;return $t(()=>{const x={es:xu(C),output:Object.assign({},b)};return he(fn(q,N=>N(x),{concurrency:f,batching:h,discard:!0}),()=>R(x))})}return R({es:C,output:b})}}case"Union":{const n=mO(e.types,t),r=xr(n.keys),s=r.length,o=e.types.length,a=new Map;for(let h=0;h<o;h++)a.set(e.types[h],on(e.types[h],t));const u=Bg(e)??1,f=Hg(e);return(h,p)=>{const m=[];let T=0,C=[];if(s>0)if(pp(h))for(let y=0;y<s;y++){const b=r[y],_=n.keys[b].buckets;if(Object.prototype.hasOwnProperty.call(h,b)){const E=String(h[b]);if(Object.prototype.hasOwnProperty.call(_,E))C=C.concat(_[E]);else{const{candidates:v,literals:R}=n.keys[b],q=tn.make(R),x=v.length===o?new br([new kt(b,q,!1,!0)],[]):tn.make(v);m.push([T++,new qt(x,h,new cn(b,h,new jt(q,h[b])))])}}else{const{candidates:E,literals:v}=n.keys[b],R=new kt(b,tn.make(v),!1,!0),q=E.length===o?new br([R],[]):tn.make(E);m.push([T++,new qt(q,h,new cn(b,h,new Cu(R)))])}}else{const y=n.candidates.length===o?e:tn.make(n.candidates);m.push([T++,new jt(y,h)])}n.otherwise.length>0&&(C=C.concat(n.otherwise));let A;for(let y=0;y<C.length;y++){const b=C[y],_=a.get(b)(h,p);if(Tn(_)&&(!A||A.length===0)){if(Gr(_))return _;m.push([T++,_.left])}else{const E=T++;A||(A=[]),A.push(v=>$t(()=>"finalResult"in v?ve:he(Sa(_),R=>(Gr(R)?v.finalResult=R:v.es.push([E,R.left]),ve))))}}const D=y=>vd(y)?y.length===1&&y[0][1]._tag==="Type"?ie(y[0][1]):ie(new qt(e,h,Ir(y))):ie(new jt(e,h));if(A&&A.length>0){const y=A;return $t(()=>{const b={es:xu(m)};return he(fn(y,_=>_(b),{concurrency:u,batching:f,discard:!0}),()=>"finalResult"in b?b.finalResult:D(b.es))})}return D(m)}}case"Suspend":{const n=pb(()=>on(Si(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},Gn=(e,t)=>n=>t(n)?ae(n):ie(new jt(e,n)),Mu=(e,t)=>{switch(e._tag){case"Declaration":{const n=Nc(e);if(tt(n))return Mu(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?d_(s.type):Tt(s.type);Ku(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=t?d_(s.type):Tt(s.type);Ku(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return Mu(e.from,t);case"Suspend":return Mu(e.f(),t);case"Transformation":return Mu(t?e.from:e.to,t)}return[]},mO=(e,t)=>{const n={},r=[],s=[];for(let o=0;o<e.length;o++){const a=e[o],u=Mu(a,t);if(u.length>0){s.push(a);for(let f=0;f<u.length;f++){const[h,p]=u[f],m=String(p.literal);n[h]=n[h]||{buckets:{},literals:[],candidates:[]};const T=n[h].buckets;if(Object.prototype.hasOwnProperty.call(T,m)){if(f<u.length-1)continue;T[m].push(a),n[h].literals.push(p),n[h].candidates.push(a)}else{T[m]=[a],n[h].literals.push(p),n[h].candidates.push(a);break}}}else r.push(a)}return{keys:n,otherwise:r,candidates:s}},gO=e=>Na(e)?gO(e.from):e,Lu=(e,t,n,r)=>{if(r?.isEffectAllowed===!0||Tn(e))return e;const s=new H1,o=ps(e,{scheduler:s});s.flush();const a=o.unsafePoll();if(a){if(ph(a))return ae(a.value);const u=a.cause;return $R(u)?ie(u.error):ie(new Tk(t,n,$h(u)))}return ie(new Tk(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))},j7=([e],[t])=>e>t?1:e<t?-1:0;function Ir(e){return e.sort(j7).map(t=>t[1])}const z7=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return ae;case"TypeLiteralTransformation":return n=>{let r=ae(n);for(const s of e.propertySignatureTransformations){const[o,a]=t?[s.from,s.to]:[s.to,s.from],u=t?s.decode:s.encode;r=$n(r,h=>{const p=u(Object.prototype.hasOwnProperty.call(h,o)?V(h[o]):W());return delete h[o],tt(p)&&(h[a]=p.value),h})}return r}}},En=(e,t=[])=>({value:e,forest:t}),Zu={formatIssue:e=>$n(Ia(e),B7),formatIssueSync:e=>{const t=Zu.formatIssue(e);return Tn(t)?qD(t):fr(t)},formatError:e=>Zu.formatIssue(e.issue),formatErrorSync:e=>Zu.formatIssueSync(e.issue)},B7=e=>e.value+_O(`
`,e.forest),_O=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const a=o===r-1;n+=e+(a?"":"")+" "+s.value,n+=_O(e+(r>1&&!a?"  ":"   "),s.forest)}return n},H7=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},W7=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},yO=e=>"ast"in e?V(e.ast):W(),Ty=ae(void 0),V7=e=>yO(e).pipe(Pc(ON),Qe({onNone:()=>Ty,onSome:t=>{const n=t(e);return Pn(n)?ae({message:n,override:!1}):Lo(n)?Pe(n,r=>({message:r,override:!1})):Pn(n.message)?ae({message:n.message,override:n.override}):Pe(n.message,r=>({message:r,override:n.override}))}})),Hw=e=>t=>t._tag===e,bO=Hw("Composite"),$k=Hw("Refinement"),Rk=Hw("Transformation"),el=e=>ao(V7(e),t=>t!==void 0?!t.override&&(bO(e)||$k(e)&&e.kind==="From"||Rk(e)&&e.kind!=="Transformation")?Rk(e)||$k(e)?el(e.issue):Ty:ae(t.message):Ty),SO=e=>yO(e).pipe(Pc(DN),DD(t=>t(e)),dr);function K7(e){return iI(e).pipe(Is(()=>sI(e)),Is(()=>oI(e)),Is(()=>bp(e)),ht(()=>`{ ${e.from} | filter }`))}function G7(e){return e.message!==void 0?e.message:`Expected ${Na(e.ast)?K7(e.ast):String(e.ast)}, actual ${yr(e.actual)}`}const Q7=e=>$n(el(e),t=>t??SO(e)??G7(e)),dd=e=>SO(e)??String(e.ast),J7=e=>e.message??"is forbidden",Y7=e=>e.message??"is unexpected",X7=e=>{const t=xN(e.ast);if(tt(t)){const n=t.value();return Pn(n)?ae(n):n}return ae(e.message??"is missing")},Ia=e=>{switch(e._tag){case"Type":return $n(Q7(e),En);case"Forbidden":return ae(En(dd(e),[En(J7(e))]));case"Unexpected":return ae(En(Y7(e)));case"Missing":return $n(X7(e),En);case"Transformation":return ao(el(e),t=>t!==void 0?ae(En(t)):$n(Ia(e.issue),n=>En(dd(e),[En(H7(e.kind),[n])])));case"Refinement":return ao(el(e),t=>t!==void 0?ae(En(t)):$n(Ia(e.issue),n=>En(dd(e),[En(W7(e.kind),[n])])));case"Pointer":return $n(Ia(e.issue),t=>En(jC(e.path),[t]));case"Composite":return ao(el(e),t=>{if(t!==void 0)return ae(En(t));const n=dd(e);return UC(e.issues)?$n(fn(e.issues,Ia),r=>En(n,r)):$n(Ia(e.issues),r=>En(n,[r]))})}},Ak=Symbol.for("effect/Pool"),Z7={_E:e=>e,_A:e=>e},wO=e=>Dn(t=>U(Qc(),n=>{const r=Zn(n,Lr),s=V$(e.acquire,f=>Po(n,f)),o=new n9(r,s,e.concurrency??1,e.min,e.max,e.strategy,Math.min(Math.max(e.targetUtilization??1,.1),1)),a=Us(yc(t(o.resize)),f=>r.addFinalizer(()=>Sl(f))),u=Us(yc(t(e.strategy.run(o))),f=>r.addFinalizer(()=>Sl(f)));return H(o).pipe(po(r.addFinalizer(()=>o.shutdown)),po(a),po(u))})),e9=e=>wO({...e,min:e.size,max:e.size,strategy:r9()}),t9=e=>U(e.timeToLiveStrategy==="creation"?s9(e.timeToLive):o9(e.timeToLive),t=>wO({...e,strategy:t}));class n9 extends hs{scope;acquire;concurrency;minSize;maxSize;strategy;targetUtilization;[Ak];isShuttingDown=!1;semaphore;items=new Set;available=new Set;availableLatch=XR(!1);invalidated=new Set;waiters=0;constructor(t,n,r,s,o,a,u){super(),this.scope=t,this.acquire=n,this.concurrency=r,this.minSize=s,this.maxSize=o,this.strategy=a,this.targetUtilization=u,this[Ak]=Z7,this.semaphore=Ju(r*o)}allocate=Xb(Zc(),t=>this.acquire.pipe(ea(t),Fr,U(n=>{const r={exit:n,finalizer:uf(t.close(n),i9),refCount:0,disableReclaim:!1};return this.items.add(r),this.available.add(r),zt(n._tag==="Success"?this.strategy.onAcquire(r):We(r.finalizer,this.strategy.onAcquire(r)),r)})),(t,n)=>n._tag==="Failure"?t.close(n):be);get currentUsage(){let t=this.waiters;for(const n of this.items)t+=n.refCount;return t}get targetSize(){if(this.isShuttingDown)return 0;const t=this.currentUsage/this.targetUtilization,n=Math.ceil(t/this.concurrency);return Math.min(Math.max(this.minSize,n),this.maxSize)}get activeSize(){return this.items.size-this.invalidated.size}resizeLoop=ne(()=>{if(this.activeSize>=this.targetSize)return be;const t=this.targetSize-this.activeSize;return this.strategy.reclaim(this).pipe(U(Qe({onNone:()=>this.allocate,onSome:H})),q5(t,{concurrency:t}),po(this.availableLatch.open),U(n=>n.some(r=>r.exit._tag==="Failure")?be:this.resizeLoop))});resizeSemaphore=Ju(1);resize=this.resizeSemaphore.withPermits(1)(this.resizeLoop);getPoolItem=Dn(t=>t(this.semaphore.take(1)).pipe(We(Lr),U(n=>ne(()=>{if(this.waiters++,this.isShuttingDown)return Ut;if(this.targetSize>this.activeSize){const r=this;return U(this.resizeSemaphore.withPermitsIfAvailable(1)(Oh(hc(this.resize),this.scope)),function s(){return r.isShuttingDown?Ut:r.available.size>0?H(o_(r.available)):(r.availableLatch.unsafeClose(),U(r.availableLatch.await,s))})}return H(o_(this.available))}).pipe(bc(B(()=>this.waiters--)),Us(r=>r.exit._tag==="Failure"?(this.items.delete(r),this.invalidated.delete(r),this.available.delete(r),this.semaphore.release(1)):(r.refCount++,this.available.delete(r),r.refCount<this.concurrency&&this.available.add(r),n.addFinalizer(()=>We(ne(()=>(r.refCount--,this.invalidated.has(r)?this.invalidatePoolItem(r):(this.available.add(r),ln))),this.semaphore.release(1))))),No(()=>this.semaphore.release(1))))));commit(){return this.get}get=U(ne(()=>this.isShuttingDown?Ut:this.getPoolItem),t=>t.exit);invalidate(t){return ne(()=>{if(this.isShuttingDown)return be;for(const n of this.items)if(n.exit._tag==="Success"&&n.exit.value===t)return n.disableReclaim=!0,Ws(this.invalidatePoolItem(n));return be})}invalidatePoolItem(t){return ne(()=>{if(this.items.has(t)){if(t.refCount===0)return this.items.delete(t),this.available.delete(t),this.invalidated.delete(t),We(t.finalizer,Oh(hc(this.resize),this.scope))}else return be;return this.invalidated.add(t),this.available.delete(t),be})}get shutdown(){return ne(()=>{if(this.isShuttingDown)return be;this.isShuttingDown=!0;const t=this.items.size,n=Ju(t);return Oi(this.items,r=>r.refCount>0?(r.finalizer=po(r.finalizer,n.release(1)),this.invalidated.add(r),n.take(1)):(this.items.delete(r),this.available.delete(r),this.invalidated.delete(r),r.finalizer)).pipe(We(this.semaphore.releaseAll),We(this.availableLatch.open),We(n.take(t)))})}pipe(){return Z(this,arguments)}}const r9=()=>({run:e=>be,onAcquire:e=>be,reclaim:e=>Il}),s9=e=>am(t=>fe(mw(),n=>{const r=nc(e),s=new WeakMap;return se({run:o=>{const a=u=>ne(()=>{if(!o.items.has(u)||o.invalidated.has(u))return be;const f=t.unsafeCurrentTimeMillis(),h=s.get(u),p=r-(f-h);return p>0?T1(a(u),p):o.invalidatePoolItem(u)});return n.take.pipe(Us(a),CS)},onAcquire:o=>ne(()=>(s.set(o,t.unsafeCurrentTimeMillis()),n.offer(o))),reclaim:o=>Il})})),o9=e=>fe(mw(),t=>se({run:n=>{const r=ne(()=>n.activeSize-n.targetSize<=0?be:t.take.pipe(Us(o=>n.invalidatePoolItem(o)),We(r)));return r.pipe(T1(e),CS)},onAcquire:n=>t.offer(n),reclaim(n){return ne(()=>{if(n.invalidated.size===0)return Il;const r=WD(JD(n.invalidated,s=>!s.disableReclaim));return r._tag==="None"?Il:(n.invalidated.delete(r.value),r.value.refCount<n.concurrency&&n.available.add(r.value),zt(t.offer(r.value),r))})}})),i9=e=>Ae(t=>{const n=t.getFiberRef(oS);return n._tag==="Some"&&t.log("Unhandled error in pool finalizer",e,n),be}),a9=MK,c9=PK,u9=yR,l9=B6,f9=bR,Cy=Symbol.for("effect/Mailbox"),qk=Symbol.for("effect/Mailbox/ReadonlyMailbox"),Zo=ot(),Ok=Ve(Zo),hd=Ve(!1),pd=Ve(!0),xk=[Zo,!0];class d9 extends hs{scheduler;capacity;strategy;[Cy]=Cy;[qk]=qk;state={_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set};messages=[];messagesChunk=ot();constructor(t,n,r){super(),this.scheduler=t,this.capacity=n,this.strategy=r}offer(t){return ne(()=>{if(this.state._tag!=="Open")return hd;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return hd;case"suspend":return this.capacity<=0&&this.state.takers.size>0?(this.messages.push(t),this.releaseTaker(),pd):this.offerRemainingSingle(t);case"sliding":return this.unsafeTake(),this.messages.push(t),pd}return this.messages.push(t),this.scheduleReleaseTaker(),pd})}unsafeOffer(t){return this.state._tag!=="Open"?!1:this.messages.length+this.messagesChunk.length>=this.capacity?this.strategy==="sliding"?(this.unsafeTake(),this.messages.push(t),!0):this.capacity<=0&&this.state.takers.size>0?(this.messages.push(t),this.releaseTaker(),!0):!1:(this.messages.push(t),this.scheduleReleaseTaker(),!0)}offerAll(t){return ne(()=>{if(this.state._tag!=="Open")return H(Ei(t));const n=this.unsafeOfferAllArray(t);return n.length===0?Ok:this.strategy==="dropping"?H(Ft(n)):this.offerRemainingArray(n)})}unsafeOfferAll(t){return Ft(this.unsafeOfferAllArray(t))}unsafeOfferAllArray(t){if(this.state._tag!=="Open")return Ke(t);if(this.capacity===Number.POSITIVE_INFINITY||this.strategy==="sliding")return this.messages.length>0&&(this.messagesChunk=ft(this.messagesChunk,Ft(this.messages))),this.strategy==="sliding"?this.messagesChunk=this.messagesChunk.pipe(ft(Ei(t)),Q3(this.capacity)):Ip(t)?this.messagesChunk=ft(this.messagesChunk,t):this.messages=Ke(t),this.scheduleReleaseTaker(),[];const n=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(n===0)return Ke(t);const r=[];let s=0;for(const o of t)s<n?this.messages.push(o):r.push(o),s++;return this.scheduleReleaseTaker(),r}fail(t){return this.done(vl(t))}failCause(t){return this.done(He(t))}unsafeDone(t){return this.state._tag!=="Open"?!1:this.state.offers.size===0&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(t),!0):(this.state={...this.state,_tag:"Closing",exit:t},!0)}shutdown=B(()=>{if(this.state._tag==="Done")return!0;this.messages=[],this.messagesChunk=Zo;const t=this.state.offers;if(this.finalize(this.state._tag==="Open"?ln:this.state.exit),t.size>0){for(const n of t)n._tag==="Single"?n.resume(hd):n.resume(Ve(Ft(n.remaining.slice(n.offset))));t.clear()}return!0});done(t){return B(()=>this.unsafeDone(t))}end=this.done(ln);clear=ne(()=>{if(this.state._tag==="Done")return Rd(this.state.exit,Zo);const t=this.unsafeTakeAll();return this.releaseCapacity(),H(t)});takeAll=ne(()=>{if(this.state._tag==="Done")return Rd(this.state.exit,xk);const t=this.unsafeTakeAll();return t.length===0?We(this.awaitTake,this.takeAll):H([t,this.releaseCapacity()])});takeN(t){return ne(()=>{if(this.state._tag==="Done")return Rd(this.state.exit,xk);if(t<=0)return H([Zo,!1]);t=Math.min(t,this.capacity);let n;if(t<=this.messagesChunk.length)n=tc(this.messagesChunk,t),this.messagesChunk=Qr(this.messagesChunk,t);else if(t<=this.messages.length+this.messagesChunk.length)this.messagesChunk=ft(this.messagesChunk,Ft(this.messages)),this.messages=[],n=tc(this.messagesChunk,t),this.messagesChunk=Qr(this.messagesChunk,t);else return We(this.awaitTake,this.takeN(t));return H([n,this.releaseCapacity()])})}unsafeTake(){if(this.state._tag==="Done")return B$(this.state.exit,vl(new vm));let t;if(this.messagesChunk.length>0)t=qp(this.messagesChunk),this.messagesChunk=Qr(this.messagesChunk,1);else if(this.messages.length>0)t=this.messages[0],this.messagesChunk=Qr(Ft(this.messages),1),this.messages=[];else return this.capacity<=0&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?Ve(this.messages.pop()):void 0):void 0;return this.releaseCapacity(),Ve(t)}take=ne(()=>this.unsafeTake()??We(this.awaitTake,this.take));await=so(t=>this.state._tag==="Done"?t(this.state.exit):(this.state.awaiters.add(t),B(()=>{this.state._tag!=="Done"&&this.state.awaiters.delete(t)})));unsafeSize(){const t=this.messages.length+this.messagesChunk.length;return this.state._tag==="Done"?W():V(t)}size=B(()=>this.unsafeSize());commit(){return this.takeAll}pipe(){return Z(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return ut(this)}[Je](){return ut(this)}offerRemainingSingle(t){return so(n=>{if(this.state._tag!=="Open")return n(hd);const r={_tag:"Single",message:t,resume:n};return this.state.offers.add(r),B(()=>{this.state._tag==="Open"&&this.state.offers.delete(r)})})}offerRemainingArray(t){return so(n=>{if(this.state._tag!=="Open")return n(Ve(Ft(t)));const r={_tag:"Array",remaining:t,offset:0,resume:n};return this.state.offers.add(r),B(()=>{this.state._tag==="Open"&&this.state.offers.delete(r)})})}releaseCapacity(){if(this.state._tag==="Done")return this.state.exit._tag==="Success";if(this.state.offers.size===0)return this.state._tag==="Closing"&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(this.state.exit),this.state.exit._tag==="Success"):!1;let t=this.capacity-this.messages.length-this.messagesChunk.length;for(const n of this.state.offers){if(t===0)return!1;if(n._tag==="Single")this.messages.push(n.message),t--,n.resume(pd),this.state.offers.delete(n);else{for(;n.offset<n.remaining.length;n.offset++){if(t===0)return!1;this.messages.push(n.remaining[n.offset]),t--}n.resume(Ok),this.state.offers.delete(n)}}return!1}awaitTake=so(t=>this.state._tag==="Done"?t(this.state.exit):(this.state.takers.add(t),B(()=>{this.state._tag!=="Done"&&this.state.takers.delete(t)})));scheduleRunning=!1;scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}releaseTaker=()=>{if(this.scheduleRunning=!1,this.state._tag==="Done")return;if(this.state.takers.size===0)return;const t=o_(this.state.takers);this.state.takers.delete(t),t(ln)};unsafeTakeAll(){if(this.messagesChunk.length>0){const t=this.messages.length>0?ft(this.messagesChunk,Ft(this.messages)):this.messagesChunk;return this.messagesChunk=Zo,this.messages=[],t}else if(this.messages.length>0){const t=Ft(this.messages);return this.messages=[],t}else if(this.state._tag!=="Done"&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,mt(this.messages.pop());return Zo}finalize(t){if(this.state._tag==="Done")return;const n=this.state;this.state={_tag:"Done",exit:t};for(const r of n.takers)r(t);n.takers.clear();for(const r of n.awaiters)r(t);n.awaiters.clear()}}const h9=e=>Ae(t=>H(new d9(t.currentScheduler,typeof e=="number"?e:e?.capacity??Number.POSITIVE_INFINITY,typeof e=="number"?"suspend":e?.strategy??"suspend"))),p9=e=>{const t=Be(e.takeAll,([n,r])=>r?n.length===0?Fn:Ye(n):jf(Ye(n),t));return t},m9=Cy,g9=e=>X(e,m9),_9=h9,y9=p9,b9=Symbol.for("@effect/matcher/Matcher"),S9={[b9]:{_input:se,_filters:se,_result:se,_return:se},_tag:"ValueMatcher",add(e){return this.value._tag==="Right"?this:e._tag==="When"&&e.guard(this.provided)===!0?Iy(this.provided,ae(e.evaluate(this.provided))):e._tag==="Not"&&e.guard(this.provided)===!1?Iy(this.provided,ae(e.evaluate(this.provided))):this},pipe(){return Z(this,arguments)}};function Iy(e,t){const n=Object.create(S9);return n.provided=e,n.value=t,n}const vO=(e,t)=>({_tag:"When",guard:e,evaluate:t}),$y=e=>{if(typeof e=="function")return e;if(Array.isArray(e)){const t=e.map($y),n=t.length;return r=>{if(!Array.isArray(r))return!1;for(let s=0;s<n;s++)if(t[s](r[s])===!1)return!1;return!0}}else if(e!==null&&typeof e=="object"){const t=Object.entries(e).map(([r,s])=>[r,$y(s)]),n=t.length;return r=>{if(typeof r!="object"||r===null)return!1;for(let s=0;s<n;s++){const[o,a]=t[s];if(!(o in r)||a(r[o])===!1)return!1}return!0}}return t=>t===e},w9=e=>Iy(e,ie(e)),v9=(e,t)=>n=>n.add(vO($y(e),t)),E9=e=>(...t)=>{const n=t[t.length-1],r=t.slice(0,-1),s=r.length===1?o=>o[e]===r[0]:o=>r.includes(o[e]);return o=>o.add(vO(s,n))},k9=E9("_tag"),T9=e=>{if(e._tag==="ValueMatcher")return e.value;const t=e.cases.length;if(t===1){const n=e.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?ae(n.evaluate(r)):ie(r)}return n=>{for(let r=0;r<t;r++){const s=e.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return ae(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return ae(s.evaluate(n))}return ie(n)}},Fk="effect/Match/exhaustive: absurd",C9=e=>{const t=T9(e);if(kC(t)){if(t._tag==="Right")return t.right;throw new Error(Fk)}return n=>{const r=t(n);if(r._tag==="Right")return r.right;throw new Error(Fk)}},EO=w9,Wg=v9,Vg=k9,kO=C9,I9=e9,$9=t9,R9=zQ,A9=Ca,q9=w(e=>ls(e[0]),(e,...t)=>{const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}),O9=w(e=>ls(e[0]),(e,...t)=>{const n={...e};for(const r of t)delete n[r];return n}),Ic=Symbol.for("effect/Schema");function Ge(e){return class{[Ic]=Ry;static ast=e;static annotations(n){return Ge(Ur(this.ast,n))}static pipe(){return Z(this,arguments)}static toString(){return String(e)}static Type;static Encoded;static Context;static[Ic]=Ry}}const Ry={_A:e=>e,_I:e=>e,_R:e=>e},Pk={schemaId:RN,message:VC,missingMessage:gb,identifier:_b,title:fs,description:ef,examples:KC,default:GC,documentation:AN,jsonSchema:QC,arbitrary:JC,pretty:YC,equivalence:yb,concurrency:XC,batching:ZC,parseIssueTitle:eI,parseOptions:tI,decodingFallback:nI},Uo=e=>{if(!e)return{};const t={...e};for(const n in Pk)if(n in e){const r=Pk[n];t[r]=e[n],delete t[n]}return t},Ur=(e,t)=>Si(e,Uo(t));const du=e=>String(e.ast),Wm=e=>Ge(d_(e.ast)),us=e=>Ge(Tt(e.ast)),Ww=(e,t)=>{const n=oa(e,t);return(r,s)=>Xu(n(r,s),lu)},x9=(e,t)=>{const n=F7(e,t);return(r,s)=>Xl(n(r,s),lu)},Vw=Ww,F9=x9,jh=(e,t)=>{const n=fu(e,t);return(r,s)=>Xu(n(r,s),lu)},P9=(e,t)=>{const n=x7(e,t);return(r,s)=>Xl(n(r,s),lu)},Uu=jh,hu=P9,D9=(e,t)=>{const n=D7(e,t);return(r,s)=>Xl(n(r,s),lu)},Nr=e=>X(e,Ic)&&ls(e[Ic]);function N9(e){return Sb(e)?tn.make(i3(e,t=>new th(t))):new th(e[0])}function TO(e,t=N9(e)){return class extends Ge(t){static annotations(r){return TO(this.literals,Ur(this.ast,r))}static literals=[...e]}}function Ce(...e){return pt(e)?TO(e):Vm}const M9=e=>Ge(new aI(e)),L9=(e,t,n)=>Kw(e,new wp(e.map(r=>r.ast),(...r)=>t.decode(...r.map(Ge)),(...r)=>t.encode(...r.map(Ge)),Uo(n))),U9=(e,t)=>{const n=()=>(s,o,a)=>e(s)?Pr(s):To(new jt(a,s)),r=n;return Kw([],new wp([],n,r,Uo(t)))};function Kw(e,t){return class extends Ge(t){static annotations(r){return Kw(this.typeParameters,Ur(this.ast,r))}static typeParameters=[...e]}}const ia=function(){if(Array.isArray(arguments[0])){const n=arguments[0],r=arguments[1],s=arguments[2];return L9(n,r,s)}const e=arguments[0],t=arguments[1];return U9(e,t)},Dk=Symbol.for("effect/SchemaId/Brand"),CO=(e,t)=>n=>Xw(n,new rf(n.ast,function(o,a,u){const f=e.either(o);return Zt(f)?V(new jt(u,o,f.left.map(h=>h.message).join(", "))):W()},Uo({schemaId:Dk,[Dk]:{constructor:e},...t})));class IO extends Ge(ec){}class Zr extends Ge(KN){}class Gw extends Ge(HN){}class Vm extends Ge(vp){}class Ay extends Ge(cI){}class Bt extends Ge(uI){}class M extends Ge(i_){}class Ue extends Ge(c_){}class js extends Ge(u_){}const j9=e=>tn.make(e.map(t=>t.ast));function $O(e,t=j9(e)){return class extends Ge(t){static annotations(r){return $O(this.members,Ur(this.ast,r))}static members=[...e]}}function Se(...e){return Sb(e)?$O(e):pt(e)?e[0]:Vm}const RO=e=>Se(e,Gw),$c=e=>Se(e,IO),z9=(e,t)=>new nf(e.map(n=>Nr(n)?new xo(n.ast,!1):n.ast),t.map(n=>Nr(n)?new tf(n.ast):n.ast),!0);function zh(e,t,n=z9(e,t)){return class extends Ge(n){static annotations(s){return zh(this.elements,this.rest,Ur(this.ast,s))}static elements=[...e];static rest=[...t]}}function AO(...e){return Array.isArray(e[0])?zh(e[0],e.slice(1)):zh(e,[])}function qO(e,t){return class extends zh([],[e],t){static annotations(r){return qO(this.value,Ur(this.ast,r))}static value=e}}const $e=e=>qO(e),qy=e=>e?'"?:"':'":"';class Km extends xo{isReadonly;defaultValue;_tag="PropertySignatureDeclaration";constructor(t,n,r,s,o){super(t,n,s),this.isReadonly=r,this.defaultValue=o}toString(){const t=qy(this.isOptional),n=String(this.type);return`PropertySignature<${t}, ${n}, never, ${t}, ${n}>`}}class B9 extends xo{isReadonly;fromKey;constructor(t,n,r,s,o){super(t,n,s),this.isReadonly=r,this.fromKey=o}}class Bh extends xo{isReadonly;defaultValue;constructor(t,n,r,s,o){super(t,n,s),this.isReadonly=r,this.defaultValue=o}}const H9=e=>e===void 0?"never":Pn(e)?JSON.stringify(e):String(e);class Hh{from;to;decode;encode;_tag="PropertySignatureTransformation";constructor(t,n,r,s){this.from=t,this.to=n,this.decode=r,this.encode=s}toString(){return`PropertySignature<${qy(this.to.isOptional)}, ${this.to.type}, ${H9(this.from.fromKey)}, ${qy(this.from.isOptional)}, ${this.from.type}>`}}const OO=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new Km(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new Hh(e.from,new Bh(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},xO=Symbol.for("effect/PropertySignature"),Qw=e=>X(e,xO);class Gm{ast;[Ic];[xO]=null;_TypeToken;_Key;_EncodedToken;_HasDefault;constructor(t){this.ast=t}pipe(){return Z(this,arguments)}annotations(t){return new Gm(OO(this.ast,Uo(t)))}toString(){return String(this.ast)}}const Wh=e=>new Gm(e);class Qm extends Gm{from;constructor(t,n){super(t),this.from=n}annotations(t){return new Qm(OO(this.ast,Uo(t)),this.from)}}const FO=e=>new Qm(new Km(e.ast,!1,!0,{},void 0),e),Jw=w(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":return Wh(new Km(n.type,n.isOptional,n.isReadonly,n.annotations,t));case"PropertySignatureTransformation":return Wh(new Hh(n.from,new Bh(n.to.type,n.to.isOptional,n.to.isReadonly,n.to.annotations,t),n.decode,n.encode))}}),Nk=(e,t)=>Qe(e,{onNone:()=>V(t()),onSome:n=>V(n===void 0?t():n)}),Vh=e=>b3(e,Vh,t=>{const n=Vh(t.to);if(n)return new gr(t.from,n,t.transformation)}),W9=w(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":{const r=Tt(n.type);return Wh(new Hh(new B9(n.type,n.isOptional,n.isReadonly,n.annotations),new Bh(Vh(r)??r,!1,!0,{},n.defaultValue),s=>Nk(s,t),se))}case"PropertySignatureTransformation":{const r=n.to.type;return Wh(new Hh(n.from,new Bh(Vh(r)??r,!1,n.to.isReadonly,n.to.annotations,n.to.defaultValue),s=>Nk(n.decode(s),t),n.encode))}}}),PO=w(2,(e,t)=>e.pipe(W9(t.decoding),Jw(t.constructor))),_n=e=>{const t=e.ast===ec||e.ast===vp?ec:$c(e).ast;return new Qm(new Km(t,!0,!0,{},void 0),e)},V9=_I([gb]),K9=(e,t)=>{const n=xr(e),r=[];if(n.length>0){const o=[],a=[],u=[];for(let f=0;f<n.length;f++){const h=n[f],p=e[h];if(Qw(p)){const m=p.ast;switch(m._tag){case"PropertySignatureDeclaration":{const T=m.type,C=m.isOptional,A=m.annotations;o.push(new kt(h,T,C,!0,V9(m))),a.push(new kt(h,Tt(T),C,!0,A)),r.push(new kt(h,T,C,!0,A));break}case"PropertySignatureTransformation":{const T=m.from.fromKey??h;o.push(new kt(T,m.from.type,m.from.isOptional,!0,m.from.annotations)),a.push(new kt(h,m.to.type,m.to.isOptional,!0,m.to.annotations)),u.push(new l3(T,h,m.decode,m.encode));break}}}else o.push(new kt(h,p.ast,!1,!0)),a.push(new kt(h,Tt(p.ast),!1,!0)),r.push(new kt(h,p.ast,!1,!0))}if(pt(u)){const f=[],h=[];for(const p of t){const{indexSignatures:m,propertySignatures:T}=RE(p.key.ast,p.value.ast);T.forEach(C=>{o.push(C),a.push(new kt(C.name,Tt(C.type),C.isOptional,C.isReadonly,C.annotations))}),m.forEach(C=>{f.push(C),h.push(new Mc(C.parameter,Tt(C.type),C.isReadonly))})}return new gr(new br(o,f,{[Da]:"Struct (Encoded side)"}),new br(a,h,{[Da]:"Struct (Type side)"}),new nh(u))}}const s=[];for(const o of t){const{indexSignatures:a,propertySignatures:u}=RE(o.key.ast,o.value.ast);u.forEach(f=>r.push(f)),a.forEach(f=>s.push(f))}return new br(r,s)},DO=(e,t)=>{const n=xr(e);for(const r of n){const s=e[r];if(t[r]===void 0&&Qw(s)){const o=s.ast,a=o._tag==="PropertySignatureDeclaration"?o.defaultValue:o.to.defaultValue;a!==void 0&&(t[r]=a())}}return t};function Yw(e,t,n=K9(e,t)){return class extends Ge(n){static annotations(s){return Yw(this.fields,this.records,Ur(this.ast,s))}static fields={...e};static records=[...t];static make=(s,o)=>{const a=DO(e,{...s});return Ym(o)?a:Hm(this)(a)};static pick(...s){return Y(q9(e,...s))}static omit(...s){return Y(O9(e,...s))}}}function Y(e,...t){return Yw(e,t)}const G9=e=>Ce(e).pipe(FO,Jw(()=>e)),Ie=(e,t)=>Y({_tag:G9(e),...t});function NO(e,t,n){return class extends Yw({},[{key:e,value:t}],n){static annotations(s){return NO(e,t,Ur(this.ast,s))}static key=e;static value=t}}const pu=e=>NO(e.key,e.value),Pl=(...e)=>t=>Ge(vs(t.ast,e)),Dl=w(2,(e,t)=>{const n=ti(Tt(e.ast),t),r=Ge(n.isOptional?Cd(n.type):n.type);return kr(e.pipe(Pl(t)),r,{strict:!0,decode:o=>o[t],encode:o=>n.isOptional&&o===void 0?{}:{[t]:o}})});function Xw(e,t){return class extends Ge(t){static annotations(r){return Xw(this.from,Ur(this.ast,r))}static make=(r,s)=>Ym(s)?r:Hm(this)(r);static from=e}}const Q9=(e,t)=>n=>{const r=Qe(rI(n.ast),{onNone:()=>[e],onSome:o=>[...o,e]}),s=Si(n.ast,Uo({[WC]:r,...t}));return Xw(n,s)},Kh=e=>Ge(Fu(e.ast)),MO=e=>Ge(ka(e.ast)),Iu=(e,t,n)=>{if($E(e)&&$E(t)){const r=[...e.propertySignatures];for(const s of t.propertySignatures){const o=s.name,a=r.findIndex(u=>u.name===o);if(a===-1)r.push(s);else{const{isOptional:u,type:f}=r[a];r[a]=new kt(o,Gh(f,s.type,n.concat(o)),u,!0)}}return new br(r,e.indexSignatures.concat(t.indexSignatures))}throw new Error(BC(e,t,n))},J9=m3([_b]),$u=(e,t)=>t.map(n=>new rf(n,e.filter,J9(e))),Gh=(e,t,n)=>tn.make(Es([e],[t],n)),Ko=e=>wb(e)?e.types:[e],Es=(e,t,n)=>Xd(e,r=>Xd(t,s=>{switch(s._tag){case"Literal":{if(Pn(s.literal)&&a_(r)||Fs(s.literal)&&TE(r)||mi(s.literal)&&CE(r))return[s];break}case"StringKeyword":{if(s===i_){if(a_(r)||Ku(r)&&Pn(r.literal))return[r];if(Na(r))return $u(r,Es(Ko(r.from),[s],n))}else if(r===i_)return[s];break}case"NumberKeyword":{if(s===c_){if(TE(r)||Ku(r)&&Fs(r.literal))return[r];if(Na(r))return $u(r,Es(Ko(r.from),[s],n))}else if(r===c_)return[s];break}case"BooleanKeyword":{if(s===u_){if(CE(r)||Ku(r)&&mi(r.literal))return[r];if(Na(r))return $u(r,Es(Ko(r.from),[s],n))}else if(r===u_)return[s];break}case"Union":return Es(Ko(r),s.types,n);case"Suspend":return[new bi(()=>Gh(r,s.f(),n))];case"Refinement":return $u(s,Es(Ko(r),Ko(s.from),n));case"TypeLiteral":{switch(r._tag){case"Union":return Es(r.types,[s],n);case"Suspend":return[new bi(()=>Gh(r.f(),s,n))];case"Refinement":return $u(r,Es(Ko(r.from),[s],n));case"TypeLiteral":return[Iu(r,s,n)];case"Transformation":{const o=r.transformation,a=Iu(r.from,s,n),u=Iu(r.to,Tt(s),n);switch(o._tag){case"TypeLiteralTransformation":return[new gr(a,u,new nh(o.propertySignatureTransformations))];case"ComposeTransformation":return[new gr(a,u,vb)];case"FinalTransformation":return[new gr(a,u,new dI((f,h,p,m)=>$n(o.decode(f,h,p,m),T=>({...f,...T})),(f,h,p,m)=>$n(o.encode(f,h,p,m),T=>({...f,...T}))))]}}}break}case"Transformation":{if(a3(r)){if(f_(s.transformation)&&f_(r.transformation))return[new gr(Iu(r.from,s.from,n),Iu(r.to,s.to,n),new nh(s.transformation.propertySignatureTransformations.concat(r.transformation.propertySignatureTransformations)))]}else return Es([s],[r],n);break}}throw new Error(BC(r,s,n))})),LO=w(2,(e,t)=>Ge(Gh(e.ast,t.ast,[]))),Y9=w(e=>Nr(e[1]),(e,t)=>ev(e,t,_3(e.ast,t.ast))),Nl=e=>Ge(new bi(()=>e().ast)),UO=Symbol.for("effect/SchemaId/Refine");function jO(e,t,n){return class extends Ge(n){static annotations(s){return jO(this.from,this.filter,Ur(this.ast,s))}static[UO]=e;static from=e;static filter=t;static make=(s,o)=>Ym(o)?s:Hm(this)(s)}}const Mk=(e,t,n)=>{if(mi(e))return e?W():V(new jt(t,n));if(Pn(e))return V(new jt(t,n,e));if(e!==void 0){if("_tag"in e)return V(e);const r=new jt(t,n,e.message);return V(pt(e.path)?new cn(e.path,n,r):r)}return W()},X9=(e,t,n)=>{if(SN(e))return Mk(e,t,n);if(pt(e)){const r=DC(e,s=>Mk(s,t,n));if(pt(r))return V(r.length===1?r[0]:new qt(t,n,r))}return W()};function Zw(e,t){return n=>{function r(o,a,u){return X9(e(o,a,u),u,o)}const s=new rf(n.ast,r,Uo(t));return jO(n,r,s)}}function ev(e,t,n){return class extends Ge(n){static annotations(s){return ev(this.from,this.to,Ur(this.ast,s))}static from=e;static to=t}}const Co=w(e=>Nr(e[0])&&Nr(e[1]),(e,t,n)=>ev(e,t,new gr(e.ast,t.ast,new dI(n.decode,n.encode)))),kr=w(e=>Nr(e[0])&&Nr(e[1]),(e,t,n)=>Co(e,t,{strict:!0,decode:(r,s,o,a)=>Pr(n.decode(r,a)),encode:(r,s,o,a)=>Pr(n.encode(r,a))})),Z9=w(2,(e,t)=>e.annotations(t)),Lk=e=>e instanceof Error?e.message:String(e),eY=e=>Co(M.annotations({description:"a string to be decoded into JSON"}),Ay,{strict:!0,decode:(t,n,r)=>Ik({try:()=>JSON.parse(t,e?.reviver),catch:s=>new jt(r,t,Lk(s))}),encode:(t,n,r)=>Ik({try:()=>JSON.stringify(t,e?.replacer,e?.space),catch:s=>new jt(r,t,Lk(s))})}).annotations({title:"parseJson",schemaId:BN}),Rc=(e,t)=>Nr(e)?Y9(Rc(t),e):eY(e),tY=IN,nY=e=>t=>t.pipe(Zw(n=>Number.isSafeInteger(n),{schemaId:tY,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e})),rY=$N,sY=(e,t,n)=>r=>r.pipe(Zw(s=>s>=e&&s<=t,{schemaId:rY,title:`between(${e}, ${t})`,description:`a number between ${e} and ${t}`,jsonSchema:{minimum:e,maximum:t},...n}));class Qh extends Ue.pipe(nY({identifier:"Int"})){}const tv=(e,t,n,r)=>O7(e,{onFailure:s=>new qt(n,r,s),onSuccess:t});class Jm extends ia(G2,{identifier:"Uint8ArrayFromSelf",pretty:()=>t=>`new Uint8Array(${JSON.stringify(Array.from(t))})`,arbitrary:()=>t=>t.uint8Array(),equivalence:()=>Zl(ue)}){}class oY extends Ue.pipe(sY(0,255,{identifier:"Uint8",description:"a 8-bit unsigned integer"})){}class zO extends kr($e(oY).annotations({description:"an array of 8-bit unsigned integers to be decoded into a Uint8Array"}),Jm,{strict:!0,decode:t=>Uint8Array.from(t),encode:t=>Array.from(t)}).annotations({identifier:"Uint8Array"}){}const iY=(e,t,n)=>Co(M.annotations({description:"a string to be decoded into a Uint8Array"}),Jm,{strict:!0,decode:(r,s,o)=>Xl(t(r),a=>new jt(o,r,a.message)),encode:r=>Pr(n(r))}).annotations({identifier:e}),aY=iY("Uint8ArrayFromBase64",c7,a7),cY=e=>Ge(Td(e.ast)),ju=w(e=>Nr(e[0]),(e,t)=>Co(e,cY(us(e)),{strict:!0,decode:(n,r,s)=>n.length>0?Pr(n[0]):t?Pr(t()):To(new jt(s,n,"Unable to retrieve the first element of an empty array")),encode:n=>Pr(ur(n))})),Uk=Symbol.for("effect/SchemaId/ValidDate"),uY=e=>t=>t.pipe(Zw(n=>!Number.isNaN(n.getTime()),{schemaId:Uk,[Uk]:{noInvalidDate:!0},title:"validDate",description:"a valid Date",...e})),jk=CN;class nv extends ia(oC,{identifier:"DateFromSelf",schemaId:jk,[jk]:{noInvalidDate:!1},description:"a potentially invalid Date instance",pretty:()=>t=>`new Date(${JSON.stringify(t)})`,arbitrary:()=>t=>t.date({noInvalidDate:!1}),equivalence:()=>j2}){}class lY extends kr(M.annotations({description:"a string to be decoded into a Date"}),nv,{strict:!0,decode:t=>new Date(t),encode:t=>LC(t)}).annotations({identifier:"DateFromString"}){}class rv extends lY.pipe(uY({identifier:"Date"})){}class fY extends kr(Ue.annotations({description:"a number to be decoded into a Date"}),nv,{strict:!0,decode:t=>new Date(t),encode:t=>t.getTime()}).annotations({identifier:"DateFromNumber"}){}const dY=Y({_tag:Ce("None")}).annotations({description:"NoneEncoded"}),hY=e=>Y({_tag:Ce("Some"),value:e}).annotations({description:`SomeEncoded<${du(e)}>`}),pY=e=>Se(dY,hY(e)).annotations({description:`OptionEncoded<${du(e)}>`}),BO=e=>e._tag==="None"?W():V(e.value),mY=(e,t)=>n=>n.oneof(t,n.record({_tag:n.constant("None")}),n.record({_tag:n.constant("Some"),value:e(n)})).map(BO),gY=e=>Qe({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),zk=e=>(t,n,r)=>FD(t)?dt(t)?Pr(W()):tv(e(t.value,n),V,r,t):To(new jt(r,t)),_Y=e=>ia([e],{decode:t=>zk(fu(t)),encode:t=>zk(oa(t))},{description:`Option<${du(e)}>`,pretty:gY,arbitrary:mY,equivalence:LD}),yY={_tag:"None"},bY=e=>({_tag:"Some",value:e});function sv(e){const t=e;return kr(pY(t),_Y(us(t)),{strict:!0,decode:r=>BO(r),encode:r=>Qe(r,{onNone:()=>yY,onSome:bY})})}const SY=(e,t)=>n=>{const r=n.array(e(n));return(t.depthIdentifier!==void 0?n.oneof(t,n.constant([]),r):r).map(s=>new Set(s))},wY=e=>t=>`new Set([${Array.from(t.values()).map(n=>e(n)).join(", ")}])`,vY=e=>{const t=Zl(e);return fo((n,r)=>t(Array.from(n.values()),Array.from(r.values())))},Bk=e=>(t,n,r)=>H2(t)?tv(e(Array.from(t.values()),n),s=>new Set(s),r,t):To(new jt(r,t)),EY=(e,t)=>ia([e],{decode:n=>Bk(fu($e(n))),encode:n=>Bk(oa($e(n)))},{description:t,pretty:wY,arbitrary:SY,equivalence:vY}),kY=e=>EY(e,`ReadonlySet<${du(e)}>`);function ov(e){return kr($e(e),kY(us(e)),{strict:!0,decode:t=>new Set(t),encode:t=>Array.from(t)})}const TY=e=>Nr(e)||Qw(e),HO=e=>xr(e).every(t=>TY(e[t])),iv=e=>"fields"in e?e.fields:iv(e[UO]),av=e=>HO(e)?Y(e):Nr(e)?e:Y(iv(e)),cv=e=>HO(e)?e:iv(e),aa=e=>(t,n)=>Qa({kind:"Class",identifier:e,schema:av(t),fields:cv(t),Base:xW,annotations:n}),WO=e=>Jw(FO(Ce(e)),()=>e),jr=e=>(t,n,r)=>{class s extends MR{}s.prototype.name=t;const o=cv(n),a=av(n),u={_tag:WO(t)},f=tl(u,o),h="message"in f;class p extends Qa({kind:"TaggedError",identifier:t,schema:LO(a,Y(u)),fields:f,Base:s,annotations:r,disableToString:!0}){static _tag=t}return h||Object.defineProperty(p.prototype,"message",{get(){return`{ ${xr(o).map(m=>`${mb(m)}: ${yr(this[m])}`).join(", ")} }`},enumerable:!1,configurable:!0}),p},tl=(e,t)=>{const n={...e};for(const r of xr(t)){if(r in e)throw new Error(HC(r));n[r]=t[r]}return n};function Ym(e){return mi(e)?e:e?.disableValidation??!1}const Hk=Oe("effect/Schema/astCache",()=>new WeakMap),CY=e=>e===void 0?[]:Array.isArray(e)?e:[e],Qa=({Base:e,annotations:t,disableToString:n,fields:r,identifier:s,kind:o,schema:a})=>{const u=Symbol.for(`effect/Schema/${o}/${s}`),[f,h,p]=CY(t),m=us(a),T=m.annotations({identifier:s,...f}),C=m.annotations({[Da]:`${s} (Type side)`,...f}),A=a.annotations({[Da]:`${s} (Constructor)`,...f}),D=a.annotations({[Da]:`${s} (Encoded side)`,...p}),y=a.annotations({[Sp]:s,...p,...f,...h}),b=E=>X(E,u)&&at(C)(E),_=class extends e{constructor(E={},v=!1){E={...E},o!=="Class"&&delete E._tag,E=DO(r,E),Ym(v)||(E=Hm(A)(E)),super(E,!0)}static[Ic]=Ry;static get ast(){let E=Hk.get(this);if(E)return E;const v=ia([a],{decode:()=>(R,q,x)=>R instanceof this||b(R)?Pr(R):To(new jt(x,R)),encode:()=>(R,q)=>R instanceof this?Pr(R):$n(oa(C)(R,q),x=>new this(x,!0))},{identifier:s,pretty:R=>q=>`${s}(${R(q)})`,arbitrary:R=>q=>R(q).map(x=>new this(x)),equivalence:se,[eh]:T.ast,...f});return E=kr(D,v,{strict:!0,decode:R=>new this(R,!0),encode:se}).annotations({[eh]:y.ast,...h}).ast,Hk.set(this,E),E}static pipe(){return Z(this,arguments)}static annotations(E){return Ge(this.ast).annotations(E)}static toString(){return`(${String(D)} <-> ${s})`}static make(...E){return new this(...E)}static fields={...r};static identifier=s;static extend(E){return(v,R)=>{const q=cv(v),x=av(v),N=tl(r,q);return Qa({kind:o,identifier:E,schema:LO(a,x),fields:N,Base:this,annotations:R})}}static transformOrFail(E){return(v,R,q)=>{const x=tl(r,v);return Qa({kind:o,identifier:E,schema:Co(a,us(Y(x)),R),fields:x,Base:this,annotations:q})}}static transformOrFailFrom(E){return(v,R,q)=>{const x=tl(r,v);return Qa({kind:o,identifier:E,schema:Co(Wm(a),Y(x),R),fields:x,Base:this,annotations:q})}}get[u](){return u}};return n!==!0&&Object.defineProperty(_.prototype,"toString",{value(){return`${s}({ ${xr(r).map(E=>`${mb(E)}: ${yr(this[E])}`).join(", ")} })`},configurable:!0,writable:!0}),_},IY=Y({_tag:Ce("None")}).annotations({identifier:"FiberIdNoneEncoded"}),$Y=Y({_tag:Ce("Runtime"),id:Qh,startTimeMillis:Qh}).annotations({identifier:"FiberIdRuntimeEncoded"}),RY=Y({_tag:Ce("Composite"),left:Nl(()=>Oy),right:Nl(()=>Oy)}).annotations({identifier:"FiberIdCompositeEncoded"}),Oy=Se(IY,$Y,RY).annotations({identifier:"FiberIdEncoded"}),AY=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Jh),xy=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${xy(e.right)}, ${xy(e.left)})`}},Jh=e=>{switch(e._tag){case"None":return wr;case"Runtime":return nL(e.id,e.startTimeMillis);case"Composite":return rL(Jh(e.left),Jh(e.right))}},qY=e=>Y({_tag:Ce("Die"),defect:e}),OY=Y({_tag:Ce("Empty")}),xY=e=>Y({_tag:Ce("Fail"),error:e}),FY=Y({_tag:Ce("Interrupt"),fiberId:Oy});let PY=0;const Fy=(e,t)=>{const n=e,r=t,s=Nl(()=>o),o=Se(OY,xY(n),qY(r),FY,Y({_tag:Ce("Sequential"),left:s,right:s}),Y({_tag:Ce("Parallel"),left:s,right:s})).annotations({title:`CauseEncoded<${du(e)}>`,[Sp]:`CauseEncoded${PY++}`});return o},DY=(e,t)=>n=>n.letrec(r=>({Empty:n.record({_tag:n.constant("Empty")}),Fail:n.record({_tag:n.constant("Fail"),error:e(n)}),Die:n.record({_tag:n.constant("Die"),defect:t(n)}),Interrupt:n.record({_tag:n.constant("Interrupt"),fiberId:AY(n)}),Sequential:n.record({_tag:n.constant("Sequential"),left:r("Cause"),right:r("Cause")}),Parallel:n.record({_tag:n.constant("Parallel"),left:r("Cause"),right:r("Cause")}),Cause:n.oneof(r("Empty"),r("Fail"),r("Die"),r("Interrupt"),r("Sequential"),r("Parallel"))})).Cause.map(oi),NY=e=>t=>{const n=r=>{switch(r._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(r.error)})`;case"Die":return`Cause.die(${$h(r)})`;case"Interrupt":return`Cause.interrupt(${xy(r.fiberId)})`;case"Sequential":return`Cause.sequential(${n(r.left)}, ${n(r.right)})`;case"Parallel":return`Cause.parallel(${n(r.left)}, ${n(r.right)})`}};return n(t)},Wk=e=>(t,n,r)=>X5(t)?tv(e(Pa(t),n),oi,r,t):To(new jt(r,t)),MY=({defect:e,error:t})=>ia([t,e],{decode:(n,r)=>Wk(fu(Fy(n,r))),encode:(n,r)=>Wk(oa(Fy(n,r)))},{title:`Cause<${t.ast}>`,pretty:NY,arbitrary:DY});function oi(e){switch(e._tag){case"Empty":return Q5;case"Fail":return ta(e.error);case"Die":return Pi(e.defect);case"Interrupt":return Sm(Jh(e.fiberId));case"Sequential":return Y5(oi(e.left),oi(e.right));case"Parallel":return J5(oi(e.left),oi(e.right))}}function Pa(e){switch(e._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:e.error};case"Die":return{_tag:"Die",defect:e.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:e.fiberId};case"Sequential":return{_tag:"Sequential",left:Pa(e.left),right:Pa(e.right)};case"Parallel":return{_tag:"Parallel",left:Pa(e.left),right:Pa(e.right)}}}const LY=({defect:e,error:t})=>{const n=t,r=e;return kr(Fy(n,r),MY({error:us(n),defect:us(r)}),{strict:!1,decode:o=>oi(o),encode:o=>Pa(o)})};class Ac extends kr(Ay,Ay,{strict:!0,decode:t=>{if(ls(t)&&"message"in t&&typeof t.message=="string"){const n=new Error(t.message,{cause:t});return"name"in t&&typeof t.name=="string"&&(n.name=t.name),n.stack="stack"in t&&typeof t.stack=="string"?t.stack:"",n}return String(t)},encode:t=>t instanceof Error?{name:t.name,message:t.message}:E$(t)}).annotations({identifier:"Defect"}){}const VO=Symbol.for("effect/Schema/Serializable/symbol"),UY=e=>Ww(e[VO])(e),uv=Symbol.for("effect/Schema/Serializable/symbolResult"),Vk=e=>e[uv].failure,Kk=e=>e[uv].success,kn=e=>(t,n,r)=>{const s=tl({_tag:WO(t)},n.payload);return class extends Qa({kind:"TaggedRequest",identifier:t,schema:Y(s),fields:s,Base:lK,annotations:r}){static _tag=t;static success=n.success;static failure=n.failure;get[VO](){return this.constructor}get[uv](){return{failure:n.failure,success:n.success}}}},jY=e=>$r(e.ast,[]),zY=wn(yb),$r=(e,t)=>{const n=zY(e);if(tt(n))switch(e._tag){case"Declaration":return n.value(...e.typeParameters.map(r=>$r(r,t)));case"Refinement":return n.value($r(e.from,t));default:return n.value()}switch(e._tag){case"NeverKeyword":throw new Error(wN(e,t));case"Transformation":return $r(e.to,t);case"Declaration":case"Literal":case"StringKeyword":case"TemplateLiteral":case"UniqueSymbol":case"SymbolKeyword":case"UnknownKeyword":case"AnyKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"UndefinedKeyword":case"VoidKeyword":case"Enums":case"ObjectKeyword":return ue;case"Refinement":return $r(e.from,t);case"Suspend":{const r=pb(()=>$r(e.f(),t));return(s,o)=>r()(s,o)}case"TupleType":{const r=e.elements.map((o,a)=>$r(o.type,t.concat(a))),s=e.rest.map(o=>$r(o.type,t));return fo((o,a)=>{const u=o.length;if(u!==a.length)return!1;let f=0;for(;f<Math.min(u,e.elements.length);f++)if(!r[f](o[f],a[f]))return!1;if(pt(s)){const[h,...p]=s;for(;f<u-p.length;f++)if(!h(o[f],a[f]))return!1;for(let m=0;m<p.length;m++)if(f+=m,!p[m](o[f],a[f]))return!1}return!0})}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return ue;const r=e.propertySignatures.map(o=>$r(o.type,t.concat(o.name))),s=e.indexSignatures.map(o=>$r(o.type,t));return fo((o,a)=>{const u=Object.keys(o),f=Object.getOwnPropertySymbols(o);for(let m=0;m<r.length;m++){const T=e.propertySignatures[m],C=T.name,A=Object.prototype.hasOwnProperty.call(o,C),D=Object.prototype.hasOwnProperty.call(a,C);if(T.isOptional&&A!==D||A&&D&&!r[m](o[C],a[C]))return!1}let h,p;for(let m=0;m<s.length;m++){const T=e.indexSignatures[m],C=ll(T.parameter),A=bb(C);if(A){if(h=h||Object.getOwnPropertySymbols(a),f.length!==h.length)return!1}else if(p=p||Object.keys(a),u.length!==p.length)return!1;const D=A?f:u;for(let y=0;y<D.length;y++){const b=D[y];if(!Object.prototype.hasOwnProperty.call(a,b)||!s[m](o[b],a[b]))return!1}}return!0})}case"Union":{const r=mO(e.types,!0),s=xr(r.keys),o=s.length;return fo((a,u)=>{let f=[];if(o>0&&pp(a))for(let p=0;p<o;p++){const m=s[p],T=r.keys[m].buckets;if(Object.prototype.hasOwnProperty.call(a,m)){const C=String(a[m]);Object.prototype.hasOwnProperty.call(T,C)&&(f=f.concat(T[C]))}}r.otherwise.length>0&&(f=f.concat(r.otherwise));const h=f.map(p=>[$r(p,t),at({ast:p})]);for(let p=0;p<h.length;p++){const[m,T]=h[p];if(T(a)&&T(u)&&m(a,u))return!0}return!1})}}},BY=Xq,HY=TJ,zs=AJ,KO=qJ,WY=OJ,Io=jm,VY=eO,GO=tO,Ui=Fl,jo=nO,KY=UJ,QO=$7,JO=zJ,GY=BJ,QY=HJ,JY=KJ,hn=GJ,YY=QJ,YO=jw,Yh=YJ,zn=XJ,XY=oO,ZY=iO,eX=t7,Xm=n7,Gk=Symbol.for("effect/Subscribable"),tX=ZR,nX="effect/SubscriptionRef",rX=Symbol.for(nX),sX={_A:e=>e};class oX extends hs{ref;pubsub;semaphore;[wo]=wo;[Gk]=Gk;[W4]=kS;[tX]=eA;[rX]=sX;constructor(t,n,r){super(),this.ref=t,this.pubsub=n,this.semaphore=r,this.get=Gu(this.ref)}commit(){return this.get}get;get changes(){return k(Gu(this.ref),he(t=>Pe(tO(this.pubsub,{scoped:!0}),n=>IJ(LJ(t),n))),this.semaphore.withPermits(1),iO)}modify(t){return this.modifyEffect(n=>Nt(t(n)))}modifyEffect(t){return k(Gu(this.ref),he(t),he(([n,r])=>k(TS(this.ref,r),xs(n),cw(_w(this.pubsub,r)))),this.semaphore.withPermits(1))}}const iX=e=>k(Tm([NA(),cm(e),$m(1)]),Pe(([t,n,r])=>new oX(n,t,r))),aX=w(2,(e,t)=>k(TS(e.ref,t),cw(_w(e.pubsub,t)),e.semaphore.withPermits(1))),XO=iX,Nd=aX,lv=GQ,cX=Qq,ZO=QQ,uX=JQ,lX=e=>t=>zn(t,n=>me(()=>e(n))),ex=e=>t=>KY(t,n=>k(e(n),Pe(()=>n))),fX=()=>cX([]),Qk=(e,t)=>uX(e,n=>db(n,t)),Jk=e=>ZO(e,[]),dX=(e,t,n)=>R9(function*(){const r=yield*lv(e);if(r.length<t)return yield*A9;{const s=r.splice(0,Math.min(n,r.length));return yield*ZO(e,r),s}}),hX=e=>lv(e),pX=e=>lv(e).pipe(Pe(t=>t.length)),Yk=w(2,(e,t)=>k(e.changes,zs(t),Yh(1),JY,Pe(qp))),Xk=Symbol.for("effect/Subscribable");class mX extends hs{get;changes;[Xk]=Xk;[wo]=wo;constructor(t,n){super(),this.get=t,this.changes=n}commit(){return this.get}}const Zm=e=>new mX(e.get,e.changes);w(2,(e,t)=>Zm({get:Pe(e.get,t),changes:jo(e.changes,t)}));w(2,(e,t)=>Zm({get:he(e.get,t),changes:QO(e.changes,t)}));Zm({get:ZS,changes:GY});const gX=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,_X=e=>a9(u9,l9({formatDate:t=>`${gX(t)} ${e}`})),yX={};var bX={};const $o=()=>typeof process<"u"&&bX!==void 0||yX!==void 0?!1:!!(typeof globalThis<"u"&&globalThis.__DEV__),SX=e=>{const t=e?.toString();if(t!=="[object Object]")return t;try{return JSON.stringify(e,null,2)}catch(n){return console.log(e),"Error while printing error: "+n}},Zk=(e,t)=>{try{return new e(t)}catch{return e(t)}},Py=e=>e!==void 0&&e.toLowerCase()!=="false"&&e.toLowerCase()!=="0",Te=(e,...t)=>{if(console.error(e,...t),$o())debugger;throw new Error(`This should never happen: ${e}`)};var wX=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},ii="1.9.0",eT=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function vX(e){var t=new Set([e]),n=new Set,r=e.match(eT);if(!r)return function(){return!1};var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(s.prerelease!=null)return function(f){return f===e};function o(u){return n.add(u),!1}function a(u){return t.add(u),!0}return function(f){if(t.has(f))return!0;if(n.has(f))return!1;var h=f.match(eT);if(!h)return o(f);var p={major:+h[1],minor:+h[2],patch:+h[3],prerelease:h[4]};return p.prerelease!=null||s.major!==p.major?o(f):s.major===0?s.minor===p.minor&&s.patch<=p.patch?a(f):o(f):s.minor<=p.minor?a(f):o(f)}}var EX=vX(ii),kX=ii.split(".")[0],Ml=Symbol.for("opentelemetry.js.api."+kX),Ll=wX;function fv(e,t,n,r){var s;r===void 0&&(r=!1);var o=Ll[Ml]=(s=Ll[Ml])!==null&&s!==void 0?s:{version:ii};if(!r&&o[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}if(o.version!==ii){var a=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+ii);return n.error(a.stack||a.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+ii+"."),!0}function Ul(e){var t,n,r=(t=Ll[Ml])===null||t===void 0?void 0:t.version;if(!(!r||!EX(r)))return(n=Ll[Ml])===null||n===void 0?void 0:n[e]}function dv(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+ii+".");var n=Ll[Ml];n&&delete n[e]}var TX=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},CX=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},IX=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ru("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ru("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ru("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ru("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Ru("verbose",this._namespace,t)},e}();function Ru(e,t,n){var r=Ul("diag");if(r)return n.unshift(t),r[e].apply(r,CX([],TX(n),!1))}var Qn;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(Qn||(Qn={}));function $X(e,t){e<Qn.NONE?e=Qn.NONE:e>Qn.ALL&&(e=Qn.ALL),t=t||{};function n(r,s){var o=t[r];return typeof o=="function"&&e>=s?o.bind(t):function(){}}return{error:n("error",Qn.ERROR),warn:n("warn",Qn.WARN),info:n("info",Qn.INFO),debug:n("debug",Qn.DEBUG),verbose:n("verbose",Qn.VERBOSE)}}var RX=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},AX=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},qX="diag",Xh=function(){function e(){function t(s){return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var u=Ul("diag");if(u)return u[s].apply(u,AX([],RX(o),!1))}}var n=this,r=function(s,o){var a,u,f;if(o===void 0&&(o={logLevel:Qn.INFO}),s===n){var h=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((a=h.stack)!==null&&a!==void 0?a:h.message),!1}typeof o=="number"&&(o={logLevel:o});var p=Ul("diag"),m=$X((u=o.logLevel)!==null&&u!==void 0?u:Qn.INFO,s);if(p&&!o.suppressOverrideMessage){var T=(f=new Error().stack)!==null&&f!==void 0?f:"<failed to generate stacktrace>";p.warn("Current logger will be overwritten from "+T),m.warn("Current logger will overwrite one already registered from "+T)}return fv("diag",m,n,!0)};n.setLogger=r,n.disable=function(){dv(qX,n)},n.createComponentLogger=function(s){return new IX(s)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function OX(e){return Symbol.for(e)}var xX=function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,s){var o=new e(n._currentContext);return o._currentContext.set(r,s),o},n.deleteValue=function(r){var s=new e(n._currentContext);return s._currentContext.delete(r),s}}return e}(),FX=new xX,PX=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},DX=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},NX=function(){function e(){}return e.prototype.active=function(){return FX},e.prototype.with=function(t,n,r){for(var s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return n.call.apply(n,DX([r],PX(s),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),MX=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},LX=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Kg="context",UX=new NX,hv=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return fv(Kg,t,Xh.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var s,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return(s=this._getContextManager()).with.apply(s,LX([t,n,r],MX(o),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return Ul(Kg)||UX},e.prototype.disable=function(){this._getContextManager().disable(),dv(Kg,Xh.instance())},e}(),Ro;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(Ro||(Ro={}));var tx="0000000000000000",nx="00000000000000000000000000000000",jX={traceId:nx,spanId:tx,traceFlags:Ro.NONE},nl=function(){function e(t){t===void 0&&(t=jX),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e}(),pv=OX("OpenTelemetry Context Key SPAN");function mv(e){return e.getValue(pv)||void 0}function zX(){return mv(hv.getInstance().active())}function gv(e,t){return e.setValue(pv,t)}function BX(e){return e.deleteValue(pv)}function HX(e,t){return gv(e,new nl(t))}function rx(e){var t;return(t=mv(e))===null||t===void 0?void 0:t.spanContext()}var WX=/^([0-9a-f]{32})$/i,VX=/^[0-9a-f]{16}$/i;function KX(e){return WX.test(e)&&e!==nx}function GX(e){return VX.test(e)&&e!==tx}function sx(e){return KX(e.traceId)&&GX(e.spanId)}function QX(e){return new nl(e)}var Gg=hv.getInstance(),ox=function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=Gg.active());var s=!!n?.root;if(s)return new nl;var o=r&&rx(r);return JX(o)&&sx(o)?new nl(o):new nl},e.prototype.startActiveSpan=function(t,n,r,s){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=s);var f=a??Gg.active(),h=this.startSpan(t,o,f),p=gv(f,h);return Gg.with(p,u,void 0,h)}},e}();function JX(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var YX=new ox,XX=function(){function e(t,n,r,s){this._provider=t,this.name=n,this.version=r,this.options=s}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,s){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):YX},e}(),ZX=function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new ox},e}(),eZ=new ZX,tT=function(){function e(){}return e.prototype.getTracer=function(t,n,r){var s;return(s=this.getDelegateTracer(t,n,r))!==null&&s!==void 0?s:new XX(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:eZ},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,n,r)},e}(),ei;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(ei||(ei={}));var uo;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(uo||(uo={}));var Dy="[_0-9a-z-*/]",tZ="[a-z]"+Dy+"{0,255}",nZ="[a-z0-9]"+Dy+"{0,240}@[a-z]"+Dy+"{0,13}",rZ=new RegExp("^(?:"+tZ+"|"+nZ+")$"),sZ=/^[ -~]{0,255}[!-~]$/,oZ=/,|=/;function iZ(e){return rZ.test(e)}function aZ(e){return sZ.test(e)&&!oZ.test(e)}var nT=32,cZ=512,rT=",",sT="=",uZ=function(){function e(t){this._internalState=new Map,t&&this._parse(t)}return e.prototype.set=function(t,n){var r=this._clone();return r._internalState.has(t)&&r._internalState.delete(t),r._internalState.set(t,n),r},e.prototype.unset=function(t){var n=this._clone();return n._internalState.delete(t),n},e.prototype.get=function(t){return this._internalState.get(t)},e.prototype.serialize=function(){var t=this;return this._keys().reduce(function(n,r){return n.push(r+sT+t.get(r)),n},[]).join(rT)},e.prototype._parse=function(t){t.length>cZ||(this._internalState=t.split(rT).reverse().reduce(function(n,r){var s=r.trim(),o=s.indexOf(sT);if(o!==-1){var a=s.slice(0,o),u=s.slice(o+1,r.length);iZ(a)&&aZ(u)&&n.set(a,u)}return n},new Map),this._internalState.size>nT&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,nT))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}();function lZ(e){return new uZ(e)}var Jn=hv.getInstance(),Qg="trace",fZ=function(){function e(){this._proxyTracerProvider=new tT,this.wrapSpanContext=QX,this.isSpanContextValid=sx,this.deleteSpan=BX,this.getSpan=mv,this.getActiveSpan=zX,this.getSpanContext=rx,this.setSpan=gv,this.setSpanContext=HX}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=fv(Qg,this._proxyTracerProvider,Xh.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return Ul(Qg)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){dv(Qg,Xh.instance()),this._proxyTracerProvider=new tT},e}(),Cn=fZ.getInstance();const oT=1000000000n,Jg=e=>[Number(e/oT),Number(e%oT)],Yg=e=>Object.entries(e).reduce((t,[n,r])=>(t[n]=ix(r),t),{}),ix=e=>typeof e=="string"||typeof e=="number"||typeof e=="boolean"?e:typeof e=="bigint"?Number(e):gi(e),Md=Symbol.for("@effect/opentelemetry/Tracer/OtelSpan"),dZ={internal:ei.INTERNAL,client:ei.CLIENT,server:ei.SERVER,producer:ei.PRODUCER,consumer:ei.CONSUMER};class ax{name;parent;context;links;kind;[Md];_tag="Span";span;spanId;traceId;attributes=new Map;sampled;status;constructor(t,n,r,s,o,a,u,f){this.name=r,this.parent=s,this.context=o,this.links=a,this.kind=f,this[Md]=Md;const h=t.active();this.span=n.startSpan(r,{startTime:Jg(u),links:a.length>0?a.map(m=>({context:My(m.span),attributes:Yg(m.attributes)})):void 0,kind:dZ[this.kind]},s._tag==="Some"?ux(h,s.value,o):Cn.deleteSpan(h));const p=this.span.spanContext();this.spanId=p.spanId,this.traceId=p.traceId,this.status={_tag:"Started",startTime:u},this.sampled=(p.traceFlags&Ro.SAMPLED)===Ro.SAMPLED}attribute(t,n){this.span.setAttribute(t,ix(n)),this.attributes.set(t,n)}addLinks(t){this.links.push(...t),this.span.addLinks(t.map(n=>({context:My(n.span),attributes:Yg(n.attributes)})))}end(t,n){const r=Jg(t);if(this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime},n._tag==="Success")this.span.setStatus({code:uo.OK});else if(go(n.cause))this.span.setStatus({code:uo.OK,message:$h(n.cause)}),this.span.setAttribute("span.label"," Interrupted"),this.span.setAttribute("status.interrupted",!0);else{const s=rW(n.cause)[0];s?(s.stack=$h(n.cause,{renderErrorCause:!0}),this.span.recordException(s,r),this.span.setStatus({code:uo.ERROR,message:s.message})):this.span.setStatus({code:uo.OK})}this.span.end(r)}event(t,n,r){this.span.addEvent(t,r?Yg(r):void 0,Jg(n))}}const cx=Nn("@effect/opentelemetry/Tracer/OtelTracer"),hZ=Pe(cx,e=>g1({span(t,n,r,s,o,a){return new ax(Jn,e,t,n,r,s.slice(),o,a)},context(t,n){const r=n.currentSpan;return r===void 0?t():Jn.with(ux(Jn.active(),r),t)}})),Ny=Nn("@effect/opentelemetry/Tracer/OtelTraceFlags"),Zh=Nn("@effect/opentelemetry/Tracer/OtelTraceState"),pZ=e=>{let t=vi();return e.traceFlags&&(t=Yn(t,Ny,e.traceFlags)),typeof e.traceState=="string"?t=Qe(gZ(e.traceState),{onNone:()=>t,onSome:n=>Yn(t,Zh,n)}):e.traceState&&(t=Yn(t,Zh,e.traceState)),{_tag:"ExternalSpan",traceId:e.traceId,spanId:e.spanId,sampled:e.traceFlags?(e.traceFlags&Ro.SAMPLED)===Ro.SAMPLED:!0,context:t}},mZ=he(uw,e=>Md in e?Nt(e.span):Ni(new vm)),gZ=RC(lZ),ux=(e,t,n)=>t instanceof ax?Cn.setSpan(e,t.span):Cn.setSpanContext(e,My(t,n)),My=(e,t)=>({spanId:e.spanId,traceId:e.traceId,isRemote:e._tag==="ExternalSpan",traceFlags:ht(t?iT(e,t,Ny):tr(e.context,Ny),()=>Ro.SAMPLED),traceState:dr(t?iT(e,t,Zh):tr(e.context,Zh))}),iT=(e,t,n)=>Is(tr(t,n),()=>tr(e.context,n)),_Z=hZ,yZ=pZ,eg=mZ,lx=cx,md=(e,t,n=" ")=>e.split(`
`).map(r=>n.repeat(t)+r).join(`
`),bZ=e=>e==null,SZ=e=>e!=null,aT=()=>{const e=performance.now(),t={_performanceStartTime:e,setAttribute:()=>null,setAttributes:()=>null,addEvent:()=>null,setStatus:()=>null,updateName:()=>null,recordException:()=>null,end:()=>{const r=performance.now()-e,s=r/1e3,o=r%1e3*1e6;t._duration=[s,o]},spanContext:()=>({traceId:"livestore-noop-trace-id",spanId:"livestore-noop-span-id"}),_duration:[0,0]};return t},wZ=()=>new vZ;class vZ{startSpan=()=>aT();startActiveSpan(t,n,r,s){let o;if(!(arguments.length<2))return arguments.length===2?o=n:arguments.length===3?o=r:o=s,o(aT())}}const cT={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var uT={};const jl=e=>{if(typeof process<"u"&&uT!==void 0)return uT[e];if(cT!==void 0)return cT[e]},Au=jl("LS_TRACE_VERBOSE")!==void 0||jl("VITE_LS_TRACE_VERBOSE")!==void 0,Ao=Py(jl("LS_DEV"))||Py(jl("VITE_LS_DEV"));Py(jl("CI"));const Ja=(e,t)=>{if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ja(e[r],t[r]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(r of e.entries())if(!t.has(r[0]))return!1;for(r of e.entries())if(!Ja(r[1],t.get(r[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(r of e.entries())if(!t.has(r[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==void 0&&e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==void 0&&e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[r]))return!1;for(r=n;r--!==0;){var o=s[r];if(!Ja(e[o],t[o]))return!1}return!0}return e!==e&&t!==t},EZ=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],kZ=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],TZ=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],CZ=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],lT=(e,t,n)=>{let r=e;return typeof t=="string"||Array.isArray(t)?r=e.toLocaleString(t,n):(t===!0||n!==void 0)&&(r=e.toLocaleString(void 0,n)),r};function IZ(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const n=t.bits?t.binary?CZ:TZ:t.binary?kZ:EZ,r=t.space?" ":"";if(t.signed&&e===0)return` 0${r}${n[0]}`;const s=e<0,o=s?"-":t.signed?"+":"";s&&(e=-e);let a;if(t.minimumFractionDigits!==void 0&&(a={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(a={maximumFractionDigits:t.maximumFractionDigits,...a}),e<1){const p=lT(e,t.locale,a);return o+p+r+n[0]}const u=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),n.length-1);e/=(t.binary?1024:1e3)**u,a||(e=e.toPrecision(3));const f=lT(Number(e),t.locale,a),h=n[u];return o+f+r+h}const fx=e=>Array.isArray(e);function ji(e){debugger;throw new Error(`A case was not handled for value: ${$Z(SX(e),1e3)}`)}const fT=(e,t)=>{if(e===!1){debugger;throw new Error(`This should never happen: ${t}`)}},$Z=(e,t)=>e.length>t?e.slice(0,t)+"...":e,dT=e=>{debugger;throw new Error(`Not yet implemented: ${e}`)},hT=(e,t)=>{let n=!1,r=!1;const s=()=>{r?(e(),r=!1,setTimeout(s,t)):n=!1};return()=>{if(n){r=!0;return}e(),n=!0,setTimeout(s,t)}},RZ=e=>{const t=new Map;return n=>{if(t.has(n))return t.get(n);const r=e(n);return t.set(n,r),r}},AZ=e=>typeof e?.then=="function",ca=e=>K(function*(){const t=yield*Rf();return yield*yn(n=>Vt(t,n)),yield*e(t).pipe($f(t))}),qZ=e=>xf(()=>e()).pipe(ql(t=>Lo(t)?t:AZ(t)?Mi(()=>t):Nt(t))),OZ=(...e)=>yn(()=>aw(...e)),ze=e=>Xr(e,t=>K(function*(){if(go(t))return;const n=yield*eg.pipe(Of("NoSuchElementException",s=>Nt(void 0))),r=t.toString().split(`
`)[0];yield*Ol(r,t).pipe(s=>n===void 0?s:_o({spanId:n.spanContext().spanId,traceId:n.spanContext().traceId})(s))})),mr=(e,t)=>vK(aw(e).pipe(_o(t??{})),xK,()=>Lp(f9)),_v=({label:e,duration:t})=>n=>K(function*(){const r=yield*ra();let s=!1;const o=ow(t).pipe(jn(()=>(s=!0,Or(`${e}: Took longer than ${t}ms`))),bn(r),ps),a=Date.now(),u=yield*n.pipe(Mt,mK(Am(function*(){const f=Date.now();yield*er(o),s&&(yield*Or(`${e}: Interrupted after ${f-a}ms`))})));if(s){const f=Date.now();yield*Or(`${e}: Actual duration: ${f-a}ms`)}return yield*er(o),yield*u}),xZ=e=>t=>jn(t,n=>me(()=>e(n))),dx=e=>t=>rw(me(()=>performance.mark(`${e}:start`)),()=>t,()=>me(()=>{performance.mark(`${e}:end`),performance.measure(e,`${e}:start`,`${e}:end`)})),hx=()=>{const e=IV();return e._tag==="None"||e.value.currentSpan===void 0?"No current fiber":""},FZ=()=>console.log(hx());globalThis.getSpanTrace=hx;globalThis.logSpanTrace=FZ;class tg extends Cb("@effect/platform/Transferable/Collector")(){}const px=()=>{let e=[];const t=s=>{e.push(...s)},n=()=>e,r=()=>{const s=e;return e=[],s};return tg.of({unsafeAddAll:t,addAll:s=>me(()=>t(s)),unsafeRead:n,read:me(n),unsafeClear:r,clear:me(r)})},PZ=me(px),DZ=e=>he(SK(tg),Qe({onNone:()=>ve,onSome:t=>t.addAll(e)})),mx=w(2,(e,t)=>Co(Wm(e),e,{strict:!0,decode:Pr,encode:n=>xs(DZ(t(n)),n)})),ng=mx(Bt,e=>[e]),Ya=mx(Jm,e=>[e.buffer]),NZ=Symbol.for("@effect/platform/WorkerError"),pT=NZ;class zi extends jr()("WorkerError",{reason:Ce("spawn","decode","send","unknown","encode"),cause:Ac}){[pT]=pT;static Cause=LY({error:this,defect:Ac});static encodeCause=co(this.Cause);static decodeCause=Cc(this.Cause);get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}}const mT=Symbol.for("@effect/platform/Worker/PlatformWorker"),yv=Nn("@effect/platform/Worker/PlatformWorker"),gT=Symbol.for("@effect/platform/Worker/WorkerManager"),zl=Nn("@effect/platform/Worker/WorkerManager"),gx=Nn("@effect/platform/Worker/Spawner"),MZ=K(function*(){const e=yield*yv;let t=0;return zl.of({[gT]:gT,spawn({encode:n,initialMessage:r}){return K(function*(){const s=t++;let o=0;const a=new Map,u=px(),f=n?y=>st(u.clear,iw(n(y),tg,u)):Nt,h=yield*Le(),p=yield*e.spawn(s);yield*p.run(y=>y[0]===0?iz(h,ve):m(y[1])).pipe(_K(y=>fn(a.values(),b=>Vo in b?za(b,y):b.failCause(y))),Xr(Or),Cm(qq(1e3)),_o({package:"@effect/platform",module:"Worker"}),St,yt),yield*yn(()=>st(fn(a.values(),y=>Vo in y?t0(y):y.end,{discard:!0}),me(()=>a.clear())));const m=y=>$t(()=>{const b=a.get(y[0]);if(!b)return ve;switch(y[1]){case 0:return Vo in b?ct(b,y[2][0]):b.offerAll(y[2]);case 1:return y.length===2?Vo in b?t0(b):b.end:Vo in b?ct(b,y[2][0]):st(b.offerAll(y[2]),b.end);case 2:case 3:{if(y[1]===2)return Vo in b?K$(b,y[2]):b.fail(y[2]);const _=zi.decodeCause(y[2]);return Vo in b?za(b,_):b.failCause(_)}}}),T=(y,b)=>wc(_=>{const E=_.getFiberRef(CA),v=tr(E,m1).pipe(MD(q=>q._tag==="Span")),R=o++;return b.pipe(jn(q=>(a.set(R,q),f(y).pipe(jn(x=>p.send([R,0,x,v._tag==="Some"?[v.value.traceId,v.value.spanId,v.value.sampled]:void 0],u.unsafeRead())),tu(x=>g9(q)?q.failCause(x):za(q,x))))),Pe(q=>({id:R,mailbox:q})))}),C=({id:y},b)=>{const _=me(()=>a.delete(y));return Yc(b)?st(pr(p.send([y,1])),_):_},A=y=>VY(r7(T(y,_9()),({mailbox:b})=>y9(b),C)),D=y=>rw(T(y,Le()),({mailbox:b})=>It(b),C);return yield*It(h),r&&(yield*me(r).pipe(he(D),na(y=>new zi({reason:"spawn",cause:y})))),{id:s,execute:A,executeEffect:D}})}})}),LZ=UK(zl,MZ),_x=e=>K(function*(){const n=yield*(yield*zl).spawn({...e,encode(o){return na(UY(o),a=>new zi({reason:"encode",cause:a}))}}),r=o=>{const a=Uu(Kk(o)),u=Uu(Vk(o));return k(n.execute(o),HY(f=>he(u(f),Ni)),QO(a))},s=o=>{const a=Uu(Kk(o)),u=Uu(Vk(o));return kK(n.executeEffect(o),{onFailure:f=>he(u(f),Ni),onSuccess:a})};return se({id:n.id,execute:r,executeEffect:s})}),UZ=e=>K(function*(){const t=yield*zl,n=new Set,r=k(_x(e),jn(a=>me(()=>n.add(a))),jn(a=>yn(()=>me(()=>n.delete(a)))),e.onCreate?jn(e.onCreate):se,iw(zl,t)),s=yield*"timeToLive"in e?$9({acquire:r,min:e.minSize,max:e.maxSize,concurrency:e.concurrency,targetUtilization:e.targetUtilization,timeToLive:e.timeToLive}):I9({acquire:r,size:e.size,concurrency:e.concurrency,targetUtilization:e.targetUtilization}),o={backing:s,broadcast:a=>fn(n,u=>u.executeEffect(a),{concurrency:"unbounded",discard:!0}),execute:a=>ZY(Pe(s.get,u=>u.execute(a))),executeEffect:a=>vc(he(s.get,u=>u.executeEffect(a)))};return yield*vc(s.get),o}),jZ=e=>Pf(gx,e),zZ=()=>e=>yv.of({[mT]:mT,spawn(t){return K(function*(){const n=yield*gx;let r;const s=[];return{run:u=>nu(f=>K(function*(){const h=yield*wA,p=yield*e.setup({worker:n(t),scope:h});r=p,yield*Eo(h,me(()=>{r=void 0}));const m=(yield*ra()).pipe(nQ(L3(qW))),T=yield*b7(),C=Ow(m);if(yield*e.listen({port:p,scope:h,emit(A){w7(T,C(u(A)))},deferred:T.deferred}),s.length>0){for(const[A,D]of s)p.postMessage([0,A],D);s.length=0}return yield*f(v7(T))}).pipe(vc)),send:(u,f)=>xf({try:()=>{r===void 0?s.push([u,f]):r.postMessage([0,u],f)},catch:h=>new zi({reason:"send",cause:h})})}})}}),BZ=zZ,HZ=yv,WZ=LZ,VZ=_x,KZ=UZ,GZ=jZ,bv=(e,t)=>(n,r)=>K(function*(){const s=yield*PZ;return[yield*Vw(e,t)(n,r).pipe(iw(tg,s)),s.unsafeRead()]}),gd=(e,t)=>(n,r)=>{const s=F9(e,t)(n,r);return s._tag==="Left"?Te("encodeSyncDebug failed:",s.left):s.right},QZ=e=>Co(us(e),Wm(e),{decode:N7(e),encode:P7(e)});QZ(aY);const Bi=Se(M,Ue,js,Gw,$e(Nl(()=>Bi)),pu({key:M,value:Nl(()=>Bi)})).annotations({title:"JsonValue"}),Sn=Symbol("WebChannel"),Bl=Ie("WebChannel.DebugPing",{message:M,payload:_n(M)}),ep=Ie("WebChannel.Ping",{requestId:M}),tp=Ie("WebChannel.Pong",{requestId:M}),JZ=Se(ep,tp),_T=e=>({send:Se(e.send,Bl,ep,tp),listen:Se(e.listen,Bl,ep,tp)}),Wf=e=>X(e,"send")&&X(e,"listen")?_T(e):_T({send:e,listen:e}),rg=e=>t=>t.pipe(KO(Am(function*(n){return n._tag==="Right"&&at(Bl)(n.right)?(yield*An(`WebChannel:ping [${e}] ${n.right.message}`,n.right.payload),!1):!0}))),Sv=({channelName:e,schema:t})=>ca(n=>K(function*(){const r=Wf(t),s=new BroadcastChannel(e);yield*yn(()=>xf(()=>s.close()).pipe(tw));const o=h=>K(function*(){const p=yield*Vw(r.send)(h);s.postMessage(p)}),a=Xm(s,"message").pipe(jo(h=>hu(r.listen)(h.data)),rg(e)),u=yield*Le().pipe(Ct(Mo(Wn))),f=!1;return{[Sn]:Sn,send:o,listen:a,closedDeferred:u,shutdown:Vt(n,Rt("shutdown")),schema:r,supportsTransferables:f}}).pipe(Ne(`WebChannel:broadcastChannel(${e})`))),Ly=({listenWindow:e,sendWindow:t,targetOrigin:n="*",ids:r,schema:s})=>ca(o=>K(function*(){const a=Wf(s),u={sendTotal:0,listenTotal:0,targetOrigin:n,ids:r},f=Y({message:a.listen,from:Ce(r.other),to:Ce(r.own)}).annotations({title:"webmesh.WindowMessageListen"}),h=Y({message:a.send,from:Ce(r.own),to:Ce(r.other)}).annotations({title:"webmesh.WindowMessageSend"}),p=A=>K(function*(){u.sendTotal++;const[D,y]=yield*bv(h)({message:A,from:r.own,to:r.other});t.postMessage(D,n,y)}),m=Xm(e,"message").pipe(zs(A=>at(Wm(f))(A.data)),jo(A=>(u.listenTotal++,hu(a.listen)(A.data.message))),rg("window")),T=yield*Le().pipe(Ct(Mo(Wn))),C=!0;return{[Sn]:Sn,send:p,listen:m,closedDeferred:T,shutdown:Vt(o,Rt("shutdown")),schema:a,supportsTransferables:C,debugInfo:u}}).pipe(Ne("WebChannel:windowChannel"))),YZ=({port:e,schema:t,debugId:n})=>ca(r=>K(function*(){const s=Wf(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=p=>K(function*(){const[m,T]=yield*bv(s.send)(p);e.postMessage(m,T)}),u=Xm(e,"message").pipe(jo(p=>hu(s.listen)(p.data)),rg(o));e.start();const f=yield*Le().pipe(Ct(Mo(Wn))),h=!0;return yield*yn(()=>xf(()=>e.close()).pipe(tw)),{[Sn]:Sn,send:a,listen:u,closedDeferred:f,shutdown:Vt(r,Rt("shutdown")),schema:s,supportsTransferables:h}}).pipe(Ne("WebChannel:messagePortChannel")));Oe("livestore:sameThreadChannels",()=>new Map);const yT=({port:e,schema:t,debugId:n})=>ca(r=>K(function*(){const s=Wf(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=new Map,u=Ie("ChannelRequest",{id:M,payload:Se(s.listen,s.send)}).annotations({title:"webmesh.ChannelRequest"}),f=Ie("ChannelRequestAck",{reqId:M}).annotations({title:"webmesh.ChannelRequestAck"}),h=Se(u,f).annotations({title:"webmesh.ChannelMessage"}),p={sendTotal:0,sendPending:0,listenTotal:0,id:n},m=D=>K(function*(){p.sendTotal++,p.sendPending++;const y=crypto.randomUUID(),[b,_]=yield*bv(h)({_tag:"ChannelRequest",id:y,payload:D}),E=yield*Le();a.set(y,E),e.postMessage(b,_),yield*E,a.delete(y),p.sendPending--}),T=Xm(e,"message").pipe(jo(D=>hu(h)(D.data)),zn(D=>K(function*(){D._tag==="Right"&&(D.right._tag==="ChannelRequestAck"?yield*ct(a.get(D.right.reqId),void 0):D.right._tag==="ChannelRequest"&&(p.listenTotal++,e.postMessage(co(h)({_tag:"ChannelRequestAck",reqId:D.right.id}))))})),WY(D=>D._tag==="Left"?V(D):D.right._tag==="ChannelRequest"?V(ae(D.right.payload)):W()),D=>D,rg(o));e.start();const C=yield*Le().pipe(Ct(Mo(Wn))),A=!0;return yield*yn(()=>xf(()=>e.close()).pipe(tw)),{[Sn]:Sn,send:m,listen:T,closedDeferred:C,shutdown:Vt(r,Rt("shutdown")),schema:s,supportsTransferables:A,debugInfo:p}}).pipe(Ne("WebChannel:messagePortChannelWithAck"))),bT=(e,t)=>K(function*(){const n=yield*Ln().pipe(Ct(qn)),r={current:void 0};if(yield*e.listen.pipe(t?.heartbeat?KO(Am(function*(o){if(o._tag==="Right"&&at(JZ)(o.right)){if(o.right._tag==="WebChannel.Ping")yield*e.send(tp.make({requestId:o.right.requestId}));else{const{deferred:a,requestId:u}=r.current??Te("No pending ping");u!==o.right.requestId&&Te("Received pong for unexpected requestId",u,o.right.requestId),yield*ct(a,void 0)}return!1}return!0})):se,ex(o=>bw(n,o)),hn,yt),t?.heartbeat){const{interval:o,timeout:a}=t.heartbeat;yield*K(function*(){for(;;){yield*ow(o);const u=crypto.randomUUID();yield*e.send(ep.make({requestId:u}));const f=yield*Le();r.current={deferred:f,requestId:u},yield*f.pipe(Ec(a),Of("TimeoutException",()=>e.shutdown))}}).pipe(Ne("WebChannel:heartbeat"),yt)}const s=Ui(n,{maxChunkSize:1});return{[Sn]:Sn,send:e.send,listen:s,closedDeferred:e.closedDeferred,shutdown:e.shutdown,schema:e.schema,supportsTransferables:e.supportsTransferables,debugInfo:{innerDebugInfo:e.debugInfo,listenQueueSize:n}}}),XZ=e=>t=>{if(X(console,"createTask")===!1)return t;const n=K(function*(){const s=yield*IK;return g1({span:(o,...a)=>{const u=s.span(o,...a),f=e(o);return u.runInTask=h=>f.run(h),u},context:(o,a)=>{const u=tr(m1)(a.currentContext);if(u._tag==="None")return s.context(o,a);const f=u.value;if(f._tag==="ExternalSpan")return s.context(o,a);const h=f;return"runInTask"in h&&typeof h.runInTask=="function"?h.runInTask(()=>s.context(o,a)):s.context(o,a)}})}),r=k(n,Pe(RA),$A);return bn(t,r)},ZZ=BZ()({setup({scope:e,worker:t}){const n="port"in t?t.port:t;return xs(Eo(e,me(()=>{n.postMessage([1])})),n)},listen({deferred:e,emit:t,port:n,scope:r}){function s(a){t(a.data)}function o(a){pS(e,new zi({reason:"unknown",cause:a.error??a.message}))}return n.addEventListener("message",s),n.addEventListener("error",o),"start"in n&&n.start(),Eo(r,me(()=>{n.removeEventListener("message",s),n.removeEventListener("error",o)}))}}),eee=Pf(HZ,ZZ),tee=zK(WZ,eee),nee=e=>jK(tee,GZ(e)),ST=nee,ree=k(Aq(ki(10),4),rQ(qq(sh(1))),sQ(oQ),iQ(FI(sh(10)))),see=(e,t)=>XS((n,r)=>{r.aborted||navigator.locks.request(t,{signal:r,mode:"exclusive",ifAvailable:!1},s=>(n(ve),Ff(It(e)))).catch(s=>{if(!(s.code===20&&s.message==="signal is aborted without reason"))throw s})}),oee=(e,t)=>XS((n,r)=>{navigator.locks.request(t,{mode:"exclusive",ifAvailable:!0},s=>{n(Nt(s!==null));const o=new Promise(a=>{r.addEventListener("abort",()=>{a()})});return Promise.race([Ff(It(e)),o])})}),iee=bI(),np=CO(iee)(Qh),aee=bI(),qc=CO(aee)(Qh),Hl=0,Ht=Y({global:qc,client:np}).annotations({title:"LiveStore.EventSequenceNumber"}),Dr=e=>e.client===0?`e${e.global}`:`e${e.global}+${e.client}`,wv=(e,t)=>e.global===t.global&&e.client===t.client,cee={global:0,client:Hl},Ld=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client,rp=(e,t)=>e.global>t.global||e.global===t.global&&e.client>=t.client,uee=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client?e:t,lee=e=>at(Ht)(e)?e:Cc(Ht)(e),vv=(e,t)=>t?{seqNum:{global:e.global,client:e.client+1},parentSeqNum:e}:{seqNum:{global:e.global+1,client:Hl},parentSeqNum:{global:e.global,client:Hl}},yx=e=>{const t=["text","integer","real","blob"];return typeof e=="object"&&e!==null&&"columnType"in e&&t.includes(e.columnType)},Ev=Symbol.for("NoDefault"),fee=e=>typeof e=="object"&&e!==null&&"sql"in e&&typeof e.sql=="string",Vf=e=>t=>{const n=t?.nullable??!1,r=t?.schema??Sx(e),s=n===!0?RO(r):r,o=t?.default===void 0||t.default===Ev?W():V(t.default);return{columnType:e,schema:s,default:o,nullable:n,primaryKey:t?.primaryKey??!1}},dee=e=>Vf(e),Ar=Vf("text"),Xn=Vf("integer"),hee=Vf("real"),bx=Vf("blob"),sg=(e,t)=>n=>{const r=n?.nullable??!1,s=t._tag==="baseSchemaFn"?t.baseSchemaFn(n?.schema):t.baseSchema,o=r===!0?RO(s):s,a=n?.default===void 0||n.default===Ev?W():V(n.default);return{columnType:e,schema:o,default:a,nullable:r,primaryKey:n?.primaryKey??!1}},kv=sg("text",{_tag:"baseSchemaFn",baseSchemaFn:e=>Rc(e??Bt)}),pee=sg("text",{_tag:"baseSchema",baseSchema:rv}),mee=sg("integer",{_tag:"baseSchema",baseSchema:kr(Ue,nv,{decode:e=>new Date(e),encode:e=>e.getTime()})}),gee=sg("integer",{_tag:"baseSchema",baseSchema:kr(Ue,js,{decode:e=>e===1,encode:e=>e?1:0})}),Sx=e=>{switch(e){case"text":return M;case"integer":return Ue;case"real":return Ue;case"blob":return Jm;default:return ji(e)}},_ee=e=>Array.isArray(e)?Object.fromEntries(e.map(t=>[t.name,t])):e,wx=(e,t,n)=>{const r={_tag:"table",name:e,columns:yee(t),indexes:bee(n??[])};return{name:e,columns:t,indexes:n,ast:r}},vx=e=>Y(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.schema]))).annotations({title:e.name}),Ex=e=>Y(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.nullable===!0||t.default._tag==="Some"?_n(t.schema):t.schema]))).annotations({title:e.name}),yee=e=>Object.entries(e).map(([t,n])=>({_tag:"column",name:t,schema:n.schema,default:n.default,nullable:n.nullable??!1,primaryKey:n.primaryKey??!1,type:{_tag:n.columnType}})),bee=e=>e.map(t=>({_tag:"index",columns:t.columns,name:t.name,unique:t.isUnique??!1})),See=Object.freeze(Object.defineProperty({__proto__:null,NoDefault:Ev,blob:bx,boolean:gee,column:dee,datetime:pee,datetimeInteger:mee,defaultSchemaForColumnType:Sx,insertStructSchemaForTable:Ex,integer:Xn,isColumnDefinition:yx,isSqlDefaultValue:fee,json:kv,makeDbSchema:_ee,real:hee,structSchemaForTable:vx,table:wx,text:Ar},Symbol.toStringTag,{value:"Module"})),wee=e=>{let t=0,n,r;if(e.length===0)return t;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t=Math.trunc(t);return t},vee=e=>wee(JSON.stringify(Ud(e))),Ud=e=>{switch(e._tag){case"table":return{_tag:"table",name:e.name,columns:e.columns.map(t=>Ud(t)),indexes:e.indexes.map(t=>Ud(t))};case"column":return{_tag:"column",name:e.name,type:e.type._tag,primaryKey:e.primaryKey,nullable:e.nullable,default:e.default};case"index":return{_tag:"index",columns:e.columns,name:e.name,unique:e.unique,primaryKey:e.primaryKey};case"foreignKey":return{_tag:"foreignKey",references:e.references,key:e.key,columns:e.columns};case"dbSchema":return{_tag:"dbSchema",tables:e.tables.map(Ud)};default:throw new Error(`Unreachable: ${e}`)}},Bs=Symbol.for("QueryBuilderAst"),Hi=Symbol.for("QueryBuilder"),lo=e=>X(e,Hi),Eee=Y({mergeCounter:Ue,eventNum:Ht});Y({fileName:M},{key:M,value:Bt}).annotations({title:"LiveStore.PersistenceInfo"});const Xg=Y({done:Ue,total:Ue}),kee=Se(Y({stage:Ce("loading")}),Y({stage:Ce("migrating"),progress:Xg}),Y({stage:Ce("rehydrating"),progress:Xg}),Y({stage:Ce("syncing"),progress:Xg}),Y({stage:Ce("done")})).annotations({title:"BootStatus"}),qo=Symbol.for("@livestore/session-id");class ke extends jr()("LiveStore.UnexpectedError",{cause:Ac,note:_n(M),payload:_n(Bt)}){static mapToUnexpectedError=t=>t.pipe(na(n=>at(ke)(n)?n:new ke({cause:n})),SA(n=>new ke({cause:n})));static mapToUnexpectedErrorStream=t=>t.pipe(JO(n=>at(ke)(n)?n:new ke({cause:n})))}class sp extends jr()("LiveStore.IntentionalShutdownCause",{reason:Ce("devtools-reset","devtools-import","adapter-reset","manual")}){}class Tee extends jr()("LiveStore.StoreInterrupted",{reason:M}){}class zu extends jr()("LiveStore.SqliteError",{query:_n(Y({sql:M,bindValues:Se(pu({key:M,value:Bt}),$e(Bt))})),code:_n(Se(Ue,M)),cause:Ac,note:_n(M)}){}const Cee=Y({tableName:M,hashes:Y({expected:Ue,actual:_n(Ue)})}),Iee=Y({migrations:$e(Cee)}),_d=(e,t,n)=>e.length===0?"":`WHERE ${e.map(({col:s,op:o,value:a})=>{if(a===null){if(o!=="="&&o!=="!=")throw new Error(`Unsupported operator for NULL value: ${o}`);return`${s} ${o==="="?"IS":"IS NOT"} NULL`}const u=t.sqliteDef.columns[s];if(u===void 0)throw new Error(`Column ${s} not found`);if(o==="IN"||o==="NOT IN"){if(!Array.isArray(a))return Te(`Expected array value for ${o} operator but got`,a);if(a.length===0)return o==="IN"?"0=1":"1=1";const h=a.map(m=>co(u.schema)(m));n.push(...h);const p=h.map(()=>"?").join(", ");return`${s} ${o} (${p})`}else{const h=co(u.schema)(a);return n.push(h),`${s} ${o} ?`}}).join(" AND ")}`,Zg=e=>!e||e.length===0?"":` RETURNING ${e.join(", ")}`,wT=e=>{const t=[];if(e._tag==="InsertQuery"){const p=Object.keys(e.values),m=p.map(()=>"?").join(", "),T=co(e.tableDef.insertSchema)(e.values);p.forEach(y=>{t.push(T[y])});let C="INSERT",A="";if(e.onConflict)if(e.onConflict.action._tag==="replace")C="INSERT OR REPLACE";else if(A=` ON CONFLICT (${e.onConflict.targets.join(", ")}) `,e.onConflict.action._tag==="ignore")A+="DO NOTHING";else{const y=e.onConflict.action.update,b=Object.keys(y);if(b.length===0)throw new Error("No update columns provided for ON CONFLICT DO UPDATE");const _=b.map(E=>y[E]===void 0?`${E} = excluded.${E}`:`${E} = ?`).join(", ");b.forEach(E=>{const v=y[E];if(v!==void 0){const R=e.tableDef.sqliteDef.columns[E];if(R===void 0)throw new Error(`Column ${E} not found`);const q=co(R.schema)(v);t.push(q)}}),A+=`DO UPDATE SET ${_}`}let D=`${C} INTO '${e.tableDef.sqliteDef.name}' (${p.join(", ")}) VALUES (${m})`;return D+=A,D+=Zg(e.returning),{query:D,bindValues:t}}if(e._tag==="UpdateQuery"){const p=Object.keys(e.values);if(p.length===0)return console.warn(`UPDATE query requires at least one column to set (for table ${e.tableDef.sqliteDef.name}). Running no-op query instead to skip this update query.`),{query:"SELECT 1",bindValues:[]};const m=co(Kh(e.tableDef.rowSchema))(e.values);p.forEach(A=>{t.push(m[A])});let T=`UPDATE '${e.tableDef.sqliteDef.name}' SET ${p.map(A=>`${A} = ?`).join(", ")}`;const C=_d(e.where,e.tableDef,t);return C&&(T+=` ${C}`),T+=Zg(e.returning),{query:T,bindValues:t}}if(e._tag==="DeleteQuery"){let p=`DELETE FROM '${e.tableDef.sqliteDef.name}'`;const m=_d(e.where,e.tableDef,t);return m&&(p+=` ${m}`),p+=Zg(e.returning),{query:p,bindValues:t}}if(e._tag==="CountQuery")return{query:[`SELECT COUNT(*) as count FROM '${e.tableDef.sqliteDef.name}'`,_d(e.where,e.tableDef,t)].filter(m=>m.length>0).join(" "),bindValues:t};if(e._tag==="RowQuery"){const p=e.tableDef.sqliteDef.columns.id;if(p===void 0)throw new Error("Column id not found for ROW query");const m=e.id===qo?e.id:co(p.schema)(e.id);return{query:`SELECT * FROM '${e.tableDef.sqliteDef.name}' WHERE id = ?`,bindValues:[m]}}const r=`SELECT ${e.select.columns.length===0?"*":e.select.columns.join(", ")}`,s=`FROM '${e.tableDef.sqliteDef.name}'`,o=_d(e.where,e.tableDef,t),a=e.orderBy.length>0?`ORDER BY ${e.orderBy.map(({col:p,direction:m})=>`${p} ${m}`).join(", ")}`:"",u=e.limit._tag==="Some"?"LIMIT ?":"",f=e.offset._tag==="Some"?"OFFSET ?":"";return e.offset._tag==="Some"&&t.push(e.offset.value),e.limit._tag==="Some"&&t.push(e.limit.value),{query:[r,s,o,a,f,u].map(p=>p.trim()).filter(p=>p.length>0).join(" "),bindValues:t}},gn=(e,t=$ee(e))=>{const n={select(){qu(t);const r=[...arguments];if(r.length===1){const[o]=r;return gn(e,{...t,resultSchemaSingle:t.resultSchemaSingle.pipe(Dl(o)),select:{columns:[o]}})}const s=r;return gn(e,{...t,resultSchemaSingle:s.length===0?t.resultSchemaSingle:t.resultSchemaSingle.pipe(Pl(...s)),select:{columns:s}})},where:function(){if(t._tag==="InsertQuery")return Ou("Cannot use where with insert");if(t._tag==="RowQuery")return Ou("Cannot use where with row");if(arguments.length===1){const f=arguments[0],h=Object.entries(f).filter(([,p])=>p!==void 0).map(([p,m])=>X(m,"op")&&X(m,"value")?{col:p,op:m.op,value:m.value}:{col:p,op:"=",value:m});switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return gn(e,{...t,where:[...t.where,...h]});default:return ji(t)}}const[r,s,o]=arguments,a=o===void 0?"=":s,u=o===void 0?s:o;switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return gn(e,{...t,where:[...t.where,{col:r,op:a,value:u}]});default:return ji(t)}},orderBy(){if(qu(t),arguments.length===0||arguments.length>2)return Ou();if(arguments.length===1){const o=arguments[0];return gn(e,{...t,orderBy:[...t.orderBy,...o]})}const[r,s]=arguments;return gn(e,{...t,orderBy:[...t.orderBy,{col:r,direction:s}]})},limit:r=>(qu(t),gn(e,{...t,limit:V(r)})),offset:r=>(qu(t),gn(e,{...t,offset:V(r)})),count:()=>qee(t)||t._tag==="InsertQuery"||t._tag==="UpdateQuery"||t._tag==="DeleteQuery"?Ou():gn(e,{_tag:"CountQuery",tableDef:e,where:t.where,resultSchema:Y({count:Ue}).pipe(Dl("count"),$e,ju())}),first:r=>(qu(t),t.limit._tag==="Some"?Ou(".first() can't be called after .limit()"):gn(e,{...t,limit:V(1),pickFirst:r?.fallback!==void 0&&r.fallback!=="throws"?{fallback:r.fallback}:"throws"})),insert:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return gn(e,{_tag:"InsertQuery",tableDef:e,values:s,onConflict:void 0,returning:void 0,resultSchema:Zr})},onConflict:(r,s,o)=>{const a=Array.isArray(r)?r:[r];Ree(t);const u=EO(s).pipe(Wg("ignore",()=>({targets:a,action:{_tag:"ignore"}})),Wg("replace",()=>({targets:a,action:{_tag:"replace"}})),Wg("update",()=>({targets:a,action:{_tag:"update",update:o}})),kO);return gn(e,{...t,onConflict:u})},returning:(...r)=>(Aee(t),gn(e,{...t,returning:r,resultSchema:e.rowSchema.pipe(Pl(...r),$e)})),update:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return gn(e,{_tag:"UpdateQuery",tableDef:e,values:s,where:[],returning:void 0,resultSchema:Zr})},delete:()=>gn(e,{_tag:"DeleteQuery",tableDef:e,where:[],returning:void 0,resultSchema:Zr})};return{[Hi]:Hi,[Bs]:t,ResultType:"only-for-type-inference",asSql:()=>wT(t),toString:()=>{try{return wT(t).query}catch(r){return console.debug("QueryBuilder.toString(): Error converting query builder to string",r,t),"Error converting query builder to string"}},...n}},$ee=e=>({_tag:"SelectQuery",columns:[],pickFirst:!1,select:{columns:[]},orderBy:[],offset:W(),limit:W(),tableDef:e,where:[],resultSchemaSingle:e.rowSchema});function qu(e){if(e._tag!=="SelectQuery")return Te("Expected SelectQuery but got "+e._tag)}function Ree(e){if(e._tag!=="InsertQuery")return Te("Expected InsertQuery but got "+e._tag)}function Aee(e){if(e._tag!=="InsertQuery"&&e._tag!=="UpdateQuery"&&e._tag!=="DeleteQuery")return Te("Expected WriteQuery but got "+e._tag)}const qee=e=>e._tag==="RowQuery",Ou=e=>Te("Invalid query builder"+(e?`: ${e}`:"")),Tv=e=>{const t=e[Bs];switch(t._tag){case"SelectQuery":{const n=$e(t.resultSchemaSingle);if(t.pickFirst===!1)return n;if(t.pickFirst==="throws")return n.pipe(ju());{const r=t.pickFirst.fallback();return Se(n,AO(Ce(r))).pipe(ju(()=>r))}}case"CountQuery":return Y({count:Ue}).pipe(Dl("count"),$e,ju());case"InsertQuery":case"UpdateQuery":case"DeleteQuery":return t.returning&&t.returning.length>0?t.tableDef.rowSchema.pipe(Pl(...t.returning),$e):Ue;case"RowQuery":return t.tableDef.rowSchema.pipe(Dl("value"),Z9({title:`${t.tableDef.sqliteDef.name}.value`}),$e,ju());default:ji(t)}},{boolean:Oee,integer:xee,text:vT}=See,zo=e=>{const{name:t,columns:n,...r}=e,s=t,o={isClientDocumentTable:!1},a=yx(n)?{value:n}:n,u=wx(s,a,r?.indexes??[]),f=vx(u),h=Ex(u),p={sqliteDef:u,options:o,rowSchema:f,insertSchema:h},m=gn(p);for(const T of Object.keys(m))p[T]=m[T];return p[Bs]=m[Bs],p[Hi]=m[Hi],p},Fee="__livestore_schema",Pee=zo({name:Fee,columns:{tableName:Ar({primaryKey:!0}),schemaHash:Xn({nullable:!1}),updatedAt:Ar({nullable:!1})}}),Dee="__livestore_schema_event_defs",Nee=zo({name:Dee,columns:{eventName:Ar({primaryKey:!0}),schemaHash:Xn({nullable:!1}),updatedAt:Ar({nullable:!1})}}),kx="__livestore_session_changeset",Mee=zo({name:kx,columns:{seqNumGlobal:Xn({schema:qc}),seqNumClient:Xn({schema:np}),changeset:bx({nullable:!0}),debug:kv({nullable:!0})},indexes:[{columns:["seqNumGlobal","seqNumClient"],name:"idx_session_changeset_id"}]}),Tx="__livestore_leader_merge_counter",Lee=zo({name:Tx,columns:{id:Xn({primaryKey:!0,schema:Ce(0)}),mergeCounter:Xn({primaryKey:!0})}}),Cv=[Pee,Nee,Mee,Lee],Uee=e=>Cv.some(t=>t.sqliteDef.name===e),jee="eventlog";zo({name:jee,columns:{seqNumGlobal:Xn({primaryKey:!0,schema:qc}),seqNumClient:Xn({primaryKey:!0,schema:np}),parentSeqNumGlobal:Xn({schema:qc}),parentSeqNumClient:Xn({schema:np}),name:Ar({}),argsJson:Ar({schema:Rc(Bt)}),clientId:Ar({}),sessionId:Ar({}),schemaHash:Xn({}),syncMetadataJson:Ar({schema:Rc(sv(Bi))})},indexes:[{columns:["seqNumGlobal"],name:"idx_eventlog_seqNumGlobal"},{columns:["seqNumGlobal","seqNumClient"],name:"idx_eventlog_seqNum"}]});const zee="__livestore_sync_status";zo({name:zee,columns:{head:Xn({primaryKey:!0})}});const ET=Se(M,Ue,zO,Gw),Cx=Se($e(ET),pu({key:M,value:ET})).pipe(Q9("PreparedBindValues")),Xa=(e,...t)=>{let n="";for(const[r,s]of t.entries())n+=e[r]+String(s);return n+e[e.length-1]},rl=(e,t)=>{if(Array.isArray(e))return e;const n={};for(const[r,s]of Object.entries(e))t.includes(r)&&(n[`$${r}`]=s);return n},Bee=({eventDef:e,materializer:t,db:n,event:r})=>{const s=r.decoded===void 0?pO(e.schema)(r.encoded.args):r.decoded.args,o=bZ(r.decoded?.args)?void 0:Bw(e.schema)(r.decoded.args),u=t(s,{eventDef:e,query:h=>{if(lo(h)){const{query:p,bindValues:m}=h.asSql(),T=n.select(p,rl(m,p)),C=Tv(h);return Cc(C)(T)}else{const{query:p,bindValues:m}=h;return n.select(p,rl(m,p))}},currentFacts:new Map});return Ix(u).map(h=>{const p=h.sql,m=typeof h=="string"?o:h.bindValues,T=typeof h=="string"?void 0:h.writeTables;return{statementSql:p,bindValues:rl(m??{},p),writeTables:T}})},Ix=e=>{if(fx(e))return e.flatMap(Ix);if(lo(e)){const{query:t,bindValues:n}=e.asSql();return[{sql:t,bindValues:n,writeTables:void 0}]}else return typeof e=="string"?[{sql:e,bindValues:{},writeTables:void 0}]:[{sql:e.sql,bindValues:e.bindValues,writeTables:e.writeTables}]},$x=(e,t)=>{Uy(e,qo,t)},Uy=(e,t,n)=>{if(Array.isArray(e))for(const r in e)e[r]===t?e[r]=n:Uy(e[r],t,n);else if(typeof e=="object"&&e!==null)for(const r in e)e[r]===t?e[r]=n:Uy(e[r],t,n)},Iv=e=>{const{name:t,schema:n,...r}=e,s=o=>{const a=D9(n)(o);return a._tag==="Left"&&Te(`Invalid event args for event '${t}':`,a.left.message,`
`),{name:t,args:o}};return Object.defineProperty(s,"name",{value:t}),Object.defineProperty(s,"schema",{value:n}),Object.defineProperty(s,"options",{value:{clientOnly:r?.clientOnly??!1,facts:r?.facts?(o,a)=>{const u=r.facts(o,a);return{modify:{set:u.modify?.set?new Set(u.modify.set):new Set,unset:u.modify?.unset?new Set(u.modify.unset):new Set},require:u.require?new Set(u.require):new Set}}:void 0,derived:r?.derived??!1}}),s},Kf=e=>Iv({...e,clientOnly:!1}),Rx=(e,t)=>t,Hee=(e,t)=>t,op=Iv({name:"livestore.RawSql",schema:Y({sql:M,bindValues:_n(pu({key:M,value:Bt})),writeTables:_n(ov(M))}),clientOnly:!0,derived:!0}),Wee=Rx(op,({sql:e,bindValues:t,writeTables:n})=>({sql:e,bindValues:t??{},writeTables:n})),Vee=({name:e,schema:t,...n})=>{const r={partialSet:n.partialSet??!0,default:{id:n.default.id,value:n.default.value}},s={id:Ar({primaryKey:!0}),value:kv({schema:t})},o=zo({name:e,columns:s});o.options.isClientDocumentTable=!0;const{eventDef:a,materializer:u}=Gee({name:e,valueSchema:t,defaultValue:r.default.value,partialSet:r.partialSet}),f=(...m)=>{const[T,C=r.default.id]=m;return a({id:C,value:T})};Object.defineProperty(f,"name",{value:`${e}Set`}),Object.defineProperty(f,"schema",{value:Y({id:M,value:r.partialSet?Kh(t):t}).annotations({title:`${e}Set:Args`})}),Object.defineProperty(f,"options",{value:{derived:!0,clientOnly:!0,facts:void 0}});const h={get:Qee(()=>p),set:f,Value:"only-for-type-inference",default:r.default,valueSchema:t,[Wl]:{derived:{setEventDef:a,setMaterializer:u},options:r}},p={...o,...h};return p},Kee=(e,t)=>typeof e!="object"||typeof t!="object"||e===null||t===null?t:Object.keys(e).reduce((n,r)=>(n[r]=t[r]??e[r],n),{}),Gee=({name:e,valueSchema:t,defaultValue:n,partialSet:r})=>{const s=Iv({name:`${e}Set`,schema:Y({id:Se(M,M9(qo)),value:r?Kh(t):t}).annotations({title:`${e}Set:Args`}),clientOnly:!0,derived:!0}),o=Rx(s,({id:a,value:u})=>{if(a===qo)return Te("SessionIdSymbol needs to be replaced before materializing the set event");if(kd(t.ast).length===0||r===!1){const h=Rc(t),p=gd(h)(u??n),m=gd(h)(u);return{sql:`INSERT INTO '${e}' (id, value) VALUES (?, ?) ON CONFLICT (id) DO UPDATE SET value = ?`,bindValues:[a,p,m],writeTables:new Set([e])}}else{const h=Rc(Kh(t)),p=gd(h)(Kee(n,u));let m="value";const T=[],C=Object.keys(u),A=t.pipe(Pl(...C)),D=gd(A)(u);for(const _ in D){const E=D[_];E!==void 0&&(m=`json_set(${m}, ?, json(?))`,T.push(`$.${_}`,JSON.stringify(E)))}const y=T.length>0?`ON CONFLICT (id) DO UPDATE SET value = ${m}`:"ON CONFLICT (id) DO NOTHING";return{sql:`
      INSERT INTO '${e}' (id, value)
      VALUES (?, ?)
      ${y}
    `,bindValues:[a,p,...T],writeTables:new Set([e])}}});return{eventDef:s,materializer:o}},$v=e=>e.options.isClientDocumentTable===!0,Qee=e=>(...t)=>{const n=e(),[r=n[Wl].options.default.id,s={}]=t,o=s.default??n[Wl].options.default.value,a={_tag:"RowQuery",tableDef:n,id:r,explicitDefaultValues:o},u=Xa`SELECT * FROM '${n.sqliteDef.name}' WHERE id = ?`;return{[Hi]:Hi,[Bs]:a,ResultType:"only-for-type-inference",asSql:()=>({query:u,bindValues:[r]}),toString:()=>u.toString()}},Wl=Symbol("ClientDocumentTableDef"),Jee=Symbol.for("livestore.LiveStoreSchema"),Yee=e=>{const t=e.state,n=e.state.sqlite.tables;for(const s of Cv)n.set(s.sqliteDef.name,s);const r=new Map;if(fx(e.events))for(const s of e.events)r.set(s.name,s);else for(const s of Object.values(e.events??{}))r.has(s.name)&&Te(`Duplicate event name: ${s.name}. Please use unique names for events.`),r.set(s.name,s);r.set(op.name,op);for(const s of n.values())$v(s)&&r.has(s.set.name)===!1&&r.set(s.set.name,s.set);return{LiveStoreSchemaSymbol:Jee,_DbSchemaType:Symbol.for("livestore.DbSchemaType"),_EventDefMapType:Symbol.for("livestore.EventDefMapType"),state:t,eventsDefsMap:r,devtools:{alias:e.devtools?.alias??"default"}}},jy=(e,t)=>{const n=e.eventsDefsMap.get(t);if(n===void 0)return Te(`No mutation definition found for \`${t}\`.`);const r=e.state.materializers.get(t);return r===void 0?Te(`No materializer found for \`${t}\`.`):{eventDef:n,materializer:r}},Xee=e=>{const t=Array.isArray(e.tables)?e.tables:Object.values(e.tables),n=new Map;for(const o of t){const a=o.sqliteDef;n.has(a.ast.name)&&Te(`Duplicate table name: ${a.ast.name}. Please use unique names for tables.`),n.set(a.ast.name,o)}for(const o of Cv)n.set(o.sqliteDef.name,o);const r=new Map;for(const[o,a]of Object.entries(e.materializers))r.set(o,a);r.set(op.name,Wee);for(const o of t)$v(o)&&r.set(o[Wl].derived.setEventDef.name,o[Wl].derived.setMaterializer);const s=vee({_tag:"dbSchema",tables:[...n.values()].map(o=>o.sqliteDef.ast)});return{sqlite:{tables:n,migrations:e.migrations??{strategy:"auto"},hash:s},materializers:r}};Y({name:M,args:Bt,seqNum:Ht,parentSeqNum:Ht,clientId:M,sessionId:M}).annotations({title:"LiveStoreEvent.AnyDecoded"});const Zee=Y({name:M,args:Bt,seqNum:Ht,parentSeqNum:Ht,clientId:M,sessionId:M}).annotations({title:"LiveStoreEvent.AnyEncoded"}),ete=Y({name:M,args:Bt,seqNum:qc,parentSeqNum:qc,clientId:M,sessionId:M}).annotations({title:"LiveStoreEvent.AnyEncodedGlobal"}),tte=Y({name:M,args:Bt}),nte=e=>Se(...[...e.eventsDefsMap.values()].map(t=>Y({name:Ce(t.name),args:t.schema,seqNum:Ht,parentSeqNum:Ht,clientId:M,sessionId:M}))).annotations({title:"EventDef"}),Ax=RZ(nte);class rr extends aa("LiveStoreEvent.EncodedWithMeta")({name:M,args:Bt,seqNum:Ht,parentSeqNum:Ht,clientId:M,sessionId:M,meta:Y({sessionChangeset:Se(Ie("sessionChangeset",{data:zO,debug:Bt.pipe(_n)}),Ie("no-op",{}),Ie("unset",{})),syncMetadata:sv(Bi)}).pipe(MO,_n,PO({constructor:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:W()}),decoding:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:W()})}))}){toJSON=()=>({seqNum:`${Dr(this.seqNum)}  ${Dr(this.parentSeqNum)} (${this.clientId}, ${this.sessionId})`,name:this.name,args:this.args});rebase=(t,n)=>new rr({...this,...vv(t,n)});static fromGlobal=(t,n)=>new rr({...t,seqNum:{global:t.seqNum,client:Hl},parentSeqNum:{global:t.parentSeqNum,client:Hl},meta:{sessionChangeset:{_tag:"unset"},syncMetadata:n}});toGlobal=()=>({...this,seqNum:this.seqNum.global,parentSeqNum:this.parentSeqNum.global})}const kT=(e,t)=>e.seqNum.global===t.seqNum.global&&e.seqNum.client===t.seqNum.client&&e.name===t.name&&e.clientId===t.clientId&&e.sessionId===t.sessionId&&JSON.stringify(e.args)===JSON.stringify(t.args);class qse extends jr()("IsOfflineError",{}){}class Ose extends jr()("InvalidPushError",{reason:Se(Ie("Unexpected",{message:M}),Ie("ServerAhead",{minimumExpectedNum:Ue,providedNum:Ue}))}){}class xse extends jr()("InvalidPullError",{message:M}){}class rte extends jr()("LeaderAheadError",{minimumExpectedNum:Ht,providedNum:Ht}){}class Kr extends aa("SyncState")({pending:$e(rr),upstreamHead:Ht,localHead:Ht}){toJSON=()=>({pending:this.pending.map(t=>t.toJSON()),upstreamHead:Dr(this.upstreamHead),localHead:Dr(this.localHead)})}class qx extends Ie("upstream-rebase",{rollbackEvents:$e(rr),newEvents:$e(rr)}){}class Ox extends Ie("upstream-advance",{newEvents:$e(rr)}){}class ste extends Ie("local-push",{newEvents:$e(rr)}){}class ote extends Se(qx,Ox,ste){}class xx extends Se(qx,Ox){}class og extends aa("MergeContext")({payload:ote,syncState:Kr}){toJSON=()=>({payload:EO(this.payload).pipe(Vg("local-push",()=>({_tag:"local-push",newEvents:this.payload.newEvents.map(n=>n.toJSON())})),Vg("upstream-advance",()=>({_tag:"upstream-advance",newEvents:this.payload.newEvents.map(n=>n.toJSON())})),Vg("upstream-rebase",n=>({_tag:"upstream-rebase",newEvents:n.newEvents.map(r=>r.toJSON()),rollbackEvents:n.rollbackEvents.map(r=>r.toJSON())})),kO),syncState:this.syncState.toJSON()})}class Bu extends aa("MergeResultAdvance")({_tag:Ce("advance"),newSyncState:Kr,newEvents:$e(rr),confirmedEvents:$e(rr),mergeContext:og}){toJSON=()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(t=>t.toJSON()),confirmedEvents:this.confirmedEvents.map(t=>t.toJSON()),mergeContext:this.mergeContext.toJSON()})}class zy extends aa("MergeResultRebase")({_tag:Ce("rebase"),newSyncState:Kr,newEvents:$e(rr),rollbackEvents:$e(rr),mergeContext:og}){toJSON=()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(t=>t.toJSON()),rollbackEvents:this.rollbackEvents.map(t=>t.toJSON()),mergeContext:this.mergeContext.toJSON()})}class Fx extends aa("MergeResultReject")({_tag:Ce("reject"),expectedMinimumId:Ht,mergeContext:og}){toJSON=()=>({_tag:this._tag,expectedMinimumId:Dr(this.expectedMinimumId),mergeContext:this.mergeContext.toJSON()})}class Px extends aa("MergeResultUnexpectedError")({_tag:Ce("unexpected-error"),cause:ke}){}class Fse extends Se(Bu,zy,Fx,Px){}const By=e=>{if(Ao)debugger;return Px.make({_tag:"unexpected-error",cause:new ke({cause:e})})},TT=({syncState:e,payload:t,isClientEvent:n,isEqualEvent:r,ignoreClientEvents:s=!1})=>{Dx(e),ite(t);const o=og.make({payload:t,syncState:e});switch(t._tag){case"upstream-rebase":{const a=[...t.rollbackEvents,...e.pending],u=t.newEvents.at(-1)?.seqNum??e.upstreamHead,f=CT({events:e.pending,baseEventSequenceNumber:u,isClientEvent:n});return Go(zy.make({_tag:"rebase",newSyncState:new Kr({pending:f,upstreamHead:u,localHead:f.at(-1)?.seqNum??u}),newEvents:[...t.newEvents,...f],rollbackEvents:a,mergeContext:o}))}case"upstream-advance":{if(t.newEvents.length===0)return Go(Bu.make({_tag:"advance",newSyncState:new Kr({pending:e.pending,upstreamHead:e.upstreamHead,localHead:e.localHead}),newEvents:[],confirmedEvents:[],mergeContext:o}));for(let f=1;f<t.newEvents.length;f++)if(Ld(t.newEvents[f-1].seqNum,t.newEvents[f].seqNum))return By(`Events must be sorted in ascending order by event number. Received: [${t.newEvents.map(h=>Dr(h.seqNum)).join(", ")}]`);if(Ld(e.upstreamHead,t.newEvents[0].seqNum)||wv(e.upstreamHead,t.newEvents[0].seqNum))return By(`Incoming events must be greater than upstream head. Expected greater than: ${Dr(e.upstreamHead)}. Received: [${t.newEvents.map(f=>Dr(f.seqNum)).join(", ")}]`);const a=t.newEvents.at(-1).seqNum,u=Hy({existingEvents:e.pending,incomingEvents:t.newEvents,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});if(u===-1){const f=new Set(e.pending.map(C=>`${C.seqNum.global},${C.seqNum.client}`)),h=t.newEvents.filter(C=>!f.has(`${C.seqNum.global},${C.seqNum.client}`));let p=0;const[m,T]=hN(e.pending,(C,A)=>{if(s&&n(C))return p++,!1;const D=t.newEvents.at(A-p);return D?r(C,D)===!1:!0});return Go(Bu.make({_tag:"advance",newSyncState:new Kr({pending:T,upstreamHead:a,localHead:T.at(-1)?.seqNum??uee(e.localHead,a)}),newEvents:h,confirmedEvents:m,mergeContext:o}))}else{const f=e.pending.slice(u),h=CT({events:f,baseEventSequenceNumber:a,isClientEvent:n}),p=Hy({existingEvents:t.newEvents,incomingEvents:e.pending,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});return Go(zy.make({_tag:"rebase",newSyncState:new Kr({pending:h,upstreamHead:a,localHead:h.at(-1).seqNum}),newEvents:[...t.newEvents.slice(p),...h],rollbackEvents:f,mergeContext:o}))}}case"local-push":{if(t.newEvents.length===0)return Go(Bu.make({_tag:"advance",newSyncState:e,newEvents:[],confirmedEvents:[],mergeContext:o}));const a=t.newEvents.at(0);if(Ld(a.seqNum,e.localHead)===!1){const f=vv(e.localHead,!0).seqNum;return Go(Fx.make({_tag:"reject",expectedMinimumId:f,mergeContext:o}))}else return Go(Bu.make({_tag:"advance",newSyncState:new Kr({pending:[...e.pending,...t.newEvents],upstreamHead:e.upstreamHead,localHead:t.newEvents.at(-1).seqNum}),newEvents:t.newEvents,confirmedEvents:[],mergeContext:o}))}default:ji(t)}},Hy=({existingEvents:e,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:s})=>{if(s){const o=e.filter(f=>!r(f)),a=Hy({existingEvents:o,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:!1});if(a===-1)return-1;const u=e[a].seqNum;return e.findIndex(f=>wv(f.seqNum,u))}return e.findIndex((o,a)=>{const u=t[a];return u&&!n(o,u)})},CT=({events:e,baseEventSequenceNumber:t,isClientEvent:n})=>{let r=t;return e.map(s=>{const o=n(s),a=s.rebase(r,o);return r=a.seqNum,a})},ite=e=>{for(let t=1;t<e.newEvents.length;t++)if(rp(e.newEvents[t-1].seqNum,e.newEvents[t].seqNum))return By(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.newEvents.map(n=>Dr(n.seqNum)).join(", ")}]`)},Dx=e=>{for(let t=0;t<e.pending.length;t++){const n=e.pending[t],r=e.pending[t+1];if(r===void 0)break;rp(n.seqNum,r.seqNum)&&Te(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.pending.map(o=>Dr(o.seqNum)).join(", ")}]`,{event:n,nextEvent:r}),r.seqNum.global>n.seqNum.global?r.seqNum.client!==0&&Te(`New global events must point to clientId 0 in the parentSeqNum. Received: (${Dr(r.seqNum)})`,e.pending,{event:n,nextEvent:r}):wv(r.parentSeqNum,n.seqNum)===!1&&Te("Events must be linked in a continuous chain via the parentSeqNum",e.pending,{event:n,nextEvent:r})}},Go=e=>(e._tag==="unexpected-error"||e._tag==="reject"||(Dx(e.newSyncState),Ld(e.newSyncState.upstreamHead,e.newSyncState.localHead)&&Te("Local head must be greater than or equal to upstream head",{localHead:e.newSyncState.localHead,upstreamHead:e.newSyncState.upstreamHead}),rp(e.newSyncState.localHead,e.mergeContext.syncState.localHead)===!1&&Te("New local head must be greater than or equal to the previous local head",{localHead:e.newSyncState.localHead,previousLocalHead:e.mergeContext.syncState.localHead}),rp(e.newSyncState.upstreamHead,e.mergeContext.syncState.upstreamHead)===!1&&Te("New upstream head must be greater than or equal to the previous upstream head",{upstreamHead:e.newSyncState.upstreamHead,previousUpstreamHead:e.mergeContext.syncState.upstreamHead})),e),ate=({schema:e,clientSession:t,runtime:n,materializeEvent:r,rollback:s,refreshTables:o,span:a,params:u,confirmUnsavedChanges:f})=>{const h=Ax(e),p={current:new Kr({localHead:t.leaderThread.initialState.leaderHead,upstreamHead:t.leaderThread.initialState.leaderHead,pending:[]})},m=Ln().pipe(fr),T=_=>jy(e,_.name).eventDef.options.clientOnly,C=fX().pipe(fr),A=(_,{otelContext:E})=>{let v=p.current.localHead;const R=_.map(({name:N,args:j})=>{const P=jy(e,N),L=vv(v,P.eventDef.options.clientOnly);return v=L.seqNum,new rr(Bw(h)({name:N,args:j,...L,clientId:t.clientId,sessionId:t.sessionId}))}),q=TT({syncState:p.current,payload:{_tag:"local-push",newEvents:R},isClientEvent:T,isEqualEvent:kT});if(q._tag==="unexpected-error")return Te("Unexpected error in client-session-sync-processor",q.cause);if(a.addEvent("local-push",{batchSize:R.length,mergeResult:Au?JSON.stringify(q):void 0}),q._tag!=="advance")return Te(`Expected advance, got ${q._tag}`);p.current=q.newSyncState,m.offer(q.newSyncState).pipe(fr);const x=new Set;for(const N of q.newEvents){const j=Cc(h)(N),P=r(j,{otelContext:E,withChangeset:!0});for(const L of P.writeTables)x.add(L);N.meta.sessionChangeset=P.sessionChangeset}return Qk(C,R).pipe(fr),{writeTables:x}},D={rebaseCount:0,advanceCount:0,rejectCount:0},y=Cn.setSpan(Jn.active(),a),b=K(function*(){if(f&&typeof window<"u"&&typeof window.addEventListener=="function"){const R=q=>{p.current.pending.length>0&&q.preventDefault()};yield*Ct(me(()=>window.addEventListener("beforeunload",R)),()=>me(()=>window.removeEventListener("beforeunload",R)))}const _=yield*aO(),E=K(function*(){const R=yield*dX(C,1,u.leaderPushBatchSize);yield*t.leaderThread.events.push(R).pipe(Of("LeaderAheadError",()=>(D.rejectCount++,Jk(C))))}).pipe(kc,St,ze);yield*Uh(_,E);const v=()=>t.sqliteDb.select(Xa`SELECT mergeCounter FROM ${Tx} WHERE id = 0`)[0]?.mergeCounter??0;yield*YO(()=>t.leaderThread.events.pull({cursor:{mergeCounter:v(),eventNum:p.current.localHead}})).pipe(zn(({payload:R,mergeCounter:q})=>K(function*(){t.devtools.enabled&&(yield*t.devtools.pullLatch.await);const x=TT({syncState:p.current,payload:R,isClientEvent:T,isEqualEvent:kT});if(x._tag==="unexpected-error")return yield*Ni(x.cause);if(x._tag==="reject")return Te("Unexpected reject in client-session-sync-processor",x);if(p.current=x.newSyncState,m.offer(x.newSyncState).pipe(fr),x._tag==="rebase"){a.addEvent("merge:pull:rebase",{payloadTag:R._tag,payload:Au?JSON.stringify(R):void 0,newEventsCount:x.newEvents.length,rollbackCount:x.rollbackEvents.length,res:Au?JSON.stringify(x):void 0,leaderMergeCounter:q}),D.rebaseCount++,yield*p7(_),yield*Jk(C),yield*Uh(_,E),Ao&&An("merge:pull:rebase: rollback",x.rollbackEvents.length,...x.rollbackEvents.slice(0,10).map(j=>j.toJSON()),{leaderMergeCounter:q}).pipe(bn(n),fr);for(let j=x.rollbackEvents.length-1;j>=0;j--){const P=x.rollbackEvents[j];P.meta.sessionChangeset._tag!=="no-op"&&P.meta.sessionChangeset._tag!=="unset"&&(s(P.meta.sessionChangeset.data),P.meta.sessionChangeset={_tag:"unset"})}yield*Qk(C,x.newSyncState.pending)}else a.addEvent("merge:pull:advance",{payloadTag:R._tag,payload:Au?JSON.stringify(R):void 0,newEventsCount:x.newEvents.length,res:Au?JSON.stringify(x):void 0,leaderMergeCounter:q}),D.advanceCount++;if(x.newEvents.length===0)return;const N=new Set;for(const j of x.newEvents){const P=Cc(h)(j),L=r(P,{otelContext:y,withChangeset:!0});for(const Q of L.writeTables)N.add(Q);j.meta.sessionChangeset=L.sessionChangeset}o(N)}).pipe(ze,tu(x=>t.shutdown(x)))),hn,kc,St,Ne("client-session-sync-processor:pull"),ze,yt)});return{push:A,boot:b,syncState:Zm({get:K(function*(){const _=p.current;return p===void 0?Te("Not initialized"):_}),changes:Ui(m)}),debug:{print:()=>K(function*(){console.log("debugInfo",D),console.log("syncState",p.current);const _=yield*pX(C);console.log("pushQueueSize",_);const E=yield*hX(C);console.log("pushQueueItems",E.map(v=>v.toJSON()))}).pipe(bn(n),fr),debugInfo:()=>D}}},cte="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let _r=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=cte[n[e]&63];return t};const Nx=Ie("RequestSessions",{}),Mx=Ie("SessionInfo",{storeId:M,clientId:M,sessionId:M,schemaAlias:M,isLeader:js}),Lx=Se(Nx,Mx),Ux=({webChannel:e,sessionInfo:t})=>K(function*(){yield*e.send(t),yield*e.listen.pipe(Io(),zs(at(Nx)),zn(()=>e.send(t)),hn)});class ip{#e=new Map;#t;constructor(t){this.#t=t}onEvict;set=(t,n)=>{if(this.#e.set(t,n),this.#e.size>this.#t){const r=this.#e.keys().next().value,s=this.#e.get(r);this.#e.delete(r),this.onEvict&&this.onEvict(r,s)}};get=t=>this.#e.get(t);delete=t=>{this.#e.delete(t)};keys=()=>this.#e.keys()}class ute{#e;constructor(t){this.#e=new ip(t),this.#e.onEvict=this.#t}#t=t=>{this.onEvict&&this.onEvict(t)};onEvict;add=t=>{this.#e.set(t,t)};[Symbol.iterator]=()=>this.#e.keys()}class es{#e=[];sizeLimit;constructor(t){this.sizeLimit=t}static make=(t,n=[])=>{const r=new es(t);for(const s of n)r.push(s);return r};onEvict;push=t=>{if(this.#e.push(t),this.#e.length>this.sizeLimit){const n=this.#e.shift();n&&this.onEvict&&this.onEvict(n)}};get=t=>this.#e[t];delete=t=>{this.#e.splice(t,1)};get length(){return this.#e.length}[Symbol.iterator]=()=>this.#e[Symbol.iterator]();map=t=>this.#e.map(t);clear=()=>{this.#e=[]};sort=t=>this.#e.sort(t)}const lte=Y({queryStr:M,bindValues:$c(Cx),durationMs:Ue,rowsCount:$c(Ue),queriedTables:ov(M),startTimePerfNow:Ue}),fte=e=>ia([e],{decode:t=>(n,r,s)=>{if(n instanceof es){const o=fu($e(t))([...n],r);return $n(o,a=>es.make(n.sizeLimit,a))}return To(new jt(s,n))},encode:t=>(n,r,s)=>{if(n instanceof es){const o=oa($e(t))([...n],r);return $n(o,a=>es.make(n.sizeLimit,a))}return To(new jt(s,n))}},{description:`BoundArray<${du(e)}>`,pretty:()=>t=>`BoundArray(${t.length})`,arbitrary:()=>t=>t.anything(),equivalence:()=>(t,n)=>t===n}),IT=e=>kr(Y({size:Ue,items:$e(e)}),fte(us(e)),{encode:t=>({size:t.sizeLimit,items:[...t]}),decode:t=>es.make(t.size,t.items)}),Rv=Y({slowQueries:IT(lte),queryFrameDuration:Ue,queryFrameCount:Ue,events:IT(AO(M,Bt))});MO(Rv);const In="0.3.0",$T=4,dte=Y({isConnected:js,timestampMs:Ue,latchClosed:js}),sl=M,Av=M,jx=M,jd=Ce(In),ig=(e,t)=>Ie(e,{liveStoreVersion:jd,...t}).annotations({identifier:e}),hte=(e,t)=>ig(e,{clientId:Av,...t}),pte=(e,t)=>ig(e,{clientId:Av,sessionId:jx,...t}),Yt=(e,t)=>ig(e,{clientId:Av,sessionId:jx,requestId:sl,...t}),At=(e,t)=>hte(e,{requestId:sl,...t}),qv=(e,t)=>{const n=Ie(`${e}.Response.Success`,{requestId:sl,liveStoreVersion:jd,...t.success}).annotations({identifier:`${e}.Response.Success`}),r=t.error?Ie(`${e}.Response.Error`,{requestId:sl,liveStoreVersion:jd,...t.error}).annotations({identifier:`${e}.Response.Error`}):Vm;return{Request:Ie(`${e}.Request`,{requestId:sl,liveStoreVersion:jd,...t.payload}).annotations({identifier:`${e}.Request`}),Response:Se(n,r),Success:n,Error:r}};class mte extends Yt("LSD.ClientSession.DebugInfoReq",{}){}class zx extends Yt("LSD.ClientSession.DebugInfoRes",{debugInfo:Rv}){}class gte extends Yt("LSD.ClientSession.DebugInfoHistorySubscribe",{subscriptionId:M}){}class Bx extends Yt("LSD.ClientSession.DebugInfoHistoryRes",{debugInfoHistory:$e(Rv),subscriptionId:M}){}class _te extends Yt("LSD.ClientSession.DebugInfoHistoryUnsubscribe",{subscriptionId:M}){}class yte extends Yt("LSD.ClientSession.DebugInfoResetReq",{}){}class Hx extends Yt("LSD.ClientSession.DebugInfoResetRes",{}){}class bte extends Yt("LSD.ClientSession.DebugInfoRerunQueryReq",{queryStr:M,bindValues:$c(Cx),queriedTables:ov(M)}){}class Wx extends Yt("LSD.ClientSession.DebugInfoRerunQueryRes",{}){}let Ste=class extends Yt("LSD.ClientSession.SyncHeadSubscribe",{subscriptionId:M}){},wte=class extends Yt("LSD.ClientSession.SyncHeadUnsubscribe",{subscriptionId:M}){},Vx=class extends Yt("LSD.ClientSession.SyncHeadRes",{local:Ht,upstream:Ht,subscriptionId:M}){};class vte extends Yt("LSD.ClientSession.ReactivityGraphSubscribe",{includeResults:js,subscriptionId:M}){}class Ete extends Yt("LSD.ClientSession.ReactivityGraphUnsubscribe",{subscriptionId:M}){}class Kx extends Yt("LSD.ClientSession.ReactivityGraphRes",{reactivityGraph:Bt,subscriptionId:M}){}class kte extends Yt("LSD.ClientSession.LiveQueriesSubscribe",{subscriptionId:M}){}class Tte extends Yt("LSD.ClientSession.LiveQueriesUnsubscribe",{subscriptionId:M}){}class Cte extends Y({_tag:Ce("computed","db","graphql","signal"),id:Ue,label:M,hash:M,runs:Ue,executionTimes:$e(Ue),lastestResult:Bt,activeSubscriptions:$e(Y({frames:$e(Y({name:M,filePath:M}))}))}){}class Gx extends Yt("LSD.ClientSession.LiveQueriesRes",{liveQueries:$e(Cte),subscriptionId:M}){}let Ite=class extends Yt("LSD.ClientSession.Ping",{}){},Qx=class extends Yt("LSD.ClientSession.Pong",{}){},Ov=class extends pte("LSD.ClientSession.Disconnect",{}){};const $te=Se(mte,gte,_te,yte,bte,vte,Ete,kte,Tte,Ov,Ite,Ste,wte).annotations({identifier:"LSD.ClientSession.MessageToApp"}),Rte=Se(zx,Bx,Hx,Wx,Kx,Gx,Ov,Qx,Vx).annotations({identifier:"LSD.ClientSession.MessageFromApp"});class jse extends At("LSD.Leader.ResetAllDataReq",{mode:Ce("all-data","only-app-db")}){}class Ate extends At("LSD.Leader.DatabaseFileInfoReq",{}){}class RT extends Y({fileSize:Ue,persistenceInfo:Y({fileName:M},{key:M,value:Bt})}){}class qte extends At("LSD.Leader.DatabaseFileInfoRes",{state:RT,eventlog:RT}){}class Ote extends At("LSD.Leader.NetworkStatusSubscribe",{subscriptionId:M}){}class xte extends At("LSD.Leader.NetworkStatusUnsubscribe",{subscriptionId:M}){}class Fte extends At("LSD.Leader.NetworkStatusRes",{networkStatus:dte,subscriptionId:M}){}class Pte extends At("LSD.Leader.SyncingInfoReq",{}){}class Dte extends Y({enabled:js,metadata:pu({key:M,value:Bt})}){}class Nte extends At("LSD.Leader.SyncingInfoRes",{syncingInfo:Dte}){}class Mte extends At("LSD.Leader.SyncHistorySubscribe",{subscriptionId:M}){}class Lte extends At("LSD.Leader.SyncHistoryUnsubscribe",{subscriptionId:M}){}class Ute extends At("LSD.Leader.SyncHistoryRes",{eventEncoded:ete,metadata:sv(Bi),subscriptionId:M}){}class jte extends At("LSD.Leader.SyncHeadSubscribe",{subscriptionId:M}){}class zte extends At("LSD.Leader.SyncHeadUnsubscribe",{subscriptionId:M}){}class Bte extends At("LSD.Leader.SyncHeadRes",{local:Ht,upstream:Ht,subscriptionId:M}){}class Hte extends At("LSD.Leader.SnapshotReq",{}){}class Wte extends At("LSD.Leader.SnapshotRes",{snapshot:Ya}){}const Jx=qv("LSD.Leader.LoadDatabaseFile",{payload:{data:Ya},success:{},error:{cause:Se(Ie("unsupported-file",{}),Ie("unsupported-database",{}),Ie("unexpected-error",{cause:Ac}))}});class Vte extends ig("LSD.Leader.SyncPull",{payload:xx}){}class Kte extends At("LSD.Leader.CommitEventReq",{eventEncoded:tte}){}class Gte extends At("LSD.Leader.CommitEventRes",{}){}class Qte extends At("LSD.Leader.EventlogReq",{}){}class Jte extends At("LSD.Leader.EventlogRes",{eventlog:Ya}){}class Yte extends At("LSD.Leader.Ping",{}){}class Xte extends At("LSD.Leader.Pong",{}){}class Yx extends At("LSD.Leader.Disconnect",{}){}const xv=qv("LSD.Leader.SetSyncLatch",{payload:{closeLatch:js},success:{}}),Fv=qv("LSD.Leader.ResetAllData",{payload:{mode:Ce("all-data","only-app-db")},success:{}}),Zte=Se(Hte,Jx.Request,Qte,Fv.Request,Ote,xte,Yx,Kte,Yte,Ate,Mte,Lte,Pte,jte,zte,xv.Request).annotations({identifier:"LSD.Leader.MessageToApp"});Se(Wte,Jx.Response,Jte,Yx,Vte,Fte,Gte,Xte,qte,Ute,Nte,Bte,Fv.Success,xv.Success).annotations({identifier:"LSD.Leader.MessageFromApp"});const ene=Se(Ie("node",{url:M}),Ie("web",{}),Ie("browser-extension",{}));ene.pipe(Dl("_tag"),us);const tne={client:{session:({storeId:e,clientId:t,sessionId:n})=>`client-session-${e}-${t}-${n}`,leader:({storeId:e,clientId:t})=>`client-leader-${e}-${t}`}},Xx={sessionInfo:()=>"session-info",devtoolsClientSession:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-session-${e}-${t}-${n})`,devtoolsClientLeader:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-leader-${e}-${t}-${n})`},nne={devtoolsClientSession:(e,{storeId:t,clientId:n,sessionId:r})=>e===Xx.devtoolsClientSession({storeId:t,clientId:n,sessionId:r}),devtoolsClientLeader:(e,{storeId:t,clientId:n})=>e.startsWith(`devtools-channel(client-leader-${t}-${n}`)},rne=e=>e.makeBroadcastChannel({channelName:Xx.sessionInfo(),schema:Lx}),sne=({otelTracer:e,parentSpanContext:t})=>n=>{const r=Pf(lx,e??wZ()),s=$A(Pe(_Z,RA)).pipe(BK(r));return n.pipe(t?xa(yZ(Cn.getSpanContext(t))):se,bn(s))},ap=e=>{const t=e._duration;return t[0]*1e3+t[1]/1e6},AT=e=>e._performanceStartTime,Gf=M.pipe(_n,PO({constructor:()=>_r(10),decoding:()=>_r(10)})),ua={id:Gf,target:M,source:M,channelName:M,hops:$e(M)},Zx=IO.pipe(_n);class zd extends Ie("DirectChannelRequest",{...ua,remainingHops:$e(M).pipe(_n),channelVersion:Ue,reqId:$c(M),sourceId:M}){}class eF extends Ie("DirectChannelResponseSuccess",{...ua,reqId:M,port:ng,remainingHops:$e(M),channelVersion:Ue}){}class Pv extends Ie("DirectChannelResponseNoTransferables",{...ua,reqId:M,remainingHops:$e(M)}){}class tF extends Ie("ProxyChannelRequest",{...ua,remainingHops:Zx,channelIdCandidate:M}){}class nF extends Ie("ProxyChannelResponseSuccess",{...ua,reqId:M,remainingHops:$e(M),combinedChannelId:M,channelIdCandidate:M}){}class rF extends Ie("ProxyChannelPayload",{...ua,remainingHops:Zx,payload:Bt,combinedChannelId:M}){}class sF extends Ie("ProxyChannelPayloadAck",{...ua,reqId:M,remainingHops:$e(M),combinedChannelId:M}){}class Wy extends Ie("NetworkEdgeAdded",{id:Gf,source:M,target:M}){}class Vy extends Ie("NetworkTopologyRequest",{id:Gf,hops:$e(M),source:M,target:Ce("-")}){}class Ky extends Ie("NetworkTopologyResponse",{id:Gf,reqId:M,remainingHops:$e(M),nodeName:M,edges:$e(M),source:M,target:Ce("-")}){}const Bd=Ie("BroadcastChannelPacket",{id:Gf,channelName:M,payload:Bt,hops:$e(M),source:M,target:Ce("-")});class Gy extends Se(zd,eF,Pv){}class oF extends Se(tF,nF,rF,sF){}class Dv extends Se(Gy,oF,Wy,Vy,Ky,Bd){}class yd extends Ie("DirectChannelPing",{}){}class bd extends Ie("DirectChannelPong",{}){}class one extends jr()("EdgeAlreadyExistsError",{target:M}){}const ol=e=>({packetId:e.id,"span.label":e.id+(X(e,"reqId")&&e.reqId!==void 0?` for ${e.reqId}`:""),...e._tag!=="DirectChannelResponseSuccess"&&e._tag!=="ProxyChannelPayload"?{packet:e}:{}});Y({channelName:M,source:M,mode:Se(Ce("proxy"),Ce("direct"))});const ine=Le,ane=({nodeName:e,incomingPacketsQueue:t,target:n,checkTransferableEdges:r,channelName:s,schema:o,sendPacket:a,channelVersion:u,scope:f,sourceId:h})=>K(function*(){const p=yield*ine(),m=yield*eg.pipe(ew(()=>Nt(void 0))),T={send:Se(o.send,yd,bd),listen:Se(o.listen,yd,bd)},C={current:{_tag:"Initial"}},A=({packet:_,respondToSender:E})=>K(function*(){const v=C.current;if(m?.addEvent(`process:${_._tag}`,{channelState:v._tag,packetId:_.id,packetReqId:_.reqId,packetChannelVersion:X("channelVersion")(_)?_.channelVersion:void 0}),v._tag==="Initial")return Te();if(_._tag==="DirectChannelResponseNoTransferables")return yield*K$(p,_),"close";if(_.channelVersion>u)return m?.addEvent(`incoming packet has higher version (${_.channelVersion}), closing channel`),yield*Vt(f,Rt("higher-version-expected")),"close";if(_.channelVersion<u){const R=zd.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:void 0});m?.addEvent(`incoming packet has lower version (${_.channelVersion}), sending request to reconnect (${R.id})`),yield*a(R);return}if(v._tag==="Established"&&_._tag==="DirectChannelRequest")return _.sourceId===v.otherSourceId?void 0:(m?.addEvent("force-new-channel"),yield*Vt(f,Rt("force-new-channel")),"close");switch(_._tag){case"DirectChannelRequest":{if(v._tag!=="RequestSent")return;if(_.reqId!==v.reqPacketId){const q=zd.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:_.id});m?.addEvent(`Re-sending new request (${q.id}) for incoming request (${_.id})`),yield*a(q)}if(e>n){m?.addEvent("winner side: creating direct channel and sending response");const q=new MessageChannel,x=yield*yT({port:q.port1,schema:T,debugId:u}).pipe(ql(bT));yield*E(eF.make({reqId:_.id,target:n,source:e,channelName:_.channelName,hops:[],remainingHops:_.hops.slice(0,-1),port:q.port2,channelVersion:u})),C.current={_tag:"winner:ResponseSent",channel:x,otherSourceId:_.sourceId},yield*x.listen.pipe(Io(),zs(at(yd)),Yh(1),hn),yield*x.send(bd.make({})),m?.addEvent("winner side: established"),C.current={_tag:"Established",otherSourceId:_.sourceId},yield*ct(p,x)}else m?.addEvent("loser side: waiting for response"),C.current={_tag:"loser:WaitingForResponse",otherSourceId:_.sourceId};break}case"DirectChannelResponseSuccess":{if(v._tag!=="loser:WaitingForResponse")return Te(`Expected to find direct channel response from ${n}, but was in ${v._tag} state`);const R=yield*yT({port:_.port,schema:T,debugId:u}).pipe(ql(bT)),q=yield*R.listen.pipe(Io(),zs(at(bd)),Yh(1),hn,sw);yield*R.send(yd.make({})).pipe(Ec(10),Cm({times:2})),yield*q,m?.addEvent("loser side: established"),C.current={_tag:"Established",otherSourceId:v.otherSourceId},yield*ct(p,R);return}default:return ji(_)}}).pipe(Ne(`handleMessagePacket:${_._tag}:${_.source}${_.target}`,{attributes:ol(_)}));yield*K(function*(){for(;;){const _=yield*Tc(t);if((yield*A(_))==="close")return}}).pipe(St,ze,yt);const D=C.current;return D._tag!=="Initial"?Te(`Expected channel to be in Initial state, but was in ${D._tag} state`):(yield*K(function*(){const _=zd.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],reqId:void 0});C.current={_tag:"RequestSent",reqPacketId:_.id};const E=r(_);if(E!==void 0)return yield*mr(`No transferable edges found for ${_.source}${_.target}`),yield*Ni(E);yield*a(_),m?.addEvent(`initial edge request sent (${_.id})`)}),yield*p)}).pipe(lw(`makeDirectChannel:${u}`)),cne=({schema:e,newEdgeAvailablePubSub:t,channelName:n,checkTransferableEdges:r,nodeName:s,incomingPacketsQueue:o,target:a,sendPacket:u})=>ca(f=>K(function*(){const h=_r(),p=yield*Ln(),m=yield*hJ(),T=yield*Le(),C={pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1,innerChannelRef:{current:void 0}};yield*K(function*(){const E=yield*Le();for(;;){C.connectCounter++;const x=C.connectCounter;yield*mr(`Connecting#${x}`);const N=yield*Rf();yield*yn(Q=>Vt(N,Q));const j=yield*GO(t).pipe(zn(Q=>mr(`new-conn:${Q}`)),Yh(1),hn,xs("new-edge"),sw),P=ane({nodeName:s,sourceId:h,incomingPacketsQueue:o,target:a,checkTransferableEdges:r,channelName:n,schema:e,channelVersion:x,sendPacket:u,scope:N}).pipe($f(N),Un(N),TK(W())),L=yield*kA(P,j.pipe(pK));if(L==="new-edge")yield*Vt(N,bf("new-edge"));else{const Q=yield*L.pipe(Mt);if(Q._tag==="Failure")yield*Vt(N,Q),$R(Q.cause)&&at(Pv)(Q.cause.error)&&(yield*j.pipe(Mt));else{const oe=Q.value;yield*ct(E,{channel:oe,makeDirectChannelScope:N,channelVersion:x});break}}}const{channel:v,makeDirectChannelScope:R,channelVersion:q}=yield*E;yield*mr(`Connected#${q}`),C.isConnected=!0,C.innerChannelRef.current=v,yield*ct(T,void 0),yield*v.listen.pipe(Io(),ex(x=>bw(p,x)),hn,ze,Un(R)),yield*K(function*(){for(;;){const[x,N]=yield*fJ(m);yield*v.send(x),yield*ct(N,void 0),yield*dJ(m)}}).pipe(Un(R)),yield*v.closedDeferred,yield*Vt(R,Rt("channel-closed")),yield*mr(`Disconnected#${q}`),C.isConnected=!1,C.innerChannelRef.current=void 0}).pipe(vc,kc,ze,yt);const A=yield*uw.pipe(pr),D=E=>K(function*(){const v=yield*Le();C.pendingSends++,C.totalSends++,yield*lJ(m,[E,v]),yield*v,C.pendingSends--}).pipe(vc,xa(A)),y=Ui(p,{maxChunkSize:1}).pipe(jo(ae)),b=yield*Le().pipe(Ct(Mo(Wn)));return{webChannel:{[Sn]:Sn,send:D,listen:y,closedDeferred:b,supportsTransferables:!0,schema:e,debugInfo:C,shutdown:Vt(f,Rt("shutdown"))},initialEdgeDeferred:T}})),une=({queue:e,nodeName:t,newEdgeAvailablePubSub:n,sendPacket:r,target:s,channelName:o,schema:a})=>ca(u=>K(function*(){const f={current:{_tag:"Initial"}},h={kind:"proxy-channel",pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1},p=_r(5);yield*oy({channelIdCandidate:p});const m=yield*uw.pipe(pr),T=yield*XO(!1),C=K(function*(){return yield*Yk(T,L=>L!==!1)}),A=P=>K(function*(){yield*mr(`Connected (${P})`).pipe(xa(m)),f.current={_tag:"Established",listenSchema:a.listen,listenQueue:E,ackMap:v,combinedChannelId:P},yield*Nd(T,f.current),h.isConnected=!0}),D=$t(()=>r(tF.make({channelName:o,hops:[],source:t,target:s,channelIdCandidate:p}))),y=P=>[p,P].sort().join("_"),b=yield*Ln().pipe(Ct(qn)),_=({packet:P,respondToSender:L})=>K(function*(){const oe=`target:${P.source}, channelName:${P.channelName}`,J=f.current;switch(P._tag){case"ProxyChannelRequest":{const De=y(P.channelIdCandidate);J._tag==="Established"?J.combinedChannelId===De||(yield*Or(`[${t}] Received ProxyChannelRequest with different channel ID (${De}) while established with ${J.combinedChannelId}. Re-establishing.`),yield*Nd(T,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*mr("Reconnecting (received conflicting ProxyChannelRequest)").pipe(xa(m)),h.isConnected=!1,h.connectCounter++,yield*D):J._tag==="Initial"&&(yield*Nd(T,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*mr("Connecting (received ProxyChannelRequest)").pipe(xa(m)),h.isConnected=!1,h.connectCounter++),yield*L(nF.make({reqId:P.id,remainingHops:P.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:De,channelIdCandidate:p}));return}case"ProxyChannelResponseSuccess":{if(J._tag!=="Pending"){if(J._tag==="Established"&&J.combinedChannelId!==P.combinedChannelId)return Te(`ProxyChannel[${oe}]: Expected proxy channel to have the same combinedChannelId as the packet:
${J.combinedChannelId} (channel) === ${P.combinedChannelId} (packet)`);if(J._tag==="Established")return;yield*Or(`[${t}] Ignoring ResponseSuccess ${P.id} received in unexpected state ${J._tag}`);return}const De=y(P.channelIdCandidate);if(De!==P.combinedChannelId)return yield*Al(`ProxyChannel[${oe}]: Expected proxy channel to have the same combinedChannelId as the packet:
${De} (channel) === ${P.combinedChannelId} (packet)`);yield*A(P.combinedChannelId);const qe=f.current;if(qe._tag==="Established"){const nt=yield*Q8(b);for(const gt of nt){if(qe.combinedChannelId!==gt.combinedChannelId){yield*Or(`[${t}] Discarding buffered payload ${gt.id}: Combined channel ID mismatch during drain. Expected ${qe.combinedChannelId}, got ${gt.combinedChannelId}`);continue}const Mn=yield*jh(qe.listenSchema)(gt.payload);yield*qe.listenQueue.pipe(bt(Mn))}}else yield*Ol(`[${t}] State is not Established immediately after setStateToEstablished was called. Cannot drain buffer. State: ${qe._tag}`);return}case"ProxyChannelPayload":{if(J._tag==="Established"&&J.combinedChannelId!==P.combinedChannelId)return yield*Al(`ProxyChannel[${oe}]: Expected proxy channel to have the same combinedChannelId as the packet:
${J.combinedChannelId} (channel) === ${P.combinedChannelId} (packet)`);if(yield*L(sF.make({reqId:P.id,remainingHops:P.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:J._tag==="Established"?J.combinedChannelId:P.combinedChannelId})),J._tag==="Established"){const De=yield*jh(J.listenSchema)(P.payload);yield*J.listenQueue.pipe(bt(De))}else yield*bt(b,P);return}case"ProxyChannelPayloadAck":{if(J._tag!=="Established"){yield*mr(`Not yet connected to ${s}. dropping message`),yield*Or(`[${t}] Received Ack but not established (State: ${J._tag}). Dropping Ack for ${P.reqId}`);return}const De=J.ackMap.get(P.reqId)??Te(`[ProxyChannel[${oe}]] Expected ack for ${P.reqId}`);yield*ct(De,void 0),J.ackMap.delete(P.reqId);return}default:return ji(P)}}).pipe(Ne(`handleProxyPacket:${P._tag}:${P.source}->${P.target}`,{attributes:ol(P)}));yield*Ui(e).pipe(zn(_),hn,ze,yt);const E=yield*Ln();yield*mr("Connecting");const v=new Map;{if(f.current._tag!=="Initial")return Te("Expected proxy channel to be Initial");f.current={_tag:"Pending",initiatedVia:"outgoing-request"},yield*D;const P=yield*GO(n).pipe(zn(()=>D),hn,yt),{combinedChannelId:L}=yield*C;yield*er(P),yield*A(L)}const R=P=>K(function*(){const L=yield*Ww(a.send)(P),Q=yield*aO(),oe=yield*Le();h.pendingSends++,h.totalSends++;const J=K(function*(){const{combinedChannelId:qe}=yield*Yk(T,gt=>gt!==!1);yield*K(function*(){const gt=yield*Le(),Mn=rF.make({channelName:o,payload:L,hops:[],source:t,target:s,combinedChannelId:qe});v.set(Mn.id,gt),yield*r(Mn),yield*gt,yield*ct(oe,void 0),h.pendingSends--}).pipe(Ec(100),Cm(Aq(10)),pr)}).pipe(Xr(Ol)),De=yield*T.changes.pipe(zs(qe=>qe===!1),zn(()=>Uh(Q,J)),hn,sw);yield*Uh(Q,J),yield*oe,yield*er(De)}).pipe(vc,Ne("sendAckWithRetry:ProxyChannelPayload"),xa(m)),q=Ui(E).pipe(jo(ae)),x=yield*Le().pipe(Ct(Mo(Wn))),N=yield*ra();return{[Sn]:Sn,send:R,listen:q,closedDeferred:x,supportsTransferables:!1,schema:a,shutdown:Vt(u,Wn),debugInfo:h,debug:{ping:(P="ping")=>R(Bl.make({message:P})).pipe(bn(N),ze,ps)}}}).pipe(lw("makeProxyChannel")));class Nv{values=new Map;timeoutHandle;timeoutMs;constructor({timeout:t}){this.timeoutMs=nc(t)}static make=t=>K(function*(){const n=new Nv({timeout:t});return yield*yn(()=>me(()=>n.onShutdown())),n});add(t){this.values.set(t,Date.now()),this.scheduleCleanup()}has(t){return this.values.has(t)}delete(t){this.values.delete(t)}scheduleCleanup(){this.timeoutHandle===void 0&&(this.timeoutHandle=setTimeout(()=>{this.cleanup(),this.timeoutHandle=void 0},this.timeoutMs))}cleanup(){const t=Date.now();for(const[n,r]of this.values.entries())t-r>=this.timeoutMs&&this.values.delete(n)}onShutdown=()=>clearTimeout(this.timeoutHandle)}const lne=e=>K(function*(){const t=new Map,n=yield*Nv.make(OI(1)),r=yield*NA().pipe(Ct(ay)),s=new Map,o=yield*Ln().pipe(Ct(qn)),a=new Map,u=new Map,f=v=>{if(v._tag==="DirectChannelRequest"&&(t.size===0||t.get(v.target)?.channel.supportsTransferables===!1)||![...t.values()].some(R=>R.channel.supportsTransferables===!0))return Pv.make({reqId:v.id,channelName:v.channelName,source:v.target,target:v.source,remainingHops:v.hops,hops:[]})},h=v=>K(function*(){if(at(Wy)(v)){yield*mr("NetworkEdgeAdded",{packet:v,nodeName:e}),yield*_w(r,v.target);const R=Array.from(t).filter(([q])=>q!==v.source).map(([q,x])=>x.channel);yield*fn(R,q=>q.send(v),{concurrency:"unbounded"});return}if(at(Bd)(v)){const R=Array.from(t).filter(([N])=>!v.hops.includes(N)).map(([N,j])=>j.channel),q={...v,hops:[...v.hops,e]};if(yield*fn(R,N=>N.send(q),{concurrency:"unbounded"}),v.source===e)return;const x=u.get(v.channelName);x!==void 0&&(yield*bt(x,v));return}if(at(Vy)(v)){if(v.source!==e){const x=v.hops.at(-1)??Te(`${e}: Expected hops for packet`,v),N=t.get(x).channel,j=Ky.make({reqId:v.id,source:v.source,target:v.target,remainingHops:v.hops.slice(0,-1),nodeName:e,edges:Array.from(t.keys())});yield*N.send(j)}const R=Array.from(t).filter(([x])=>!v.hops.includes(x)).map(([x,N])=>N.channel),q={...v,hops:[...v.hops,e]};yield*fn(R,x=>x.send(q),{concurrency:"unbounded"});return}if(at(Ky)(v)){if(v.source===e)a.get(v.reqId).set(v.nodeName,new Set(v.edges));else{const q=v.remainingHops.at(-1)??Te(`${e}: Expected remaining hops for packet`,v);yield*(t.get(q)?.channel??Te(`${e}: Expected edge channel (${q}) for packet`,v,"Available edges:",Array.from(t.keys()))).send({...v,remainingHops:v.remainingHops.slice(0,-1)})}return}if(t.has(v.target)){const R=t.get(v.target).channel,q=v.source===e?[]:[...v.hops,e];yield*oy({hasDirectEdge:!0}),yield*R.send({...v,hops:q})}else if(v.remainingHops!==void 0){const R=v.remainingHops.at(-1)??Te(`${e}: Expected remaining hops for packet`,v),q=t.get(R)?.channel;if(q===void 0){yield*Or(`${e}: Expected to find hop target ${R} in edges. Dropping packet.`,v);return}yield*q.send({...v,remainingHops:v.remainingHops.slice(0,-1),hops:[...v.hops,e]})}else{const R=v.source===e?[]:[...v.hops,e],q=Array.from(t).filter(([N])=>N!==v.source).map(([N,j])=>({name:N,channel:j.channel}));R.length===0&&q.length===0&&Ao&&(yield*Or(e,"no route found to",v.target,v._tag,"TODO handle better"));const x={...v,hops:R};yield*oy({edgesToForwardTo:q.map(({name:N})=>N)}),yield*fn(q,({channel:N})=>N.send(x),{concurrency:"unbounded"})}}).pipe(Ne(`sendPacket:${v._tag}:${v.source}${v.target}`,{attributes:ol(v)}),pr),p=({target:v,edgeChannel:R,replaceIfExists:q=!1})=>K(function*(){if(t.has(v))if(q)yield*m(v).pipe(pr);else return yield*new one({target:v});const x=yield*R.listen.pipe(Io(),zn(j=>K(function*(){const P=yield*jh(Dv)(j);if(!n.has(P.id))switch(n.add(P.id),P._tag){case"NetworkEdgeAdded":case"NetworkTopologyRequest":case"NetworkTopologyResponse":{yield*h(P);break}default:if(P.target===e){const L=`target:${P.source}, channelName:${P.channelName}`;if(!s.has(L)){const J=yield*Ln().pipe(Ct(qn));s.set(L,{queue:J,debugInfo:void 0})}const Q=s.get(L).queue,oe=J=>R.send(J).pipe(Ne(`respondToSender:${J._tag}:${J.source}${J.target}`,{attributes:ol(J)}),pr);at(oF)(P)?yield*bt(Q,{packet:P,respondToSender:oe}):at(Gy)(P)&&(yield*bt(Q,{packet:P,respondToSender:oe})),(P._tag==="ProxyChannelRequest"||P._tag==="DirectChannelRequest")&&(yield*bt(o,{channelName:P.channelName,source:P.source,mode:P._tag==="ProxyChannelRequest"?"proxy":"direct"}))}else{if(at(Gy)(P)){const L=f(P);if(L!==void 0)return yield*mr(`No transferable edges found for ${P.source}${P.target}`),yield*R.send(L).pipe(Ne(`sendNoTransferableResponse:${P.source}${P.target}`,{attributes:ol(L)}))}yield*h(P)}}})),hn,St,pr,ze,yt);t.set(v,{channel:R,listenFiber:x});const N=Wy.make({source:e,target:v});yield*h(N).pipe(pr)}).pipe(_o({"addEdge:target":v,nodeName:e}),Ne(`addEdge:${e}${v}`,{attributes:{supportsTransferables:R.supportsTransferables}})),m=v=>K(function*(){t.has(v)||(yield*new vm(`No edge found for ${v}`)),yield*er(t.get(v).listenFiber),t.delete(v)}),T=({target:v,channelName:R})=>me(()=>s.has(`target:${v}, channelName:${R}`)),C=({target:v,channelName:R,schema:q,mode:x,timeout:N=sh(1),closeExisting:j=!1})=>K(function*(){const P=Wf(q),L=`target:${v}, channelName:${R}`;if(s.has(L)){const oe=s.get(L).debugInfo?.channel;oe&&(j?(yield*oe.shutdown,s.delete(L)):Te(`Channel ${L} already exists`,oe))}if(s.has(L)===!1){const oe=yield*Ln().pipe(Ct(qn));s.set(L,{queue:oe,debugInfo:void 0})}const Q=s.get(L).queue;if(yield*yn(()=>me(()=>s.delete(L))),x==="direct"){const oe=yield*Ln().pipe(Ct(qn));yield*MA(Q,1,10).pipe(jn(qe=>bw(oe,qe)),kc,St,ze,yt);const{webChannel:J,initialEdgeDeferred:De}=yield*cne({nodeName:e,incomingPacketsQueue:oe,newEdgeAvailablePubSub:r,target:v,channelName:R,schema:P,sendPacket:h,checkTransferableEdges:f});return s.set(L,{queue:Q,debugInfo:{channel:J,target:v}}),yield*De,J}else{const oe=yield*une({nodeName:e,newEdgeAvailablePubSub:r,target:v,channelName:R,schema:P,queue:Q,sendPacket:h});return s.set(L,{queue:Q,debugInfo:{channel:oe,target:v}}),oe}}).pipe(lw(`makeChannel:${e}${v}(${R})`,{attributes:{target:v,channelName:R,mode:x,timeout:N}}),_o({nodeName:e,target:v,channelName:R}));let A=!1;const D=YO(()=>{if(A)return Te("listenForChannel already started");A=!0;const v=q=>`${q.channelName}:${q.source}:${q.mode}`,R=new Set;return Ui(o).pipe(zs(q=>{const x=v(q);return R.has(x)?!1:(R.add(x),!0)}))}),y=({channelName:v,schema:R})=>ca(q=>K(function*(){if(u.has(v))return Te(`Broadcast channel ${v} already exists`,u.get(v));const x={},N=yield*Ln().pipe(Ct(qn));u.set(v,N);const j=Q=>K(function*(){const oe=yield*Vw(R)(Q),J=Bd.make({channelName:v,payload:oe,source:e,target:"-",hops:[]});yield*h(J)}),P=Ui(N).pipe(zs(at(Bd)),jo(Q=>hu(R)(Q.payload))),L=yield*Le().pipe(Ct(Mo(Wn)));return{[Sn]:Sn,send:j,listen:P,closedDeferred:L,supportsTransferables:!1,schema:{listen:R,send:R},shutdown:Vt(q,Wn),debugInfo:x}})),b=me(()=>new Set(t.keys())),_=yield*ra();return{nodeName:e,addEdge:p,removeEdge:m,hasChannel:T,makeChannel:C,listenForChannel:D,makeBroadcastChannel:y,edgeKeys:b,debug:{print:()=>{console.log("Webmesh debug info for node:",e),console.log("Edges:",t.size);for(const[v,R]of t)console.log(`  ${v}: supportsTransferables=${R.channel.supportsTransferables}`);console.log("Channels:",s.size);for(const[v,R]of s)console.log(md(v,2),`
`,Object.entries({target:R.debugInfo?.target,supportsTransferables:R.debugInfo?.channel.supportsTransferables,...R.debugInfo?.channel.debugInfo}).map(([q,x])=>md(`${q}=${x}`,4)).join(`
`),"    ",R.debugInfo?.channel,`
`,md(`Queue: ${R.queue.unsafeSize().pipe(dr)}`,4),R.queue);console.log("Broadcast channels:",u.size);for(const[v,R]of u)console.log(md(v,2))},ping:v=>{K(function*(){const R=q=>Bl.make({message:`ping from ${e} via ${q}`,payload:v});for(const[q,x]of t)yield*An(`sending ping via edge ${q}`),yield*x.channel.send(R(`edge ${q}`));for(const[q,x]of s){if(x.debugInfo===void 0){yield*An(`channel ${q} has no debug info`);continue}yield*An(`sending ping via channel ${q}`),yield*x.debugInfo.channel.send(R(`channel ${q}`))}}).pipe(bn(_),ze,ps)},requestTopology:(v=1e3)=>K(function*(){const R=Vy.make({source:e,target:"-",hops:[]}),q=new Map;q.set(e,new Set(t.keys())),a.set(R.id,q),yield*h(R),yield*An(`Waiting ${v}ms for topology response`),yield*ow(v),yield*An(`Topology response (from ${e}):`);for(const[x,N]of q)yield*An(`  node '${x}' has edge to: ${Array.from(N.values()).join(", ")}`)}).pipe(bn(_),ze,Ff)}}}).pipe(Ne(`makeMeshNode:${e}`),_o({"makeMeshNode.nodeName":e})),fne=({storeId:e,clientId:t,sessionId:n,isLeader:r,devtoolsEnabled:s,connectDevtoolsToStore:o,lockStatus:a,leaderThread:u,schema:f,sqliteDb:h,shutdown:p,connectWebmeshNode:m,webmeshMode:T,registerBeforeUnload:C,debugInstanceId:A})=>K(function*(){const D=s?{enabled:!0,pullLatch:yield*J0(!0),pushLatch:yield*J0(!0)}:{enabled:!1};return s&&(yield*K(function*(){const y=yield*lne(tne.client.session({storeId:e,clientId:t,sessionId:n}));globalThis.__debugWebmeshNode=y;const b=f.devtools.alias,_=Mx.make({storeId:e,clientId:t,sessionId:n,schemaAlias:b,isLeader:r});yield*m({webmeshNode:y,sessionInfo:_});const E=yield*rne(y);yield*Ux({webChannel:E,sessionInfo:_}).pipe(ze,yt),yield*y.listenForChannel.pipe(zs(v=>nne.devtoolsClientSession(v.channelName,{storeId:e,clientId:t,sessionId:n})&&v.mode===T),zn(RK(function*({channelName:v,source:R}){const q=yield*y.makeChannel({target:R,channelName:v,schema:{listen:$te,send:Rte},mode:T}),x=q.send(Ov.make({clientId:t,liveStoreVersion:In,sessionId:n})).pipe(pr);yield*yn(()=>x),yield*Ct(me(()=>C(()=>x.pipe(ps))),N=>me(()=>N())),yield*o(q)},ze,yt)),hn)}).pipe(Ne("@livestore/common:make-client-session:devtools"),ze,yt)),{sqliteDb:h,leaderThread:u,devtools:D,lockStatus:a,clientId:t,sessionId:n,shutdown:p,debugInstanceId:A}}),te=0,dne=1,Vl=10,Mv=12,Qf=14,Zs=21,e_=25,hne=27,Qy=100,pne=101,ag=522,iF=778,qT=2,cp=4,up=8,aF=64,cF=256,uF=2048,lF=16384,fF=524288,mne=2048,OT=1,xT=2,FT=3,PT=4,DT=5,gne=512;class dF{name;mxPathname=64;_module;constructor(t,n){this.name=t,this._module=n}close(){}isReady(){return!0}hasAsyncMethod(t){return!1}xOpen(t,n,r,s,o){return Qf}xDelete(t,n,r){return te}xAccess(t,n,r,s){return te}xFullPathname(t,n,r,s){return te}xGetLastError(t,n,r){return te}xClose(t){return te}xRead(t,n,r,s,o){return te}xWrite(t,n,r,s,o){return te}xTruncate(t,n,r){return te}xSync(t,n){return te}xFileSize(t,n){return te}xLock(t,n){return te}xUnlock(t,n){return te}xCheckReservedLock(t,n){return te}xFileControl(t,n,r){return Mv}xSectorSize(t){return gne}xDeviceCharacteristics(t){return 0}}const _ne=Object.getPrototypeOf(async function(){}).constructor;let yne=class extends dF{constructor(t,n){super(t,n)}hasAsyncMethod(t){const n=`j${t.slice(1)}`;return this[n]instanceof _ne}getFilename(t){throw new Error("unimplemented")}jOpen(t,n,r,s){return Qf}jDelete(t,n){return te}jAccess(t,n,r){return te}jFullPathname(t,n){const{read:r,written:s}=new TextEncoder().encodeInto(t,n);return r<t.length||s>=n.length?Vl:(n[s]=0,te)}jGetLastError(t){return te}jClose(t){return te}jRead(t,n,r){return n.fill(0),ag}jWrite(t,n,r){return iF}jTruncate(t,n){return te}jSync(t,n){return te}jFileSize(t,n){return te}jLock(t,n){return te}jUnlock(t,n){return te}jCheckReservedLock(t,n){return n.setInt32(0,0,!0),te}jFileControl(t,n,r){return Mv}jSectorSize(t){return super.xSectorSize(t)}jDeviceCharacteristics(t){return 0}xOpen(t,n,r,s,o){const a=this.#n(n,s),u=this.#e("Int32",o);return this.log?.("jOpen",a,r,"0x"+s.toString(16)),this.jOpen(a,r,s,u)}xDelete(t,n,r){const s=this._module.UTF8ToString(n);return this.log?.("jDelete",s,r),this.jDelete(s,r)}xAccess(t,n,r,s){const o=this._module.UTF8ToString(n),a=this.#e("Int32",s);return this.log?.("jAccess",o,r),this.jAccess(o,r,a)}xFullPathname(t,n,r,s){const o=this._module.UTF8ToString(n),a=this._module.HEAPU8.subarray(s,s+r);return this.log?.("jFullPathname",o,r),this.jFullPathname(o,a)}xGetLastError(t,n,r){const s=this._module.HEAPU8.subarray(r,r+n);return this.log?.("jGetLastError",n),this.jGetLastError(s)}xClose(t){return this.log?.("jClose",t),this.jClose(t)}xRead(t,n,r,s,o){const a=this.#t(n,r),u=t_(s,o);return this.log?.("jRead",t,r,u),this.jRead(t,a,u)}xWrite(t,n,r,s,o){const a=this.#t(n,r),u=t_(s,o);return this.log?.("jWrite",t,a,u),this.jWrite(t,a,u)}xTruncate(t,n,r){const s=t_(n,r);return this.log?.("jTruncate",t,s),this.jTruncate(t,s)}xSync(t,n){return this.log?.("jSync",t,n),this.jSync(t,n)}xFileSize(t,n){const r=this.#e("BigInt64",n);return this.log?.("jFileSize",t),this.jFileSize(t,r)}xLock(t,n){return this.log?.("jLock",t,n),this.jLock(t,n)}xUnlock(t,n){return this.log?.("jUnlock",t,n),this.jUnlock(t,n)}xCheckReservedLock(t,n){const r=this.#e("Int32",n);return this.log?.("jCheckReservedLock",t),this.jCheckReservedLock(t,r)}xFileControl(t,n,r){const s=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r);return this.log?.("jFileControl",t,n,s),this.jFileControl(t,n,s)}xSectorSize(t){return this.log?.("jSectorSize",t),this.jSectorSize(t)}xDeviceCharacteristics(t){return this.log?.("jDeviceCharacteristics",t),this.jDeviceCharacteristics(t)}#e(t,n){const r=t==="Int32"?4:8,s=`get${t}`,o=`set${t}`,a=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+n,r);let u=a();return new Proxy(u,{get(f,h){if(u.buffer.byteLength===0&&(u=a()),h===s)return function(m,T){if(!T)throw new Error("must be little endian");return u[h](m,T)};if(h===o)return function(m,T,C){if(!C)throw new Error("must be little endian");return u[h](m,T,C)};if(typeof h=="string"&&h.match(/^(get)|(set)/))throw new Error("invalid type");const p=u[h];return typeof p=="function"?p.bind(u):p}})}#t(t,n){let r=this._module.HEAPU8.subarray(t,t+n);return new Proxy(r,{get:(s,o,a)=>{r.buffer.byteLength===0&&(r=this._module.HEAPU8.subarray(t,t+n));const u=r[o];return typeof u=="function"?u.bind(r):u}})}#n(t,n){if(n&aF){let r=t,s=1;const o=[];for(;s;){const a=this._module.HEAPU8[r++];if(a)o.push(a);else switch(this._module.HEAPU8[r]||(s=null),s){case 1:o.push(63),s=2;break;case 2:o.push(61),s=3;break;case 3:o.push(38),s=2;break}}return new TextDecoder().decode(new Uint8Array(o))}return t?this._module.UTF8ToString(t):null}};function t_(e,t){return t*4294967296+e+(e<0?2**32:0)}class Lv extends yne{mapNameToFile=new Map;mapIdToFile=new Map;static async create(t,n){const r=new Lv(t,n);return await r.isReady(),r}constructor(t,n){super(t,n)}close(){for(const t of this.mapIdToFile.keys())this.jClose(t)}jOpen(t,n,r,s){const a=new URL(t||Math.random().toString(36).slice(2),"file://").pathname;let u=this.mapNameToFile.get(a);if(!u)if(r&cp)u={pathname:a,flags:r,size:0,data:new ArrayBuffer(0)},this.mapNameToFile.set(a,u);else return Qf;return this.mapIdToFile.set(n,u),s.setInt32(0,r,!0),te}jClose(t){const n=this.mapIdToFile.get(t);return this.mapIdToFile.delete(t),n.flags&up&&this.mapNameToFile.delete(n.pathname),te}jRead(t,n,r){const s=this.mapIdToFile.get(t),o=Math.min(r,s.size),u=Math.min(r+n.byteLength,s.size)-o;return u&&n.set(new Uint8Array(s.data,o,u)),u<n.byteLength?(n.fill(0,u),ag):te}jWrite(t,n,r){const s=this.mapIdToFile.get(t);if(r+n.byteLength>s.data.byteLength){const o=Math.max(r+n.byteLength,2*s.data.byteLength),a=new ArrayBuffer(o);new Uint8Array(a).set(new Uint8Array(s.data,0,s.size)),s.data=a}return new Uint8Array(s.data,r,n.byteLength).set(n),s.size=Math.max(s.size,r+n.byteLength),te}jTruncate(t,n){const r=this.mapIdToFile.get(t);return r.size=Math.min(r.size,n),te}jFileSize(t,n){const r=this.mapIdToFile.get(t);return n.setBigInt64(0,BigInt(r.size),!0),te}jDelete(t,n){const s=new URL(t,"file://").pathname;return this.mapNameToFile.delete(s),te}jAccess(t,n,r){const o=new URL(t,"file://").pathname,a=this.mapNameToFile.get(o);return r.setInt32(0,a?1:0,!0),te}}let NT;const hF=e=>{if(e.vfs_registered.has("memory-vfs")===!1){const r=new Lv("memory-vfs",e.module);e.vfs_register(r,!1),NT=r}return{dbPointer:e.open_v2Sync(":memory:",void 0,"memory-vfs"),vfs:NT}},MT=({sqlite3:e,metadata:t})=>{const n=[],{dbPointer:r}=t;let s=!1;const o={_tag:"SqliteDb",metadata:t,prepare:a=>{try{const u=e.statements(r,a.trim(),{unscoped:!0});let f=!1;const h={execute:(p,m)=>{for(const T of u){p!==void 0&&Object.keys(p).length>0&&e.bind_collection(T,p);try{e.step(T)}finally{m?.onRowsChanged&&m.onRowsChanged(e.changes(r)),e.reset(T)}}},select:p=>{if(u.length!==1)throw new zu({query:{bindValues:p,sql:a},code:-1,cause:"Expected only one statement when using `select`"});const m=u[0];p!==void 0&&Object.keys(p).length>0&&e.bind_collection(m,p);const T=[];try{let C;try{C=e.column_names(m)}catch{}for(;e.step(m)===Qy;)if(C!==void 0){const A={};for(let D=0;D<C.length;D++)A[C[D]]=e.column(m,D);T.push(A)}}catch(C){throw new zu({query:{bindValues:p,sql:a},code:C.code,cause:C})}finally{e.reset(m)}return T},finalize:()=>{if(!f){f=!0;for(const p of u)e.finalize(p)}},sql:a};return n.push(h),h}catch(u){throw new zu({query:{sql:a,bindValues:{}},code:u.code,cause:u})}},export:()=>e.serialize(r,"main"),execute:(a,u,f)=>{const h=o.prepare(a);h.execute(u,f),h.finalize()},select:(a,u)=>{const f=o.prepare(a),h=f.select(u);return f.finalize(),h},destroy:()=>{o.close(),t.deleteDb()},close:()=>{if(!s){for(const a of n)a.finalize();e.close(r),s=!0}},import:a=>{if(a instanceof Uint8Array){const h=hF(e);e.deserialize(h.dbPointer,"main",a,a.length,a.length,3),e.backup(r,"main",h.dbPointer,"main"),e.close(h.dbPointer)}else e.backup(r,"main",a.metadata.dbPointer,"main");t.configureDb(o)},session:()=>{const a=e.session_create(r,"main");return e.session_attach(a,null),{changeset:()=>e.session_changeset(a).changeset??void 0,finish:()=>{e.session_delete(a)}}},makeChangeset:a=>({invert:()=>{const f=e.changeset_invert(a);return o.makeChangeset(f)},apply:()=>{try{e.changeset_apply(r,a),a=void 0}catch(f){throw new zu({code:f.code??-1,cause:f,note:"Failed calling makeChangeset.apply"})}}})};return t.configureDb(o),o},bne=Object.getPrototypeOf(async()=>{}).constructor;class Sne extends dF{constructor(t,n){super(t,n)}hasAsyncMethod(t){const n=`j${t.slice(1)}`;return this[n]instanceof bne}getFilename(t){throw new Error("unimplemented")}jOpen(t,n,r,s){return Qf}jDelete(t,n){return te}jAccess(t,n,r){return te}jFullPathname(t,n){const{read:r,written:s}=new TextEncoder().encodeInto(t,n);return r<t.length||s>=n.length?Vl:(n[s]=0,te)}jGetLastError(t){return te}jClose(t){return te}jRead(t,n,r){return n.fill(0),ag}jWrite(t,n,r){return iF}jTruncate(t,n){return te}jSync(t,n){return te}jFileSize(t,n){return te}jLock(t,n){return te}jUnlock(t,n){return te}jCheckReservedLock(t,n){return n.setInt32(0,0,!0),te}jFileControl(t,n,r){return Mv}jSectorSize(t){return super.xSectorSize(t)}jDeviceCharacteristics(t){return 0}xOpen(t,n,r,s,o){const a=this.#n(n,s),u=this.#e("Int32",o);return this.log?.("jOpen",a,r,"0x"+s.toString(16)),this.jOpen(a,r,s,u)}xDelete(t,n,r){const s=this._module.UTF8ToString(n);return this.log?.("jDelete",s,r),this.jDelete(s,r)}xAccess(t,n,r,s){const o=this._module.UTF8ToString(n),a=this.#e("Int32",s);return this.log?.("jAccess",o,r),this.jAccess(o,r,a)}xFullPathname(t,n,r,s){const o=this._module.UTF8ToString(n),a=this._module.HEAPU8.subarray(s,s+r);return this.log?.("jFullPathname",o,r),this.jFullPathname(o,a)}xGetLastError(t,n,r){const s=this._module.HEAPU8.subarray(r,r+n);return this.log?.("jGetLastError",n),this.jGetLastError(s)}xClose(t){return this.log?.("jClose",t),this.jClose(t)}xRead(t,n,r,s,o){const a=this.#t(n,r),u=n_(s,o);return this.log?.("jRead",t,r,u),this.jRead(t,a,u)}xWrite(t,n,r,s,o){const a=this.#t(n,r),u=n_(s,o);return this.log?.("jWrite",t,a,u),this.jWrite(t,a,u)}xTruncate(t,n,r){const s=n_(n,r);return this.log?.("jTruncate",t,s),this.jTruncate(t,s)}xSync(t,n){return this.log?.("jSync",t,n),this.jSync(t,n)}xFileSize(t,n){const r=this.#e("BigInt64",n);return this.log?.("jFileSize",t),this.jFileSize(t,r)}xLock(t,n){return this.log?.("jLock",t,n),this.jLock(t,n)}xUnlock(t,n){return this.log?.("jUnlock",t,n),this.jUnlock(t,n)}xCheckReservedLock(t,n){const r=this.#e("Int32",n);return this.log?.("jCheckReservedLock",t),this.jCheckReservedLock(t,r)}xFileControl(t,n,r){const s=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r);return this.log?.("jFileControl",t,n,s),this.jFileControl(t,n,s)}xSectorSize(t){return this.log?.("jSectorSize",t),this.jSectorSize(t)}xDeviceCharacteristics(t){return this.log?.("jDeviceCharacteristics",t),this.jDeviceCharacteristics(t)}#e(t,n){const r=t==="Int32"?4:8,s=`get${t}`,o=`set${t}`,a=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+n,r);let u=a();return new Proxy(u,{get(f,h){if(u.buffer.byteLength===0&&(u=a()),h===s)return function(m,T){if(!T)throw new Error("must be little endian");return u[h](m,T)};if(h===o)return function(m,T,C){if(!C)throw new Error("must be little endian");return u[h](m,T,C)};if(typeof h=="string"&&/^(get)|(set)/.test(h))throw new Error("invalid type");const p=u[h];return typeof p=="function"?p.bind(u):p}})}#t(t,n){let r=this._module.HEAPU8.subarray(t,t+n);return new Proxy(r,{get:(s,o,a)=>{r.buffer.byteLength===0&&(r=this._module.HEAPU8.subarray(t,t+n));const u=r[o];return typeof u=="function"?u.bind(r):u}})}#n(t,n){if(n&aF){let r=t,s=1;const o=[];for(;s;){const a=this._module.HEAPU8[r++];if(a)o.push(a);else switch(this._module.HEAPU8[r]||(s=null),s){case 1:{o.push(63),s=2;break}case 2:{o.push(61),s=3;break}case 3:{o.push(38),s=2;break}}}return new TextDecoder().decode(new Uint8Array(o))}return t?this._module.UTF8ToString(t):null}}function n_(e,t){return t*4294967296+e+(e<0?2**32:0)}const pF=4096,Uv=512,wne=4,vne=8,Jy=Uv+wne,LT=Uv,UT=Jy,Qo=pF,Ene=cF|uF|lF|fF,kne=6;class jv extends Sne{log=null;#e;#t;#n=new Map;#r=new Map;#o=new Set;#s=new Map;static async create(t,n,r){const s=new jv(t,n,r);return await s.isReady(),s}constructor(t,n,r){super(t,r),this.#e=n}getOpfsFileName(t){const n=this.#a(t),r=this.#r.get(n);return this.#n.get(r)}resetAccessHandle(t){const n=this.#a(t);this.#r.get(n).truncate(Qo)}jOpen(t,n,r,s){try{const o=t?this.#a(t):Math.random().toString(36);let a=this.#r.get(o);if(!a&&r&cp)if(this.getSize()<this.getCapacity())[a]=this.#o.keys(),this.#i(a,o,r);else throw new Error("cannot create file");if(!a)throw new Error("file not found");const u={path:o,flags:r,accessHandle:a};return this.#s.set(n,u),s.setInt32(0,r,!0),te}catch(o){return console.error(o.message),Qf}}jClose(t){const n=this.#s.get(t);return n&&(n.accessHandle.flush(),this.#s.delete(t),n.flags&up&&this.#u(n.path)),te}jRead(t,n,r){const o=this.#s.get(t).accessHandle.read(n.subarray(),{at:Qo+r});return o<n.byteLength?(n.fill(0,o,n.byteLength),ag):te}jWrite(t,n,r){return this.#s.get(t).accessHandle.write(n.subarray(),{at:Qo+r})===n.byteLength?te:Vl}jTruncate(t,n){return this.#s.get(t).accessHandle.truncate(Qo+n),te}jSync(t,n){return this.#s.get(t).accessHandle.flush(),te}jFileSize(t,n){const s=this.#s.get(t).accessHandle.getSize()-Qo;return n.setBigInt64(0,BigInt(s),!0),te}jSectorSize(t){return pF}jDeviceCharacteristics(t){return mne}jAccess(t,n,r){const s=this.#a(t);return r.setInt32(0,this.#r.has(s)?1:0,!0),te}jDelete(t,n){const r=this.#a(t);return this.#u(r),te}async close(){this.#f()}async isReady(){if(!this.#t){let t=await navigator.storage.getDirectory();for(const n of this.#e.split("/"))n&&(t=await t.getDirectoryHandle(n,{create:!0}));this.#t=t,await this.#l(),this.getCapacity()===0&&await this.addCapacity(kne)}return!0}getSize(){return this.#r.size}getCapacity(){return this.#n.size}async addCapacity(t){for(let n=0;n<t;++n){const r=Math.random().toString(36).replace("0.",""),o=await(await this.#t.getFileHandle(r,{create:!0})).createSyncAccessHandle();this.#n.set(o,r),this.#i(o,"",0)}return t}async removeCapacity(t){let n=0;for(const r of Array.from(this.#o)){if(n==t||this.getSize()===this.getCapacity())return n;const s=this.#n.get(r);r.close(),await this.#t.removeEntry(s),this.#n.delete(r),this.#o.delete(r),++n}return n}async#l(){const t=[];for await(const[n,r]of this.#t)r.kind==="file"&&t.push([n,r]);await Promise.all(t.map(async([n,r])=>{const s=await r.createSyncAccessHandle();this.#n.set(s,n);const o=this.#d(s);o?this.#r.set(o,s):this.#o.add(s)}))}#f(){for(const t of this.#n.keys())t.close();this.#n.clear(),this.#r.clear(),this.#o.clear()}#d(t){const n=new Uint8Array(Jy);t.read(n,{at:0});const s=new DataView(n.buffer,n.byteOffset).getUint32(LT);if(n[0]&&(s&up||(s&Ene)===0))return console.warn(`Remove file with unexpected flags ${s.toString(16)}`),this.#i(t,"",0),"";const o=new Uint32Array(vne/4);t.read(o,{at:UT});const a=this.#c(n);if(o.every((u,f)=>u===a[f])){const u=n.indexOf(0);return u===0&&t.truncate(Qo),new TextDecoder().decode(n.subarray(0,u))}else return console.warn("Disassociating file with bad digest."),this.#i(t,"",0),""}#i(t,n,r){const s=new Uint8Array(Jy);if(new TextEncoder().encodeInto(n,s).written>=Uv)throw new Error("path too long");new DataView(s.buffer,s.byteOffset).setUint32(LT,r);const u=this.#c(s);t.write(s,{at:0}),t.write(u,{at:UT}),t.flush(),n?(this.#r.set(n,t),this.#o.delete(t)):(t.truncate(Qo),this.#o.add(t))}#c(t){if(!t[0])return new Uint32Array([4274806656,2899230775]);let n=3735928559,r=1103547991;for(const s of t)n=Math.imul(n^s,2654435761),r=Math.imul(r^s,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),new Uint32Array([n>>>0,r>>>0])}#a(t){return(typeof t=="string"?new URL(t,"file://localhost/"):t).pathname}#u(t){const n=this.#r.get(t);n&&(this.#r.delete(t),this.#i(n,"",0))}}const Tne=$m(1).pipe(fr),jT=new Map,Cne=({sqlite3:e,directory:t,fileName:n})=>K(function*(){const r=t.replaceAll(/["*/:<>?\\|]/g,"_"),o=`opfs${r.length===0?"":`-${r}`}`;if(e.vfs_registered.has(o)===!1){const f=yield*Mi(()=>jv.create(o,t,e.module));e.vfs_register(f,!1),jT.set(o,f)}const a=e.open_v2Sync(n,void 0,o),u=jT.get(o);return{dbPointer:a,vfs:u}}).pipe(Tne.withPermits(1)),Ine=4096,mF=512,$ne=4,Rne=8,gF=mF+$ne,Ane=mF,zT=gF,qne=Ine,One=cF|uF|lF|fF,xne=new TextDecoder,Fne=async e=>{const t=new Uint8Array(await e.slice(0,gF).arrayBuffer()),r=new DataView(t.buffer,t.byteOffset).getUint32(Ane);if(t[0]&&(r&up||(r&One)===0))return console.warn(`Remove file with unexpected flags ${r.toString(16)}`),"";const s=new Uint32Array(await e.slice(zT,zT+Rne).arrayBuffer()),o=Pne(t);if(s.every((a,u)=>a===o[u])){const a=t.indexOf(0);return xne.decode(t.subarray(0,a))}else return console.warn("Disassociating file with bad digest."),""},Pne=e=>{if(!e[0])return new Uint32Array([4274806656,2899230775]);let t=3735928559,n=1103547991;for(const r of e)t=Math.imul(t^r,2654435761),n=Math.imul(n^r,1597334677);return t=Math.imul(t^t>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(t^t>>>13,3266489909),new Uint32Array([t>>>0,n>>>0])},Dne=({sqlite3:e})=>t=>K(function*(){if(t._tag==="in-memory"){const{dbPointer:a,vfs:u}=hF(e);return MT({sqlite3:e,metadata:{_tag:"in-memory",vfs:u,dbPointer:a,deleteDb:()=>{},configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:":memory:"}}})}const n=60;let r=t.fileName;t.fileName.length>n&&(yield*Or(`dbFilename too long: '${t.fileName}'. Max ${n} chars, got ${t.fileName.length}. Hashing...`),r=`hash-${Pt(t.fileName)}.db`);const{dbPointer:s,vfs:o}=yield*Cne({sqlite3:e,directory:t.opfsDirectory,fileName:r});return MT({sqlite3:e,metadata:{_tag:"opfs",vfs:o,dbPointer:s,deleteDb:()=>o.resetAccessHandle(t.fileName),configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:r,opfsDirectory:t.opfsDirectory,opfsFileName:o.getOpfsFileName(r)}}})}),BT=0x7fffffffffffffffn,HT=-0x8000000000000000n;class ir extends Error{constructor(t,n){super(t),this.code=n}}const va=!1;function Nne(e){const t={};e.retryOps=[];const n=e._getSqliteFree(),r=e._malloc(8),s=[r,r+4];function o(y){if(typeof y!="string")return 0;const b=new TextEncoder().encode(y),_=e._sqlite3_malloc(b.byteLength+1);return e.HEAPU8.set(b,_),e.HEAPU8[_+b.byteLength]=0,_}function a(y,b){return BigInt(b)<<32n|BigInt(y)&0xffffffffn}const u=function(){const y=BigInt(Number.MAX_SAFE_INTEGER)>>32n,b=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(_,E){return E>y||E<b?a(_,E):E*4294967296+(_&2147483647)-(_&2147483648)}}(),f=new Set;function h(y){if(!f.has(y))throw new ir("not a database",Zs)}const p=new Map;function m(y){if(!p.has(y))throw new ir("not a statement",Zs)}t.bind_collection=function(y,b){m(y);const _=Array.isArray(b),E=t.bind_parameter_count(y);for(let v=1;v<=E;++v){const R=_?v-1:t.bind_parameter_name(y,v),q=b[R];q!==void 0&&t.bind(y,v,q)}return te},t.bind=function(y,b,_){switch(m(y),typeof _){case"number":return _===(_|0)?t.bind_int(y,b,_):t.bind_double(y,b,_);case"string":return t.bind_text(y,b,_);default:return _ instanceof Uint8Array||Array.isArray(_)?t.bind_blob(y,b,_):_===null?t.bind_null(y,b):typeof _=="bigint"?t.bind_int64(y,b,_):_===void 0?hne:(console.warn("unknown binding converted to null",_),t.bind_null(y,b))}},t.bind_blob=function(){const y="sqlite3_bind_blob",b=e.cwrap(y,...re("nnnnn:n"));return function(_,E,v){m(_);const R=v.byteLength??v.length,q=e._sqlite3_malloc(R);e.HEAPU8.subarray(q).set(v);const x=b(_,E,q,R,n);return A(y,x,p.get(_))}}(),t.bind_parameter_count=function(){const b=e.cwrap("sqlite3_bind_parameter_count",...re("n:n"));return function(_){return m(_),b(_)}}(),t.bind_double=function(){const y="sqlite3_bind_double",b=e.cwrap(y,...re("nnn:n"));return function(_,E,v){m(_);const R=b(_,E,v);return A(y,R,p.get(_))}}(),t.bind_int=function(){const y="sqlite3_bind_int",b=e.cwrap(y,...re("nnn:n"));return function(_,E,v){if(m(_),v>2147483647||v<-2147483648)return e_;const R=b(_,E,v);return A(y,R,p.get(_))}}(),t.bind_int64=function(){const y="sqlite3_bind_int64",b=e.cwrap(y,...re("nnnn:n"));return function(_,E,v){if(m(_),v>BT||v<HT)return e_;const R=v&0xffffffffn,q=v>>32n,x=b(_,E,Number(R),Number(q));return A(y,x,p.get(_))}}(),t.bind_null=function(){const y="sqlite3_bind_null",b=e.cwrap(y,...re("nn:n"));return function(_,E){m(_);const v=b(_,E);return A(y,v,p.get(_))}}(),t.bind_parameter_name=function(){const b=e.cwrap("sqlite3_bind_parameter_name",...re("n:s"));return function(_,E){return m(_),b(_,E)}}(),t.bind_text=function(){const y="sqlite3_bind_text",b=e.cwrap(y,...re("nnnnn:n"));return function(_,E,v){m(_);const R=o(v),q=b(_,E,R,-1,n);return A(y,q,p.get(_))}}(),t.changes=function(){const b=e.cwrap("sqlite3_changes",...re("n:n"));return function(_){return h(_),b(_)}}(),t.deserialize=function(){const b=e.cwrap("sqlite3_deserialize",...re("nnnnnn:n"));return function(_,E,v,R,q,x){h(_);const N=e._sqlite3_malloc(R);return e.HEAPU8.subarray(N).set(v),b(_,E,N,R,q,x)}}();const T=1;t.serialize=function(){const b=e.cwrap("sqlite3_serialize",...re("nsnn:n"));return function(_,E){h(_);const v=s[0];let R=b(_,E,v,0);if(R===0){R=b(_,E,v,T);const q=e.getValue(v,"*"),x=e.HEAPU8.subarray(R,R+q);return new Uint8Array(x.slice())}else{const q=e.getValue(v,"*"),x=e.HEAPU8.subarray(R,R+q);return new Uint8Array(x)}}}(),t.backup=function(){const y=e.cwrap("sqlite3_backup_init",...re("nsns:n")),b=e.cwrap("sqlite3_backup_step",...re("nn:n")),_=e.cwrap("sqlite3_backup_finish",...re("n:n"));return function(E,v,R,q){h(E),h(R);const x=y(E,v,R,q);if(x===0){const N=e.ccall("sqlite3_errmsg","string",["number"],[E]);throw new ir(`backup failed: ${N}`,dne)}return b(x,-1),_(x)}}(),t.clear_bindings=function(){const y="sqlite3_clear_bindings",b=e.cwrap(y,...re("n:n"));return function(_){m(_);const E=b(_);return A(y,E,p.get(_))}}(),t.close=function(){const y="sqlite3_close",b=e.cwrap(y,...re("n:n"),{async:va});return function(_){h(_);const E=b(_);return f.delete(_),A(y,E,_)}}(),t.column=function(y,b){m(y);const _=t.column_type(y,b);switch(_){case PT:return t.column_blob(y,b);case xT:return t.column_double(y,b);case OT:const E=t.column_int(y,b),v=e.getTempRet0();return u(E,v);case DT:return null;case FT:return t.column_text(y,b);default:throw new ir("unknown type",_)}},t.column_blob=function(){const b=e.cwrap("sqlite3_column_blob",...re("nn:n"));return function(_,E){m(_);const v=t.column_bytes(_,E),R=b(_,E);if(R===0)return null;const q=e.HEAPU8.subarray(R,R+v);return new Uint8Array(q)}}(),t.column_bytes=function(){const b=e.cwrap("sqlite3_column_bytes",...re("nn:n"));return function(_,E){return m(_),b(_,E)}}(),t.column_count=function(){const b=e.cwrap("sqlite3_column_count",...re("n:n"));return function(_){return m(_),b(_)}}(),t.column_double=function(){const b=e.cwrap("sqlite3_column_double",...re("nn:n"));return function(_,E){return m(_),b(_,E)}}(),t.column_int=function(){const b=e.cwrap("sqlite3_column_int64",...re("nn:n"));return function(_,E){return m(_),b(_,E)}}(),t.column_int64=function(){const b=e.cwrap("sqlite3_column_int64",...re("nn:n"));return function(_,E){m(_);const v=b(_,E),R=e.getTempRet0();return a(v,R)}}(),t.column_name=function(){const b=e.cwrap("sqlite3_column_name",...re("nn:s"));return function(_,E){return m(_),b(_,E)}}(),t.column_names=function(y){const b=[],_=t.column_count(y);for(let E=0;E<_;++E)b.push(t.column_name(y,E));return b},t.column_text=function(){const b=e.cwrap("sqlite3_column_text",...re("nn:s"));return function(_,E){return m(_),b(_,E)}}(),t.column_type=function(){const b=e.cwrap("sqlite3_column_type",...re("nn:n"));return function(_,E){return m(_),b(_,E)}}(),t.create_function=function(y,b,_,E,v,R,q,x){h(y);function N(P){return(L,Q,oe)=>P(L,e.HEAP32.subarray(oe/4,oe/4+Q))}const j=e.create_function(y,b,_,E,v,R&&N(R),q&&N(q),x);return A("sqlite3_create_function",j,y)},t.data_count=function(){const b=e.cwrap("sqlite3_data_count",...re("n:n"));return function(_){return m(_),b(_)}}(),t.exec=function(y,b,_){const E=t.statements(y,b,{unscoped:!0});for(const v of E){let R;for(;t.step(v)===Qy;)if(_){R=R??t.column_names(v);const q=t.row(v);_(q,R),_(q,R)}}for(const v of E)t.finalize(v);return te},t.finalize=function(){const b=e.cwrap("sqlite3_finalize",...re("n:n"),{async:va});return function(_){const E=b(_);return p.delete(_),E}}(),t.get_autocommit=function(){const b=e.cwrap("sqlite3_get_autocommit",...re("n:n"));return function(_){return b(_)}}(),t.libversion=function(){const b=e.cwrap("sqlite3_libversion",...re(":s"));return function(){return b()}}(),t.libversion_number=function(){const b=e.cwrap("sqlite3_libversion_number",...re(":n"));return function(){return b()}}(),t.limit=function(){const b=e.cwrap("sqlite3_limit",...re("nnn:n"));return function(_,E,v){return b(_,E,v)}}(),t.open_v2=function(){const y="sqlite3_open_v2",b=e.cwrap(y,...re("snnn:n"),{async:va});return async function(_,E,v){E=E||cp|qT,v=o(v);try{const R=await D(()=>b(_,s[0],E,v)),q=e.getValue(s[0],"*");return f.add(q),e.ccall("RegisterExtensionFunctions","void",["number"],[q]),A(y,R,q),q}finally{e._sqlite3_free(v)}}}(),t.open_v2Sync=function(){const y="sqlite3_open_v2",b=e.cwrap(y,...re("snnn:n"),{async:va});return function(_,E,v){E=E||cp|qT,v=o(v);try{const R=b(_,s[0],E,v),q=e.getValue(s[0],"*");return f.add(q),e.ccall("RegisterExtensionFunctions","void",["number"],[q]),A(y,R,q),q}finally{e._sqlite3_free(v)}}}(),t.progress_handler=function(y,b,_,E){h(y),e.progress_handler(y,b,_,E)},t.reset=function(){const y="sqlite3_reset",b=e.cwrap(y,...re("n:n"),{async:va});return function(_){m(_);const E=b(_);return A(y,E,p.get(_))}}(),t.result=function(y,b){switch(typeof b){case"number":b===(b|0)?t.result_int(y,b):t.result_double(y,b);break;case"string":t.result_text(y,b);break;default:if(b instanceof Uint8Array||Array.isArray(b))t.result_blob(y,b);else if(b===null)t.result_null(y);else{if(typeof b=="bigint")return t.result_int64(y,b);console.warn("unknown result converted to null",b),t.result_null(y)}break}},t.result_blob=function(){const b=e.cwrap("sqlite3_result_blob",...re("nnnn:n"));return function(_,E){const v=E.byteLength??E.length,R=e._sqlite3_malloc(v);e.HEAPU8.subarray(R).set(E),b(_,R,v,n)}}(),t.result_double=function(){const b=e.cwrap("sqlite3_result_double",...re("nn:n"));return function(_,E){b(_,E)}}(),t.result_int=function(){const b=e.cwrap("sqlite3_result_int",...re("nn:n"));return function(_,E){b(_,E)}}(),t.result_int64=function(){const b=e.cwrap("sqlite3_result_int64",...re("nnn:n"));return function(_,E){if(E>BT||E<HT)return e_;const v=E&0xffffffffn,R=E>>32n;b(_,Number(v),Number(R))}}(),t.result_null=function(){const b=e.cwrap("sqlite3_result_null",...re("n:n"));return function(_){b(_)}}(),t.result_text=function(){const b=e.cwrap("sqlite3_result_text",...re("nnnn:n"));return function(_,E){const v=o(E);b(_,v,-1,n)}}(),t.row=function(y){const b=[],_=t.data_count(y);for(let E=0;E<_;++E){const v=t.column(y,E);b.push(v?.buffer===e.HEAPU8.buffer?v.slice():v)}return b},t.set_authorizer=function(y,b,_){h(y);function E(q,x,N,j,P,L){return[q,x,e.UTF8ToString(N),e.UTF8ToString(j),e.UTF8ToString(P),e.UTF8ToString(L)]}function v(q){return(x,N,j,P,L,Q)=>q(...E(x,N,j,P,L,Q))}const R=e.set_authorizer(y,v(b),_);return A("sqlite3_set_authorizer",R,y)},t.sql=function(){const b=e.cwrap("sqlite3_sql",...re("n:s"));return function(_){return m(_),b(_)}}(),t.statements=function(y,b,_={}){const E=e.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!1}),v=[],R=new TextEncoder().encode(b),q=R.byteLength-R.byteLength%4+12,x=e._sqlite3_malloc(q),N=x+R.byteLength+1;e.HEAPU8.set(R,x),e.HEAPU8[N-1]=0;const j=x+q-8,P=x+q-4;let L;function Q(){L&&!_.unscoped&&t.finalize(L),L=0}e.setValue(P,x,"*");do{Q();const oe=e.getValue(P,"*"),J=E(y,oe,N-P,_.flags||0,j,P);J!==te&&A("sqlite3_prepare_v3",J,y),L=e.getValue(j,"*"),L&&(p.set(L,y),v.push(L))}while(L);return v},t.step=function(){const y="sqlite3_step",b=e.cwrap(y,...re("n:n"),{async:va});return function(_){m(_);const E=b(_);return A(y,E,p.get(_),[Qy,pne])}}(),t.commit_hook=function(y,b){h(y),e.commit_hook(y,b)},t.update_hook=function(y,b){h(y);function _(v,R,q,x,N){return[v,e.UTF8ToString(R),e.UTF8ToString(q),a(x,N)]}function E(v){return(R,q,x,N,j)=>v(..._(R,q,x,N,j))}e.update_hook(y,E(b))},t.session_create=function(){const y="sqlite3session_create",b=e.cwrap(y,...re("nsn:n"));return function(_,E){h(_);const v=e._malloc(4),R=b(_,E,v);return R!==te&&A(y,R,_),e.getValue(v,"i32")}}(),t.session_attach=function(){const y="sqlite3session_attach",b=e.cwrap(y,...re("ns:n"));return function(_,E){if(typeof _!="number")throw new ir("Invalid session object",Zs);const v=b(_,E);return A(y,v)}}(),t.session_enable=function(){const b=e.cwrap("sqlite3session_enable",...re("nn:n"));return function(_,E){const v=E?1:0;if(typeof _!="number")throw new ir("Invalid session object",Zs);if(b(_,v)!==v)throw new ir("Failed to enable session",Zs)}}(),t.session_changeset=function(){const y="sqlite3session_changeset",b=e.cwrap(y,...re("nnn:n"));return function(_){if(typeof _!="number")throw new ir("Invalid session object",Zs);const E=e._malloc(4),v=e._malloc(4);try{const R=b(_,E,v);if(R===te){const q=e.getValue(E,"i32"),x=e.getValue(v,"i32");if(x===0)return{result:R,size:0,changeset:null};const N=new Uint8Array(e.HEAPU8.subarray(x,x+q));return e._sqlite3_free(x),{result:R,size:q,changeset:N}}return A(y,R)}finally{e._free(E),e._free(v)}}}(),t.session_delete=function(){const b=e.cwrap("sqlite3session_delete",...re("n:v"));return function(_){if(typeof _!="number")throw new ir("Invalid session object",Zs);return b(_)}}(),t.changeset_start=function(){const y="sqlite3changeset_start",b=e.cwrap(y,...re("nnn:n"));return function(_){const E=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(E).set(_);const v=e._malloc(4);try{const R=b(v,_.length,E);return R!==te&&A(y,R),e.getValue(v,"i32")}finally{e._sqlite3_free(E),e._free(v)}}}(),t.changeset_finalize=function(){const b=e.cwrap("sqlite3changeset_finalize",...re("n:n"));return function(_){return b(_)}}(),t.changeset_invert=function(){const y="sqlite3changeset_invert",b=e.cwrap(y,...re("nn:nn"));return function(_){const E=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(E).set(_);const v=e._malloc(4),R=e._malloc(4),q=b(_.length,E,v,R);q!==te&&A(y,q);const x=e.getValue(v,"i32"),N=e.getValue(R,"i32"),j=new Uint8Array(e.HEAPU8.buffer,N,x).slice();return e._sqlite3_free(E),e._sqlite3_free(N),j}}(),t.session_changeset_inverted=function(){const y="sqlite3session_changeset",b=e.cwrap(y,...re("nnn:n")),_="sqlite3changeset_invert",E=e.cwrap(_,...re("nn:nn"));return function(v){if(typeof v!="number")throw new ir("Invalid session object",Zs);const R=e._malloc(4),q=e._malloc(4),x=e._malloc(4),N=e._malloc(4);try{const j=b(v,R,q);if(j!==te)return A(y,j);const P=e.getValue(R,"i32"),L=e.getValue(q,"i32"),Q=E(P,L,x,N);if(Q!==te)return A(_,Q);const oe=e.getValue(x,"i32"),J=e.getValue(N,"i32"),De=new Uint8Array(e.HEAPU8.buffer,J,oe);return e._sqlite3_free(L),e._sqlite3_free(J),{result:j,size:P,changeset:new Uint8Array(De)}}finally{e._free(R),e._free(q),e._free(x),e._free(N)}}}(),t.changeset_apply=function(){const y="sqlite3changeset_apply",b=e.cwrap(y,...re("nnnnnn:n"));return function(_,E,v){const R=e._sqlite3_malloc(E.length);e.HEAPU8.subarray(R).set(E);const q=1,x=()=>q,N=b(_,E.length,R,null,x,null);return e._sqlite3_free(R),N!==te&&A(y,N),N}}(),t.value=function(y){const b=t.value_type(y);switch(b){case PT:return t.value_blob(y);case xT:return t.value_double(y);case OT:const _=t.value_int(y),E=e.getTempRet0();return u(_,E);case DT:return null;case FT:return t.value_text(y);default:throw new ir("unknown type",b)}},t.value_blob=function(){const b=e.cwrap("sqlite3_value_blob",...re("n:n"));return function(_){const E=t.value_bytes(_),v=b(_);return e.HEAPU8.subarray(v,v+E)}}(),t.value_bytes=function(){const b=e.cwrap("sqlite3_value_bytes",...re("n:n"));return function(_){return b(_)}}(),t.value_double=function(){const b=e.cwrap("sqlite3_value_double",...re("n:n"));return function(_){return b(_)}}(),t.value_int=function(){const b=e.cwrap("sqlite3_value_int64",...re("n:n"));return function(_){return b(_)}}(),t.value_int64=function(){const b=e.cwrap("sqlite3_value_int64",...re("n:n"));return function(_){const E=b(_),v=e.getTempRet0();return a(E,v)}}(),t.value_text=function(){const b=e.cwrap("sqlite3_value_text",...re("n:s"));return function(_){return b(_)}}(),t.value_type=function(){const b=e.cwrap("sqlite3_value_type",...re("n:n"));return function(_){return b(_)}}();const C=new Set;t.vfs_register=function(y,b){if(C.has(y.name))return;const _=e.vfs_register(y,b),E=A("sqlite3_vfs_register",_);return C.add(y.name),E},t.vfs_registered=C;function A(y,b,_=null,E=[te]){if(E.includes(b))return b;const v=_?e.ccall("sqlite3_errmsg","string",["number"],[_]):y;throw new ir(v,b)}async function D(y){let b;do e.retryOps.length&&(await Promise.all(e.retryOps),e.retryOps=[]),b=await y();while(b&&e.retryOps.length);return b}return t}function re(e){const t=[],n=e.match(/([ns@]*):([nsv@])/);switch(n[2]){case"n":t.push("number");break;case"s":t.push("string");break;case"v":t.push(null);break}const r=[];for(let s of n[1])switch(s){case"n":r.push("number");break;case"s":r.push("string");break}return t.push(r),t}var Mne=(()=>{var e=import.meta.url;return function(t={}){var n,r=t,s,o,a=new Promise((i,c)=>{s=i,o=c}),u=typeof window=="object",f=typeof WorkerGlobalScope<"u";typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var h=Object.assign({},r),p="./this.program",m=(i,c)=>{throw c},T="";function C(i){return r.locateFile?r.locateFile(i,T):T+i}var A,D;(u||f)&&(f?T=self.location.href:typeof document<"u"&&document.currentScript&&(T=document.currentScript.src),e&&(T=e),T.startsWith("blob:")?T="":T=T.substr(0,T.replace(/[?#].*/,"").lastIndexOf("/")+1),f&&(D=i=>{var c=new XMLHttpRequest;return c.open("GET",i,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),A=i=>fetch(i,{credentials:"same-origin"}).then(c=>c.ok?c.arrayBuffer():Promise.reject(new Error(c.status+" : "+c.url))));var y=r.print||console.log.bind(console),b=r.printErr||console.error.bind(console);Object.assign(r,h),h=null,r.arguments&&r.arguments,r.thisProgram&&(p=r.thisProgram);var _=r.wasmBinary,E,v=!1,R,q,x,N,j,P,L,Q,oe;function J(){var i=E.buffer;r.HEAP8=q=new Int8Array(i),r.HEAP16=N=new Int16Array(i),r.HEAPU8=x=new Uint8Array(i),r.HEAPU16=j=new Uint16Array(i),r.HEAP32=P=new Int32Array(i),r.HEAPU32=L=new Uint32Array(i),r.HEAPF32=Q=new Float32Array(i),r.HEAPF64=oe=new Float64Array(i)}var De=[],qe=[],nt=[],gt=[];function Mn(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)gs(r.preRun.shift());Xf(De)}function Jf(){!r.noFSInit&&!g.initialized&&g.init(),g.ignorePermissions=!1,Xf(qe)}function we(){Xf(nt)}function Xt(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)RF(r.postRun.shift());Xf(gt)}function gs(i){De.unshift(i)}function $F(i){qe.unshift(i)}function RF(i){gt.unshift(i)}var Bo=0,mu=null;function ase(i){return i}function lg(i){Bo++,r.monitorRunDependencies?.(Bo)}function Yf(i){if(Bo--,r.monitorRunDependencies?.(Bo),Bo==0&&mu){var c=mu;mu=null,c()}}function Gs(i){r.onAbort?.(i),i="Aborted("+i+")",b(i),v=!0,i+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(i);throw o(c),c}var AF="data:application/octet-stream;base64,",Hv=i=>i.startsWith(AF);function qF(){if(r.locateFile){var i="wa-sqlite.wasm";return Hv(i)?i:C(i)}return new URL("/assets/wa-sqlite-CWx0VZcQ.wasm",import.meta.url).href}var fg;function Wv(i){if(i==fg&&_)return new Uint8Array(_);if(D)return D(i);throw"both async and sync fetching of the wasm failed"}function OF(i){return _?Promise.resolve().then(()=>Wv(i)):A(i).then(c=>new Uint8Array(c),()=>Wv(i))}function Vv(i,c,l){return OF(i).then(d=>WebAssembly.instantiate(d,c)).then(l,d=>{b(`failed to asynchronously prepare wasm: ${d}`),Gs(d)})}function xF(i,c,l,d){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!Hv(c)&&typeof fetch=="function"?fetch(c,{credentials:"same-origin"}).then(S=>{var $=WebAssembly.instantiateStreaming(S,l);return $.then(d,function(O){return b(`wasm streaming compile failed: ${O}`),b("falling back to ArrayBuffer instantiation"),Vv(c,l,d)})}):Vv(c,l,d)}function FF(){return{a:P2}}function PF(){function i(d,S){return I=d.exports,E=I.la,J(),ha=I.of,$F(I.ma),Yf(),I}lg();function c(d){i(d.instance)}var l=FF();if(r.instantiateWasm)try{return r.instantiateWasm(l,i)}catch(d){b(`Module.instantiateWasm callback failed with error: ${d}`),o(d)}return fg??=qF(),xF(_,fg,l,c).catch(o),{}}var _e,_t;class Kv{name="ExitStatus";constructor(c){this.message=`Program terminated with exit(${c})`,this.status=c}}var Xf=i=>{for(;i.length>0;)i.shift()(r)};function Gv(i,c="i8"){switch(c.endsWith("*")&&(c="*"),c){case"i1":return q[i];case"i8":return q[i];case"i16":return N[i>>1];case"i32":return P[i>>2];case"i64":Gs("to do getValue(i64) use WASM_BIGINT");case"float":return Q[i>>2];case"double":return oe[i>>3];case"*":return L[i>>2];default:Gs(`invalid type for getValue: ${c}`)}}r.noExitRuntime;function la(i,c,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":q[i]=c;break;case"i8":q[i]=c;break;case"i16":N[i>>1]=c;break;case"i32":P[i>>2]=c;break;case"i64":Gs("to do setValue(i64) use WASM_BIGINT");case"float":Q[i>>2]=c;break;case"double":oe[i>>3]=c;break;case"*":L[i>>2]=c;break;default:Gs(`invalid type for setValue: ${l}`)}}var DF=i=>lE(i),NF=()=>dE(),Qv=typeof TextDecoder<"u"?new TextDecoder:void 0,fa=(i,c=0,l=NaN)=>{for(var d=c+l,S=c;i[S]&&!(S>=d);)++S;if(S-c>16&&i.buffer&&Qv)return Qv.decode(i.subarray(c,S));for(var $="";c<S;){var O=i[c++];if(!(O&128)){$+=String.fromCharCode(O);continue}var F=i[c++]&63;if((O&224)==192){$+=String.fromCharCode((O&31)<<6|F);continue}var z=i[c++]&63;if((O&240)==224?O=(O&15)<<12|F<<6|z:O=(O&7)<<18|F<<12|z<<6|i[c++]&63,O<65536)$+=String.fromCharCode(O);else{var ee=O-65536;$+=String.fromCharCode(55296|ee>>10,56320|ee&1023)}}return $},Ho=(i,c)=>i?fa(x,i,c):"",MF=(i,c,l,d)=>Gs(`Assertion failed: ${Ho(i)}, at: `+[c?Ho(c):"unknown filename",l,d?Ho(d):"unknown function"]),Ze={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return c.exec(i).slice(1)},normalizeArray:(i,c)=>{for(var l=0,d=i.length-1;d>=0;d--){var S=i[d];S==="."?i.splice(d,1):S===".."?(i.splice(d,1),l++):l&&(i.splice(d,1),l--)}if(c)for(;l;l--)i.unshift("..");return i},normalize:i=>{var c=Ze.isAbs(i),l=i.substr(-1)==="/";return i=Ze.normalizeArray(i.split("/").filter(d=>!!d),!c).join("/"),!i&&!c&&(i="."),i&&l&&(i+="/"),(c?"/":"")+i},dirname:i=>{var c=Ze.splitPath(i),l=c[0],d=c[1];return!l&&!d?".":(d&&(d=d.substr(0,d.length-1)),l+d)},basename:i=>{if(i==="/")return"/";i=Ze.normalize(i),i=i.replace(/\/$/,"");var c=i.lastIndexOf("/");return c===-1?i:i.substr(c+1)},join:(...i)=>Ze.normalize(i.join("/")),join2:(i,c)=>Ze.normalize(i+"/"+c)},LF=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);Gs("initRandomDevice")},Jv=i=>(Jv=LF())(i),Qs={resolve:(...i)=>{for(var c="",l=!1,d=i.length-1;d>=-1&&!l;d--){var S=d>=0?i[d]:g.cwd();if(typeof S!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!S)return"";c=S+"/"+c,l=Ze.isAbs(S)}return c=Ze.normalizeArray(c.split("/").filter($=>!!$),!l).join("/"),(l?"/":"")+c||"."},relative:(i,c)=>{i=Qs.resolve(i).substr(1),c=Qs.resolve(c).substr(1);function l(ee){for(var ye=0;ye<ee.length&&ee[ye]==="";ye++);for(var Fe=ee.length-1;Fe>=0&&ee[Fe]==="";Fe--);return ye>Fe?[]:ee.slice(ye,Fe-ye+1)}for(var d=l(i.split("/")),S=l(c.split("/")),$=Math.min(d.length,S.length),O=$,F=0;F<$;F++)if(d[F]!==S[F]){O=F;break}for(var z=[],F=O;F<d.length;F++)z.push("..");return z=z.concat(S.slice(O)),z.join("/")}},dg=[],da=i=>{for(var c=0,l=0;l<i.length;++l){var d=i.charCodeAt(l);d<=127?c++:d<=2047?c+=2:d>=55296&&d<=57343?(c+=4,++l):c+=3}return c},hg=(i,c,l,d)=>{if(!(d>0))return 0;for(var S=l,$=l+d-1,O=0;O<i.length;++O){var F=i.charCodeAt(O);if(F>=55296&&F<=57343){var z=i.charCodeAt(++O);F=65536+((F&1023)<<10)|z&1023}if(F<=127){if(l>=$)break;c[l++]=F}else if(F<=2047){if(l+1>=$)break;c[l++]=192|F>>6,c[l++]=128|F&63}else if(F<=65535){if(l+2>=$)break;c[l++]=224|F>>12,c[l++]=128|F>>6&63,c[l++]=128|F&63}else{if(l+3>=$)break;c[l++]=240|F>>18,c[l++]=128|F>>12&63,c[l++]=128|F>>6&63,c[l++]=128|F&63}}return c[l]=0,l-S};function pg(i,c,l){var d=l>0?l:da(i)+1,S=new Array(d),$=hg(i,S,0,S.length);return c&&(S.length=$),S}var UF=()=>{if(!dg.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`)),!i)return null;dg=pg(i,!0)}return dg.shift()},Wo={ttys:[],init(){},shutdown(){},register(i,c){Wo.ttys[i]={input:[],output:[],ops:c},g.registerDevice(i,Wo.stream_ops)},stream_ops:{open(i){var c=Wo.ttys[i.node.rdev];if(!c)throw new g.ErrnoError(43);i.tty=c,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,c,l,d,S){if(!i.tty||!i.tty.ops.get_char)throw new g.ErrnoError(60);for(var $=0,O=0;O<d;O++){var F;try{F=i.tty.ops.get_char(i.tty)}catch{throw new g.ErrnoError(29)}if(F===void 0&&$===0)throw new g.ErrnoError(6);if(F==null)break;$++,c[l+O]=F}return $&&(i.node.timestamp=Date.now()),$},write(i,c,l,d,S){if(!i.tty||!i.tty.ops.put_char)throw new g.ErrnoError(60);try{for(var $=0;$<d;$++)i.tty.ops.put_char(i.tty,c[l+$])}catch{throw new g.ErrnoError(29)}return d&&(i.node.timestamp=Date.now()),$}},default_tty_ops:{get_char(i){return UF()},put_char(i,c){c===null||c===10?(y(fa(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(y(fa(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,c,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,c){c===null||c===10?(b(fa(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(b(fa(i.output)),i.output=[])}}},jF=(i,c)=>{x.fill(0,i,i+c)},Yv=(i,c)=>Math.ceil(i/c)*c,Xv=i=>{i=Yv(i,65536);var c=cE(65536,i);return c&&jF(c,i),c},Ee={ops_table:null,mount(i){return Ee.createNode(null,"/",16895,0)},createNode(i,c,l,d){if(g.isBlkdev(l)||g.isFIFO(l))throw new g.ErrnoError(63);Ee.ops_table||={dir:{node:{getattr:Ee.node_ops.getattr,setattr:Ee.node_ops.setattr,lookup:Ee.node_ops.lookup,mknod:Ee.node_ops.mknod,rename:Ee.node_ops.rename,unlink:Ee.node_ops.unlink,rmdir:Ee.node_ops.rmdir,readdir:Ee.node_ops.readdir,symlink:Ee.node_ops.symlink},stream:{llseek:Ee.stream_ops.llseek}},file:{node:{getattr:Ee.node_ops.getattr,setattr:Ee.node_ops.setattr},stream:{llseek:Ee.stream_ops.llseek,read:Ee.stream_ops.read,write:Ee.stream_ops.write,allocate:Ee.stream_ops.allocate,mmap:Ee.stream_ops.mmap,msync:Ee.stream_ops.msync}},link:{node:{getattr:Ee.node_ops.getattr,setattr:Ee.node_ops.setattr,readlink:Ee.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Ee.node_ops.getattr,setattr:Ee.node_ops.setattr},stream:g.chrdev_stream_ops}};var S=g.createNode(i,c,l,d);return g.isDir(S.mode)?(S.node_ops=Ee.ops_table.dir.node,S.stream_ops=Ee.ops_table.dir.stream,S.contents={}):g.isFile(S.mode)?(S.node_ops=Ee.ops_table.file.node,S.stream_ops=Ee.ops_table.file.stream,S.usedBytes=0,S.contents=null):g.isLink(S.mode)?(S.node_ops=Ee.ops_table.link.node,S.stream_ops=Ee.ops_table.link.stream):g.isChrdev(S.mode)&&(S.node_ops=Ee.ops_table.chrdev.node,S.stream_ops=Ee.ops_table.chrdev.stream),S.timestamp=Date.now(),i&&(i.contents[c]=S,i.timestamp=S.timestamp),S},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,c){var l=i.contents?i.contents.length:0;if(!(l>=c)){var d=1024*1024;c=Math.max(c,l*(l<d?2:1.125)>>>0),l!=0&&(c=Math.max(c,256));var S=i.contents;i.contents=new Uint8Array(c),i.usedBytes>0&&i.contents.set(S.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,c){if(i.usedBytes!=c)if(c==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(c),l&&i.contents.set(l.subarray(0,Math.min(c,i.usedBytes))),i.usedBytes=c}},node_ops:{getattr(i){var c={};return c.dev=g.isChrdev(i.mode)?i.id:1,c.ino=i.id,c.mode=i.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=i.rdev,g.isDir(i.mode)?c.size=4096:g.isFile(i.mode)?c.size=i.usedBytes:g.isLink(i.mode)?c.size=i.link.length:c.size=0,c.atime=new Date(i.timestamp),c.mtime=new Date(i.timestamp),c.ctime=new Date(i.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr(i,c){c.mode!==void 0&&(i.mode=c.mode),c.timestamp!==void 0&&(i.timestamp=c.timestamp),c.size!==void 0&&Ee.resizeFileStorage(i,c.size)},lookup(i,c){throw Ee.doesNotExistError},mknod(i,c,l,d){return Ee.createNode(i,c,l,d)},rename(i,c,l){if(g.isDir(i.mode)){var d;try{d=g.lookupNode(c,l)}catch{}if(d)for(var S in d.contents)throw new g.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,c.contents[l]=i,c.timestamp=i.parent.timestamp},unlink(i,c){delete i.contents[c],i.timestamp=Date.now()},rmdir(i,c){var l=g.lookupNode(i,c);for(var d in l.contents)throw new g.ErrnoError(55);delete i.contents[c],i.timestamp=Date.now()},readdir(i){var c=[".",".."];for(var l of Object.keys(i.contents))c.push(l);return c},symlink(i,c,l){var d=Ee.createNode(i,c,41471,0);return d.link=l,d},readlink(i){if(!g.isLink(i.mode))throw new g.ErrnoError(28);return i.link}},stream_ops:{read(i,c,l,d,S){var $=i.node.contents;if(S>=i.node.usedBytes)return 0;var O=Math.min(i.node.usedBytes-S,d);if(O>8&&$.subarray)c.set($.subarray(S,S+O),l);else for(var F=0;F<O;F++)c[l+F]=$[S+F];return O},write(i,c,l,d,S,$){if(c.buffer===q.buffer&&($=!1),!d)return 0;var O=i.node;if(O.timestamp=Date.now(),c.subarray&&(!O.contents||O.contents.subarray)){if($)return O.contents=c.subarray(l,l+d),O.usedBytes=d,d;if(O.usedBytes===0&&S===0)return O.contents=c.slice(l,l+d),O.usedBytes=d,d;if(S+d<=O.usedBytes)return O.contents.set(c.subarray(l,l+d),S),d}if(Ee.expandFileStorage(O,S+d),O.contents.subarray&&c.subarray)O.contents.set(c.subarray(l,l+d),S);else for(var F=0;F<d;F++)O.contents[S+F]=c[l+F];return O.usedBytes=Math.max(O.usedBytes,S+d),d},llseek(i,c,l){var d=c;if(l===1?d+=i.position:l===2&&g.isFile(i.node.mode)&&(d+=i.node.usedBytes),d<0)throw new g.ErrnoError(28);return d},allocate(i,c,l){Ee.expandFileStorage(i.node,c+l),i.node.usedBytes=Math.max(i.node.usedBytes,c+l)},mmap(i,c,l,d,S){if(!g.isFile(i.node.mode))throw new g.ErrnoError(43);var $,O,F=i.node.contents;if(!(S&2)&&F&&F.buffer===q.buffer)O=!1,$=F.byteOffset;else{if(O=!0,$=Xv(c),!$)throw new g.ErrnoError(48);F&&((l>0||l+c<F.length)&&(F.subarray?F=F.subarray(l,l+c):F=Array.prototype.slice.call(F,l,l+c)),q.set(F,$))}return{ptr:$,allocated:O}},msync(i,c,l,d,S){return Ee.stream_ops.write(i,c,0,d,l,!1),0}}},zF=(i,c,l,d)=>{var S=`al ${i}`;A(i).then($=>{c(new Uint8Array($)),S&&Yf()},$=>{if(l)l();else throw`Loading data file "${i}" failed.`}),S&&lg()},BF=(i,c,l,d,S,$)=>{g.createDataFile(i,c,l,d,S,$)},HF=r.preloadPlugins||[],WF=(i,c,l,d)=>{typeof Browser<"u"&&Browser.init();var S=!1;return HF.forEach($=>{S||$.canHandle(c)&&($.handle(i,c,l,d),S=!0)}),S},VF=(i,c,l,d,S,$,O,F,z,ee)=>{var ye=c?Qs.resolve(Ze.join2(i,c)):i;function Fe(Re){function de(ce){ee?.(),F||BF(i,c,ce,d,S,z),$?.(),Yf()}WF(Re,ye,de,()=>{O?.(),Yf()})||de(Re)}lg(),typeof l=="string"?zF(l,Fe,O):Fe(l)},KF=i=>{var c={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=c[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},mg=(i,c)=>{var l=0;return i&&(l|=365),c&&(l|=146),l},g={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{name="ErrnoError";constructor(i){this.errno=i}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(i,c,l,d){i||(i=this),this.parent=i,this.mount=i.mount,this.id=g.nextInode++,this.name=c,this.mode=l,this.rdev=d}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return g.isDir(this.mode)}get isDevice(){return g.isChrdev(this.mode)}},lookupPath(i,c={}){if(i=Qs.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(c=Object.assign(l,c),c.recurse_count>8)throw new g.ErrnoError(32);for(var d=i.split("/").filter(Fe=>!!Fe),S=g.root,$="/",O=0;O<d.length;O++){var F=O===d.length-1;if(F&&c.parent)break;if(S=g.lookupNode(S,d[O]),$=Ze.join2($,d[O]),g.isMountpoint(S)&&(!F||F&&c.follow_mount)&&(S=S.mounted.root),!F||c.follow)for(var z=0;g.isLink(S.mode);){var ee=g.readlink($);$=Qs.resolve(Ze.dirname($),ee);var ye=g.lookupPath($,{recurse_count:c.recurse_count+1});if(S=ye.node,z++>40)throw new g.ErrnoError(32)}}return{path:$,node:S}},getPath(i){for(var c;;){if(g.isRoot(i)){var l=i.mount.mountpoint;return c?l[l.length-1]!=="/"?`${l}/${c}`:l+c:l}c=c?`${i.name}/${c}`:i.name,i=i.parent}},hashName(i,c){for(var l=0,d=0;d<c.length;d++)l=(l<<5)-l+c.charCodeAt(d)|0;return(i+l>>>0)%g.nameTable.length},hashAddNode(i){var c=g.hashName(i.parent.id,i.name);i.name_next=g.nameTable[c],g.nameTable[c]=i},hashRemoveNode(i){var c=g.hashName(i.parent.id,i.name);if(g.nameTable[c]===i)g.nameTable[c]=i.name_next;else for(var l=g.nameTable[c];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,c){var l=g.mayLookup(i);if(l)throw new g.ErrnoError(l);for(var d=g.hashName(i.id,c),S=g.nameTable[d];S;S=S.name_next){var $=S.name;if(S.parent.id===i.id&&$===c)return S}return g.lookup(i,c)},createNode(i,c,l,d){var S=new g.FSNode(i,c,l,d);return g.hashAddNode(S),S},destroyNode(i){g.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var c=["r","w","rw"][i&3];return i&512&&(c+="w"),c},nodePermissions(i,c){return g.ignorePermissions?0:c.includes("r")&&!(i.mode&292)||c.includes("w")&&!(i.mode&146)||c.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!g.isDir(i.mode))return 54;var c=g.nodePermissions(i,"x");return c||(i.node_ops.lookup?0:2)},mayCreate(i,c){var l;try{return l=g.lookupNode(i,c),20}catch{}return g.nodePermissions(i,"wx")},mayDelete(i,c,l){var d;try{d=g.lookupNode(i,c)}catch($){return $.errno}var S=g.nodePermissions(i,"wx");if(S)return S;if(l){if(!g.isDir(d.mode))return 54;if(g.isRoot(d)||g.getPath(d)===g.cwd())return 10}else if(g.isDir(d.mode))return 31;return 0},mayOpen(i,c){return i?g.isLink(i.mode)?32:g.isDir(i.mode)&&(g.flagsToPermissionString(c)!=="r"||c&512)?31:g.nodePermissions(i,g.flagsToPermissionString(c)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=g.MAX_OPEN_FDS;i++)if(!g.streams[i])return i;throw new g.ErrnoError(33)},getStreamChecked(i){var c=g.getStream(i);if(!c)throw new g.ErrnoError(8);return c},getStream:i=>g.streams[i],createStream(i,c=-1){return i=Object.assign(new g.FSStream,i),c==-1&&(c=g.nextfd()),i.fd=c,g.streams[c]=i,i},closeStream(i){g.streams[i]=null},dupStream(i,c=-1){var l=g.createStream(i,c);return l.stream_ops?.dup?.(l),l},chrdev_stream_ops:{open(i){var c=g.getDevice(i.node.rdev);i.stream_ops=c.stream_ops,i.stream_ops.open?.(i)},llseek(){throw new g.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,c)=>i<<8|c,registerDevice(i,c){g.devices[i]={stream_ops:c}},getDevice:i=>g.devices[i],getMounts(i){for(var c=[],l=[i];l.length;){var d=l.pop();c.push(d),l.push(...d.mounts)}return c},syncfs(i,c){typeof i=="function"&&(c=i,i=!1),g.syncFSRequests++,g.syncFSRequests>1&&b(`warning: ${g.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=g.getMounts(g.root.mount),d=0;function S(O){return g.syncFSRequests--,c(O)}function $(O){if(O)return $.errored?void 0:($.errored=!0,S(O));++d>=l.length&&S(null)}l.forEach(O=>{if(!O.type.syncfs)return $(null);O.type.syncfs(O,i,$)})},mount(i,c,l){var d=l==="/",S=!l,$;if(d&&g.root)throw new g.ErrnoError(10);if(!d&&!S){var O=g.lookupPath(l,{follow_mount:!1});if(l=O.path,$=O.node,g.isMountpoint($))throw new g.ErrnoError(10);if(!g.isDir($.mode))throw new g.ErrnoError(54)}var F={type:i,opts:c,mountpoint:l,mounts:[]},z=i.mount(F);return z.mount=F,F.root=z,d?g.root=z:$&&($.mounted=F,$.mount&&$.mount.mounts.push(F)),z},unmount(i){var c=g.lookupPath(i,{follow_mount:!1});if(!g.isMountpoint(c.node))throw new g.ErrnoError(28);var l=c.node,d=l.mounted,S=g.getMounts(d);Object.keys(g.nameTable).forEach(O=>{for(var F=g.nameTable[O];F;){var z=F.name_next;S.includes(F.mount)&&g.destroyNode(F),F=z}}),l.mounted=null;var $=l.mount.mounts.indexOf(d);l.mount.mounts.splice($,1)},lookup(i,c){return i.node_ops.lookup(i,c)},mknod(i,c,l){var d=g.lookupPath(i,{parent:!0}),S=d.node,$=Ze.basename(i);if(!$||$==="."||$==="..")throw new g.ErrnoError(28);var O=g.mayCreate(S,$);if(O)throw new g.ErrnoError(O);if(!S.node_ops.mknod)throw new g.ErrnoError(63);return S.node_ops.mknod(S,$,c,l)},statfs(i){var c={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:g.nextInode,ffree:g.nextInode-1,fsid:42,flags:2,namelen:255},l=g.lookupPath(i,{follow:!0}).node;return l?.node_ops.statfs&&Object.assign(c,l.node_ops.statfs(l.mount.opts.root)),c},create(i,c=438){return c&=4095,c|=32768,g.mknod(i,c,0)},mkdir(i,c=511){return c&=1023,c|=16384,g.mknod(i,c,0)},mkdirTree(i,c){for(var l=i.split("/"),d="",S=0;S<l.length;++S)if(l[S]){d+="/"+l[S];try{g.mkdir(d,c)}catch($){if($.errno!=20)throw $}}},mkdev(i,c,l){return typeof l>"u"&&(l=c,c=438),c|=8192,g.mknod(i,c,l)},symlink(i,c){if(!Qs.resolve(i))throw new g.ErrnoError(44);var l=g.lookupPath(c,{parent:!0}),d=l.node;if(!d)throw new g.ErrnoError(44);var S=Ze.basename(c),$=g.mayCreate(d,S);if($)throw new g.ErrnoError($);if(!d.node_ops.symlink)throw new g.ErrnoError(63);return d.node_ops.symlink(d,S,i)},rename(i,c){var l=Ze.dirname(i),d=Ze.dirname(c),S=Ze.basename(i),$=Ze.basename(c),O,F,z;if(O=g.lookupPath(i,{parent:!0}),F=O.node,O=g.lookupPath(c,{parent:!0}),z=O.node,!F||!z)throw new g.ErrnoError(44);if(F.mount!==z.mount)throw new g.ErrnoError(75);var ee=g.lookupNode(F,S),ye=Qs.relative(i,d);if(ye.charAt(0)!==".")throw new g.ErrnoError(28);if(ye=Qs.relative(c,l),ye.charAt(0)!==".")throw new g.ErrnoError(55);var Fe;try{Fe=g.lookupNode(z,$)}catch{}if(ee!==Fe){var Re=g.isDir(ee.mode),de=g.mayDelete(F,S,Re);if(de)throw new g.ErrnoError(de);if(de=Fe?g.mayDelete(z,$,Re):g.mayCreate(z,$),de)throw new g.ErrnoError(de);if(!F.node_ops.rename)throw new g.ErrnoError(63);if(g.isMountpoint(ee)||Fe&&g.isMountpoint(Fe))throw new g.ErrnoError(10);if(z!==F&&(de=g.nodePermissions(F,"w"),de))throw new g.ErrnoError(de);g.hashRemoveNode(ee);try{F.node_ops.rename(ee,z,$),ee.parent=z}catch(ce){throw ce}finally{g.hashAddNode(ee)}}},rmdir(i){var c=g.lookupPath(i,{parent:!0}),l=c.node,d=Ze.basename(i),S=g.lookupNode(l,d),$=g.mayDelete(l,d,!0);if($)throw new g.ErrnoError($);if(!l.node_ops.rmdir)throw new g.ErrnoError(63);if(g.isMountpoint(S))throw new g.ErrnoError(10);l.node_ops.rmdir(l,d),g.destroyNode(S)},readdir(i){var c=g.lookupPath(i,{follow:!0}),l=c.node;if(!l.node_ops.readdir)throw new g.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var c=g.lookupPath(i,{parent:!0}),l=c.node;if(!l)throw new g.ErrnoError(44);var d=Ze.basename(i),S=g.lookupNode(l,d),$=g.mayDelete(l,d,!1);if($)throw new g.ErrnoError($);if(!l.node_ops.unlink)throw new g.ErrnoError(63);if(g.isMountpoint(S))throw new g.ErrnoError(10);l.node_ops.unlink(l,d),g.destroyNode(S)},readlink(i){var c=g.lookupPath(i),l=c.node;if(!l)throw new g.ErrnoError(44);if(!l.node_ops.readlink)throw new g.ErrnoError(28);return l.node_ops.readlink(l)},stat(i,c){var l=g.lookupPath(i,{follow:!c}),d=l.node;if(!d)throw new g.ErrnoError(44);if(!d.node_ops.getattr)throw new g.ErrnoError(63);return d.node_ops.getattr(d)},lstat(i){return g.stat(i,!0)},chmod(i,c,l){var d;if(typeof i=="string"){var S=g.lookupPath(i,{follow:!l});d=S.node}else d=i;if(!d.node_ops.setattr)throw new g.ErrnoError(63);d.node_ops.setattr(d,{mode:c&4095|d.mode&-4096,timestamp:Date.now()})},lchmod(i,c){g.chmod(i,c,!0)},fchmod(i,c){var l=g.getStreamChecked(i);g.chmod(l.node,c)},chown(i,c,l,d){var S;if(typeof i=="string"){var $=g.lookupPath(i,{follow:!d});S=$.node}else S=i;if(!S.node_ops.setattr)throw new g.ErrnoError(63);S.node_ops.setattr(S,{timestamp:Date.now()})},lchown(i,c,l){g.chown(i,c,l,!0)},fchown(i,c,l){var d=g.getStreamChecked(i);g.chown(d.node,c,l)},truncate(i,c){if(c<0)throw new g.ErrnoError(28);var l;if(typeof i=="string"){var d=g.lookupPath(i,{follow:!0});l=d.node}else l=i;if(!l.node_ops.setattr)throw new g.ErrnoError(63);if(g.isDir(l.mode))throw new g.ErrnoError(31);if(!g.isFile(l.mode))throw new g.ErrnoError(28);var S=g.nodePermissions(l,"w");if(S)throw new g.ErrnoError(S);l.node_ops.setattr(l,{size:c,timestamp:Date.now()})},ftruncate(i,c){var l=g.getStreamChecked(i);if((l.flags&2097155)===0)throw new g.ErrnoError(28);g.truncate(l.node,c)},utime(i,c,l){var d=g.lookupPath(i,{follow:!0}),S=d.node;S.node_ops.setattr(S,{timestamp:Math.max(c,l)})},open(i,c,l=438){if(i==="")throw new g.ErrnoError(44);c=typeof c=="string"?KF(c):c,c&64?l=l&4095|32768:l=0;var d;if(typeof i=="object")d=i;else{i=Ze.normalize(i);try{var S=g.lookupPath(i,{follow:!(c&131072)});d=S.node}catch{}}var $=!1;if(c&64)if(d){if(c&128)throw new g.ErrnoError(20)}else d=g.mknod(i,l,0),$=!0;if(!d)throw new g.ErrnoError(44);if(g.isChrdev(d.mode)&&(c&=-513),c&65536&&!g.isDir(d.mode))throw new g.ErrnoError(54);if(!$){var O=g.mayOpen(d,c);if(O)throw new g.ErrnoError(O)}c&512&&!$&&g.truncate(d,0),c&=-131713;var F=g.createStream({node:d,path:g.getPath(d),flags:c,seekable:!0,position:0,stream_ops:d.stream_ops,ungotten:[],error:!1});return F.stream_ops.open&&F.stream_ops.open(F),r.logReadFiles&&!(c&1)&&(i in g.readFiles||(g.readFiles[i]=1)),F},close(i){if(g.isClosed(i))throw new g.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(c){throw c}finally{g.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,c,l){if(g.isClosed(i))throw new g.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new g.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new g.ErrnoError(28);return i.position=i.stream_ops.llseek(i,c,l),i.ungotten=[],i.position},read(i,c,l,d,S){if(d<0||S<0)throw new g.ErrnoError(28);if(g.isClosed(i))throw new g.ErrnoError(8);if((i.flags&2097155)===1)throw new g.ErrnoError(8);if(g.isDir(i.node.mode))throw new g.ErrnoError(31);if(!i.stream_ops.read)throw new g.ErrnoError(28);var $=typeof S<"u";if(!$)S=i.position;else if(!i.seekable)throw new g.ErrnoError(70);var O=i.stream_ops.read(i,c,l,d,S);return $||(i.position+=O),O},write(i,c,l,d,S,$){if(d<0||S<0)throw new g.ErrnoError(28);if(g.isClosed(i))throw new g.ErrnoError(8);if((i.flags&2097155)===0)throw new g.ErrnoError(8);if(g.isDir(i.node.mode))throw new g.ErrnoError(31);if(!i.stream_ops.write)throw new g.ErrnoError(28);i.seekable&&i.flags&1024&&g.llseek(i,0,2);var O=typeof S<"u";if(!O)S=i.position;else if(!i.seekable)throw new g.ErrnoError(70);var F=i.stream_ops.write(i,c,l,d,S,$);return O||(i.position+=F),F},allocate(i,c,l){if(g.isClosed(i))throw new g.ErrnoError(8);if(c<0||l<=0)throw new g.ErrnoError(28);if((i.flags&2097155)===0)throw new g.ErrnoError(8);if(!g.isFile(i.node.mode)&&!g.isDir(i.node.mode))throw new g.ErrnoError(43);if(!i.stream_ops.allocate)throw new g.ErrnoError(138);i.stream_ops.allocate(i,c,l)},mmap(i,c,l,d,S){if((d&2)!==0&&(S&2)===0&&(i.flags&2097155)!==2)throw new g.ErrnoError(2);if((i.flags&2097155)===1)throw new g.ErrnoError(2);if(!i.stream_ops.mmap)throw new g.ErrnoError(43);if(!c)throw new g.ErrnoError(28);return i.stream_ops.mmap(i,c,l,d,S)},msync(i,c,l,d,S){return i.stream_ops.msync?i.stream_ops.msync(i,c,l,d,S):0},ioctl(i,c,l){if(!i.stream_ops.ioctl)throw new g.ErrnoError(59);return i.stream_ops.ioctl(i,c,l)},readFile(i,c={}){if(c.flags=c.flags||0,c.encoding=c.encoding||"binary",c.encoding!=="utf8"&&c.encoding!=="binary")throw new Error(`Invalid encoding type "${c.encoding}"`);var l,d=g.open(i,c.flags),S=g.stat(i),$=S.size,O=new Uint8Array($);return g.read(d,O,0,$,0),c.encoding==="utf8"?l=fa(O):c.encoding==="binary"&&(l=O),g.close(d),l},writeFile(i,c,l={}){l.flags=l.flags||577;var d=g.open(i,l.flags,l.mode);if(typeof c=="string"){var S=new Uint8Array(da(c)+1),$=hg(c,S,0,S.length);g.write(d,S,0,$,void 0,l.canOwn)}else if(ArrayBuffer.isView(c))g.write(d,c,0,c.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");g.close(d)},cwd:()=>g.currentPath,chdir(i){var c=g.lookupPath(i,{follow:!0});if(c.node===null)throw new g.ErrnoError(44);if(!g.isDir(c.node.mode))throw new g.ErrnoError(54);var l=g.nodePermissions(c.node,"x");if(l)throw new g.ErrnoError(l);g.currentPath=c.path},createDefaultDirectories(){g.mkdir("/tmp"),g.mkdir("/home"),g.mkdir("/home/web_user")},createDefaultDevices(){g.mkdir("/dev"),g.registerDevice(g.makedev(1,3),{read:()=>0,write:(d,S,$,O,F)=>O,llseek:()=>0}),g.mkdev("/dev/null",g.makedev(1,3)),Wo.register(g.makedev(5,0),Wo.default_tty_ops),Wo.register(g.makedev(6,0),Wo.default_tty1_ops),g.mkdev("/dev/tty",g.makedev(5,0)),g.mkdev("/dev/tty1",g.makedev(6,0));var i=new Uint8Array(1024),c=0,l=()=>(c===0&&(c=Jv(i).byteLength),i[--c]);g.createDevice("/dev","random",l),g.createDevice("/dev","urandom",l),g.mkdir("/dev/shm"),g.mkdir("/dev/shm/tmp")},createSpecialDirectories(){g.mkdir("/proc");var i=g.mkdir("/proc/self");g.mkdir("/proc/self/fd"),g.mount({mount(){var c=g.createNode(i,"fd",16895,73);return c.node_ops={lookup(l,d){var S=+d,$=g.getStreamChecked(S),O={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>$.path}};return O.parent=O,O}},c}},{},"/proc/self/fd")},createStandardStreams(i,c,l){i?g.createDevice("/dev","stdin",i):g.symlink("/dev/tty","/dev/stdin"),c?g.createDevice("/dev","stdout",null,c):g.symlink("/dev/tty","/dev/stdout"),l?g.createDevice("/dev","stderr",null,l):g.symlink("/dev/tty1","/dev/stderr"),g.open("/dev/stdin",0),g.open("/dev/stdout",1),g.open("/dev/stderr",1)},staticInit(){g.nameTable=new Array(4096),g.mount(Ee,{},"/"),g.createDefaultDirectories(),g.createDefaultDevices(),g.createSpecialDirectories(),g.filesystems={MEMFS:Ee}},init(i,c,l){g.initialized=!0,i??=r.stdin,c??=r.stdout,l??=r.stderr,g.createStandardStreams(i,c,l)},quit(){g.initialized=!1;for(var i=0;i<g.streams.length;i++){var c=g.streams[i];c&&g.close(c)}},findObject(i,c){var l=g.analyzePath(i,c);return l.exists?l.object:null},analyzePath(i,c){try{var l=g.lookupPath(i,{follow:!c});i=l.path}catch{}var d={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=g.lookupPath(i,{parent:!0});d.parentExists=!0,d.parentPath=l.path,d.parentObject=l.node,d.name=Ze.basename(i),l=g.lookupPath(i,{follow:!c}),d.exists=!0,d.path=l.path,d.object=l.node,d.name=l.node.name,d.isRoot=l.path==="/"}catch(S){d.error=S.errno}return d},createPath(i,c,l,d){i=typeof i=="string"?i:g.getPath(i);for(var S=c.split("/").reverse();S.length;){var $=S.pop();if($){var O=Ze.join2(i,$);try{g.mkdir(O)}catch{}i=O}}return O},createFile(i,c,l,d,S){var $=Ze.join2(typeof i=="string"?i:g.getPath(i),c),O=mg(d,S);return g.create($,O)},createDataFile(i,c,l,d,S,$){var O=c;i&&(i=typeof i=="string"?i:g.getPath(i),O=c?Ze.join2(i,c):i);var F=mg(d,S),z=g.create(O,F);if(l){if(typeof l=="string"){for(var ee=new Array(l.length),ye=0,Fe=l.length;ye<Fe;++ye)ee[ye]=l.charCodeAt(ye);l=ee}g.chmod(z,F|146);var Re=g.open(z,577);g.write(Re,l,0,l.length,0,$),g.close(Re),g.chmod(z,F)}},createDevice(i,c,l,d){var S=Ze.join2(typeof i=="string"?i:g.getPath(i),c),$=mg(!!l,!!d);g.createDevice.major??=64;var O=g.makedev(g.createDevice.major++,0);return g.registerDevice(O,{open(F){F.seekable=!1},close(F){d?.buffer?.length&&d(10)},read(F,z,ee,ye,Fe){for(var Re=0,de=0;de<ye;de++){var ce;try{ce=l()}catch{throw new g.ErrnoError(29)}if(ce===void 0&&Re===0)throw new g.ErrnoError(6);if(ce==null)break;Re++,z[ee+de]=ce}return Re&&(F.node.timestamp=Date.now()),Re},write(F,z,ee,ye,Fe){for(var Re=0;Re<ye;Re++)try{d(z[ee+Re])}catch{throw new g.ErrnoError(29)}return ye&&(F.node.timestamp=Date.now()),Re}}),g.mkdev(S,$,O)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=D(i.url),i.usedBytes=i.contents.length}catch{throw new g.ErrnoError(29)}},createLazyFile(i,c,l,d,S){class ${lengthKnown=!1;chunks=[];get(de){if(!(de>this.length-1||de<0)){var ce=de%this.chunkSize,Et=de/this.chunkSize|0;return this.getter(Et)[ce]}}setDataGetter(de){this.getter=de}cacheLength(){var de=new XMLHttpRequest;if(de.open("HEAD",l,!1),de.send(null),!(de.status>=200&&de.status<300||de.status===304))throw new Error("Couldn't load "+l+". Status: "+de.status);var ce=Number(de.getResponseHeader("Content-length")),Et,Vn=(Et=de.getResponseHeader("Accept-Ranges"))&&Et==="bytes",Kn=(Et=de.getResponseHeader("Content-Encoding"))&&Et==="gzip",Tr=1024*1024;Vn||(Tr=ce);var Cr=(zr,ma)=>{if(zr>ma)throw new Error("invalid range ("+zr+", "+ma+") or no bytes requested!");if(ma>ce-1)throw new Error("only "+ce+" bytes available! programmer error!");var an=new XMLHttpRequest;if(an.open("GET",l,!1),ce!==Tr&&an.setRequestHeader("Range","bytes="+zr+"-"+ma),an.responseType="arraybuffer",an.overrideMimeType&&an.overrideMimeType("text/plain; charset=x-user-defined"),an.send(null),!(an.status>=200&&an.status<300||an.status===304))throw new Error("Couldn't load "+l+". Status: "+an.status);return an.response!==void 0?new Uint8Array(an.response||[]):pg(an.responseText||"",!0)},yu=this;yu.setDataGetter(zr=>{var ma=zr*Tr,an=(zr+1)*Tr-1;if(an=Math.min(an,ce-1),typeof yu.chunks[zr]>"u"&&(yu.chunks[zr]=Cr(ma,an)),typeof yu.chunks[zr]>"u")throw new Error("doXHR failed!");return yu.chunks[zr]}),(Kn||!ce)&&(Tr=ce=1,ce=this.getter(0).length,Tr=ce,y("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=ce,this._chunkSize=Tr,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var O=new $,F={isDevice:!1,contents:O}}else var F={isDevice:!1,url:l};var z=g.createFile(i,c,F,d,S);F.contents?z.contents=F.contents:F.url&&(z.contents=null,z.url=F.url),Object.defineProperties(z,{usedBytes:{get:function(){return this.contents.length}}});var ee={},ye=Object.keys(z.stream_ops);ye.forEach(Re=>{var de=z.stream_ops[Re];ee[Re]=(...ce)=>(g.forceLoadFile(z),de(...ce))});function Fe(Re,de,ce,Et,Vn){var Kn=Re.node.contents;if(Vn>=Kn.length)return 0;var Tr=Math.min(Kn.length-Vn,Et);if(Kn.slice)for(var Cr=0;Cr<Tr;Cr++)de[ce+Cr]=Kn[Vn+Cr];else for(var Cr=0;Cr<Tr;Cr++)de[ce+Cr]=Kn.get(Vn+Cr);return Tr}return ee.read=(Re,de,ce,Et,Vn)=>(g.forceLoadFile(z),Fe(Re,de,ce,Et,Vn)),ee.mmap=(Re,de,ce,Et,Vn)=>{g.forceLoadFile(z);var Kn=Xv(de);if(!Kn)throw new g.ErrnoError(48);return Fe(Re,q,Kn,de,ce),{ptr:Kn,allocated:!0}},z.stream_ops=ee,z}},xe={DEFAULT_POLLMASK:5,calculateAt(i,c,l){if(Ze.isAbs(c))return c;var d;if(i===-100)d=g.cwd();else{var S=xe.getStreamFromFD(i);d=S.path}if(c.length==0){if(!l)throw new g.ErrnoError(44);return d}return Ze.join2(d,c)},doStat(i,c,l){var d=i(c);P[l>>2]=d.dev,P[l+4>>2]=d.mode,L[l+8>>2]=d.nlink,P[l+12>>2]=d.uid,P[l+16>>2]=d.gid,P[l+20>>2]=d.rdev,_t=[d.size>>>0,(_e=d.size,+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[l+24>>2]=_t[0],P[l+28>>2]=_t[1],P[l+32>>2]=4096,P[l+36>>2]=d.blocks;var S=d.atime.getTime(),$=d.mtime.getTime(),O=d.ctime.getTime();return _t=[Math.floor(S/1e3)>>>0,(_e=Math.floor(S/1e3),+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[l+40>>2]=_t[0],P[l+44>>2]=_t[1],L[l+48>>2]=S%1e3*1e3*1e3,_t=[Math.floor($/1e3)>>>0,(_e=Math.floor($/1e3),+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[l+56>>2]=_t[0],P[l+60>>2]=_t[1],L[l+64>>2]=$%1e3*1e3*1e3,_t=[Math.floor(O/1e3)>>>0,(_e=Math.floor(O/1e3),+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[l+72>>2]=_t[0],P[l+76>>2]=_t[1],L[l+80>>2]=O%1e3*1e3*1e3,_t=[d.ino>>>0,(_e=d.ino,+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[l+88>>2]=_t[0],P[l+92>>2]=_t[1],0},doMsync(i,c,l,d,S){if(!g.isFile(c.node.mode))throw new g.ErrnoError(43);if(d&2)return 0;var $=x.slice(i,i+l);g.msync(c,$,S,l,d)},getStreamFromFD(i){var c=g.getStreamChecked(i);return c},varargs:void 0,getStr(i){var c=Ho(i);return c}};function GF(i,c){try{return i=xe.getStr(i),g.chmod(i,c),0}catch(l){if(typeof g>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function QF(i,c,l,d){try{if(c=xe.getStr(c),c=xe.calculateAt(i,c),l&-8)return-28;var S=g.lookupPath(c,{follow:!0}),$=S.node;if(!$)return-44;var O="";return l&4&&(O+="r"),l&2&&(O+="w"),l&1&&(O+="x"),O&&g.nodePermissions($,O)?-2:0}catch(F){if(typeof g>"u"||F.name!=="ErrnoError")throw F;return-F.errno}}function JF(i,c){try{return g.fchmod(i,c),0}catch(l){if(typeof g>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function YF(i,c,l){try{return g.fchown(i,c,l),0}catch(d){if(typeof g>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}var Zf=()=>{var i=P[+xe.varargs>>2];return xe.varargs+=4,i},XF=Zf;function ZF(i,c,l){xe.varargs=l;try{var d=xe.getStreamFromFD(i);switch(c){case 0:{var S=Zf();if(S<0)return-28;for(;g.streams[S];)S++;var $;return $=g.dupStream(d,S),$.fd}case 1:case 2:return 0;case 3:return d.flags;case 4:{var S=Zf();return d.flags|=S,0}case 12:{var S=XF(),O=0;return N[S+O>>1]=2,0}case 13:case 14:return 0}return-28}catch(F){if(typeof g>"u"||F.name!=="ErrnoError")throw F;return-F.errno}}function eP(i,c){try{var l=xe.getStreamFromFD(i);return xe.doStat(g.stat,l.path,c)}catch(d){if(typeof g>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}var gu=(i,c)=>c+2097152>>>0<4194305-!!i?(i>>>0)+c*4294967296:NaN;function tP(i,c,l){var d=gu(c,l);try{return isNaN(d)?61:(g.ftruncate(i,d),0)}catch(S){if(typeof g>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}var Js=(i,c,l)=>hg(i,x,c,l);function nP(i,c){try{if(c===0)return-28;var l=g.cwd(),d=da(l)+1;return c<d?-68:(Js(l,i,c),d)}catch(S){if(typeof g>"u"||S.name!=="ErrnoError")throw S;return-S.errno}}function rP(i,c){try{return i=xe.getStr(i),xe.doStat(g.lstat,i,c)}catch(l){if(typeof g>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function sP(i,c,l){try{return c=xe.getStr(c),c=xe.calculateAt(i,c),c=Ze.normalize(c),c[c.length-1]==="/"&&(c=c.substr(0,c.length-1)),g.mkdir(c,l,0),0}catch(d){if(typeof g>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function oP(i,c,l,d){try{c=xe.getStr(c);var S=d&256,$=d&4096;return d=d&-6401,c=xe.calculateAt(i,c,$),xe.doStat(S?g.lstat:g.stat,c,l)}catch(O){if(typeof g>"u"||O.name!=="ErrnoError")throw O;return-O.errno}}function iP(i,c,l,d){xe.varargs=d;try{c=xe.getStr(c),c=xe.calculateAt(i,c);var S=d?Zf():0;return g.open(c,l,S).fd}catch($){if(typeof g>"u"||$.name!=="ErrnoError")throw $;return-$.errno}}function aP(i,c,l,d){try{if(c=xe.getStr(c),c=xe.calculateAt(i,c),d<=0)return-28;var S=g.readlink(c),$=Math.min(d,da(S)),O=q[l+$];return Js(S,l,d+1),q[l+$]=O,$}catch(F){if(typeof g>"u"||F.name!=="ErrnoError")throw F;return-F.errno}}function cP(i){try{return i=xe.getStr(i),g.rmdir(i),0}catch(c){if(typeof g>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function uP(i,c){try{return i=xe.getStr(i),xe.doStat(g.stat,i,c)}catch(l){if(typeof g>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function lP(i,c,l){try{return c=xe.getStr(c),c=xe.calculateAt(i,c),l===0?g.unlink(c):l===512?g.rmdir(c):Gs("Invalid flags passed to unlinkat"),0}catch(d){if(typeof g>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}var Zv=i=>L[i>>2]+P[i+4>>2]*4294967296;function fP(i,c,l,d){try{c=xe.getStr(c),c=xe.calculateAt(i,c,!0);var S=Date.now(),$,O;if(!l)$=S,O=S;else{var F=Zv(l),z=P[l+8>>2];z==1073741823?$=S:z==1073741822?$=-1:$=F*1e3+z/(1e3*1e3),l+=16,F=Zv(l),z=P[l+8>>2],z==1073741823?O=S:z==1073741822?O=-1:O=F*1e3+z/(1e3*1e3)}return(O!=-1||$!=-1)&&g.utime(c,$,O),0}catch(ee){if(typeof g>"u"||ee.name!=="ErrnoError")throw ee;return-ee.errno}}var dP=i=>i%4===0&&(i%100!==0||i%400===0),hP=[0,31,60,91,121,152,182,213,244,274,305,335],pP=[0,31,59,90,120,151,181,212,243,273,304,334],mP=i=>{var c=dP(i.getFullYear()),l=c?hP:pP,d=l[i.getMonth()]+i.getDate()-1;return d};function gP(i,c,l){var d=gu(i,c),S=new Date(d*1e3);P[l>>2]=S.getSeconds(),P[l+4>>2]=S.getMinutes(),P[l+8>>2]=S.getHours(),P[l+12>>2]=S.getDate(),P[l+16>>2]=S.getMonth(),P[l+20>>2]=S.getFullYear()-1900,P[l+24>>2]=S.getDay();var $=mP(S)|0;P[l+28>>2]=$,P[l+36>>2]=-(S.getTimezoneOffset()*60);var O=new Date(S.getFullYear(),0,1),F=new Date(S.getFullYear(),6,1).getTimezoneOffset(),z=O.getTimezoneOffset(),ee=(F!=z&&S.getTimezoneOffset()==Math.min(z,F))|0;P[l+32>>2]=ee}function _P(i,c,l,d,S,$,O,F){var z=gu(S,$);try{if(isNaN(z))return 61;var ee=xe.getStreamFromFD(d),ye=g.mmap(ee,i,z,c,l),Fe=ye.ptr;return P[O>>2]=ye.allocated,L[F>>2]=Fe,0}catch(Re){if(typeof g>"u"||Re.name!=="ErrnoError")throw Re;return-Re.errno}}function yP(i,c,l,d,S,$,O){var F=gu($,O);try{var z=xe.getStreamFromFD(S);l&2&&xe.doMsync(i,z,c,d,F)}catch(ee){if(typeof g>"u"||ee.name!=="ErrnoError")throw ee;return-ee.errno}}var bP=(i,c,l,d)=>{var S=new Date().getFullYear(),$=new Date(S,0,1),O=new Date(S,6,1),F=$.getTimezoneOffset(),z=O.getTimezoneOffset(),ee=Math.max(F,z);L[i>>2]=ee*60,P[c>>2]=+(F!=z);var ye=de=>{var ce=de>=0?"-":"+",Et=Math.abs(de),Vn=String(Math.floor(Et/60)).padStart(2,"0"),Kn=String(Et%60).padStart(2,"0");return`UTC${ce}${Vn}${Kn}`},Fe=ye(F),Re=ye(z);z<F?(Js(Fe,l,17),Js(Re,d,17)):(Js(Fe,d,17),Js(Re,l,17))},SP=()=>Date.now(),wP=()=>performance.now(),vP=()=>2147483648,EP=i=>{var c=E.buffer,l=(i-c.byteLength+65535)/65536|0;try{return E.grow(l),J(),1}catch{}},kP=i=>{var c=x.length;i>>>=0;var l=vP();if(i>l)return!1;for(var d=1;d<=4;d*=2){var S=c*(1+.2/d);S=Math.min(S,i+100663296);var $=Math.min(l,Yv(Math.max(i,S),65536)),O=EP($);if(O)return!0}return!1},gg={},TP=()=>p||"./this.program",_u=()=>{if(!_u.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:TP()};for(var l in gg)gg[l]===void 0?delete c[l]:c[l]=gg[l];var d=[];for(var l in c)d.push(`${l}=${c[l]}`);_u.strings=d}return _u.strings},CP=(i,c)=>{for(var l=0;l<i.length;++l)q[c++]=i.charCodeAt(l);q[c]=0},IP=(i,c)=>{var l=0;return _u().forEach((d,S)=>{var $=c+l;L[i+S*4>>2]=$,CP(d,$),l+=d.length+1}),0},$P=(i,c)=>{var l=_u();L[i>>2]=l.length;var d=0;return l.forEach(S=>d+=S.length+1),L[c>>2]=d,0};function RP(i){try{var c=xe.getStreamFromFD(i);return g.close(c),0}catch(l){if(typeof g>"u"||l.name!=="ErrnoError")throw l;return l.errno}}function AP(i,c){try{var l=0,d=0,S=0,$=xe.getStreamFromFD(i),O=$.tty?2:g.isDir($.mode)?3:g.isLink($.mode)?7:4;return q[c]=O,N[c+2>>1]=S,_t=[l>>>0,(_e=l,+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[c+8>>2]=_t[0],P[c+12>>2]=_t[1],_t=[d>>>0,(_e=d,+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[c+16>>2]=_t[0],P[c+20>>2]=_t[1],0}catch(F){if(typeof g>"u"||F.name!=="ErrnoError")throw F;return F.errno}}var qP=(i,c,l,d)=>{for(var S=0,$=0;$<l;$++){var O=L[c>>2],F=L[c+4>>2];c+=8;var z=g.read(i,q,O,F,d);if(z<0)return-1;if(S+=z,z<F)break}return S};function OP(i,c,l,d){try{var S=xe.getStreamFromFD(i),$=qP(S,c,l);return L[d>>2]=$,0}catch(O){if(typeof g>"u"||O.name!=="ErrnoError")throw O;return O.errno}}function xP(i,c,l,d,S){var $=gu(c,l);try{if(isNaN($))return 61;var O=xe.getStreamFromFD(i);return g.llseek(O,$,d),_t=[O.position>>>0,(_e=O.position,+Math.abs(_e)>=1?_e>0?+Math.floor(_e/4294967296)>>>0:~~+Math.ceil((_e-+(~~_e>>>0))/4294967296)>>>0:0)],P[S>>2]=_t[0],P[S+4>>2]=_t[1],O.getdents&&$===0&&d===0&&(O.getdents=null),0}catch(F){if(typeof g>"u"||F.name!=="ErrnoError")throw F;return F.errno}}function FP(i){try{var c=xe.getStreamFromFD(i);return c.stream_ops?.fsync?c.stream_ops.fsync(c):0}catch(l){if(typeof g>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var PP=(i,c,l,d)=>{for(var S=0,$=0;$<l;$++){var O=L[c>>2],F=L[c+4>>2];c+=8;var z=g.write(i,q,O,F,d);if(z<0)return-1;if(S+=z,z<F)break}return S};function DP(i,c,l,d){try{var S=xe.getStreamFromFD(i),$=PP(S,c,l);return L[d>>2]=$,0}catch(O){if(typeof g>"u"||O.name!=="ErrnoError")throw O;return O.errno}}var je=function(){const i=typeof Asyncify=="object"?Asyncify.handleAsync.bind(Asyncify):null;r.handleAsync=i;const c=new Map;r.setCallback=(l,d)=>c.set(l,d),r.getCallback=l=>c.get(l),r.deleteCallback=l=>c.delete(l),je=function(l,d,...S){const $=c.get(d);let O=null;const F=typeof $=="function"?$:$[O=Ho(S.shift())];if(l){if(i)return i(()=>F.apply($,S));throw new Error("Synchronous WebAssembly cannot call async function")}const z=F.apply($,S);if(typeof z?.then=="function")throw console.error("unexpected Promise",F),new Error(`${O} unexpectedly returned a Promise`);return z}};function NP(...i){return je(!1,...i)}function MP(...i){return je(!0,...i)}function LP(...i){return je(!1,...i)}function UP(...i){return je(!0,...i)}function jP(...i){return je(!1,...i)}function zP(...i){return je(!0,...i)}function BP(...i){return je(!1,...i)}function HP(...i){return je(!0,...i)}function WP(...i){return je(!1,...i)}function VP(...i){return je(!0,...i)}function KP(...i){return je(!1,...i)}function GP(...i){return je(!0,...i)}function QP(...i){return je(!1,...i)}function JP(...i){return je(!0,...i)}function YP(...i){return je(!1,...i)}function XP(...i){return je(!0,...i)}function ZP(...i){return je(!1,...i)}function e2(...i){return je(!0,...i)}function t2(...i){return je(!1,...i)}function n2(...i){return je(!0,...i)}function r2(...i){return je(!1,...i)}function s2(...i){return je(!0,...i)}function o2(...i){return je(!1,...i)}function i2(...i){return je(!0,...i)}function a2(...i){return je(!1,...i)}function c2(...i){return je(!0,...i)}function u2(...i){return je(!1,...i)}function l2(...i){return je(!0,...i)}function f2(...i){return je(!1,...i)}function d2(...i){return je(!0,...i)}function h2(...i){return je(!1,...i)}function p2(...i){return je(!0,...i)}var m2=i=>{R=i,m(i,new Kv(i))},g2=(i,c)=>{R=i,m2(i)},_2=i=>{if(i instanceof Kv||i=="unwind")return R;m(1,i)},eE=(i,c)=>{i<128?c.push(i):c.push(i%128|128,i>>7)},y2=i=>{for(var c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},l={parameters:[],results:i[0]=="v"?[]:[c[i[0]]]},d=1;d<i.length;++d)l.parameters.push(c[i[d]]);return l},b2=(i,c)=>{var l=i.slice(0,1),d=i.slice(1),S={i:127,p:127,j:126,f:125,d:124,e:111};c.push(96),eE(d.length,c);for(var $=0;$<d.length;++$)c.push(S[d[$]]);l=="v"?c.push(0):c.push(1,S[l])},S2=(i,c)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(y2(c),i);var l=[1];b2(c,l);var d=[0,97,115,109,1,0,0,0,1];eE(l.length,d),d.push(...l),d.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var S=new WebAssembly.Module(new Uint8Array(d)),$=new WebAssembly.Instance(S,{e:{f:i}}),O=$.exports.f;return O},ha,w2=i=>ha.get(i),v2=(i,c)=>{if(pa)for(var l=i;l<i+c;l++){var d=w2(l);d&&pa.set(d,l)}},pa,E2=i=>(pa||(pa=new WeakMap,v2(0,ha.length)),pa.get(i)||0),tE=[],k2=()=>{if(tE.length)return tE.pop();try{ha.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return ha.length-1},nE=(i,c)=>ha.set(i,c),T2=(i,c)=>{var l=E2(i);if(l)return l;var d=k2();try{nE(d,i)}catch($){if(!($ instanceof TypeError))throw $;var S=S2(i,c);nE(d,S)}return pa.set(i,d),d},rE=i=>{var c=r["_"+i];return c},sE=(i,c)=>{q.set(i,c)},oE=i=>fE(i),C2=i=>{var c=da(i)+1,l=oE(c);return Js(i,l,c),l},Ys=(i,c,l,d,S)=>{var $={string:ce=>{var Et=0;return ce!=null&&ce!==0&&(Et=C2(ce)),Et},array:ce=>{var Et=oE(ce.length);return sE(ce,Et),Et}};function O(ce){return c==="string"?Ho(ce):c==="boolean"?!!ce:ce}var F=rE(i),z=[],ee=0;if(d)for(var ye=0;ye<d.length;ye++){var Fe=$[l[ye]];Fe?(ee===0&&(ee=NF()),z[ye]=Fe(d[ye])):z[ye]=d[ye]}var Re=F(...z);function de(ce){return ee!==0&&DF(ee),O(ce)}return Re=de(Re),Re},I2=(i,c,l,d)=>{var S=!l||l.every(O=>O==="number"||O==="boolean"),$=c!=="string";return $&&S&&!d?rE(i):(...O)=>Ys(i,c,l,O)},$2=i=>uE(),R2=(i,c,l)=>{if(l??=2147483647,l<2)return 0;l-=2;for(var d=c,S=l<i.length*2?l/2:i.length,$=0;$<S;++$){var O=i.charCodeAt($);N[c>>1]=O,c+=2}return N[c>>1]=0,c-d},A2=(i,c,l)=>{if(l??=2147483647,l<4)return 0;for(var d=c,S=d+l-4,$=0;$<i.length;++$){var O=i.charCodeAt($);if(O>=55296&&O<=57343){var F=i.charCodeAt(++$);O=65536+((O&1023)<<10)|F&1023}if(P[c>>2]=O,c+=4,c+4>S)break}return P[c>>2]=0,c-d},q2=i=>{for(var c="";;){var l=x[i++];if(!l)return c;c+=String.fromCharCode(l)}},iE=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,O2=(i,c)=>{for(var l=i,d=l>>1,S=d+c/2;!(d>=S)&&j[d];)++d;if(l=d<<1,l-i>32&&iE)return iE.decode(x.subarray(i,l));for(var $="",O=0;!(O>=c/2);++O){var F=N[i+O*2>>1];if(F==0)break;$+=String.fromCharCode(F)}return $},x2=(i,c)=>{for(var l=0,d="";!(l>=c/4);){var S=P[i+l*4>>2];if(S==0)break;if(++l,S>=65536){var $=S-65536;d+=String.fromCharCode(55296|$>>10,56320|$&1023)}else d+=String.fromCharCode(S)}return d};function F2(i){for(var c=[],l=0;l<i.length;l++){var d=i[l];d>255&&(d&=255),c.push(String.fromCharCode(d))}return c.join("")}g.createPreloadedFile=VF,g.staticInit(),Ee.doesNotExistError=new g.ErrnoError(44),Ee.doesNotExistError.stack="<generic error, no stack>",je();var P2={a:MF,Y:GF,$:QF,Z:JF,X:YF,b:ZF,W:eP,y:tP,Q:nP,U:rP,N:sP,S:oP,L:iP,J:aP,I:cP,V:uP,G:lP,F:fP,w:gP,u:_P,v:yP,M:bP,n:SP,m:wP,D:kP,O:IP,P:$P,o:RP,E:AP,K:OP,x:xP,R:FP,H:DP,s:NP,t:MP,ga:LP,ka:UP,i:jP,j:zP,c:BP,d:HP,ca:WP,da:VP,ea:KP,fa:GP,g:QP,h:JP,z:YP,A:XP,e:ZP,f:e2,aa:t2,ba:n2,B:r2,C:s2,p:o2,q:i2,ha:a2,ia:c2,ja:u2,r:l2,k:f2,l:d2,T:h2,_:p2},I=PF();r._sqlite3_status64=(i,c,l,d)=>(r._sqlite3_status64=I.na)(i,c,l,d),r._sqlite3_status=(i,c,l,d)=>(r._sqlite3_status=I.oa)(i,c,l,d),r._sqlite3_db_status=(i,c,l,d,S)=>(r._sqlite3_db_status=I.pa)(i,c,l,d,S),r._sqlite3_msize=i=>(r._sqlite3_msize=I.qa)(i),r._sqlite3_vfs_find=i=>(r._sqlite3_vfs_find=I.ra)(i),r._sqlite3_vfs_register=(i,c)=>(r._sqlite3_vfs_register=I.sa)(i,c),r._sqlite3_vfs_unregister=i=>(r._sqlite3_vfs_unregister=I.ta)(i),r._sqlite3_release_memory=i=>(r._sqlite3_release_memory=I.ua)(i),r._sqlite3_soft_heap_limit64=(i,c)=>(r._sqlite3_soft_heap_limit64=I.va)(i,c),r._sqlite3_memory_used=()=>(r._sqlite3_memory_used=I.wa)(),r._sqlite3_hard_heap_limit64=(i,c)=>(r._sqlite3_hard_heap_limit64=I.xa)(i,c),r._sqlite3_memory_highwater=i=>(r._sqlite3_memory_highwater=I.ya)(i),r._sqlite3_malloc=i=>(r._sqlite3_malloc=I.za)(i),r._sqlite3_malloc64=(i,c)=>(r._sqlite3_malloc64=I.Aa)(i,c),r._sqlite3_free=i=>(r._sqlite3_free=I.Ba)(i),r._sqlite3_realloc=(i,c)=>(r._sqlite3_realloc=I.Ca)(i,c),r._sqlite3_realloc64=(i,c,l)=>(r._sqlite3_realloc64=I.Da)(i,c,l),r._sqlite3_str_vappendf=(i,c,l)=>(r._sqlite3_str_vappendf=I.Ea)(i,c,l),r._sqlite3_str_append=(i,c,l)=>(r._sqlite3_str_append=I.Fa)(i,c,l),r._sqlite3_str_appendchar=(i,c,l)=>(r._sqlite3_str_appendchar=I.Ga)(i,c,l),r._sqlite3_str_appendall=(i,c)=>(r._sqlite3_str_appendall=I.Ha)(i,c),r._sqlite3_str_appendf=(i,c,l)=>(r._sqlite3_str_appendf=I.Ia)(i,c,l),r._sqlite3_str_finish=i=>(r._sqlite3_str_finish=I.Ja)(i),r._sqlite3_str_errcode=i=>(r._sqlite3_str_errcode=I.Ka)(i),r._sqlite3_str_length=i=>(r._sqlite3_str_length=I.La)(i),r._sqlite3_str_value=i=>(r._sqlite3_str_value=I.Ma)(i),r._sqlite3_str_reset=i=>(r._sqlite3_str_reset=I.Na)(i),r._sqlite3_str_new=i=>(r._sqlite3_str_new=I.Oa)(i),r._sqlite3_vmprintf=(i,c)=>(r._sqlite3_vmprintf=I.Pa)(i,c),r._sqlite3_mprintf=(i,c)=>(r._sqlite3_mprintf=I.Qa)(i,c),r._sqlite3_vsnprintf=(i,c,l,d)=>(r._sqlite3_vsnprintf=I.Ra)(i,c,l,d),r._sqlite3_snprintf=(i,c,l,d)=>(r._sqlite3_snprintf=I.Sa)(i,c,l,d),r._sqlite3_log=(i,c,l)=>(r._sqlite3_log=I.Ta)(i,c,l),r._sqlite3_randomness=(i,c)=>(r._sqlite3_randomness=I.Ua)(i,c),r._sqlite3_stricmp=(i,c)=>(r._sqlite3_stricmp=I.Va)(i,c),r._sqlite3_strnicmp=(i,c,l)=>(r._sqlite3_strnicmp=I.Wa)(i,c,l),r._sqlite3_os_init=()=>(r._sqlite3_os_init=I.Xa)(),r._sqlite3_os_end=()=>(r._sqlite3_os_end=I.Ya)(),r._sqlite3_serialize=(i,c,l,d)=>(r._sqlite3_serialize=I.Za)(i,c,l,d),r._sqlite3_prepare_v2=(i,c,l,d,S)=>(r._sqlite3_prepare_v2=I._a)(i,c,l,d,S),r._sqlite3_step=i=>(r._sqlite3_step=I.$a)(i),r._sqlite3_column_int64=(i,c)=>(r._sqlite3_column_int64=I.ab)(i,c),r._sqlite3_reset=i=>(r._sqlite3_reset=I.bb)(i),r._sqlite3_exec=(i,c,l,d,S)=>(r._sqlite3_exec=I.cb)(i,c,l,d,S),r._sqlite3_column_int=(i,c)=>(r._sqlite3_column_int=I.db)(i,c),r._sqlite3_finalize=i=>(r._sqlite3_finalize=I.eb)(i),r._sqlite3_deserialize=(i,c,l,d,S,$,O,F)=>(r._sqlite3_deserialize=I.fb)(i,c,l,d,S,$,O,F),r._sqlite3_database_file_object=i=>(r._sqlite3_database_file_object=I.gb)(i),r._sqlite3_backup_init=(i,c,l,d)=>(r._sqlite3_backup_init=I.hb)(i,c,l,d),r._sqlite3_backup_step=(i,c)=>(r._sqlite3_backup_step=I.ib)(i,c),r._sqlite3_backup_finish=i=>(r._sqlite3_backup_finish=I.jb)(i),r._sqlite3_backup_remaining=i=>(r._sqlite3_backup_remaining=I.kb)(i),r._sqlite3_backup_pagecount=i=>(r._sqlite3_backup_pagecount=I.lb)(i),r._sqlite3_clear_bindings=i=>(r._sqlite3_clear_bindings=I.mb)(i),r._sqlite3_value_blob=i=>(r._sqlite3_value_blob=I.nb)(i),r._sqlite3_value_text=i=>(r._sqlite3_value_text=I.ob)(i),r._sqlite3_value_bytes=i=>(r._sqlite3_value_bytes=I.pb)(i),r._sqlite3_value_bytes16=i=>(r._sqlite3_value_bytes16=I.qb)(i),r._sqlite3_value_double=i=>(r._sqlite3_value_double=I.rb)(i),r._sqlite3_value_int=i=>(r._sqlite3_value_int=I.sb)(i),r._sqlite3_value_int64=i=>(r._sqlite3_value_int64=I.tb)(i),r._sqlite3_value_subtype=i=>(r._sqlite3_value_subtype=I.ub)(i),r._sqlite3_value_pointer=(i,c)=>(r._sqlite3_value_pointer=I.vb)(i,c),r._sqlite3_value_text16=i=>(r._sqlite3_value_text16=I.wb)(i),r._sqlite3_value_text16be=i=>(r._sqlite3_value_text16be=I.xb)(i),r._sqlite3_value_text16le=i=>(r._sqlite3_value_text16le=I.yb)(i),r._sqlite3_value_type=i=>(r._sqlite3_value_type=I.zb)(i),r._sqlite3_value_encoding=i=>(r._sqlite3_value_encoding=I.Ab)(i),r._sqlite3_value_nochange=i=>(r._sqlite3_value_nochange=I.Bb)(i),r._sqlite3_value_frombind=i=>(r._sqlite3_value_frombind=I.Cb)(i),r._sqlite3_value_dup=i=>(r._sqlite3_value_dup=I.Db)(i),r._sqlite3_value_free=i=>(r._sqlite3_value_free=I.Eb)(i),r._sqlite3_result_blob=(i,c,l,d)=>(r._sqlite3_result_blob=I.Fb)(i,c,l,d),r._sqlite3_result_blob64=(i,c,l,d,S)=>(r._sqlite3_result_blob64=I.Gb)(i,c,l,d,S),r._sqlite3_result_double=(i,c)=>(r._sqlite3_result_double=I.Hb)(i,c),r._sqlite3_result_error=(i,c,l)=>(r._sqlite3_result_error=I.Ib)(i,c,l),r._sqlite3_result_error16=(i,c,l)=>(r._sqlite3_result_error16=I.Jb)(i,c,l),r._sqlite3_result_int=(i,c)=>(r._sqlite3_result_int=I.Kb)(i,c),r._sqlite3_result_int64=(i,c,l)=>(r._sqlite3_result_int64=I.Lb)(i,c,l),r._sqlite3_result_null=i=>(r._sqlite3_result_null=I.Mb)(i),r._sqlite3_result_pointer=(i,c,l,d)=>(r._sqlite3_result_pointer=I.Nb)(i,c,l,d),r._sqlite3_result_subtype=(i,c)=>(r._sqlite3_result_subtype=I.Ob)(i,c),r._sqlite3_result_text=(i,c,l,d)=>(r._sqlite3_result_text=I.Pb)(i,c,l,d),r._sqlite3_result_text64=(i,c,l,d,S,$)=>(r._sqlite3_result_text64=I.Qb)(i,c,l,d,S,$),r._sqlite3_result_text16=(i,c,l,d)=>(r._sqlite3_result_text16=I.Rb)(i,c,l,d),r._sqlite3_result_text16be=(i,c,l,d)=>(r._sqlite3_result_text16be=I.Sb)(i,c,l,d),r._sqlite3_result_text16le=(i,c,l,d)=>(r._sqlite3_result_text16le=I.Tb)(i,c,l,d),r._sqlite3_result_value=(i,c)=>(r._sqlite3_result_value=I.Ub)(i,c),r._sqlite3_result_error_toobig=i=>(r._sqlite3_result_error_toobig=I.Vb)(i),r._sqlite3_result_zeroblob=(i,c)=>(r._sqlite3_result_zeroblob=I.Wb)(i,c),r._sqlite3_result_zeroblob64=(i,c,l)=>(r._sqlite3_result_zeroblob64=I.Xb)(i,c,l),r._sqlite3_result_error_code=(i,c)=>(r._sqlite3_result_error_code=I.Yb)(i,c),r._sqlite3_result_error_nomem=i=>(r._sqlite3_result_error_nomem=I.Zb)(i),r._sqlite3_user_data=i=>(r._sqlite3_user_data=I._b)(i),r._sqlite3_context_db_handle=i=>(r._sqlite3_context_db_handle=I.$b)(i),r._sqlite3_vtab_nochange=i=>(r._sqlite3_vtab_nochange=I.ac)(i),r._sqlite3_vtab_in_first=(i,c)=>(r._sqlite3_vtab_in_first=I.bc)(i,c),r._sqlite3_vtab_in_next=(i,c)=>(r._sqlite3_vtab_in_next=I.cc)(i,c),r._sqlite3_aggregate_context=(i,c)=>(r._sqlite3_aggregate_context=I.dc)(i,c),r._sqlite3_get_auxdata=(i,c)=>(r._sqlite3_get_auxdata=I.ec)(i,c),r._sqlite3_set_auxdata=(i,c,l,d)=>(r._sqlite3_set_auxdata=I.fc)(i,c,l,d),r._sqlite3_column_count=i=>(r._sqlite3_column_count=I.gc)(i),r._sqlite3_data_count=i=>(r._sqlite3_data_count=I.hc)(i),r._sqlite3_column_blob=(i,c)=>(r._sqlite3_column_blob=I.ic)(i,c),r._sqlite3_column_bytes=(i,c)=>(r._sqlite3_column_bytes=I.jc)(i,c),r._sqlite3_column_bytes16=(i,c)=>(r._sqlite3_column_bytes16=I.kc)(i,c),r._sqlite3_column_double=(i,c)=>(r._sqlite3_column_double=I.lc)(i,c),r._sqlite3_column_text=(i,c)=>(r._sqlite3_column_text=I.mc)(i,c),r._sqlite3_column_value=(i,c)=>(r._sqlite3_column_value=I.nc)(i,c),r._sqlite3_column_text16=(i,c)=>(r._sqlite3_column_text16=I.oc)(i,c),r._sqlite3_column_type=(i,c)=>(r._sqlite3_column_type=I.pc)(i,c),r._sqlite3_column_name=(i,c)=>(r._sqlite3_column_name=I.qc)(i,c),r._sqlite3_column_name16=(i,c)=>(r._sqlite3_column_name16=I.rc)(i,c),r._sqlite3_bind_blob=(i,c,l,d,S)=>(r._sqlite3_bind_blob=I.sc)(i,c,l,d,S),r._sqlite3_bind_blob64=(i,c,l,d,S,$)=>(r._sqlite3_bind_blob64=I.tc)(i,c,l,d,S,$),r._sqlite3_bind_double=(i,c,l)=>(r._sqlite3_bind_double=I.uc)(i,c,l),r._sqlite3_bind_int=(i,c,l)=>(r._sqlite3_bind_int=I.vc)(i,c,l),r._sqlite3_bind_int64=(i,c,l,d)=>(r._sqlite3_bind_int64=I.wc)(i,c,l,d),r._sqlite3_bind_null=(i,c)=>(r._sqlite3_bind_null=I.xc)(i,c),r._sqlite3_bind_pointer=(i,c,l,d,S)=>(r._sqlite3_bind_pointer=I.yc)(i,c,l,d,S),r._sqlite3_bind_text=(i,c,l,d,S)=>(r._sqlite3_bind_text=I.zc)(i,c,l,d,S),r._sqlite3_bind_text64=(i,c,l,d,S,$,O)=>(r._sqlite3_bind_text64=I.Ac)(i,c,l,d,S,$,O),r._sqlite3_bind_text16=(i,c,l,d,S)=>(r._sqlite3_bind_text16=I.Bc)(i,c,l,d,S),r._sqlite3_bind_value=(i,c,l)=>(r._sqlite3_bind_value=I.Cc)(i,c,l),r._sqlite3_bind_zeroblob=(i,c,l)=>(r._sqlite3_bind_zeroblob=I.Dc)(i,c,l),r._sqlite3_bind_zeroblob64=(i,c,l,d)=>(r._sqlite3_bind_zeroblob64=I.Ec)(i,c,l,d),r._sqlite3_bind_parameter_count=i=>(r._sqlite3_bind_parameter_count=I.Fc)(i),r._sqlite3_bind_parameter_name=(i,c)=>(r._sqlite3_bind_parameter_name=I.Gc)(i,c),r._sqlite3_bind_parameter_index=(i,c)=>(r._sqlite3_bind_parameter_index=I.Hc)(i,c),r._sqlite3_db_handle=i=>(r._sqlite3_db_handle=I.Ic)(i),r._sqlite3_stmt_readonly=i=>(r._sqlite3_stmt_readonly=I.Jc)(i),r._sqlite3_stmt_isexplain=i=>(r._sqlite3_stmt_isexplain=I.Kc)(i),r._sqlite3_stmt_explain=(i,c)=>(r._sqlite3_stmt_explain=I.Lc)(i,c),r._sqlite3_stmt_busy=i=>(r._sqlite3_stmt_busy=I.Mc)(i),r._sqlite3_next_stmt=(i,c)=>(r._sqlite3_next_stmt=I.Nc)(i,c),r._sqlite3_stmt_status=(i,c,l)=>(r._sqlite3_stmt_status=I.Oc)(i,c,l),r._sqlite3_sql=i=>(r._sqlite3_sql=I.Pc)(i),r._sqlite3_expanded_sql=i=>(r._sqlite3_expanded_sql=I.Qc)(i),r._sqlite3_value_numeric_type=i=>(r._sqlite3_value_numeric_type=I.Rc)(i),r._sqlite3_blob_open=(i,c,l,d,S,$,O,F)=>(r._sqlite3_blob_open=I.Sc)(i,c,l,d,S,$,O,F),r._sqlite3_blob_close=i=>(r._sqlite3_blob_close=I.Tc)(i),r._sqlite3_blob_read=(i,c,l,d)=>(r._sqlite3_blob_read=I.Uc)(i,c,l,d),r._sqlite3_blob_write=(i,c,l,d)=>(r._sqlite3_blob_write=I.Vc)(i,c,l,d),r._sqlite3_blob_bytes=i=>(r._sqlite3_blob_bytes=I.Wc)(i),r._sqlite3_blob_reopen=(i,c,l)=>(r._sqlite3_blob_reopen=I.Xc)(i,c,l),r._sqlite3_set_authorizer=(i,c,l)=>(r._sqlite3_set_authorizer=I.Yc)(i,c,l),r._sqlite3_strglob=(i,c)=>(r._sqlite3_strglob=I.Zc)(i,c),r._sqlite3_strlike=(i,c,l)=>(r._sqlite3_strlike=I._c)(i,c,l),r._sqlite3_errmsg=i=>(r._sqlite3_errmsg=I.$c)(i),r._sqlite3_auto_extension=i=>(r._sqlite3_auto_extension=I.ad)(i),r._sqlite3_cancel_auto_extension=i=>(r._sqlite3_cancel_auto_extension=I.bd)(i),r._sqlite3_reset_auto_extension=()=>(r._sqlite3_reset_auto_extension=I.cd)(),r._sqlite3_prepare=(i,c,l,d,S)=>(r._sqlite3_prepare=I.dd)(i,c,l,d,S),r._sqlite3_prepare_v3=(i,c,l,d,S,$)=>(r._sqlite3_prepare_v3=I.ed)(i,c,l,d,S,$),r._sqlite3_prepare16=(i,c,l,d,S)=>(r._sqlite3_prepare16=I.fd)(i,c,l,d,S),r._sqlite3_prepare16_v2=(i,c,l,d,S)=>(r._sqlite3_prepare16_v2=I.gd)(i,c,l,d,S),r._sqlite3_prepare16_v3=(i,c,l,d,S,$)=>(r._sqlite3_prepare16_v3=I.hd)(i,c,l,d,S,$),r._sqlite3_get_table=(i,c,l,d,S,$)=>(r._sqlite3_get_table=I.id)(i,c,l,d,S,$),r._sqlite3_free_table=i=>(r._sqlite3_free_table=I.jd)(i),r._sqlite3_create_module=(i,c,l,d)=>(r._sqlite3_create_module=I.kd)(i,c,l,d),r._sqlite3_create_module_v2=(i,c,l,d,S)=>(r._sqlite3_create_module_v2=I.ld)(i,c,l,d,S),r._sqlite3_drop_modules=(i,c)=>(r._sqlite3_drop_modules=I.md)(i,c),r._sqlite3_declare_vtab=(i,c)=>(r._sqlite3_declare_vtab=I.nd)(i,c),r._sqlite3_vtab_on_conflict=i=>(r._sqlite3_vtab_on_conflict=I.od)(i),r._sqlite3_vtab_config=(i,c,l)=>(r._sqlite3_vtab_config=I.pd)(i,c,l),r._sqlite3_vtab_collation=(i,c)=>(r._sqlite3_vtab_collation=I.qd)(i,c),r._sqlite3_vtab_in=(i,c,l)=>(r._sqlite3_vtab_in=I.rd)(i,c,l),r._sqlite3_vtab_rhs_value=(i,c,l)=>(r._sqlite3_vtab_rhs_value=I.sd)(i,c,l),r._sqlite3_vtab_distinct=i=>(r._sqlite3_vtab_distinct=I.td)(i),r._sqlite3_keyword_name=(i,c,l)=>(r._sqlite3_keyword_name=I.ud)(i,c,l),r._sqlite3_keyword_count=()=>(r._sqlite3_keyword_count=I.vd)(),r._sqlite3_keyword_check=(i,c)=>(r._sqlite3_keyword_check=I.wd)(i,c),r._sqlite3_complete=i=>(r._sqlite3_complete=I.xd)(i),r._sqlite3_complete16=i=>(r._sqlite3_complete16=I.yd)(i),r._sqlite3_libversion=()=>(r._sqlite3_libversion=I.zd)(),r._sqlite3_libversion_number=()=>(r._sqlite3_libversion_number=I.Ad)(),r._sqlite3_threadsafe=()=>(r._sqlite3_threadsafe=I.Bd)(),r._sqlite3_initialize=()=>(r._sqlite3_initialize=I.Cd)(),r._sqlite3_shutdown=()=>(r._sqlite3_shutdown=I.Dd)(),r._sqlite3_config=(i,c)=>(r._sqlite3_config=I.Ed)(i,c),r._sqlite3_db_mutex=i=>(r._sqlite3_db_mutex=I.Fd)(i),r._sqlite3_db_release_memory=i=>(r._sqlite3_db_release_memory=I.Gd)(i),r._sqlite3_db_cacheflush=i=>(r._sqlite3_db_cacheflush=I.Hd)(i),r._sqlite3_db_config=(i,c,l)=>(r._sqlite3_db_config=I.Id)(i,c,l),r._sqlite3_last_insert_rowid=i=>(r._sqlite3_last_insert_rowid=I.Jd)(i),r._sqlite3_set_last_insert_rowid=(i,c,l)=>(r._sqlite3_set_last_insert_rowid=I.Kd)(i,c,l),r._sqlite3_changes64=i=>(r._sqlite3_changes64=I.Ld)(i),r._sqlite3_changes=i=>(r._sqlite3_changes=I.Md)(i),r._sqlite3_total_changes64=i=>(r._sqlite3_total_changes64=I.Nd)(i),r._sqlite3_total_changes=i=>(r._sqlite3_total_changes=I.Od)(i),r._sqlite3_txn_state=(i,c)=>(r._sqlite3_txn_state=I.Pd)(i,c),r._sqlite3_close=i=>(r._sqlite3_close=I.Qd)(i),r._sqlite3_close_v2=i=>(r._sqlite3_close_v2=I.Rd)(i),r._sqlite3_busy_handler=(i,c,l)=>(r._sqlite3_busy_handler=I.Sd)(i,c,l),r._sqlite3_progress_handler=(i,c,l,d)=>(r._sqlite3_progress_handler=I.Td)(i,c,l,d),r._sqlite3_busy_timeout=(i,c)=>(r._sqlite3_busy_timeout=I.Ud)(i,c),r._sqlite3_interrupt=i=>(r._sqlite3_interrupt=I.Vd)(i),r._sqlite3_is_interrupted=i=>(r._sqlite3_is_interrupted=I.Wd)(i),r._sqlite3_create_function=(i,c,l,d,S,$,O,F)=>(r._sqlite3_create_function=I.Xd)(i,c,l,d,S,$,O,F),r._sqlite3_create_function_v2=(i,c,l,d,S,$,O,F,z)=>(r._sqlite3_create_function_v2=I.Yd)(i,c,l,d,S,$,O,F,z),r._sqlite3_create_window_function=(i,c,l,d,S,$,O,F,z,ee)=>(r._sqlite3_create_window_function=I.Zd)(i,c,l,d,S,$,O,F,z,ee),r._sqlite3_create_function16=(i,c,l,d,S,$,O,F)=>(r._sqlite3_create_function16=I._d)(i,c,l,d,S,$,O,F),r._sqlite3_overload_function=(i,c,l)=>(r._sqlite3_overload_function=I.$d)(i,c,l),r._sqlite3_trace_v2=(i,c,l,d)=>(r._sqlite3_trace_v2=I.ae)(i,c,l,d),r._sqlite3_commit_hook=(i,c,l)=>(r._sqlite3_commit_hook=I.be)(i,c,l),r._sqlite3_update_hook=(i,c,l)=>(r._sqlite3_update_hook=I.ce)(i,c,l),r._sqlite3_rollback_hook=(i,c,l)=>(r._sqlite3_rollback_hook=I.de)(i,c,l),r._sqlite3_autovacuum_pages=(i,c,l,d)=>(r._sqlite3_autovacuum_pages=I.ee)(i,c,l,d),r._sqlite3_wal_autocheckpoint=(i,c)=>(r._sqlite3_wal_autocheckpoint=I.fe)(i,c),r._sqlite3_wal_hook=(i,c,l)=>(r._sqlite3_wal_hook=I.ge)(i,c,l),r._sqlite3_wal_checkpoint_v2=(i,c,l,d,S)=>(r._sqlite3_wal_checkpoint_v2=I.he)(i,c,l,d,S),r._sqlite3_wal_checkpoint=(i,c)=>(r._sqlite3_wal_checkpoint=I.ie)(i,c),r._sqlite3_error_offset=i=>(r._sqlite3_error_offset=I.je)(i),r._sqlite3_errmsg16=i=>(r._sqlite3_errmsg16=I.ke)(i),r._sqlite3_errcode=i=>(r._sqlite3_errcode=I.le)(i),r._sqlite3_extended_errcode=i=>(r._sqlite3_extended_errcode=I.me)(i),r._sqlite3_system_errno=i=>(r._sqlite3_system_errno=I.ne)(i),r._sqlite3_errstr=i=>(r._sqlite3_errstr=I.oe)(i),r._sqlite3_limit=(i,c,l)=>(r._sqlite3_limit=I.pe)(i,c,l),r._sqlite3_open=(i,c)=>(r._sqlite3_open=I.qe)(i,c),r._sqlite3_open_v2=(i,c,l,d)=>(r._sqlite3_open_v2=I.re)(i,c,l,d),r._sqlite3_open16=(i,c)=>(r._sqlite3_open16=I.se)(i,c),r._sqlite3_create_collation=(i,c,l,d,S)=>(r._sqlite3_create_collation=I.te)(i,c,l,d,S),r._sqlite3_create_collation_v2=(i,c,l,d,S,$)=>(r._sqlite3_create_collation_v2=I.ue)(i,c,l,d,S,$),r._sqlite3_create_collation16=(i,c,l,d,S)=>(r._sqlite3_create_collation16=I.ve)(i,c,l,d,S),r._sqlite3_collation_needed=(i,c,l)=>(r._sqlite3_collation_needed=I.we)(i,c,l),r._sqlite3_collation_needed16=(i,c,l)=>(r._sqlite3_collation_needed16=I.xe)(i,c,l),r._sqlite3_get_clientdata=(i,c)=>(r._sqlite3_get_clientdata=I.ye)(i,c),r._sqlite3_set_clientdata=(i,c,l,d)=>(r._sqlite3_set_clientdata=I.ze)(i,c,l,d),r._sqlite3_get_autocommit=i=>(r._sqlite3_get_autocommit=I.Ae)(i),r._sqlite3_table_column_metadata=(i,c,l,d,S,$,O,F,z)=>(r._sqlite3_table_column_metadata=I.Be)(i,c,l,d,S,$,O,F,z),r._sqlite3_sleep=i=>(r._sqlite3_sleep=I.Ce)(i),r._sqlite3_extended_result_codes=(i,c)=>(r._sqlite3_extended_result_codes=I.De)(i,c),r._sqlite3_file_control=(i,c,l,d)=>(r._sqlite3_file_control=I.Ee)(i,c,l,d),r._sqlite3_test_control=(i,c)=>(r._sqlite3_test_control=I.Fe)(i,c),r._sqlite3_create_filename=(i,c,l,d,S)=>(r._sqlite3_create_filename=I.Ge)(i,c,l,d,S),r._sqlite3_free_filename=i=>(r._sqlite3_free_filename=I.He)(i),r._sqlite3_uri_parameter=(i,c)=>(r._sqlite3_uri_parameter=I.Ie)(i,c),r._sqlite3_uri_key=(i,c)=>(r._sqlite3_uri_key=I.Je)(i,c),r._sqlite3_uri_boolean=(i,c,l)=>(r._sqlite3_uri_boolean=I.Ke)(i,c,l),r._sqlite3_uri_int64=(i,c,l,d)=>(r._sqlite3_uri_int64=I.Le)(i,c,l,d),r._sqlite3_filename_database=i=>(r._sqlite3_filename_database=I.Me)(i),r._sqlite3_filename_journal=i=>(r._sqlite3_filename_journal=I.Ne)(i),r._sqlite3_filename_wal=i=>(r._sqlite3_filename_wal=I.Oe)(i),r._sqlite3_db_name=(i,c)=>(r._sqlite3_db_name=I.Pe)(i,c),r._sqlite3_db_filename=(i,c)=>(r._sqlite3_db_filename=I.Qe)(i,c),r._sqlite3_db_readonly=(i,c)=>(r._sqlite3_db_readonly=I.Re)(i,c),r._sqlite3_compileoption_used=i=>(r._sqlite3_compileoption_used=I.Se)(i),r._sqlite3_compileoption_get=i=>(r._sqlite3_compileoption_get=I.Te)(i),r._sqlite3session_create=(i,c,l)=>(r._sqlite3session_create=I.Ue)(i,c,l),r._sqlite3session_delete=i=>(r._sqlite3session_delete=I.Ve)(i),r._sqlite3session_attach=(i,c)=>(r._sqlite3session_attach=I.We)(i,c),r._sqlite3session_changeset=(i,c,l)=>(r._sqlite3session_changeset=I.Xe)(i,c,l),r._sqlite3session_enable=(i,c)=>(r._sqlite3session_enable=I.Ye)(i,c),r._sqlite3changeset_start=(i,c,l)=>(r._sqlite3changeset_start=I.Ze)(i,c,l),r._sqlite3changeset_finalize=i=>(r._sqlite3changeset_finalize=I._e)(i),r._sqlite3changeset_invert=(i,c,l,d)=>(r._sqlite3changeset_invert=I.$e)(i,c,l,d),r._sqlite3changeset_apply=(i,c,l,d,S,$)=>(r._sqlite3changeset_apply=I.af)(i,c,l,d,S,$),r._sqlite3_sourceid=()=>(r._sqlite3_sourceid=I.bf)(),r._malloc=i=>(r._malloc=I.cf)(i),r._free=i=>(r._free=I.df)(i),r._RegisterExtensionFunctions=i=>(r._RegisterExtensionFunctions=I.ef)(i),r._getSqliteFree=()=>(r._getSqliteFree=I.ff)();var aE=r._main=(i,c)=>(aE=r._main=I.gf)(i,c);r._libauthorizer_set_authorizer=(i,c,l)=>(r._libauthorizer_set_authorizer=I.hf)(i,c,l),r._libfunction_create_function=(i,c,l,d,S,$,O,F)=>(r._libfunction_create_function=I.jf)(i,c,l,d,S,$,O,F),r._libhook_commit_hook=(i,c,l)=>(r._libhook_commit_hook=I.kf)(i,c,l),r._libhook_update_hook=(i,c,l)=>(r._libhook_update_hook=I.lf)(i,c,l),r._libprogress_progress_handler=(i,c,l,d)=>(r._libprogress_progress_handler=I.mf)(i,c,l,d),r._libvfs_vfs_register=(i,c,l,d,S,$)=>(r._libvfs_vfs_register=I.nf)(i,c,l,d,S,$);var cE=(i,c)=>(cE=I.pf)(i,c),uE=()=>(uE=I.qf)(),lE=i=>(lE=I.rf)(i),fE=i=>(fE=I.sf)(i),dE=()=>(dE=I.tf)();r._sqlite3_version=5472,r.getTempRet0=$2,r.ccall=Ys,r.cwrap=I2,r.addFunction=T2,r.setValue=la,r.getValue=Gv,r.UTF8ToString=Ho,r.stringToUTF8=Js,r.lengthBytesUTF8=da,r.intArrayFromString=pg,r.intArrayToString=F2,r.AsciiToString=q2,r.UTF16ToString=O2,r.stringToUTF16=R2,r.UTF32ToString=x2,r.stringToUTF32=A2,r.writeArrayToMemory=sE;var ed;mu=function i(){ed||hE(),ed||(mu=i)};function D2(){var i=aE,c=0,l=0;try{var d=i(c,l);return g2(d,!0),d}catch(S){return _2(S)}}function hE(){if(Bo>0||(Mn(),Bo>0))return;function i(){ed||(ed=!0,r.calledRun=!0,!v&&(Jf(),we(),s(r),r.onRuntimeInitialized?.(),pE&&D2(),Xt()))}r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),i()},1)):i()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var pE=!0;return r.noInitialRun&&(pE=!1),hE(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.set_authorizer=function(l,d,S){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),la(c,d instanceof i?1:0,"i32");const $=Ys("libauthorizer_set_authorizer","number",["number","number","number"],[l,d?1:0,c]);return!$&&d&&r.setCallback(c,(O,F,z,ee,ye,Fe)=>d(S,F,z,ee,ye,Fe)),$}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor,c=["xFunc","xStep","xFinal"],l=new Map;r.create_function=function(d,S,$,O,F,z,ee,ye){const Fe=r._sqlite3_malloc(4),Re={xFunc:z,xStep:ee,xFinal:ye};la(Fe,c.reduce((ce,Et,Vn)=>Re[Et]instanceof i?ce|1<<Vn:ce,0),"i32");const de=Ys("libfunction_create_function","number",["number","string","number","number","number","number","number","number"],[d,S,$,O,Fe,z?1:0,ee?1:0,ye?1:0]);if(!de){if(l.has(S)){const ce=l.get(S);r.deleteCallback(ce)}l.set(S,Fe),r.setCallback(Fe,{xFunc:z,xStep:ee,xFinal:ye})}return de}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.update_hook=function(l,d){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),la(c,d instanceof i?1:0,"i32"),Ys("libhook_update_hook","void",["number","number","number"],[l,d?1:0,c]),d&&r.setCallback(c,(S,$,O,F,z,ee)=>d($,O,F,z,ee))}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.commit_hook=function(l,d){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),la(c,d instanceof i?1:0,"i32"),Ys("libhook_commit_hook","void",["number","number","number"],[l,d?1:0,c]),d&&r.setCallback(c,S=>d())}}(),function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.progress_handler=function(l,d,S,$){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),la(c,S instanceof i?1:0,"i32"),Ys("libprogress_progress_handler","number",["number","number","number","number"],[l,d,S?1:0,c]),S&&r.setCallback(c,O=>S($))}}(),function(){const i=["xOpen","xDelete","xAccess","xFullPathname","xRandomness","xSleep","xCurrentTime","xGetLastError","xCurrentTimeInt64","xClose","xRead","xWrite","xTruncate","xSync","xFileSize","xLock","xUnlock","xCheckReservedLock","xFileControl","xSectorSize","xDeviceCharacteristics","xShmMap","xShmLock","xShmBarrier","xShmUnmap"],c=new Map;r.vfs_register=function(l,d){let S=0,$=0;i.forEach((F,z)=>{l[F]&&(S|=1<<z,l.hasAsyncMethod(F)&&($|=1<<z))});const O=r._sqlite3_malloc(4);try{const F=Ys("libvfs_vfs_register","number",["string","number","number","number","number","number"],[l.name,l.mxPathname,S,$,d?1:0,O]);if(!F){if(c.has(l.name)){const ee=c.get(l.name);r.deleteCallback(ee)}const z=Gv(O,"*");c.set(l.name,z),r.setCallback(z,l)}return F}finally{r._sqlite3_free(O)}}}(),n=a,n}})();const Lne=async()=>{const e=await Mne(),t=Nne(e);return t.module=e,t},cg=typeof navigator>"u"||navigator.storage===void 0?new Proxy({},{get:()=>Promise.reject(new Error("Can't get OPFS root handle in this environment as navigator.storage is undefined"))}):navigator.storage.getDirectory(),_F=async e=>{const t=await cg;if(e===void 0)return t;let n=t;const r=e?.split("/").filter(Boolean);for(;r.length>0;)n=await n.getDirectoryHandle(r.shift());return n},yF=async(e=cg,t=Number.POSITIVE_INFINITY,n="")=>{if(t<0)return;const r=await e,s=r.values();for await(const o of s){const a=o.kind==="directory",u=o.kind==="file"?await o.getFile().then(f=>IZ(f.size)):void 0;if(console.log(`${n}${a?"":""} ${o.name} ${u?`(${u})`:""}`),a){const f=await r.getDirectoryHandle(o.name);await yF(f,t-1,`${n}  `)}}},Une=async e=>{if(e.kind==="directory")for await(const t of e.keys())await e.removeEntry(t,{recursive:!0})},jne=Object.freeze(Object.defineProperty({__proto__:null,deleteAll:Une,getDirHandle:_F,printTree:yF,rootHandlePromise:cg},Symbol.toStringTag,{value:"Module"}));class Bse extends jr()("PersistedSqliteError",{cause:Ac}){}const zne=({storageOptions:e,storeId:t,schema:n})=>Mi(async()=>{const r=bF(e.directory,t),s=await _F(r).catch(()=>{});if(s===void 0)return;const o=async m=>{const T=await m.getFile(),C=await Fne(T);return C?{fileName:C,file:T}:void 0},u=await(async m=>{const T=[];for await(const C of m)C.kind==="file"&&T.push(C);return T})(s.values()),f=await Promise.all(u.map(o)),h="/"+Wne(n),p=f.find(m=>m?.fileName===h);if(p!==void 0){const m=await p.file.slice(qne).arrayBuffer();return m.byteLength===0?void 0:new Uint8Array(m)}}).pipe(_v({duration:1e3,label:"@livestore/adapter-web:readPersistedAppDbFromClientSession"}),dx("@livestore/adapter-web:readPersistedAppDbFromClientSession"),Ne("@livestore/adapter-web:readPersistedAppDbFromClientSession")),Bne=({storageOptions:e,storeId:t})=>K(function*(){const n=bF(e.directory,t);yield*Hne(n)}).pipe(Cm({schedule:ree}),Ne("@livestore/adapter-web:resetPersistedDataFromClientSession")),Hne=e=>Mi(async()=>{const t=await cg,n=e.split("/").filter(r=>r.length);try{let r=t;for(let s=0;s<n.length-1;s++)r=await r.getDirectoryHandle(n[s]);await r.removeEntry(n.at(-1),{recursive:!0})}catch(r){if(r instanceof DOMException&&r.name==="NotFoundError")return;throw r}}).pipe(ke.mapToUnexpectedError,Ne("@livestore/adapter-web:worker:opfsDeleteFile",{attributes:{absFilePath:e}})),bF=(e,t)=>{if(e===void 0||e===""||e==="/")return`livestore-${t}@${$T}`;if(e.includes("/"))throw new Error(`@livestore/adapter-web:worker:sanitizeOpfsDir: Nested directories are not yet supported ('${e}')`);return`${e}@${$T}`},Wne=e=>`state${e.state.sqlite.migrations.strategy==="manual"?"fixed":e.state.sqlite.hash.toString()}.db`;class Vne extends Se(sp,ke){}const Kne=e=>Sv({channelName:`livestore.shutdown.${e}`,schema:Vne});class SF extends Ie("DedicatedWorkerDisconnectBroadcast",{}){}const Gne=e=>Sv({channelName:`livestore.worker-disconnect.${e}`,schema:SF});class ug extends kn()("DevtoolsWebCommon.CreateConnection",{payload:{from:M,port:ng},success:Y({}),failure:Vm}){}class Hse extends Se(ug){}const Qne=Y({type:Ce("opfs"),directory:_n(M)}),wF=Se(Qne);pu({key:M,value:Bi});var Yy;(function(e){class t extends kn()("InitialMessage",{payload:{port:ng,storeId:M,clientId:M},success:Zr,failure:ke}){}e.InitialMessage=t;class n extends Se(t){}e.Request=n})(Yy||(Yy={}));var xt;(function(e){class t extends kn()("InitialMessage",{payload:{storageOptions:wF,devtoolsEnabled:js,storeId:M,clientId:M,debugInstanceId:M,syncPayload:$c(Bi)},success:Zr,failure:ke}){}e.InitialMessage=t;class n extends kn()("BootStatusStream",{payload:{},success:kee,failure:ke}){}e.BootStatusStream=n;class r extends kn()("PushToLeader",{payload:{batch:$e(Zee)},success:Zr,failure:Se(ke,rte)}){}e.PushToLeader=r;class s extends kn()("PullStream",{payload:{cursor:Eee},success:Y({payload:xx,mergeCounter:Ue}),failure:ke}){}e.PullStream=s;class o extends kn()("Export",{payload:{},success:Ya,failure:ke}){}e.Export=o;class a extends kn()("ExportEventlog",{payload:{},success:Ya,failure:ke}){}e.ExportEventlog=a;class u extends kn()("GetRecreateSnapshot",{payload:{},success:Y({snapshot:Ya,migrationsReport:Iee}),failure:ke}){}e.GetRecreateSnapshot=u;class f extends kn()("GetLeaderHead",{payload:{},success:Ht,failure:ke}){}e.GetLeaderHead=f;class h extends kn()("GetLeaderSyncState",{payload:{},success:Kr,failure:ke}){}e.GetLeaderSyncState=h;class p extends kn()("Shutdown",{payload:{},success:Zr,failure:ke}){}e.Shutdown=p;class m extends kn()("ExtraDevtoolsMessage",{payload:{message:Zte},success:Zr,failure:ke}){}e.ExtraDevtoolsMessage=m,e.Request=Se(t,n,r,s,o,a,u,f,h,p,m,ug)})(xt||(xt={}));var lp;(function(e){class t extends Ie("FromClientSession",{initialMessage:xt.InitialMessage}){}e.InitialMessagePayloadFromClientSession=t;class n extends kn()("InitialMessage",{payload:{payload:Se(t,Ie("FromWebBridge",{})),liveStoreVersion:Ce(In)},success:Zr,failure:ke}){}e.InitialMessage=n;class r extends kn()("UpdateMessagePort",{payload:{port:ng},success:Zr,failure:ke}){}e.UpdateMessagePort=r;class s extends Se(n,r,xt.BootStatusStream,xt.PushToLeader,xt.PullStream,xt.Export,xt.GetRecreateSnapshot,xt.ExportEventlog,xt.GetLeaderHead,xt.GetLeaderSyncState,xt.Shutdown,xt.ExtraDevtoolsMessage,ug){}e.Request=s})(lp||(lp={}));const Jne=Sv({channelName:"session-info",schema:Lx}),WT={sharedWorker:({storeId:e})=>`shared-worker-${e}`,browserExtension:{contentscriptMain:e=>`contentscript-main-${e}`,contentscriptIframe:e=>`contentscript-iframe-${e}`}},Xy=Ie("ClientSessionContentscriptMainReq",{storeId:M,clientId:M,sessionId:M}),VT=Ie("ClientSessionContentscriptMainRes",{tabId:Ue}),Yne={contentscriptMain:$t(()=>Ly({listenWindow:window,sendWindow:window,schema:{listen:Xy,send:VT},ids:{own:"contentscript-main-static",other:"client-session-static"}})),clientSession:$t(()=>Ly({listenWindow:window,sendWindow:window,schema:{listen:VT,send:Xy},ids:{own:"client-session-static",other:"contentscript-main-static"}}))},Xne=({node:e,target:t,worker:n})=>K(function*(){const r=new MessageChannel,s=yield*Le();Ao&&(yield*OZ(`@livestore/devtools-web-common: closing message channel ${e.nodeName}  ${t}`)),yield*n.execute(ug.make({from:e.nodeName,port:r.port1})).pipe(zn(()=>ct(s,!0)),hn,ze,yt),yield*s;const o=yield*YZ({port:r.port2,schema:Dv});yield*e.addEdge({target:t,edgeChannel:o,replaceIfExists:!0}),Ao&&(yield*An(`@livestore/devtools-web-common: initiated connection: ${e.nodeName}  ${t}`))}).pipe(ke.mapToUnexpectedError),Zne=({schema:e,storeId:t,clientId:n,sessionId:r})=>K(function*(){if($o()){const s=globalThis.LIVESTORE_DEVTOOLS_PATH??"/_livestore",o=`${location.origin}${s}`,a=yield*Mi(()=>fetch(o));if(a.ok&&(yield*Mi(()=>a.text())).includes('<meta name="livestore-devtools" content="true" />')){const f=`${o}/web/${t}/${n}/${r}/${e.devtools.alias}`;yield*aw(`[@livestore/adapter-web] Devtools ready on ${f}`)}}}).pipe(Ne("@livestore/adapter-web:client-session:devtools:logDevtoolsUrl")),ere=Am(function*({webmeshNode:e,sessionInfo:t,sharedWorker:n,devtoolsEnabled:r,schema:s}){if(r){const{clientId:o,sessionId:a,storeId:u}=t;yield*Zne({clientId:o,sessionId:a,schema:s,storeId:u}),yield*Ux({webChannel:yield*Jne,sessionInfo:t}).pipe(ze,yt),yield*K(function*(){const f=yield*Yne.clientSession;yield*f.send(Xy.make({clientId:o,sessionId:a,storeId:u}));const{tabId:h}=yield*f.listen.pipe(Io(),YY,ro),p=WT.browserExtension.contentscriptMain(h),m=yield*Ly({listenWindow:window,sendWindow:window,schema:Dv,ids:{own:e.nodeName,other:p}});yield*e.addEdge({target:p,edgeChannel:m})}).pipe(Ne("@livestore/adapter-web:client-session:devtools:browser-extension"),ze,yt),yield*Xne({node:e,target:WT.sharedWorker({storeId:u}),worker:n})}}),tre=Lne();$o()&&(globalThis.__debugLiveStoreUtils={opfs:jne,runSync:e=>fr(e),runFork:e=>ps(e)});const nre=e=>t=>K(function*(){const{schema:n,storeId:r,devtoolsEnabled:s,debugInstanceId:o,bootStatusQueue:a,shutdown:u,syncPayload:f}=t;yield*rre,yield*bt(a,{stage:"loading"});const h=yield*Mi(()=>tre),p=`livestore-tab-lock-${r}`,m=yield*Uu(wF)(e.storage),T=yield*Kne(r);e.resetPersistence===!0&&(yield*T.send(sp.make({reason:"adapter-reset"})),yield*Bne({storageOptions:m,storeId:r}));const C=e.experimental?.disableFastPath===!0?void 0:yield*zne({storageOptions:m,storeId:r,schema:n}),A=e.clientId??KT(`clientId:${r}`,"local"),D=e.sessionId??KT(`sessionId:${r}`,"session"),y=yield*Gne(r);yield*T.listen.pipe(Io(),zn(we=>u(ta(we))),hn,St,ze,yt);const b=Zk(e.sharedWorker,{name:`livestore-shared-worker-${r}`}),_=yield*KZ({size:1,concurrency:100,initialMessage:()=>new lp.InitialMessage({liveStoreVersion:In,payload:{_tag:"FromClientSession",initialMessage:new xt.InitialMessage({storageOptions:m,storeId:r,clientId:A,devtoolsEnabled:s,debugInstanceId:o,syncPayload:f})}})}).pipe(bn(ST(()=>b)),ze,ke.mapToUnexpectedError,Xr(u),Ne("@livestore/adapter-web:client-session:setupSharedWorker"),yt),E=yield*Le();let v=yield*oee(E,p);const R=yield*XO(v?"has-lock":"no-lock"),q=yield*Le();v===!1&&(yield*ct(q,void 0));const x=K(function*(){yield*An(`[@livestore/adapter-web:client-session]  Got lock '${p}' (clientId: ${A}, sessionId: ${D}).`),yield*yn(()=>An(`[@livestore/adapter-web:client-session] Releasing lock for '${p}'`)),yield*Nd(R,"has-lock");const we=new MessageChannel,Xt=Zk(e.worker,{name:`livestore-worker-${r}-${D}`});yield*VZ({initialMessage:()=>new Yy.InitialMessage({port:we.port1,storeId:r,clientId:A})}).pipe(bn(ST(()=>Xt)),ke.mapToUnexpectedError,Xr(u),Ne("@livestore/adapter-web:client-session:setupDedicatedWorker"),ze,yt),yield*y.send(SF.make({})),yield*(yield*oo(_)).executeEffect(new lp.UpdateMessagePort({port:we.port2})).pipe(ke.mapToUnexpectedError,Xr(u)),yield*ct(q,void 0),yield*ZS}).pipe(Ne("@livestore/adapter-web:client-session:lock"));v===!1?(yield*An(`[@livestore/adapter-web:client-session]  Waiting for lock '${p}' (sessionId: ${D})`),yield*see(E,p).pipe(ql(()=>(v=!0,x)),St,ze,yt)):yield*x.pipe(St,ze,yt);const N=we=>oo(_).pipe(jn(()=>q),he(Xt=>Xt.executeEffect(we)),_v({label:`@livestore/adapter-web:client-session:runInWorker:${we._tag}`,duration:2e3}),Ne(`@livestore/adapter-web:client-session:runInWorker:${we._tag}`),na(Xt=>at(ke)(Xt)?Xt:Ck(Xt)||at(zi)(Xt)?new ke({cause:Xt}):Xt),SA(Xt=>new ke({cause:Xt}))),j=we=>K(function*(){return(yield*oo(_)).execute(we).pipe(JO(gs=>at(ke)(gs)?gs:Ck(gs)||at(zi)(gs)?new ke({cause:gs}):gs),eX(`@livestore/adapter-web:client-session:runInWorkerStream:${we._tag}`))}).pipe(XY),P=yield*j(new xt.BootStatusStream).pipe(zn(we=>bt(a,we)),hn,Xr(we=>go(we)?ve:u(we)),St,ze,yt);yield*G8(a).pipe(ql(er(P)),ze,yt);const L=C===void 0?yield*N(new xt.GetRecreateSnapshot).pipe(Pe(({snapshot:we,migrationsReport:Xt})=>({_tag:"from-leader-worker",snapshot:we,migrationsReport:Xt}))):{_tag:"fast-path",snapshot:C},Q=L._tag==="from-leader-worker"?L.migrationsReport:{migrations:[]},J=yield*Dne({sqlite3:h})({_tag:"in-memory"});J.import(L.snapshot),(J.select("select count(*) as count from sqlite_master")[0]?.count??0)===0&&(yield*ke.make({cause:"Encountered empty or corrupted database",payload:{snapshotByteLength:L.snapshot.byteLength,storageOptions:e.storage}}));const qe=J.select(`select seqNumGlobal, seqNumClient from ${kx} order by seqNumGlobal desc, seqNumClient desc limit 1`)[0],nt=qe?lee({global:qe.seqNumGlobal,client:qe.seqNumClient}):cee;yield*yn(we=>K(function*(){Yc(we)&&cz(we)===!1&&at(sp)(L0(we.cause))===!1&&at(Tee)(L0(we.cause))===!1?yield*Ol("[@livestore/adapter-web:client-session] client-session shutdown",we.cause):yield*An("[@livestore/adapter-web:client-session] client-session shutdown",v,we),v&&(yield*ct(E,void 0))}).pipe(ze,pr));const gt={export:N(new xt.Export).pipe(Ec(1e4),ke.mapToUnexpectedError,Ne("@livestore/adapter-web:client-session:export")),events:{pull:({cursor:we})=>j(new xt.PullStream({cursor:we})).pipe(QY),push:we=>N(new xt.PushToLeader({batch:we})).pipe(Ne("@livestore/adapter-web:client-session:pushToLeader",{attributes:{batchSize:we.length}}))},initialState:{leaderHead:nt,migrationsReport:Q},getEventlogData:N(new xt.ExportEventlog).pipe(Ec(1e4),ke.mapToUnexpectedError,Ne("@livestore/adapter-web:client-session:getEventlogData")),getSyncState:N(new xt.GetLeaderSyncState).pipe(ke.mapToUnexpectedError,Ne("@livestore/adapter-web:client-session:getLeaderSyncState")),sendDevtoolsMessage:we=>N(new xt.ExtraDevtoolsMessage({message:we})).pipe(ke.mapToUnexpectedError,Ne("@livestore/adapter-web:client-session:devtoolsMessageForLeader"))},Mn=yield*oo(_);return yield*fne({...t,sqliteDb:J,lockStatus:R,clientId:A,sessionId:D,isLeader:!0,leaderThread:gt,webmeshMode:"direct",connectWebmeshNode:({sessionInfo:we,webmeshNode:Xt})=>ere({webmeshNode:Xt,sessionInfo:we,sharedWorker:Mn,devtoolsEnabled:s,schema:n}),registerBeforeUnload:we=>typeof window<"u"&&typeof window.addEventListener=="function"?(window.addEventListener("beforeunload",we),()=>window.removeEventListener("beforeunload",we)):()=>{}})}).pipe(ke.mapToUnexpectedError),KT=(e,t)=>{const n=()=>_r(5),r=typeof window>"u"?void 0:t==="session"?sessionStorage:t==="local"?localStorage:Te(`[@livestore/adapter-web] Invalid storage type: ${t}`);if(r===void 0)return n();const s=`livestore:${e}`,o=r.getItem(s);if(o)return o;const a=n();return r.setItem(s,a),a},rre=K(function*(){const e=(t,n)=>K(function*(){t&&(yield*ke.make({cause:`[@livestore/adapter-web] Browser not supported. The LiveStore web adapter needs '${n}' to work properly`}))});yield*Tm([e(typeof navigator>"u","navigator"),e(navigator.locks===void 0,"navigator.locks"),e(navigator.storage===void 0,"navigator.storage"),e(typeof window>"u","window"),e(typeof sessionStorage>"u","sessionStorage")])});function sre(e){return new SharedWorker("/assets/make-shared-worker-CSui3nIu.js",{type:"module",name:e?.name})}const Kl=Symbol.for("NOT_REFRESHED_YET"),ore=e=>typeof e=="object"&&e!==null&&"_tag"in e&&e._tag==="thunk",GT=()=>({_tag:"unknown"}),ire=e=>({_tag:"Some",value:e}),are=()=>({_tag:"None"});let cre=0;const ure=()=>`graph-${++cre}`;class lre{id=ure();atoms=new Set;effects=new Set;context;debugRefreshInfos=new es(200);currentDebugRefresh;deferredEffects=new Map;refreshCallbacks=new Set;nodeIdCounter=0;uniqueNodeId=()=>`node-${++this.nodeIdCounter}`;refreshInfoIdCounter=0;uniqueRefreshInfoId=()=>`refresh-info-${++this.refreshInfoIdCounter}`;makeRef(t,n){const r={_tag:"ref",id:this.uniqueNodeId(),isDirty:!1,isDestroyed:!1,previousResult:t,computeResult:()=>r.previousResult,sub:new Set,super:new Set,label:n?.label,meta:n?.meta,equal:n?.equal??Ja,refreshes:0};return this.atoms.add(r),r}makeThunk(t,n){const r={_tag:"thunk",id:this.uniqueNodeId(),previousResult:Kl,isDirty:!0,isDestroyed:!1,computeResult:(s,o)=>{if(r.isDirty){const a=this.currentDebugRefresh===void 0;a&&(this.currentDebugRefresh={refreshedAtoms:[],startMs:performance.now()}),r.sub=new Set;const u=(C,A)=>(this.addEdge(r,C),QT(C,A,o));let f;const p=t(u,C=>{f=C},this.context??fre(this),s,o),m=r.equal(r.previousResult,p)===!1,T={atom:JT(r,!1),resultChanged:m,debugInfo:f??GT()};if(this.currentDebugRefresh.refreshedAtoms.push(T),r.isDirty=!1,r.previousResult=p,r.recomputations++,a){const C=this.currentDebugRefresh.refreshedAtoms,A=performance.now()-this.currentDebugRefresh.startMs;this.currentDebugRefresh=void 0,this.debugRefreshInfos.push({id:this.uniqueRefreshInfoId(),reason:o??{_tag:"makeThunk",label:n?.label},skippedRefresh:!1,refreshedAtoms:C,durationMs:A,completedTimestamp:Date.now(),graphSnapshot:this.getSnapshot({includeResults:!1})})}return p}else return r.previousResult},sub:new Set,super:new Set,recomputations:0,label:n?.label,meta:n?.meta,equal:n?.equal??Ja,__getResult:t};return this.atoms.add(r),r}destroyNode(t){if(t._tag==="ref"||t._tag==="thunk")for(const n of t.super)this.destroyNode(n);if(t._tag!=="ref")for(const n of t.sub)this.removeEdge(t,n);t._tag==="effect"?(this.deferredEffects.delete(t),this.effects.delete(t)):this.atoms.delete(t),t.isDestroyed=!0}destroy(){for(const t of this.atoms)this.destroyNode(t)}makeEffect(t,n){const r={_tag:"effect",id:this.uniqueNodeId(),isDestroyed:!1,doEffect:(s,o)=>{r.invocations++,r.sub=new Set,t((u,f,h)=>(this.addEdge(r,u),QT(u,f,h)),s,o)},sub:new Set,label:n?.label,invocations:0};return this.effects.add(r),r}setRef(t,n,r){this.setRefs([[t,n]],r)}setRefs(t,n){const r=new Set;for(const[s,o]of t)s.previousResult=o,s.refreshes++,Zy(s,r);if(n?.skipRefresh)for(const s of r)this.deferredEffects.has(s)===!1&&this.deferredEffects.set(s,new Set),n?.debugRefreshReason!==void 0&&this.deferredEffects.get(s).add(n.debugRefreshReason);else this.runEffects(r,{debugRefreshReason:n?.debugRefreshReason??GT(),otelContext:n?.otelContext})}runEffects=(t,n)=>{(this.context?.effectsWrapper??(s=>s()))(()=>{this.currentDebugRefresh={refreshedAtoms:[],startMs:performance.now()};for(const u of t)u.doEffect(n?.otelContext,n.debugRefreshReason);const s=this.currentDebugRefresh.refreshedAtoms,o=performance.now()-this.currentDebugRefresh.startMs;this.currentDebugRefresh=void 0;const a={id:this.uniqueRefreshInfoId(),reason:n.debugRefreshReason,skippedRefresh:!1,refreshedAtoms:s,durationMs:o,completedTimestamp:Date.now(),graphSnapshot:this.getSnapshot({includeResults:!1})};this.debugRefreshInfos.push(a),this.runRefreshCallbacks()})};runDeferredEffects=t=>{for(const[n,r]of this.deferredEffects)this.runEffects(new Set([n]),{debugRefreshReason:{_tag:"runDeferredEffects",originalRefreshReasons:Array.from(r),manualRefreshReason:t?.debugRefreshReason},otelContext:t?.otelContext})};runRefreshCallbacks=()=>{for(const t of this.refreshCallbacks)t()};addEdge(t,n){t.sub.add(n),n.super.add(t),this.currentDebugRefresh===void 0&&this.runRefreshCallbacks()}removeEdge(t,n){t.sub.delete(n);const r=new Set;Zy(n,r);for(const s of r)this.deferredEffects.set(s,new Set);n.super.delete(t),this.currentDebugRefresh===void 0&&this.runRefreshCallbacks()}getSnapshot=t=>{const{includeResults:n=!1}=t??{},r=[];for(const a of this.atoms)r.push(JT(a,n));const s=[];for(const a of this.effects)s.push(dre(a));const o=[];for(const[a]of this.deferredEffects)o.push(a.id);return{atoms:r,effects:s,deferredEffects:o}};subscribeToRefresh=t=>(this.refreshCallbacks.add(t),()=>{this.refreshCallbacks.delete(t)})}const QT=(e,t,n)=>{if(e.isDestroyed&&Te(`LiveStore Error: Attempted to compute destroyed ${e._tag} (${e.id}): ${e.label??""}`),e.isDirty){const r=e.computeResult(t,n);return e.isDirty=!1,e.previousResult=r,r}else return e.previousResult},Zy=(e,t)=>{for(const n of e.super)n._tag==="thunk"?(n.isDirty=!0,Zy(n,t)):t.add(n)},fre=e=>{throw new Error(`LiveStore Error: \`context\` not set on ReactiveGraph (${e.id})`)},JT=(e,t)=>{const n=[];for(const o of e.sub)n.push(o.id);const r=[];for(const o of e.super)r.push(o.id);const s=t?ire(e.previousResult===Kl?'"SYMBOL_NOT_REFRESHED_YET"':JSON.stringify(e.previousResult)):are();return e._tag==="ref"?{_tag:e._tag,id:e.id,label:e.label,meta:e.meta,isDirty:e.isDirty,sub:n,super:r,isDestroyed:e.isDestroyed,refreshes:e.refreshes,previousResult:s}:{_tag:"thunk",id:e.id,label:e.label,meta:e.meta,isDirty:e.isDirty,sub:n,super:r,isDestroyed:e.isDestroyed,recomputations:e.recomputations,previousResult:s}},dre=e=>{const t=[];for(const n of e.sub)t.push(n.id);return{_tag:e._tag,id:e.id,label:e.label,sub:t,invocations:e.invocations,isDestroyed:e.isDestroyed}},hre=()=>new lre;let pre=0;const YT=Symbol.for("LiveQuery"),mre=e=>typeof e=="string"||typeof e=="number"?e.toString():e.filter(SZ).join(",");class gre{"__result!";id=pre++;[YT]=YT;activeSubscriptions=new Set;get runs(){return this.results$._tag==="thunk"?this.results$.recomputations:0}executionTimes=[];isDestroyed=!1;run=t=>this.results$.computeResult(t.otelContext,t.debugRefreshReason);dependencyQueriesRef=new Set}const _re=(e,t,n,r)=>{const s=(o,a,u)=>{if(o._tag==="thunk"||o._tag==="ref")return e(o,n,u);if(o._tag==="def"||o._tag==="signal-def"){const f=o.make(t);return r.add(f),s(f.value,a,u)}return o._tag==="signal"&&X(o,"ref")?e(o.ref,n,u):e(o.results$,n,u)};return s},yre=(e,t)=>(n,r)=>{let s=n.defRcMap.get(e);return s?(s.rc++,s):(s={rc:1,value:t(n,r),deref:()=>{s.rc--,s.rc===0&&(s.value.destroy(),n.defRcMap.delete(e))}},n.defRcMap.set(e,s),s)},XT=(e,t)=>`${e.sqliteDef.name}.get:${t===void 0?e.default.id:t===qo?"sessionId":t}`,vF=({id:e,explicitDefaultValues:t,table:n,otelContext:r})=>({store:s})=>{if($v(n)===!1)return Te(`Cannot insert row for table "${n.sqliteDef.name}" which does not have 'deriveEvents: true' set`);const o=r??s.otel.queriesSpanContext,a=e===qo?s.sessionId:e;s.sqliteDbWrapper.select(`SELECT 1 FROM '${n.sqliteDef.name}' WHERE id = ?`,[a],{otelContext:o}).length!==1&&s.commit({otelContext:o,skipRefresh:!0,label:`${n.sqliteDef.name}.set:${a}`},n.set(t,a))},bre=["begin","rollback","commit","savepoint","release"],ZT=200;class Sre{#e=new ip(ZT);#t=new Map;getKey=(t,n)=>n==null?t:Array.isArray(n)?t+`
`+n.join(`
`):t+`
`+Object.values(n).join(`
`);get=t=>this.#e.get(t);set=(t,n,r)=>{this.#e.set(n,r);for(const s of t){let o=this.#t.get(s);o==null&&(o=new ute(ZT),o.onEvict=this.#n,this.#t.set(s,o)),o.add(n)}};#n=t=>{this.#e.delete(t)};ignoreQuery=t=>bre.some(n=>t.startsWith(n));invalidate=t=>{for(const n of t){const r=this.#t.get(n);if(r!=null)for(const s of r)this.#e.delete(s)}}}const EF=()=>({slowQueries:new es(200),queryFrameDuration:0,queryFrameCount:0,events:new es(1e3)});class wre{_tag="SqliteDb";cachedStmts=new ip(200);tablesUsedCache=new ip(200);resultCache=new Sre;db;otelTracer;otelRootSpanContext;tablesUsedStmt;debugInfo=EF();constructor({db:t,otel:n}){this.db=t,this.otelTracer=n.tracer,this.otelRootSpanContext=n.rootSpanContext,this.tablesUsedStmt=t.prepare("SELECT tbl_name FROM tables_used(?) AS u JOIN sqlite_master ON sqlite_master.name = u.name WHERE u.schema = 'main';"),this.cachedStmts.onEvict=(r,s)=>s.finalize(),vre(this)}metadata;prepare(t){return this.db.prepare(t)}import(t){return this.db.import(t)}close(){return this.db.close()}destroy(){return this.db.destroy()}session(){return this.db.session()}makeChangeset(t){return this.db.makeChangeset(t)}txn(t){this.execute(Xa`begin transaction;`);let n=!1,r;try{r=t()}catch(s){throw n=!0,this.execute(Xa`rollback;`),s}return n||this.execute(Xa`commit;`),r}withChangeset(t){const n=this.db.session(),r=t(),s=n.changeset();return n.finish(),{result:r,changeset:s?{_tag:"sessionChangeset",data:s,debug:null}:{_tag:"no-op"}}}rollback(t){this.db.makeChangeset(t).invert().apply()}getTablesUsed(t){const n=Ere(t);if(n!==void 0)return new Set([n]);const r=this.tablesUsedCache.get(t);if(r)return r;const s=this.tablesUsedStmt,o=new Set;try{const a=s.select([t]);for(const u of a)o.add(u.tbl_name)}catch(a){return console.error("Error getting tables used",a,"for query",t),new Set}return this.tablesUsedCache.set(t,o),o}execute(t,n,r){return this.otelTracer.startActiveSpan("livestore.in-memory-db:execute",{attributes:{"sql.query":t}},r?.otelContext??this.otelRootSpanContext,s=>{try{let o=this.cachedStmts.get(t);o===void 0&&(o=this.db.prepare(t),this.cachedStmts.set(t,o)),o.execute(n),r?.hasNoEffects!==!0&&!this.resultCache.ignoreQuery(t)&&this.resultCache.invalidate(r?.writeTables??this.getTablesUsed(t)),s.end();const a=ap(s);return this.debugInfo.queryFrameDuration+=a,this.debugInfo.queryFrameCount++,a>5&&$o()&&this.debugInfo.slowQueries.push({queryStr:t,bindValues:n,durationMs:a,rowsCount:void 0,queriedTables:new Set,startTimePerfNow:AT(s)}),{durationMs:a}}catch(o){if(s.recordException(o),s.end(),Ao)debugger;throw new zu({cause:o,query:{bindValues:n??{},sql:t}})}})}select(t,n,r){const{queriedTables:s,skipCache:o=!1,otelContext:a}=r??{};return this.otelTracer.startActiveSpan("sql-in-memory-select",{},a??this.otelRootSpanContext,u=>{try{u.setAttribute("sql.query",t);const f=this.resultCache.getKey(t,n),h=this.resultCache.get(f);if(o===!1&&h!==void 0)return u.setAttribute("sql.rowsCount",h.length),u.setAttribute("sql.cached",!0),u.end(),h;let p=this.cachedStmts.get(t);p===void 0&&(p=this.db.prepare(t),this.cachedStmts.set(t,p));const m=p.select(n);u.setAttribute("sql.rowsCount",m.length),u.setAttribute("sql.cached",!1);const T=s??this.getTablesUsed(t);this.resultCache.set(T,f,m),u.end();const C=ap(u);return this.debugInfo.queryFrameDuration+=C,this.debugInfo.queryFrameCount++,C>5&&$o()&&this.debugInfo.slowQueries.push({queryStr:t,bindValues:n,durationMs:C,rowsCount:m.length,queriedTables:T,startTimePerfNow:AT(u)}),m}finally{u.end()}})}export(){for(const t of this.cachedStmts.keys())this.cachedStmts.delete(t);return this.db.export()}}const vre=e=>{e.execute(Xa`
      PRAGMA page_size=32768;
      PRAGMA cache_size=10000;
      PRAGMA synchronous='OFF';
      PRAGMA temp_store='MEMORY';
      PRAGMA foreign_keys='ON'; -- we want foreign key constraints to be enforced
    `)},Ere=e=>{const[t,n]=e.trim().match(/^delete\s+from\s+(\w+)$/i)??[];return n};class kre{map;constructor(){this.map=new Map}add=t=>{const n=this.map.get(t)??0;this.map.set(t,n+1)};remove=t=>{const n=this.map.get(t)??0;n===1?this.map.delete(t):this.map.set(t,n-1)};has=t=>this.map.has(t);get size(){return this.map.size}*[Symbol.iterator](){for(const t of this.map.keys())yield t}}const eb=(e,t,n="application/octet-stream")=>{const r=e instanceof Blob?e:new Blob([e],{type:n}),s=window.URL.createObjectURL(r);Tre(s,t),setTimeout(()=>window.URL.revokeObjectURL(s),1e3)},Tre=(e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,document.body.append(n),n.style.display="none",n.click(),n.remove()},Cre=()=>{$o()&&(globalThis.__debugLiveStoreUtils={downloadBlob:eb,runSync:e=>fr(e),runFork:e=>ps(e)})};$o()&&Cre();class Ire extends lD{storeId;reactivityGraph;sqliteDbWrapper;clientSession;schema;context;otel;tableRefs;effectContext;activeQueries;__eventSchema;syncProcessor;boot;constructor({clientSession:t,schema:n,otelOptions:r,context:s,batchUpdates:o,storeId:a,effectContext:u,params:f,confirmUnsavedChanges:h,__runningInDevtools:p}){super(),this.storeId=a,this.sqliteDbWrapper=new wre({otel:r,db:t.sqliteDb}),this.clientSession=t,this.schema=n,this.context=s,this.effectContext=u;const m=hre(),T=r.tracer.startSpan("LiveStore:sync",{},r.rootSpanContext);this.syncProcessor=ate({schema:n,clientSession:t,runtime:u.runtime,materializeEvent:(E,{otelContext:v,withChangeset:R})=>{const{eventDef:q,materializer:x}=jy(n,E.name),N=Bee({eventDef:q,materializer:x,db:this.sqliteDbWrapper,event:{decoded:E,encoded:void 0}}),j=new Set,P=()=>{for(const{statementSql:Q,bindValues:oe,writeTables:J=this.sqliteDbWrapper.getTablesUsed(Q)}of N){this.sqliteDbWrapper.execute(Q,oe,{otelContext:v,writeTables:J});for(const De of J)j.add(De)}};let L={_tag:"unset"};return R===!0?L=this.sqliteDbWrapper.withChangeset(P).changeset:P(),{writeTables:j,sessionChangeset:L}},rollback:E=>{this.sqliteDbWrapper.rollback(E)},refreshTables:E=>{const v=[];for(const R of E){const q=this.tableRefs[R];fT(q!==void 0,`No table ref found for ${R}`),v.push([q,null])}m.setRefs(v)},span:T,params:{leaderPushBatchSize:f.leaderPushBatchSize},confirmUnsavedChanges:h}),this.__eventSchema=Ax(n),this.tableRefs={},this.activeQueries=new kre;const C=r.tracer.startSpan("LiveStore:commits",{},r.rootSpanContext),A=Cn.setSpan(Jn.active(),C),D=r.tracer.startSpan("LiveStore:queries",{},r.rootSpanContext),y=Cn.setSpan(Jn.active(),D);this.reactivityGraph=m,this.reactivityGraph.context={store:this,defRcMap:new Map,reactivityGraph:new WeakRef(m),otelTracer:r.tracer,rootOtelContext:y,effectsWrapper:o},this.otel={tracer:r.tracer,rootSpanContext:r.rootSpanContext,commitsSpanContext:A,queriesSpanContext:y};const b=new Set(p?this.schema.state.sqlite.tables.keys():Array.from(this.schema.state.sqlite.tables.keys()).filter(E=>!Uee(E))),_=new Map(Array.from(this.reactivityGraph.atoms.values()).filter(E=>E._tag==="ref"&&E.label?.startsWith("tableRef:")===!0).map(E=>[E.label.slice(9),E]));for(const E of b)this.tableRefs[E]=_.get(E)??this.reactivityGraph.makeRef(null,{equal:()=>!1,label:`tableRef:${E}`,meta:{liveStoreRefType:"table"}});this.boot=K(this,function*(){yield*yn(()=>me(()=>{for(const E of Object.values(this.tableRefs))for(const v of E.super)this.reactivityGraph.removeEdge(v,E);T.end(),C.end(),D.end()})),yield*this.syncProcessor.boot})}get sessionId(){return this.clientSession.sessionId}get clientId(){return this.clientSession.clientId}subscribe=(t,n)=>this.otel.tracer.startActiveSpan("LiveStore.subscribe",{attributes:{label:n?.label,queryLabel:t.label}},n?.otelContext??this.otel.queriesSpanContext,r=>{const s=Cn.setSpan(Jn.active(),r),o=t._tag==="def"||t._tag==="signal-def"?t.make(this.reactivityGraph.context):{value:t,deref:()=>{}},a=o.value,u=`subscribe:${n?.label}`,f=this.reactivityGraph.makeEffect((p,m,T)=>n.onUpdate(p(a.results$,s,T)),{label:u});return n?.stackInfo&&a.activeSubscriptions.add(n.stackInfo),n?.onSubscribe?.(a),this.activeQueries.add(a),n?.skipInitialRun!==!0&&!a.isDestroyed&&f.doEffect(s,{_tag:"subscribe.initial",label:`subscribe-initial-run:${n?.label}`}),()=>{try{this.reactivityGraph.destroyNode(f),this.activeQueries.remove(a),n?.stackInfo&&a.activeSubscriptions.delete(n.stackInfo),o.deref(),n?.onUnsubsubscribe?.()}finally{r.end()}}});subscribeStream=(t,n)=>BY(r=>K(this,function*(){const s=yield*eg.pipe(Of("NoSuchElementException",()=>Nt(void 0))),o=s?Cn.setSpan(Jn.active(),s):Jn.active();yield*Ct(me(()=>this.subscribe(t,{onUpdate:a=>r.single(a),otelContext:o,label:n?.label})),a=>me(()=>a()))}));query=(t,n)=>{if(typeof t=="object"&&"query"in t&&"bindValues"in t)return this.sqliteDbWrapper.select(t.query,rl(t.bindValues,t.query),{otelContext:n?.otelContext});if(lo(t)){const r=t[Bs];r._tag==="RowQuery"&&vF({table:r.tableDef,id:r.id,explicitDefaultValues:r.explicitDefaultValues,otelContext:n?.otelContext})(this.reactivityGraph.context);const s=t.asSql(),o=Tv(t),a=this.sqliteDbWrapper.select(s.query,s.bindValues,{otelContext:n?.otelContext,queriedTables:new Set([t[Bs].tableDef.sqliteDef.name])});return Cc(o)(a)}else if(t._tag==="def"){const r=t.make(this.reactivityGraph.context),s=this.query(r.value,n);return r.deref(),s}else return t._tag==="signal-def"?t.make(this.reactivityGraph.context).value.get():t.run({otelContext:n?.otelContext,debugRefreshReason:n?.debugRefreshReason})};setSignal=(t,n)=>{const r=t.make(this.reactivityGraph.context),s=typeof n=="function"?n(r.value.get()):n;r.value.set(s),r.rc>1&&r.deref()};commit=(t,...n)=>{const{events:r,options:s}=this.getCommitArgs(t,n);for(const f of r)$x(f.args,this.clientSession.sessionId);if(r.length===0)return;const o=s?.skipRefresh??!1;Cn.getSpan(this.otel.commitsSpanContext).addEvent("commit");let u;return this.otel.tracer.startActiveSpan("LiveStore:commit",{attributes:{"livestore.eventsCount":r.length,"livestore.eventTags":r.map(f=>f.name),"livestore.commitLabel":s?.label},links:s?.spanLinks},s?.otelContext??this.otel.commitsSpanContext,f=>{const h=Cn.setSpan(Jn.active(),f);try{const{writeTables:p}=(()=>{try{const C=()=>this.syncProcessor.push(r,{otelContext:h});return r.length>1?this.sqliteDbWrapper.txn(C):C()}catch(C){throw console.error(C),f.setStatus({code:uo.ERROR,message:C.toString()}),C}finally{f.end()}})(),m=[];for(const C of p){const A=this.tableRefs[C];fT(A!==void 0,`No table ref found for ${C}`),m.push([A,null])}const T={_tag:"commit",events:r,writeTables:Array.from(p)};this.reactivityGraph.setRefs(m,{debugRefreshReason:T,otelContext:h,skipRefresh:o})}catch(p){throw console.error(p),f.setStatus({code:uo.ERROR,message:p.toString()}),p}finally{f.end(),u=ap(f)}return{durationMs:u}})};events=t=>dT("store.events() is not yet implemented but planned soon");eventsStream=t=>dT("store.eventsStream() is not yet implemented but planned soon");manualRefresh=t=>{const{label:n}=t??{};this.otel.tracer.startActiveSpan("LiveStore:manualRefresh",{attributes:{"livestore.manualRefreshLabel":n}},this.otel.commitsSpanContext,r=>{const s=Cn.setSpan(Jn.active(),r);this.reactivityGraph.runDeferredEffects({otelContext:s}),r.end()})};shutdown=async t=>{await this.clientSession.shutdown(t??ta(sp.make({reason:"manual"}))).pipe(this.runEffectFork,oo,Ff)};_dev={downloadDb:(t="local")=>{K(this,function*(){const n=t==="local"?this.sqliteDbWrapper.export():yield*this.clientSession.leaderThread.export;eb(n,`livestore-${Date.now()}.db`)}).pipe(this.runEffectFork)},downloadEventlogDb:()=>{K(this,function*(){const t=yield*this.clientSession.leaderThread.getEventlogData;eb(t,`livestore-eventlog-${Date.now()}.db`)}).pipe(this.runEffectFork)},hardReset:(t="all-data")=>{K(this,function*(){const n=this.clientSession.clientId;yield*this.clientSession.leaderThread.sendDevtoolsMessage(Fv.Request.make({liveStoreVersion:In,mode:t,requestId:_r(),clientId:n}))}).pipe(this.runEffectFork)},overrideNetworkStatus:t=>{const n=this.clientSession.clientId;this.clientSession.leaderThread.sendDevtoolsMessage(xv.Request.make({clientId:n,closeLatch:t==="offline",liveStoreVersion:In,requestId:_r()})).pipe(this.runEffectFork)},syncStates:()=>{K(this,function*(){const t=yield*this.syncProcessor.syncState;console.log("Session sync state:",t.toJSON());const n=yield*this.clientSession.leaderThread.getSyncState;console.log("Leader sync state:",n.toJSON())}).pipe(this.runEffectFork)},version:In,otel:{rootSpanContext:()=>Cn.getSpan(this.otel.rootSpanContext)?.spanContext()}};toJSON=()=>({_tag:"livestore.Store",reactivityGraph:this.reactivityGraph.getSnapshot({includeResults:!0})});runEffectFork=t=>t.pipe(Un(this.effectContext.lifetimeScope),ze,Ow(this.effectContext.runtime));getCommitArgs=(t,n)=>{let r,s;return typeof t=="function"?r=t(o=>r.push(o)):t?.label!==void 0||t?.skipRefresh!==void 0||t?.otelContext!==void 0||t?.spanLinks!==void 0?(s=t,r=n):t===void 0?r=[]:r=[t,...n],{events:r,options:s}}}const eC=globalThis.requestAnimationFrame===void 0?e=>setTimeout(e,1e3):globalThis.requestAnimationFrame,$re=globalThis.cancelAnimationFrame===void 0?e=>clearTimeout(e):globalThis.cancelAnimationFrame,Rre=({storeDevtoolsChannel:e,store:t})=>K(function*(){const n=new Map,r=new Map,s=new Map,o=new Map,{clientId:a,sessionId:u}=t.clientSession;yield*yn(()=>me(()=>{n.forEach(m=>m()),r.forEach(m=>m()),s.forEach(m=>m()),o.forEach(m=>m())}));const f=new Set,h=m=>e.send(m).pipe(ze,ps),p=m=>{if(m.clientId!==a||m.sessionId!==u||m._tag==="LSD.ClientSession.Disconnect")return;const T=m.requestId;if(f.has(T))return;f.add(T);const C=globalThis.requestIdleCallback??(A=>A());switch(m._tag){case"LSD.ClientSession.ReactivityGraphSubscribe":{const A=m.includeResults,{subscriptionId:D}=m,y=()=>C(()=>h(Kx.make({reactivityGraph:t.reactivityGraph.getSnapshot({includeResults:A}),requestId:_r(10),clientId:a,sessionId:u,liveStoreVersion:In,subscriptionId:D})),{timeout:500});y();const b=hT(y,20);n.set(D,t.reactivityGraph.subscribeToRefresh(b));break}case"LSD.ClientSession.DebugInfoReq":{h(zx.make({debugInfo:t.sqliteDbWrapper.debugInfo,requestId:T,clientId:a,sessionId:u,liveStoreVersion:In}));break}case"LSD.ClientSession.DebugInfoHistorySubscribe":{const{subscriptionId:A}=m,D=[];let y=!1,b;const _=()=>{D.push(t.sqliteDbWrapper.debugInfo),t.sqliteDbWrapper.debugInfo=EF(),D.length>10&&(h(Bx.make({debugInfoHistory:D,requestId:_r(10),clientId:a,sessionId:u,liveStoreVersion:In,subscriptionId:A})),D.length=0),y===!1&&(b=eC(_))};b=eC(_);const E=()=>{y=!0,b!==void 0&&($re(b),b=void 0)};s.set(A,E);break}case"LSD.ClientSession.DebugInfoHistoryUnsubscribe":{const{subscriptionId:A}=m;s.get(A)?.(),s.delete(A);break}case"LSD.ClientSession.DebugInfoResetReq":{t.sqliteDbWrapper.debugInfo.slowQueries.clear(),h(Hx.make({requestId:T,clientId:a,sessionId:u,liveStoreVersion:In}));break}case"LSD.ClientSession.DebugInfoRerunQueryReq":{const{queryStr:A,bindValues:D,queriedTables:y}=m;t.sqliteDbWrapper.select(A,D,{queriedTables:y,skipCache:!0}),h(Wx.make({requestId:T,clientId:a,sessionId:u,liveStoreVersion:In}));break}case"LSD.ClientSession.ReactivityGraphUnsubscribe":{const{subscriptionId:A}=m;n.get(A)?.(),n.delete(A);break}case"LSD.ClientSession.LiveQueriesSubscribe":{const{subscriptionId:A}=m,D=()=>C(()=>h(Gx.make({liveQueries:[...t.activeQueries].map(b=>({_tag:b._tag,id:b.id,label:b.label,hash:b.def.hash,runs:b.runs,executionTimes:b.executionTimes.map(_=>Number(_.toString().slice(0,5))),lastestResult:b.results$.previousResult===Kl?"SYMBOL_NOT_REFRESHED_YET":b.results$.previousResult,activeSubscriptions:Array.from(b.activeSubscriptions)})),requestId:_r(10),liveStoreVersion:In,clientId:a,sessionId:u,subscriptionId:A})),{timeout:500});D();const y=hT(D,20);r.set(A,t.reactivityGraph.subscribeToRefresh(y));break}case"LSD.ClientSession.LiveQueriesUnsubscribe":{const{subscriptionId:A}=m;r.get(A)?.(),r.delete(A);break}case"LSD.ClientSession.SyncHeadSubscribe":{const{subscriptionId:A}=m,D=y=>h(Vx.make({local:y.localHead,upstream:y.upstreamHead,requestId:_r(10),clientId:a,sessionId:u,liveStoreVersion:In,subscriptionId:A}));D(t.syncProcessor.syncState.pipe(fr)),o.set(A,t.syncProcessor.syncState.changes.pipe(zn(y=>D(y)),hn,St,ze,CK));break}case"LSD.ClientSession.SyncHeadUnsubscribe":{const{subscriptionId:A}=m;o.get(A)?.(),o.delete(A);break}case"LSD.ClientSession.Ping":{h(Qx.make({requestId:T,clientId:a,sessionId:u,liveStoreVersion:In}));break}default:console.warn("[LSD.ClientSession] Unknown message",m)}};yield*e.listen.pipe(Io(),lX(m=>p(m)),hn,Ne("LSD.devtools.onMessage"))}).pipe(ke.mapToUnexpectedError,Ne("LSD.devtools.connectStoreToDevtools")),Are={leaderPushBatchSize:1};class zv extends Cb("@livestore/livestore/effect/LiveStoreContextRunning")(){static fromDeferred=K(function*(){const n=yield*yield*qre;return Pf(zv,n)}).pipe(HK)}class qre extends Cb("@livestore/livestore/effect/DeferredStoreContext")(){}const Ore=async({signal:e,otelOptions:t,...n})=>K(function*(){const r=yield*Rf(),s=yield*ra();return e!==void 0&&e.addEventListener("abort",()=>{Vt(r,Wn).pipe(ze,Ow(s))}),yield*xre({...n}).pipe($f(r))}).pipe(Ne("createStore",{attributes:{storeId:n.storeId,disableDevtools:n.disableDevtools}}),sne({parentSpanContext:t?.rootSpanContext,otelTracer:t?.tracer}),ze,_o({thread:"window"}),bn(_X("window")),c9(wS),Ff),xre=({schema:e,adapter:t,storeId:n,context:r={},boot:s,batchUpdates:o,disableDevtools:a,onBootStatus:u,shutdownDeferred:f,params:h,debug:p,confirmUnsavedChanges:m=!0,syncPayload:T})=>K(function*(){const C=yield*Rf();yield*Fre(n),yield*yn(D=>Vt(C,D));const A=p?.instanceId??_r(10);return yield*K(function*(){const D=yield*eg.pipe(pr),y=Cn.setSpan(Jn.active(),D),b=yield*lx,_=yield*Ln().pipe(Ct(qn));yield*Tc(_).pipe(xZ(j=>u?.(j)),jn(j=>j.stage==="done"?qn(_):ve),kc,ze,yt);const E=yield*Le(),v=j=>K(function*(){const P=yield*E;yield*Rre({storeDevtoolsChannel:j,store:P})}),R=yield*ra(),q=j=>K(function*(){yield*Vt(C,Gt(j)).pipe(_v({label:"@livestore/livestore:shutdown",duration:500}),Ec(1e3),Of("TimeoutException",()=>Ol("@livestore/livestore:shutdown: Timed out after 1 second"))),f&&(yield*za(f,j)),yield*An("LiveStore shutdown complete")}).pipe(Ne("@livestore/livestore:shutdown"),bn(R),ze,ps,oo),x=yield*t({schema:e,storeId:n,devtoolsEnabled:tC(a),bootStatusQueue:_,shutdown:q,connectDevtoolsToStore:v,debugInstanceId:A,syncPayload:T}).pipe(dx("livestore:makeAdapter"),Ne("createStore:makeAdapter"));Ao&&x.leaderThread.initialState.migrationsReport.migrations.length>0&&(yield*An("[@livestore/livestore:createStore] migrationsReport",...x.leaderThread.initialState.migrationsReport.migrations.map(j=>j.hashes.actual===void 0?`Table '${j.tableName}' doesn't exist yet. Creating table...`:`Schema hash mismatch for table '${j.tableName}' (DB: ${j.hashes.actual}, expected: ${j.hashes.expected}), migrating table...`)));const N=new Ire({clientSession:x,schema:e,context:r,otelOptions:{tracer:b,rootSpanContext:y},effectContext:{lifetimeScope:C,runtime:R},__runningInDevtools:tC(a)===!1,confirmUnsavedChanges:m,batchUpdates:j=>j(),storeId:n,params:{leaderPushBatchSize:h?.leaderPushBatchSize??Are.leaderPushBatchSize}});return yield*N.boot,s!==void 0&&(yield*qZ(()=>s(N,{migrationsReport:x.leaderThread.initialState.migrationsReport,parentSpan:D})).pipe(ke.mapToUnexpectedError,bn(Pf(zv,{stage:"running",store:N})),Ne("createStore:boot"))),yield*dK(),o!==void 0&&(N.reactivityGraph.context.effectsWrapper=o),yield*ct(E,N),N}).pipe(Ne("createStore",{attributes:{debugInstanceId:A,storeId:n}}),_o({debugInstanceId:A,storeId:n}),Ao?XZ(D=>console.createTask(D)):se,$f(C))}),Fre=e=>K(function*(){if(!/^[a-zA-Z0-9_-]+$/.test(e))return yield*ke.make({cause:`Invalid storeId: ${e}. Only alphanumeric characters, underscores, and hyphens are allowed.`,payload:{storeId:e}})}),tC=e=>e===!0||e===!1?!e:$o()===!0,Pre="function() { [bytecode] }",Dre=e=>e===Pre?{_tag:"invalid",reason:"react-native"}:{_tag:"valid"},Nre=e=>X(e,"query")&&X(e,"schema"),kF=(e,t)=>{const{queryString:n,extraDeps:r}=Mre(e),s=[n,void 0,mre(r)].filter(Boolean).join("-");if(Dre(s)._tag==="invalid")throw new Error("On Expo/React Native, db queries must provide a `deps` option");if(s.trim()==="")return Te(`Invalid query hash for query: ${e}`);const o=n,a={_tag:"def",make:yre(s,(u,f)=>new Lre({reactivityGraph:u.reactivityGraph.deref(),queryInput:e,label:o,map:t?.map,otelContext:f,def:a})),label:o,hash:s};return a},nC=e=>e===void 0?[]:Object.entries(e).map(([t,n])=>`${t}:${n===qo?"SessionIdSymbol":n}`).join(","),Mre=e=>{if(lo(e)){const{query:t,bindValues:n}=e.asSql();return{queryString:t,extraDeps:nC(n)}}return Nre(e)?{queryString:e.query,extraDeps:nC(e.bindValues)}:typeof e=="function"?{queryString:e.toString(),extraDeps:[]}:Te(`Invalid query input: ${e}`)};class Lre extends gre{_tag="db";queryInput$;results$;label;reactivityGraph;mapResult;def;constructor({queryInput:t,label:n,reactivityGraph:r,map:s,otelContext:o,def:a}){super();let u=n??"db(unknown)";this.reactivityGraph=r,this.def=a,this.mapResult=s===void 0?y=>y:s;const f={current:typeof t=="function"||lo(t)?void 0:t.schema},h={current:void 0};let p;const m=(y,b)=>{try{const _=y.asSql(),E=Tv(y),v=y[Bs];return{queryInputRaw:{query:_.query,schema:E,bindValues:_.bindValues,queriedTables:new Set([v.tableDef.sqliteDef.name])},label:v._tag==="RowQuery"?XT(v.tableDef,v.id):y.toString(),execBeforeFirstRun:v._tag==="RowQuery"?vF({table:v.tableDef,explicitDefaultValues:v.explicitDefaultValues,id:v.id,otelContext:b}):void 0}}catch(_){throw new ke({cause:_,note:`Error building query for ${y.toString()}`,payload:{qb:y}})}};if(typeof t=="function")p=this.reactivityGraph.makeThunk((y,b,_,E)=>{const v=performance.now(),R=t(_re(y,_,E??_.rootOtelContext,this.dependencyQueriesRef),_),q=performance.now()-v;let x;if(lo(R)){const N=m(R,E);x=N.queryInputRaw,this.label=N.label,h.current=N.execBeforeFirstRun}else x=R;return b({_tag:"computed",label:`${this.label}:queryInput`,query:x.query,durationMs:q}),f.current=x.schema,x},{label:`${u}:query`,meta:{liveStoreThunkType:"db.query"},equal:(y,b)=>y.query===b.query&&Ja(y.bindValues,b.bindValues)}),this.queryInput$=p;else{let y;if(lo(t)){const b=m(t,o);y=b.queryInputRaw,u=b.label,h.current=b.execBeforeFirstRun}else y=t;if(f.current=y.schema,p=y,n===void 0&&lo(t)){const b=t[Bs];b._tag==="RowQuery"&&(u=`db(${XT(b.tableDef,b.id)})`)}}const T={current:void 0},C=y=>(b,_)=>b===Kl||_===Kl?!1:jY(y)(b,_),A=s===void 0?f.current===void 0?(y,b)=>C(f.current)(y,b):C(f.current):void 0,D=this.reactivityGraph.makeThunk((y,b,_,E,v)=>_.otelTracer.startActiveSpan("db:...",{attributes:{"livestore.debugRefreshReason":X(v,"label")?v.label:v?._tag}},E??_.rootOtelContext,R=>{const q=Cn.setSpan(Jn.active(),R),{store:x}=_;h.current!==void 0&&(h.current(_,q),h.current=void 0);const N=ore(p)?y(p,q,v):p,j=N.query,P=N.bindValues;T.current===void 0&&(T.current=x.sqliteDbWrapper.getTablesUsed(j)),P!==void 0&&$x(P,x.clientSession.sessionId);for(const De of T.current){const qe=x.tableRefs[De]??Te(`No table ref found for ${De}`);y(qe,q,v)}R.setAttribute("sql.query",j),R.updateName(`db:${j.slice(0,50)}`);const L=x.sqliteDbWrapper.select(j,P?rl(P,j):void 0,{queriedTables:T.current,otelContext:q});R.setAttribute("sql.rowsCount",L.length);const Q=hu(f.current)(L);if(Q._tag==="Left"){const De=Zu.formatErrorSync(Q.left),qe=String(f.current.ast),nt=P===void 0?"":`
Bind values: ${JSON.stringify(P)}`;return Te(`Error parsing SQL query result (${u}).

Query: ${j}${nt}

Expected schema: ${qe}

Error: ${De}

Result:`,L,`
`)}const oe=this.mapResult(Q.right);R.end();const J=ap(R);return this.executionTimes.push(J),b({_tag:"db",label:`${u}:results`,query:j,durationMs:J}),oe}),{label:`${u}:results`,meta:{liveStoreThunkType:"db.result"},equal:A});this.results$=D,this.label=u}destroy=()=>{this.isDestroyed=!0,this.queryInput$!==void 0&&this.reactivityGraph.destroyNode(this.queryInput$),this.reactivityGraph.destroyNode(this.results$);for(const t of this.dependencyQueriesRef)t.deref()}}function Ure(e){return new Worker("/assets/livestore.worker-DoS1HQPU.js",{type:"module",name:e?.name})}const jre=Kf({name:"v1.TodoCreated",schema:Y({id:M,text:M})}),zre=Kf({name:"v1.TodoCompleted",schema:Y({id:M})}),Bre=Kf({name:"v1.TodoUncompleted",schema:Y({id:M})}),Hre=Kf({name:"v1.TodoDeleted",schema:Y({id:M,deletedAt:rv})}),Wre=Kf({name:"v1.TodoClearedCompleted",schema:Y({deletedAt:rv})}),Vre=Object.freeze(Object.defineProperty({__proto__:null,todoClearedCompleted:Wre,todoCompleted:zre,todoCreated:jre,todoDeleted:Hre,todoUncompleted:Bre},Symbol.toStringTag,{value:"Module"})),$a=zo({name:"todos",columns:{id:vT({primaryKey:!0}),text:vT({default:""}),completed:Oee({default:!1}),deletedAt:xee({nullable:!0,schema:fY})}}),Kre=Ce("all","active","completed"),TF=Vee({name:"uiState",schema:Y({newTodoText:M,filter:Kre}),default:{id:qo,value:{newTodoText:"",filter:"all"}}}),Bv={todos:$a,uiState:TF},Oo={...Vre,uiStateSet:TF.set},Gre=Hee(Oo,{"v1.TodoCreated":({id:e,text:t})=>$a.insert({id:e,text:t,completed:!1}),"v1.TodoCompleted":({id:e})=>$a.update({completed:!0}).where({id:e}),"v1.TodoUncompleted":({id:e})=>$a.update({completed:!1}).where({id:e}),"v1.TodoDeleted":({id:e,deletedAt:t})=>$a.update({deletedAt:t}).where({id:e}),"v1.TodoClearedCompleted":({deletedAt:e})=>$a.update({deletedAt:e}).where({completed:!0})}),Qre=Xee({tables:Bv,materializers:Gre}),Jre=Yee({events:Oo,state:Qre});function CF(e){const t=document.createElement("template");return t.innerHTML=e,{source:e,cloneNode(){return t.content.cloneNode(!0)}}}const Yre=`<!-- Todo item template - represents a single todo with checkbox, label, and delete button -->
<li class="todo-item">
    <!-- Checkbox for marking todo as completed/uncompleted -->
    <input type="checkbox" />
    
    <!-- Label that displays the todo text (populated by TodoItem.updateTemplate()) -->
    <label class="container"></label>
    
    <!-- Delete button with SVG X icon - hidden by default, shown on hover -->
    <button class="delete-todo" aria-label="Delete todo">
        <!-- SVG X icon - uses currentColor to inherit text color, centered via CSS flexbox -->
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
        </svg>
    </button>
</li>
`;class IF extends HTMLElement{#e;onDeleteTodo;onToggleTodo;constructor(t){super(),this.#e=null,this.append(CF(Yre).cloneNode()),this.onDeleteTodo=t.onDeleteTodo,this.onToggleTodo=t.onToggleTodo;const n=this.querySelector("button");n&&n.addEventListener("click",this.onDelete.bind(this));const r=this.querySelector("input[type=checkbox]");r&&r.addEventListener("change",this.onToggle.bind(this))}onDelete(){this.#e&&this.onDeleteTodo(this.#e)}onToggle(){this.#e&&this.onToggleTodo(this.#e)}set todo(t){this.#e=t,this.updateTemplate()}get todo(){return this.#e}updateTemplate(){const t=this.querySelector("label");t&&(t.textContent=this.#e?.text||"");const n=this.querySelector("input");n&&(n.checked=!!this.#e?.completed)}}const Xre=`<header>
    <form>
        <input autofocus placeholder="What needs to be done?" />
    </form>
</header>
<section class="main">
    <fieldset id="todo-container"></fieldset>
</section>
`;class Zre extends HTMLElement{constructor(){super(),this.appendChild(CF(Xre).cloneNode())}todos=[];onInput(t){}onSubmit(t){}onDeleteTodo(t){}onToggleTodo(t){}configure(t){const{onSubmit:n,onInput:r,onDeleteTodo:s,onToggleTodo:o}=t;this.onSubmit=n,this.onInput=r,this.onDeleteTodo=s,this.onToggleTodo=o,this.querySelector("input")?.addEventListener("input",this.onInput.bind(this)),this.querySelector("form")?.addEventListener("submit",this.onSubmit.bind(this)),this.render()}render(){const t=this.querySelector("#todo-container");if(t){t.innerHTML="";for(const n of this.todos){const r=new IF({onDeleteTodo:this.onDeleteTodo,onToggleTodo:this.onToggleTodo});r.todo=n,t.append(r)}}}connectedCallback(){this.render()}}const ese=nre({storage:{type:"opfs"},worker:Ure,sharedWorker:sre}),Wi=await Ore({schema:Jre,adapter:ese,storeId:"todomvc-custom-elements"}),tse=kF(Bv.uiState.get()),nse=kF(Bv.todos.where({deletedAt:null})),rse=e=>Wi.commit(Oo.uiStateSet({newTodoText:e})),sse=e=>Wi.commit(Oo.todoCreated({id:crypto.randomUUID(),text:e}),Oo.uiStateSet({newTodoText:""})),ose=e=>{e.completed?Wi.commit(Oo.todoUncompleted({id:e.id})):Wi.commit(Oo.todoCompleted({id:e.id}))},ise=e=>Wi.commit(Oo.todoDeleted({id:e.id,deletedAt:new Date}));customElements.define("todo-item",IF);customElements.define("todo-list",Zre);const Ea=document.getElementById("todo-list");if(Ea){const e=Ea.querySelector("input");Wi.subscribe(nse,{onUpdate:t=>{Ea.todos=t,Ea.render()}}),Wi.subscribe(tse,{onUpdate:t=>{e&&(e.value=t.newTodoText)}}),Ea.configure({onInput:t=>{const n=t.target;rse(n.value)},onSubmit:t=>{t.preventDefault();const n=Ea.querySelector("input");n&&sse(n.value)},onToggleTodo:t=>{ose(t)},onDeleteTodo:t=>{ise(t)}})}
