const fR=e=>typeof e=="function",l=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(i){return t(i,n,r,s)}};case 5:return function(n,r,s,o,i){return arguments.length>=5?t(n,r,s,o,i):function(c){return t(c,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},j=e=>e,Hf=e=>()=>e,vS=Hf(!0),An=Hf(!1),_$=Hf(void 0),sa=_$;function f(e,t,n,r,s,o,i,c,a){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return i(o(s(r(n(t(e))))));case 8:return c(i(o(s(r(n(t(e)))))));case 9:return a(c(i(o(s(r(n(t(e))))))));default:{let u=arguments[0];for(let d=1;d<arguments.length;d++)u=arguments[d](u);return u}}}const Us=e=>(t,n)=>t===n||e(t,n),dR=l(2,(e,t)=>Us((n,r)=>e(t(n),t(r)))),hR=e=>Us((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0});let pR="3.15.2";const Jf=()=>pR,IS=`effect/GlobalValue/globalStoreId/${Jf()}`;let Cc;const te=(e,t)=>(Cc||(globalThis[IS]??=new Map,Cc=globalThis[IS]),Cc.has(e)||Cc.set(e,t()),Cc.get(e)),Jt=e=>typeof e=="string",Fr=e=>typeof e=="number",Xs=e=>typeof e=="boolean",Vf=e=>typeof e=="bigint",Nl=e=>typeof e=="symbol",Ja=fR,gR=e=>e===void 0,mR=e=>!1,Gf=e=>typeof e=="object"&&e!==null,dr=e=>Gf(e)||Ja(e),q=l(2,(e,t)=>dr(e)&&t in e),Sm=l(2,(e,t)=>q(e,"_tag")&&e._tag===t),jo=e=>e==null,yR=e=>e!=null,bR=e=>e instanceof Uint8Array,SR=e=>e instanceof Date,_m=e=>q(e,Symbol.iterator),_R=e=>Gf(e)&&!Array.isArray(e),w$=e=>q(e,"then")&&Ja(e.then),Qf=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let $$=class E${self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new E$(this.self)}};const wR=335903614,$R=4150755663,ER=1481765933,kR=1284865837,CR=9007199254740992,vR=134217728;class IR{_state;constructor(t,n,r,s){return jo(n)&&jo(t)?(n=Math.random()*4294967295>>>0,t=0):jo(n)&&(n=t,t=0),jo(s)&&jo(r)?(s=this._state?this._state[3]:$R,r=this._state?this._state[2]:wR):jo(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),TS(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*vR+n)/CR}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;TR(this._state,t,n,ER,kR),TS(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,i=t>>>27,c=(-i>>>0&31)>>>0;return(o>>>i|o<<c)>>>0}}function TR(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,i=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,a=(n>>>16)*(s>>>16)+((i>>>16)+(o>>>16))>>>0;i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(a=a+1>>>0),o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(a=a+1>>>0),a=a+Math.imul(n,r)>>>0,a=a+Math.imul(t,s)>>>0,e[0]=a,e[1]=c}function TS(e,t,n,r,s){let o=t+r>>>0;const i=n+s>>>0;i>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=i}const Tp=Symbol.for("effect/Utils/YieldWrap");class Vi{#e;constructor(t){this.#e=t}[Tp](){return this.#e}}function OR(e){if(typeof e=="object"&&e!==null&&Tp in e)return e[Tp]();throw new Error(Qf("yieldWrapGet"))}const yn=te("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),k$={effect_internal_function:e=>e()},RR={effect_internal_function:e=>{try{return e()}finally{}}},PR=k$.effect_internal_function(()=>new Error().stack)?.includes("effect_internal_function")===!0,Pe=PR?k$.effect_internal_function:RR.effect_internal_function,FR=function*(){}.constructor,xR=e=>dr(e)&&e.constructor===FR,Qh=te(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),G=Symbol.for("effect/Hash"),M=e=>{if(yn.enabled===!0)return 0;switch(typeof e){case"number":return wm(e);case"bigint":return ot(e.toString(10));case"boolean":return ot(String(e));case"symbol":return ot(String(e));case"string":return ot(e);case"undefined":return ot("undefined");case"function":case"object":return e===null?ot("null"):e instanceof Date?M(e.toISOString()):e instanceof URL?M(e.href):MR(e)?e[G]():Yf(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},Yf=e=>(Qh.has(e)||Qh.set(e,wm(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),Qh.get(e)),K=e=>t=>t*53^e,Xf=e=>e&3221225471|e>>>1&1073741824,MR=e=>q(e,G),wm=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return Xf(t)},ot=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return Xf(t)},AR=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=f(ot(t[r]),K(M(e[t[r]])));return Xf(n)},C$=e=>AR(e,Object.keys(e)),Va=e=>{let t=6151;for(let n=0;n<e.length;n++)t=f(t,K(M(e[n])));return Xf(t)},$e=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,G,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,G,{value(){return t},enumerable:!1}),t},V=Symbol.for("effect/Equal");function W(){return arguments.length===1?e=>Ll(e,arguments[0]):Ll(arguments[0],arguments[1])}function Ll(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(Dl(e)&&Dl(t))return M(e)===M(t)&&e[V](t)?!0:yn.enabled&&yn.tester?yn.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString();if(e instanceof URL&&t instanceof URL)return e.href===t.href}if(yn.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>Ll(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&Ll(e[o],t[o])))return yn.tester?yn.tester(e,t):!1;return!0}}return yn.tester?yn.tester(e,t):!1}}return yn.enabled&&yn.tester?yn.tester(e,t):!1}const Dl=e=>q(e,V),$m=()=>W,fe=Symbol.for("nodejs.util.inspect.custom"),Ae=e=>{try{if(q(e,"toJSON")&&Ja(e.toJSON)&&e.toJSON.length===0)return e.toJSON();if(Array.isArray(e))return e.map(Ae)}catch{return{}}return Zs(e)},Oe=e=>JSON.stringify(e,null,2),Zf={toJSON(){return Ae(this)},[fe](){return this.toJSON()},toString(){return Oe(this.toJSON())}};let NR=class{[fe](){return this.toJSON()}toString(){return Oe(this.toJSON())}};const yi=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?v$(e,t):String(e)}catch{return String(e)}},v$=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&(js.fiberRefs!==void 0&&I$(o)?o[ed](js.fiberRefs):o):o,t);return n=void 0,r},ed=Symbol.for("effect/Inspectable/Redactable"),I$=e=>typeof e=="object"&&e!==null&&ed in e,js=te("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),LR=(e,t)=>{const n=js.fiberRefs;js.fiberRefs=e;try{return t()}finally{js.fiberRefs=n}},Zs=e=>I$(e)&&js.fiberRefs!==void 0?e[ed](js.fiberRefs):e,N=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},zc="Async",Ga="Commit",bt="Failure",pl="OnFailure",ql="OnSuccess",Ul="OnSuccessAndFailure",St="Success",T$="Sync",DR="Tag",Gi="UpdateRuntimeFlags",jl="While",Wc="Iterator",O$="WithRuntime",gl="Yield",Em="RevertFlags",qR=Symbol.for("effect/Effect"),Op=Symbol.for("effect/Stream"),UR=Symbol.for("effect/Sink"),jR=Symbol.for("effect/Channel"),eo={_R:e=>e,_E:e=>e,_A:e=>e,_V:Jf()},zR={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},WR={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Qa={[qR]:eo,[Op]:eo,[UR]:zR,[jR]:WR,[V](e){return this===e},[G](){return $e(this,Yf(this))},[Symbol.iterator](){return new $$(new Vi(this))},pipe(){return N(this,arguments)}},km={[G](){return $e(this,C$(this))},[V](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&W(this[r],e[r])))return!1;return!0}},Ya={...Qa,_op:Ga},BR={...Ya,...km},KR=function(){function e(){}return e.prototype=Ya,e}(),R$=Symbol.for("effect/Option"),P$={...Qa,[R$]:{_A:e=>e},[fe](){return this.toJSON()},toString(){return Oe(this.toJSON())}},HR=Object.assign(Object.create(P$),{_tag:"Some",_op:"Some",[V](e){return Cm(e)&&x$(e)&&W(this.value,e.value)},[G](){return $e(this,K(M(this._tag))(M(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:Ae(this.value)}}}),JR=M("None"),VR=Object.assign(Object.create(P$),{_tag:"None",_op:"None",[V](e){return Cm(e)&&F$(e)},[G](){return JR},toJSON(){return{_id:"Option",_tag:this._tag}}}),Cm=e=>q(e,R$),F$=e=>e._tag==="None",x$=e=>e._tag==="Some",vm=Object.create(VR),zl=e=>{const t=Object.create(HR);return t.value=e,t},M$=Symbol.for("effect/Either"),A$={...Qa,[M$]:{_R:e=>e},[fe](){return this.toJSON()},toString(){return Oe(this.toJSON())}},GR=Object.assign(Object.create(A$),{_tag:"Right",_op:"Right",[V](e){return Im(e)&&L$(e)&&W(this.right,e.right)},[G](){return K(M(this._tag))(M(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:Ae(this.right)}}}),QR=Object.assign(Object.create(A$),{_tag:"Left",_op:"Left",[V](e){return Im(e)&&N$(e)&&W(this.left,e.left)},[G](){return K(M(this._tag))(M(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:Ae(this.left)}}}),Im=e=>q(e,M$),N$=e=>e._tag==="Left",L$=e=>e._tag==="Right",YR=e=>{const t=Object.create(QR);return t.left=e,t},XR=e=>{const t=Object.create(GR);return t.right=e,t},H=XR,z=YR,D$=Im,pt=N$,tr=L$,ZR=l(2,(e,{onLeft:t,onRight:n})=>pt(e)?z(t(e.left)):H(n(e.right))),Tm=l(2,(e,t)=>pt(e)?z(t(e.left)):H(e.right)),e1=l(2,(e,t)=>tr(e)?H(t(e.right)):z(e.left)),vt=l(2,(e,{onLeft:t,onRight:n})=>pt(e)?t(e.left):n(e.right)),t1=vt({onLeft:j,onRight:j}),q$=l(2,(e,t)=>{if(tr(e))return e.right;throw t(e.left)}),n1=q$(()=>new Error("getOrThrow called on a Left")),U$=e=>e.length>0,j$=e=>(t,n)=>t===n?0:e(t,n),r1=j$((e,t)=>e<t?-1:1),z$=l(2,(e,t)=>j$((n,r)=>e(t(n),t(r)))),s1=e=>l(2,(t,n)=>e(t,n)===1),P=()=>vm,F=zl,o1=Cm,qe=F$,_e=x$,Re=l(2,(e,{onNone:t,onSome:n})=>qe(e)?t():n(e.value)),Ue=l(2,(e,t)=>qe(e)?t():e.value),Zr=l(2,(e,t)=>qe(e)?t():e),i1=l(2,(e,t)=>qe(e)?F(t()):e),$o=e=>e==null?P():F(e),Fn=Ue(_$),c1=e=>(...t)=>{try{return F(e(...t))}catch{return P()}},zs=l(2,(e,t)=>qe(e)?P():F(t(e.value))),Qi=l(2,(e,t)=>qe(e)?P():t(e.value)),a1=l(2,(e,t)=>qe(e)?P():$o(t(e.value))),u1=Qi,l1=l(2,(e,t)=>u1(e,n=>t(n)?zl(n):vm)),f1=e=>Us((t,n)=>qe(t)?qe(n):qe(n)?!1:e(t.value,n.value)),d1=e=>l(2,(t,n)=>qe(t)?!1:e(t.value,n)),h1=$m(),p1=d1(h1),g1=l(2,(e,t)=>qe(e)?!1:t(e.value)),OS=e=>(t,n)=>qe(t)?n:qe(n)?t:F(e(t.value,n.value)),m1=(...e)=>e,y1=e=>{const n=e[Symbol.iterator]().next();return n.done?P():F(n.value)},Rp=e=>{const n=e[Symbol.iterator]().next();if(n.done)throw new Error("unsafeHead: empty iterable");return n.value},b1=l(2,(e,t)=>{let n=0;for(const r of e){const s=t(r,n);if(Xs(s)){if(s)return F(r)}else if(_e(s))return s;n++}return P()}),S1={[Symbol.iterator](){return _1}},_1={next(){return{done:!0,value:void 0}}},w1=()=>S1,$1=l(2,(e,t)=>({[Symbol.iterator](){const n=e[Symbol.iterator]();let r=0;return{next(){let s=n.next();for(;!s.done;){if(t(s.value,r++))return{done:!1,value:s.value};s=n.next()}return{done:!0,value:void 0}}}}})),E1=l(2,(e,t)=>{const n={...e};for(const r of k1(e))n[r]=t(e[r],r);return n}),k1=e=>Object.keys(e),td=e=>new Array(e),C1=l(2,(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r}),ge=e=>Array.isArray(e)?e:Array.from(e),Om=e=>Array.isArray(e)?e:[e],v1=l(2,(e,{onEmpty:t,onNonEmpty:n})=>je(e)?n(Bt(e),to(e)):t()),Wl=l(2,(e,t)=>[t,...e]),I1=l(2,(e,t)=>[...e,t]),Rm=l(2,(e,t)=>ge(e).concat(ge(t))),T1=Array.isArray,O1=e=>e.length===0,R1=O1,ml=U$,je=U$,W$=(e,t)=>e<0||e>=t.length,P1=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),F1=l(2,(e,t)=>{const n=Math.floor(t);return W$(n,e)?P():F(e[n])}),B$=l(2,(e,t)=>{const n=Math.floor(t);if(W$(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),Bc=F1(0),Bt=B$(0),x1=e=>je(e)?F(K$(e)):P(),K$=e=>e[e.length-1],to=e=>e.slice(1),M1=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},A1=l(2,(e,t)=>J$(e,M1(e,t))),N1=l(2,(e,t)=>{const n=ge(e);return n.slice(P1(t,n),n.length)}),L1=b1,RS=e=>Array.from(e).reverse(),oa=l(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),PS=l(2,(e,t)=>D1(e,t,m1)),D1=l(3,(e,t,n)=>{const r=ge(e),s=ge(t);if(je(r)&&je(s)){const o=[n(Bt(r),Bt(s))],i=Math.min(r.length,s.length);for(let c=1;c<i;c++)o[c]=n(r[c],s[c]);return o}return[]}),q1=e=>l(2,(t,n)=>{for(const r of t)if(e(n,r))return!0;return!1}),H$=$m(),J$=l(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return je(n)?r>=1?U1(n,r):[[],n]:[n,[]]}),U1=l(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[Nc(e),[]]:[Wl(e.slice(1,n),Bt(e)),e.slice(n)]}),Nc=e=>e.slice(),j1=l(3,(e,t,n)=>{const r=ge(e),s=ge(t);return je(r)?je(s)?Q$(n)(Rm(r,s)):r:s}),yl=l(2,(e,t)=>j1(e,t,H$)),z1=e=>{const t=q1(e);return l(2,(n,r)=>ge(n).filter(s=>t(r,s)))},W1=z1(H$),cs=()=>[],Pn=e=>[e],Ws=l(2,(e,t)=>e.map(t)),Bl=l(2,(e,t)=>{if(R1(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),B1=Bl(j),V$=l(2,(e,t)=>{const n=ge(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);_e(o)&&r.push(o.value)}return r}),G$=l(2,(e,t)=>{const n=ge(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),Pm=l(3,(e,t,n)=>ge(e).reduce((r,s,o)=>n(r,s,o),t)),FS=(e,t)=>{const n=[];let r=e,s;for(;_e(s=t(r));){const[o,i]=s.value;n.push(o),r=i}return n},nd=hR,Q$=l(2,(e,t)=>{const n=ge(e);if(je(n)){const r=[Bt(n)],s=to(n);for(const o of s)r.every(i=>!t(o,i))&&r.push(o);return r}return[]}),K1=e=>Q$(e,$m()),Yi=l(2,(e,t)=>ge(e).join(t)),Y$=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return Y$(e,t.from)}},Nn=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),Fm=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},H1=e=>{try{return e.toISOString()}catch{return String(e)}},En=(e,t=!0)=>{if(Array.isArray(e))return`[${e.map(n=>En(n,t)).join(",")}]`;if(SR(e))return H1(e);if(q(e,"toString")&&Ja(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();if(Jt(e))return JSON.stringify(e);if(Fr(e)||e==null||Xs(e)||Nl(e))return String(e);if(Vf(e))return String(e)+"n";if(_m(e))return`${e.constructor.name}(${En(Array.from(e),t)})`;try{t&&JSON.stringify(e);const n=`{${Nn(e).map(s=>`${Jt(s)?JSON.stringify(s):String(s)}:${En(e[s],!1)}`).join(",")}}`,r=e.constructor.name;return e.constructor!==Object.prototype.constructor?`${r}(${n})`:n}catch{return"<circular structure>"}},xm=e=>typeof e=="string"?JSON.stringify(e):String(e),X$=e=>Array.isArray(e),J1=e=>!Array.isArray(e),xS=e=>`[${xm(e)}]`,Z$=e=>X$(e)?e.map(xS).join(""):xS(e),qr=(e,t,n,r)=>{let s=e;return n&&je(n)&&(s+=`
at path: ${Z$(n)}`),t!==void 0&&(s+=`
details: ${t}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},eE=(e,t,n)=>qr("Unsupported schema",e,t,n),V1=(e,t)=>eE("Cannot build an Equivalence",t,e),tE=(e,t,n)=>qr("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,n),nE=e=>eE(void 0,void 0,e),G1=e=>qr("Unsupported key schema",void 0,void 0,e),Q1=e=>qr("Unsupported literal",`literal value: ${En(e)}`),MS=e=>qr("Duplicate index signature",`${e} index signature`),Y1=qr("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),X1=qr("Invalid element","A required element cannot follow an optional element. ts(1257)"),AS=e=>qr("Duplicate property signature transformation",`Duplicate key ${En(e)}`),rE=e=>qr("Duplicate property signature",`Duplicate key ${En(e)}`),Z1=Symbol.for("effect/SchemaId/Int"),eP=Symbol.for("effect/SchemaId/Between"),bi=r1,Kl=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),tP=Symbol.for("effect/annotation/Brand"),nP=Symbol.for("effect/annotation/SchemaId"),sE=Symbol.for("effect/annotation/Message"),Mm=Symbol.for("effect/annotation/MissingMessage"),Am=Symbol.for("effect/annotation/Identifier"),hr=Symbol.for("effect/annotation/Title"),ti=Symbol.for("effect/annotation/AutoTitle"),Xa=Symbol.for("effect/annotation/Description"),oE=Symbol.for("effect/annotation/Examples"),iE=Symbol.for("effect/annotation/Default"),cE=Symbol.for("effect/annotation/JSONSchema"),aE=Symbol.for("effect/annotation/Arbitrary"),uE=Symbol.for("effect/annotation/Pretty"),Nm=Symbol.for("effect/annotation/Equivalence"),rP=Symbol.for("effect/annotation/Documentation"),lE=Symbol.for("effect/annotation/Concurrency"),fE=Symbol.for("effect/annotation/Batching"),dE=Symbol.for("effect/annotation/ParseIssueTitle"),hE=Symbol.for("effect/annotation/ParseOptions"),pE=Symbol.for("effect/annotation/DecodingFallback"),Hl=Symbol.for("effect/annotation/Surrogate"),sP=Symbol.for("effect/annotation/StableFilter"),Mt=l(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?F(e.annotations[t]):P()),oP=Mt(tP),iP=Mt(sE),cP=Mt(Mm),gE=Mt(hr),mE=Mt(ti),rd=Mt(Am),yE=Mt(Xa),aP=Mt(lE),uP=Mt(fE),lP=Mt(dE),fP=Mt(hE),dP=Mt(pE),Eo=Mt(Hl),hP=Mt(sP),pP=e=>g1(hP(e),t=>t===!0),sd=Symbol.for("effect/annotation/JSONIdentifier"),gP=Mt(sd),mP=e=>Zr(gP(e),()=>rd(e));class od{typeParameters;decodeUnknown;encodeUnknown;annotations;_tag="Declaration";constructor(t,n,r,s={}){this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return Ue(ir(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:lt(this.annotations)}}}const Wn=e=>t=>t._tag===e;let Jl=class{literal;annotations;_tag="Literal";constructor(t,n={}){this.literal=t,this.annotations=n}toString(){return Ue(ir(this),()=>En(this.literal))}toJSON(){return{_tag:this._tag,literal:Vf(this.literal)?String(this.literal):this.literal,annotations:lt(this.annotations)}}};const Kc=Wn("Literal"),yP=new Jl(null);class bP{symbol;annotations;_tag="UniqueSymbol";constructor(t,n={}){this.symbol=t,this.annotations=n}toString(){return Ue(ir(this),()=>En(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:lt(this.annotations)}}}class SP{annotations;_tag="UndefinedKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const Vl=new SP({[hr]:"undefined"});class _P{annotations;_tag="VoidKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const wP=new _P({[hr]:"void"});class $P{annotations;_tag="NeverKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const id=new $P({[hr]:"never"}),EP=Wn("NeverKeyword");class kP{annotations;_tag="UnknownKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const bE=new kP({[hr]:"unknown"});class CP{annotations;_tag="AnyKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const SE=new CP({[hr]:"any"});class vP{annotations;_tag="StringKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const Pp=new vP({[hr]:"string",[Xa]:"a string"}),Gl=Wn("StringKeyword");class IP{annotations;_tag="NumberKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const Fp=new IP({[hr]:"number",[Xa]:"a number"}),NS=Wn("NumberKeyword");class TP{annotations;_tag="BooleanKeyword";constructor(t={}){this.annotations=t}toString(){return ys(this)}toJSON(){return{_tag:this._tag,annotations:lt(this.annotations)}}}const xp=new TP({[hr]:"boolean",[Xa]:"a boolean"}),LS=Wn("BooleanKeyword"),Lm=Wn("SymbolKeyword"),OP=Wn("TemplateLiteral");let cd=class{type;annotations;constructor(t,n={}){this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:lt(this.annotations)}}toString(){return String(this.type)}};class ko extends cd{isOptional;constructor(t,n,r={}){super(t,r),this.isOptional=n}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:lt(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const _E=e=>e.map(t=>t.type);class ad{elements;rest;isReadonly;annotations;_tag="TupleType";constructor(t,n,r,s={}){this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,i=!1;for(const c of t)if(c.isOptional)o=!0;else if(o){i=!0;break}if(i||o&&n.length>1)throw new Error(X1)}toString(){return Ue(ir(this),()=>RP(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:lt(this.annotations)}}}const RP=e=>{const t=e.elements.map(String).join(", ");return v1(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const i=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${i}]`:`readonly [...${o}[], ${i}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Ge extends ko{name;isReadonly;constructor(t,n,r,s,o){super(n,r,o),this.name=t,this.isReadonly=s}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:lt(this.annotations)}}}const wE=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return wE(e.from)}return!1};class Za{type;isReadonly;parameter;constructor(t,n,r){if(this.type=n,this.isReadonly=r,wE(t))this.parameter=t;else throw new Error(Y1)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class kn{annotations;_tag="TypeLiteral";propertySignatures;indexSignatures;constructor(t,n,r={}){this.annotations=r;const s={};for(let i=0;i<t.length;i++){const c=t[i].name;if(Object.prototype.hasOwnProperty.call(s,c))throw new Error(rE(c));s[c]=null}const o={string:!1,symbol:!1};for(let i=0;i<n.length;i++){const c=no(n[i].parameter);if(Gl(c)){if(o.string)throw new Error(MS("string"));o.string=!0}else if(Lm(c)){if(o.symbol)throw new Error(MS("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return Ue(ir(this),()=>PP(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:lt(this.annotations)}}}const DS=e=>e.map(String).join("; "),PP=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${DS(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${DS(e.indexSignatures)} }`:"{}"},Ql=Wn("TypeLiteral"),FP=oa(z$(bi,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),xP={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},$E=e=>Bl(e,t=>eu(t)?$E(t.types):[t]),MP=e=>{const t=FP(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[SE];case"UnknownKeyword":return[bE];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const i=typeof o.literal;switch(i){case"string":case"number":case"bigint":case"boolean":{const c=xP[i];!r[c]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n};let Ut=class Mp{types;annotations;static make=(t,n)=>Dm(t)?new Mp(t,n):t.length===1?t[0]:id;static unify=(t,n)=>Mp.make(MP($E(t)),n);_tag="Union";constructor(t,n={}){this.types=t,this.annotations=n}toString(){return Ue(ir(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:lt(this.annotations)}}};const AP=(e,t)=>e.map(t),Dm=e=>e.length>1,eu=Wn("Union"),Yh=te(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class Si{f;annotations;_tag="Suspend";constructor(t,n={}){this.f=t,this.annotations=n,this.f=Fm(t)}toString(){return ir(this).pipe(Zr(()=>Qi(c1(this.f)(),t=>ir(t))),Ue(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=Yh.get(t);return n||(Yh.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:lt(this.annotations)},Yh.set(t,n),n)}}let tu=class{from;filter;annotations;_tag="Refinement";constructor(t,n,r={}){this.from=t,this.filter=n,this.annotations=r}toString(){return rd(this).pipe(Ue(()=>Re(RE(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:t=>ni(this.from)?String(this.from)+" & "+t:t})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:lt(this.annotations)}}};const ni=Wn("Refinement"),Xh={};let nr=class{from;to;transformation;annotations;_tag="Transformation";constructor(t,n,r,s={}){this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return Ue(ir(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:lt(this.annotations)}}};const NP=Wn("Transformation");class EE{decode;encode;_tag="FinalTransformation";constructor(t,n){this.decode=t,this.encode=n}}const LP=e=>t=>t._tag===e;class DP{_tag="ComposeTransformation"}const kE=new DP;let qP=class{from;to;decode;encode;constructor(t,n,r,s){this.from=t,this.to=n,this.decode=r,this.encode=s}};class Yl{propertySignatureTransformations;_tag="TypeLiteralTransformation";constructor(t){this.propertySignatureTransformations=t;const n={},r={};for(const s of t){const o=s.from;if(n[o])throw new Error(AS(o));n[o]=!0;const i=s.to;if(r[i])throw new Error(AS(i));r[i]=!0}}}const qS=LP("TypeLiteralTransformation"),_i=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={...e.annotations,...t},s=Eo(e);return _e(s)&&(r[Hl]=_i(s.value,t)),n.annotations.value=r,Object.create(Object.getPrototypeOf(e),n)},UP="[\\s\\S]*",jP="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",CE=(e,t)=>{switch(e._tag){case"Literal":return Kl(String(e.literal));case"StringKeyword":return UP;case"NumberKeyword":return jP;case"TemplateLiteral":return vE(e);case"Union":return e.types.map(n=>CE(n)).join("|")}},zP=(e,t,n,r)=>eu(e)?`(${t})`:t,vE=(e,t,n)=>{let r="";if(e.head!==""){const s=Kl(e.head);r+=s}for(const s of e.spans){const o=CE(s.type);if(r+=zP(s.type,o),s.literal!==""){const i=Kl(s.literal);r+=i}}return r},IE=e=>new RegExp(`^${vE(e)}$`),Hc=e=>{const t=Eo(e);if(_e(t))return Hc(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.slice();case"Suspend":return Hc(e.f());case"Refinement":return Hc(e.from)}return Jr(e).map(n=>Ps(e,n))},bl=e=>{const t=Eo(e);if(_e(t))return bl(t.value);switch(e._tag){case"TypeLiteral":return e.indexSignatures.slice();case"Suspend":return bl(e.f());case"Refinement":return bl(e.from)}return[]},TE=(e,t)=>{const n=L1(e.propertySignatures,r=>r.name===t);if(_e(n))return n.value;if(Jt(t)){let r;for(const s of e.indexSignatures){const o=no(s.parameter);switch(o._tag){case"TemplateLiteral":{if(IE(o).test(t))return new Ge(t,s.type,!1,!0);break}case"StringKeyword":r===void 0&&(r=new Ge(t,s.type,!1,!0))}}if(r)return r}else if(Nl(t))for(const r of e.indexSignatures){const s=no(r.parameter);if(Lm(s))return new Ge(t,r.type,!1,!0)}},Ps=(e,t)=>{const n=Eo(e);if(_e(n))return Ps(n.value,t);switch(e._tag){case"TypeLiteral":{const r=TE(e,t);if(r)return r;break}case"Union":return new Ge(t,Ut.make(e.types.map(r=>Ps(r,t).type)),!1,!0);case"Suspend":return Ps(e.f(),t);case"Refinement":return Ps(e.from,t)}throw new Error(nE(e))},Jr=e=>{const t=Eo(e);if(_e(t))return Jr(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.map(n=>n.name);case"Union":return e.types.slice(1).reduce((n,r)=>W1(n,Jr(r)),Jr(e.types[0]));case"Suspend":return Jr(e.f());case"Refinement":return Jr(e.from);case"Transformation":return Jr(e.to)}return[]},US=(e,t)=>{const n=[],r=[],s=o=>{switch(o._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new Za(o,t,!0));break;case"Literal":if(Jt(o.literal)||Fr(o.literal))n.push(new Ge(o.literal,t,!1,!0));else throw new Error(Q1(o.literal));break;case"Enums":{for(const[i,c]of o.enums)n.push(new Ge(c,t,!1,!0));break}case"UniqueSymbol":n.push(new Ge(o.symbol,t,!1,!0));break;case"Union":o.types.forEach(s);break;default:throw new Error(G1(o))}};return s(e),{propertySignatures:n,indexSignatures:r}},Yn=(e,t)=>{const n=Eo(e);if(_e(n))return Yn(n.value,t);switch(e._tag){case"TypeLiteral":{const r=[],s={};for(const o of e.propertySignatures)s[o.name]=null,t.includes(o.name)&&r.push(o);for(const o of t)if(!(o in s)){const i=TE(e,o);i&&r.push(i)}return new kn(r,[])}case"Union":return new kn(t.map(r=>Ps(e,r)),[]);case"Suspend":return Yn(e.f(),t);case"Refinement":return Yn(e.from,t);case"Transformation":switch(e.transformation._tag){case"ComposeTransformation":return new nr(Yn(e.from,t),Yn(e.to,t),kE);case"TypeLiteralTransformation":{const r=[],s=[];for(const o of t){const i=e.transformation.propertySignatureTransformations.find(c=>c.to===o);i?(r.push(i),s.push(i.from)):s.push(o)}return je(r)?new nr(Yn(e.from,s),Yn(e.to,t),new Yl(r)):Yn(e.from,s)}}}throw new Error(nE(e))},WP=(e,t)=>{let n=bl(e);return n.length>0?(n.some(r=>Gl(no(r.parameter)))&&(n=n.filter(r=>!OP(no(r.parameter)))),new kn([],n)):Yn(e,Jr(e).filter(r=>!t.includes(r)))},BP=e=>Ut.make([e,Vl]),Jo=e=>{switch(e._tag){case"TupleType":return e.isReadonly===!1?e:new ad(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{const t=jt(e.propertySignatures,r=>r.isReadonly===!1?r:new Ge(r.name,r.type,r.isOptional,!1,r.annotations)),n=jt(e.indexSignatures,r=>r.isReadonly===!1?r:new Za(r.parameter,r.type,!1));return t===e.propertySignatures&&n===e.indexSignatures?e:new kn(t,n,e.annotations)}case"Union":{const t=jt(e.types,Jo);return t===e.types?e:Ut.make(t,e.annotations)}case"Suspend":return new Si(()=>Jo(e.f()),e.annotations);case"Refinement":{const t=Jo(e.from);return t===e.from?e:new tu(t,e.filter,e.annotations)}case"Transformation":{const t=Jo(e.from),n=Jo(e.to);return t===e.from&&n===e.to?e:new nr(t,n,e.transformation,e.annotations)}}return e},OE=e=>t=>{let n;for(const r of e)Object.prototype.hasOwnProperty.call(t.annotations,r)&&(n===void 0&&(n={}),n[r]=t.annotations[r]);return n},KP=e=>t=>{const n={...t.annotations};for(const r of e)delete n[r];return n},HP=OE([oE,iE,cE,aE,uE,Nm]),Qe=e=>{switch(e._tag){case"Declaration":{const t=jt(e.typeParameters,Qe);return t===e.typeParameters?e:new od(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=jt(e.elements,s=>{const o=Qe(s.type);return o===s.type?s:new ko(o,s.isOptional)}),n=_E(e.rest),r=jt(n,Qe);return t===e.elements&&r===n?e:new ad(t,r.map(s=>new cd(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=jt(e.propertySignatures,r=>{const s=Qe(r.type);return s===r.type?r:new Ge(r.name,s,r.isOptional,r.isReadonly)}),n=jt(e.indexSignatures,r=>{const s=Qe(r.type);return s===r.type?r:new Za(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new kn(t,n,e.annotations)}case"Union":{const t=jt(e.types,Qe);return t===e.types?e:Ut.make(t,e.annotations)}case"Suspend":return new Si(()=>Qe(e.f()),e.annotations);case"Refinement":{const t=Qe(e.from);return t===e.from?e:new tu(t,e.filter,e.annotations)}case"Transformation":{const t=HP(e);return Qe(t!==void 0?_i(e.to,t):e.to)}}return e},zo=e=>Re(mP(e),{onNone:()=>{},onSome:t=>({[sd]:t})});function jt(e,t){let n=!1;const r=td(e.length);for(let s=0;s<e.length;s++){const o=e[s],i=t(o);i!==o&&(n=!0),r[s]=i}return n?r:e}const Gn=(e,t)=>{switch(e._tag){case"Declaration":{const n=jt(e.typeParameters,r=>Gn(r));return n===e.typeParameters?e:new od(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=jt(e.elements,o=>{const i=Gn(o.type);return i===o.type?o:new ko(i,o.isOptional)}),r=_E(e.rest),s=jt(r,o=>Gn(o));return n===e.elements&&s===r?e:new ad(n,s.map(o=>new cd(o)),e.isReadonly,zo(e))}case"TypeLiteral":{const n=jt(e.propertySignatures,s=>{const o=Gn(s.type);return o===s.type?s:new Ge(s.name,o,s.isOptional,s.isReadonly)}),r=jt(e.indexSignatures,s=>{const o=Gn(s.type);return o===s.type?s:new Za(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new kn(n,r,zo(e))}case"Union":{const n=jt(e.types,r=>Gn(r));return n===e.types?e:Ut.make(n,zo(e))}case"Suspend":return new Si(()=>Gn(e.f()),zo(e));case"Refinement":{const n=Gn(e.from),r=zo(e);return r?_i(n,r):n}case"Transformation":{const n=zo(e);return Gn(n?_i(e.from,n):e.from)}}return e},Ap=e=>Gn(e),lt=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},no=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return no(e.from)}},ys=e=>Ue(ir(e),()=>e._tag);function JP(e){return Re(oP(e),{onNone:()=>"",onSome:t=>t.map(n=>` & Brand<${En(n)}>`).join("")})}const RE=e=>gE(e).pipe(Zr(()=>yE(e)),Zr(()=>mE(e)),zs(t=>t+JP(e))),ir=e=>Zr(rd(e),()=>RE(e)),VP=(e,t,n)=>{switch(e._tag){case"UndefinedKeyword":return id;case"Union":{const r=[];let s=!1;for(const o of e.types){const i=t(o);i?(s=!0,EP(i)||r.push(i)):r.push(o)}if(s)return Ut.make(r);break}case"Suspend":return t(e.f());case"Transformation":return n(e)}},jS=Symbol.for("effect/Brand/Refined"),PE=()=>Object.assign(e=>e,{[jS]:jS,option:e=>F(e),either:e=>H(e),is:e=>!0}),FE=Symbol.for("effect/Context/Tag"),Xl=Symbol.for("effect/Context/Reference"),GP="effect/STM",QP=Symbol.for(GP),qm={...Qa,_op:"Tag",[QP]:eo,[FE]:{_Service:e=>e,_Identifier:e=>e},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[fe](){return this.toJSON()},of(e){return e},context(e){return AE(this,e)}},YP={...qm,[Xl]:Xl},XP=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(qm);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},ZP=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,qm),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},eF=()=>(e,t)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,YP),s.key=e,s.defaultValue=t.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},xE=Symbol.for("effect/Context"),tF={[xE]:{_Services:e=>e},[V](e){if(ME(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!W(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[G](){return $e(this,wm(this.unsafeMap.size))},pipe(){return N(this,arguments)},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(Ae)}},[fe](){return this.toJSON()}},ro=e=>{const t=Object.create(tF);return t.unsafeMap=e,t},nF=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},ME=e=>q(e,xE),rF=e=>q(e,FE),sF=e=>q(e,Xl),oF=ro(new Map),iF=()=>oF,AE=(e,t)=>ro(new Map([[e.key,t]])),cF=l(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),ro(r)}),Zh=te("effect/Context/defaultValueCache",()=>new Map),Um=e=>{if(Zh.has(e.key))return Zh.get(e.key);const t=e.defaultValue();return Zh.set(e.key,t),t},aF=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):Um(t),NE=l(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(Xl in t)return Um(t);throw nF(t)}return e.unsafeMap.get(t.key)}),uF=NE,lF=l(2,(e,t)=>e.unsafeMap.has(t.key)?zl(e.unsafeMap.get(t.key)):sF(t)?zl(Um(t)):vm),fF=l(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return ro(n)}),dF=(...e)=>t=>{const n=new Map(t.unsafeMap);for(const r of e)n.delete(r.key);return ro(n)},sn=XP,hF=ME,ud=rF,as=iF,nu=AE,Zn=cF,Xt=uF,ld=NE,Ur=lF,jr=fF,LE=dF,DE=ZP,Xi=eF,qE=Symbol.for("effect/Chunk");function pF(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const UE=[],gF=e=>Us((t,n)=>t.length===n.length&&fn(t).every((r,s)=>e(r,es(n,s)))),mF=gF(W),yF={[qE]:{_A:e=>e},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"Chunk",values:fn(this).map(Ae)}},[fe](){return this.toJSON()},[V](e){return fd(e)&&mF(this,e)},[G](){return $e(this,Va(fn(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return UE[Symbol.iterator]();default:return fn(this)[Symbol.iterator]()}},pipe(){return N(this,arguments)}},Ve=e=>{const t=Object.create(yF);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=xn,t.right=xn;break}case"ISingleton":{t.length=1,t.depth=0,t.left=xn,t.right=xn;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=xn,t.right=xn;break}}return t},fd=e=>q(e,qE),xn=Ve({_tag:"IEmpty"}),xe=()=>xn,ep=(...e)=>wF(e),ke=e=>Ve({_tag:"ISingleton",a:e}),so=e=>fd(e)?e:Ye(ge(e)),Np=(e,t,n)=>{switch(e.backing._tag){case"IArray":{pF(e.backing.array,0,t,n,e.length);break}case"IConcat":{Np(e.left,t,n),Np(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=es(e,r),r+=1,s+=1;break}}},bF=e=>{switch(e.backing._tag){case"IEmpty":return UE;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return Np(e,t,0),e.backing={_tag:"IArray",array:t},e.left=xn,e.right=xn,e.depth=0,t}}},fn=bF,SF=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return Ve({_tag:"IArray",array:RS(e.backing.array)});case"IConcat":return Ve({_tag:"IConcat",left:xr(e.backing.right),right:xr(e.backing.left)});case"ISlice":return Ye(RS(fn(e)))}},xr=SF,_F=l(2,(e,t)=>t<0||t>=e.length?P():F(es(e,t))),Ye=e=>e.length===0?xe():e.length===1?ke(e[0]):Ve({_tag:"IArray",array:e}),wF=e=>Ye(e),es=l(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?es(e.left,t):es(e.right,t-e.left.length);case"ISlice":return es(e.backing.chunk,t+e.backing.offset)}}),ia=l(2,(e,t)=>Me(e,ke(t))),Rt=l(2,(e,t)=>Me(ke(t),e)),wi=l(2,(e,t)=>{if(t<=0)return xn;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return Ve({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?Ve({_tag:"IConcat",left:e.left,right:wi(e.right,t-e.left.length)}):wi(e.left,t);default:return Ve({_tag:"ISlice",chunk:e,offset:0,length:t})}}),Er=l(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return xn;switch(e.backing._tag){case"ISlice":return Ve({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?Er(e.right,t-e.left.length):Ve({_tag:"IConcat",left:Er(e.left,t),right:e.right});default:return Ve({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),Me=l(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return Ve({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=Me(e.right,t);return Ve({_tag:"IConcat",left:e.left,right:r})}else{const r=Me(e.right.right,t);if(r.depth===e.depth-3){const s=Ve({_tag:"IConcat",left:e.right.left,right:r});return Ve({_tag:"IConcat",left:e.left,right:s})}else{const s=Ve({_tag:"IConcat",left:e.left,right:e.right.left});return Ve({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=Me(e,t.left);return Ve({_tag:"IConcat",left:r,right:t.right})}else{const r=Me(e,t.left.left);if(r.depth===t.depth-3){const s=Ve({_tag:"IConcat",left:r,right:t.left.right});return Ve({_tag:"IConcat",left:s,right:t.right})}else{const s=Ve({_tag:"IConcat",left:t.left.right,right:t.right});return Ve({_tag:"IConcat",left:r,right:s})}}}),jE=l(2,(e,t)=>Ye(V$(e,t))),dd=l(2,(e,t)=>Ye(G$(e,t))),hd=e=>e.length===0,Mr=e=>e.length>0,pd=_F(0),gd=e=>es(e,0),rr=gd,zE=l(2,(e,t)=>e.backing._tag==="ISingleton"?ke(t(e.backing.a,0)):Ye(f(fn(e),Ws((n,r)=>t(n,r))))),WE=l(2,(e,t)=>[wi(e,t),Er(e,t)]),$F=l(2,(e,t)=>{let n=0;for(const r of fn(e)){if(t(r))break;n++}return WE(e,n)}),kr=e=>Er(e,1),EF=l(2,(e,t)=>Er(e,e.length-t)),kF=Pm,Lp=Symbol.for("effect/Duration"),BE=BigInt(0),zS=BigInt(24),Qu=BigInt(60),Dp=BigInt(1e3),WS=BigInt(1e6),BS=BigInt(1e9),CF=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,pn=e=>{if(KE(e))return e;if(Fr(e))return ca(e);if(Vf(e))return tp(e);if(Array.isArray(e)&&e.length===2&&e.every(Fr))return e[0]===-1/0||e[1]===-1/0||Number.isNaN(e[0])||Number.isNaN(e[1])?HE:e[0]===1/0||e[1]===1/0?OF:tp(BigInt(Math.round(e[0]*1e9))+BigInt(Math.round(e[1])));if(Jt(e)){const t=CF.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return tp(BigInt(r));case"micro":case"micros":return RF(BigInt(r));case"milli":case"millis":return ca(o);case"second":case"seconds":return jm(o);case"minute":case"minutes":return JE(o);case"hour":case"hours":return PF(o);case"day":case"days":return FF(o);case"week":case"weeks":return xF(o)}}}throw new Error("Invalid DurationInput")},KS={_tag:"Millis",millis:0},vF={_tag:"Infinity"},IF={[Lp]:Lp,[G](){return $e(this,C$(this.value))},[V](e){return KE(e)&&jF(this,e)},toString(){return`Duration(${GE(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:AF(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},nn=e=>{const t=Object.create(IF);return Fr(e)?isNaN(e)||e<=0?t.value=KS:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=vF:e<=BE?t.value=KS:t.value={_tag:"Nanos",nanos:e},t},KE=e=>q(e,Lp),TF=e=>{switch(e.value._tag){case"Millis":return e.value.millis===0;case"Nanos":return e.value.nanos===BE;case"Infinity":return!1}},HE=nn(0),OF=nn(1/0),tp=e=>nn(e),RF=e=>nn(e*Dp),ca=e=>nn(e),jm=e=>nn(e*1e3),JE=e=>nn(e*6e4),PF=e=>nn(e*36e5),FF=e=>nn(e*864e5),xF=e=>nn(e*6048e5),$i=e=>VE(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),MF=e=>{const t=pn(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},AF=e=>{const t=pn(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/BS),Number(t.value.nanos%BS)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},VE=l(2,(e,t)=>{const n=pn(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),md=l(3,(e,t,n)=>{const r=pn(e),s=pn(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis($i(r),$i(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),i=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,i)}return n.onMillis(r.value.millis,s.value.millis)}),NF=(e,t)=>md(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),LF=l(2,(e,t)=>VE(e,{onMillis:n=>nn(n*t),onNanos:n=>nn(n*BigInt(t))})),DF=l(2,(e,t)=>md(e,t,{onMillis:(n,r)=>nn(n+r),onNanos:(n,r)=>nn(n+r)})),qF=l(2,(e,t)=>md(e,t,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),UF=l(2,(e,t)=>md(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),jF=l(2,(e,t)=>NF(pn(e),pn(t))),zF=e=>{const t=pn(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=MF(t),r=n/WS,s=r/Dp,o=s/Qu,i=o/Qu,c=i/zS;return{days:Number(c),hours:Number(i%zS),minutes:Number(o%Qu),seconds:Number(s%Qu),millis:Number(r%Dp),nanos:Number(n%WS)}},GE=e=>{const t=pn(e);if(t.value._tag==="Infinity")return"Infinity";if(TF(t))return"0";const n=zF(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},oo=5,zm=Math.pow(2,oo),WF=zm-1,BF=zm/2,KF=zm/4;function HF(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Ei(e,t){return t>>>e&WF}function Qo(e){return 1<<e}function QE(e,t){return HF(e&t-1)}const JF=(e,t)=>({value:e,previous:t});function ri(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let i=0;i<o;++i)s[i]=r[i]}return s[t]=n,s}function YE(e,t,n){const r=n.length-1;let s=0,o=0,i=n;if(e)s=o=t;else for(i=new Array(r);s<t;)i[o++]=n[s++];for(++s;s<=r;)i[o++]=n[s++];return e&&(i.length=r),i}function VF(e,t,n,r){const s=r.length;if(e){let a=s;for(;a>=t;)r[a--]=r[a];return r[t]=n,r}let o=0,i=0;const c=new Array(s+1);for(;o<t;)c[i++]=r[o++];for(c[t]=n;o<s;)c[++i]=r[o++];return c}class us{_tag="EmptyNode";modify(t,n,r,s,o,i){const c=r(P());return qe(c)?new us:(++i.value,new Bs(t,s,o,c))}}function Mn(e){return Sm(e,"EmptyNode")}function GF(e){return Mn(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function yd(e,t){return Mn(e)?!1:t===e.edit}class Bs{edit;hash;key;value;_tag="LeafNode";constructor(t,n,r,s){this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,i){if(W(o,this.key)){const a=r(this.value);return a===this.value?this:qe(a)?(--i.value,new us):yd(this,t)?(this.value=a,this):new Bs(t,s,o,a)}const c=r(P());return qe(c)?this:(++i.value,XE(t,n,this.hash,this,s,new Bs(t,s,o,c)))}}class Wm{edit;hash;children;_tag="CollisionNode";constructor(t,n,r){this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,i){if(s===this.hash){const a=yd(this,t),u=this.updateCollisionList(a,t,this.hash,this.children,r,o,i);return u===this.children?this:u.length>1?new Wm(t,this.hash,u):u[0]}const c=r(P());return qe(c)?this:(++i.value,XE(t,n,this.hash,this,s,new Bs(t,s,o,c)))}updateCollisionList(t,n,r,s,o,i,c){const a=s.length;for(let d=0;d<a;++d){const h=s[d];if("key"in h&&W(i,h.key)){const p=h.value,g=o(p);return g===p?s:qe(g)?(--c.value,YE(t,d,s)):ri(t,d,new Bs(n,r,i,g),s)}}const u=o(P());return qe(u)?s:(++c.value,ri(t,a,new Bs(n,r,i,u),s))}}class ki{edit;mask;children;_tag="IndexedNode";constructor(t,n,r){this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,i){const c=this.mask,a=this.children,u=Ei(n,s),d=Qo(u),h=QE(c,d),p=c&d,g=yd(this,t);if(!p){const b=new us().modify(t,n+oo,r,s,o,i);return b?a.length>=BF?YF(t,u,b,c,a):new ki(t,c|d,VF(g,h,b,a)):this}const y=a[h],E=y.modify(t,n+oo,r,s,o,i);if(y===E)return this;let S=c,_;if(Mn(E)){if(S&=~d,!S)return new us;if(a.length<=2&&GF(a[h^1]))return a[h^1];_=YE(g,h,a)}else _=ri(g,h,E,a);return g?(this.mask=S,this.children=_,this):new ki(t,S,_)}}class Bm{edit;size;children;_tag="ArrayNode";constructor(t,n,r){this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,i){let c=this.size;const a=this.children,u=Ei(n,s),d=a[u],h=(d||new us).modify(t,n+oo,r,s,o,i);if(d===h)return this;const p=yd(this,t);let g;if(Mn(d)&&!Mn(h))++c,g=ri(p,u,h,a);else if(!Mn(d)&&Mn(h)){if(--c,c<=KF)return QF(t,c,u,a);g=ri(p,u,new us,a)}else g=ri(p,u,h,a);return p?(this.size=c,this.children=g,this):new Bm(t,c,g)}}function QF(e,t,n,r){const s=new Array(t-1);let o=0,i=0;for(let c=0,a=r.length;c<a;++c)if(c!==n){const u=r[c];u&&!Mn(u)&&(s[o++]=u,i|=1<<c)}return new ki(e,i,s)}function YF(e,t,n,r,s){const o=[];let i=r,c=0;for(let a=0;i;++a)i&1&&(o[a]=s[c++]),i>>>=1;return o[t]=n,new Bm(e,c+1,o)}function XF(e,t,n,r,s,o){if(n===s)return new Wm(e,n,[o,r]);const i=Ei(t,n),c=Ei(t,s);if(i===c)return a=>new ki(e,Qo(i)|Qo(c),[a]);{const a=i<c?[r,o]:[o,r];return new ki(e,Qo(i)|Qo(c),a)}}function XE(e,t,n,r,s,o){let i,c=t;for(;;){const a=XF(e,c,n,r,s,o);if(typeof a=="function")i=JF(a,i),c=c+oo;else{let u=a;for(;i!=null;)u=i.value(u),i=i.previous;return u}}}const ZE="effect/HashMap",qp=Symbol.for(ZE),ZF={[qp]:qp,[Symbol.iterator](){return new bd(this,(e,t)=>[e,t])},[G](){let e=M(ZE);for(const t of this)e^=f(M(t[0]),K(M(t[1])));return $e(this,e)},[V](e){if(nx(e)){if(e._size!==this._size)return!1;for(const t of this){const n=f(e,Hm(t[0],M(t[0])));if(qe(n))return!1;if(!W(t[1],n.value))return!1}return!0}return!1},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(Ae)}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},Km=(e,t,n,r)=>{const s=Object.create(ZF);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class bd{map;f;v;constructor(t,n){this.map=t,this.f=n,this.v=ek(this.map._root,this.f,void 0)}next(){if(qe(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=Zl(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new bd(this.map,this.f)}}const Zl=e=>e?tk(e[0],e[1],e[2],e[3],e[4]):P(),ek=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return _e(e.value)?F({value:t(e.key,e.value.value),cont:n}):Zl(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return tk(r.length,r,0,t,n)}default:return Zl(n)}},tk=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!Mn(o))return ek(o,r,[e,t,n,r,s])}return Zl(s)},ex=Km(!1,0,new us,0),Sd=()=>ex,tx=e=>{const t=rk(Sd());for(const n of e)aa(t,n[0],n[1]);return cx(t)},nx=e=>q(e,qp),rx=e=>e&&Mn(e._root),sx=l(2,(e,t)=>Hm(e,t,M(t))),Hm=l(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return W(t,r.key)?r.value:P();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let i=0,c=o.length;i<c;++i){const a=o[i];if("key"in a&&W(t,a.key))return a.value}}return P()}case"IndexedNode":{const o=Ei(s,n),i=Qo(o);if(r.mask&i){r=r.children[QE(r.mask,i)],s+=oo;break}return P()}case"ArrayNode":{if(r=r.children[Ei(s,n)],r){s+=oo;break}return P()}default:return P()}}),ox=l(2,(e,t)=>_e(Hm(e,t,M(t)))),aa=l(3,(e,t,n)=>Jm(e,t,()=>F(n))),ix=l(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:Km(e._editable,e._edit,t,n)),nk=e=>new bd(e,t=>t),ef=e=>e._size,rk=e=>Km(!0,e._edit+1,e._root,e._size),cx=e=>(e._editable=!1,e),Jm=l(3,(e,t,n)=>ax(e,t,M(t),n)),ax=l(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return f(e,ix(o,s.value))}),HS=l(2,(e,t)=>Jm(e,t,P)),ux=l(2,(e,t)=>_d(e,Sd(),(n,r,s)=>aa(n,s,t(r,s)))),sk=l(2,(e,t)=>_d(e,void 0,(n,r,s)=>t(r,s))),_d=l(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return _e(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let i=0,c=o.length;i<c;){const a=o[i++];a&&!Mn(a)&&(a._tag==="LeafNode"?_e(a.value)&&(t=n(t,a.value.value,a.key)):s.push(a.children))}return t}),ok="effect/HashSet",Up=Symbol.for(ok),lx={[Up]:Up,[Symbol.iterator](){return nk(this._keyMap)},[G](){return $e(this,K(M(this._keyMap))(M(ok)))},[V](e){return fx(e)?ef(this._keyMap)===ef(e._keyMap)&&W(this._keyMap,e._keyMap):!1},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(Ae)}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},wd=e=>{const t=Object.create(lx);return t._keyMap=e,t},fx=e=>q(e,Up),dx=wd(Sd()),$d=()=>dx,hx=e=>{const t=Vm($d());for(const n of e)ua(t,n);return Gm(t)},px=(...e)=>{const t=Vm($d());for(const n of e)ua(t,n);return Gm(t)},gx=l(2,(e,t)=>ox(e._keyMap,t)),mx=e=>ef(e._keyMap),Vm=e=>wd(rk(e._keyMap)),Gm=e=>(e._keyMap._editable=!1,e),ik=l(2,(e,t)=>{const n=Vm(e);return t(n),Gm(n)}),ua=l(2,(e,t)=>e._keyMap._editable?(aa(t,!0)(e._keyMap),e):wd(aa(t,!0)(e._keyMap))),ck=l(2,(e,t)=>e._keyMap._editable?(HS(t)(e._keyMap),e):wd(HS(t)(e._keyMap))),yx=l(2,(e,t)=>ik(e,n=>{for(const r of t)ck(n,r)})),bx=l(2,(e,t)=>ik($d(),n=>{Sx(e,r=>ua(n,r));for(const r of t)ua(n,r)})),Sx=l(2,(e,t)=>sk(e._keyMap,(n,r)=>t(r))),_x=l(3,(e,t,n)=>_d(e._keyMap,t,(r,s,o)=>n(r,o))),io=$d,wx=hx,Ed=px,Qm=gx,Ym=mx,si=ua,Xm=ck,JS=yx,la=bx,fa=_x,VS=Symbol.for("effect/MutableRef"),$x={[VS]:VS,toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableRef",current:Ae(this.current)}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},Co=e=>{const t=Object.create($x);return t.current=e,t},Ex=l(3,(e,t,n)=>W(t,e.current)?(e.current=n,!0):!1),le=e=>e.current,vo=l(2,(e,t)=>(e.current=t,e)),kd="effect/FiberId",co=Symbol.for(kd),Ci="None",jp="Runtime",zp="Composite",kx=ot(`${kd}-${Ci}`);let Cx=class{[co]=co;_tag=Ci;id=-1;startTimeMillis=-1;[G](){return kx}[V](t){return ey(t)&&t._tag===Ci}toString(){return Oe(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[fe](){return this.toJSON()}};class Zm{id;startTimeMillis;[co]=co;_tag=jp;constructor(t,n){this.id=t,this.startTimeMillis=n}[G](){return $e(this,ot(`${kd}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[V](t){return ey(t)&&t._tag===jp&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return Oe(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[fe](){return this.toJSON()}}let ak=class{left;right;[co]=co;_tag=zp;constructor(t,n){this.left=t,this.right=n}_hash;[G](){return f(ot(`${kd}-${this._tag}`),K(M(this.left)),K(M(this.right)),$e(this))}[V](t){return ey(t)&&t._tag===zp&&W(this.left,t.left)&&W(this.right,t.right)}toString(){return Oe(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:Ae(this.left),right:Ae(this.right)}}[fe](){return this.toJSON()}};const uk=new Cx,vx=(e,t)=>new Zm(e,t),Ix=(e,t)=>new ak(e,t),ey=e=>q(e,co),lk=l(2,(e,t)=>e._tag===Ci?t:t._tag===Ci?e:new ak(e,t)),Tx=e=>f(e,fa(uk,(t,n)=>lk(n)(t))),tf=e=>{switch(e._tag){case Ci:return io();case jp:return Ed(e.id);case zp:return f(tf(e.left),la(tf(e.right)))}},GS=te(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Co(0)),Ox=(e,t)=>new Zm(e,t),Cd=e=>Array.from(tf(e)).map(n=>`#${n}`).join(","),Rx=()=>{const e=le(GS);return f(GS,vo(e+1)),new Zm(e,Date.now())},Cn=uk,Px=vx,Fx=Ix,Ks=lk,xx=Tx,ty=tf,fk=Ox,Mx=Cd,dk=Rx,vd=Sd,Ax=tx,Nx=rx,hk=sx,nf=aa,pk=nk,gk=ef,Lx=Jm,Dx=ux,qx=sk,mk=_d,da=Symbol.for("effect/List"),Wp=e=>ge(e),Ux=e=>dR(nd(e),Wp),jx=Ux(W),zx={[da]:da,_tag:"Cons",toString(){return Oe(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Wp(this).map(Ae)}},[fe](){return this.toJSON()},[V](e){return bk(e)&&this._tag===e._tag&&jx(this,e)},[G](){return $e(this,Va(Wp(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return N(this,arguments)}},rf=(e,t)=>{const n=Object.create(zx);return n.head=e,n.tail=t,n},Wx=ot("Nil"),Bx={[da]:da,_tag:"Nil",toString(){return Oe(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[fe](){return this.toJSON()},[G](){return Wx},[V](e){return bk(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return N(this,arguments)}},yk=Object.create(Bx),bk=e=>q(e,da),Ir=e=>e._tag==="Nil",ny=e=>e._tag==="Cons",Kx=()=>yk,ao=(e,t)=>rf(e,t),vi=Kx,ry=e=>rf(e,yk),Hx=l(2,(e,t)=>Vx(t,e)),Jx=l(2,(e,t)=>ao(t,e)),Vx=l(2,(e,t)=>{if(Ir(e))return t;if(Ir(t))return e;{const n=rf(t.head,e);let r=n,s=t.tail;for(;!Ir(s);){const o=rf(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),Gx=l(3,(e,t,n)=>{let r=t,s=e;for(;!Ir(s);)r=n(r,s.head),s=s.tail;return r}),Qx=e=>{let t=vi(),n=e;for(;!Ir(n);)t=Jx(t,n.head),n=n.tail;return t},Id=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=km,e}(),Yx=Symbol.for("effect/DifferContextPatch");function QS(e){return e}const ru={...Id.prototype,[Yx]:{_Value:QS,_Patch:QS}},Xx=Object.assign(Object.create(ru),{_tag:"Empty"}),Zx=Object.create(Xx),Sk=()=>Zx,eM=Object.assign(Object.create(ru),{_tag:"AndThen"}),tM=(e,t)=>{const n=Object.create(eM);return n.first=e,n.second=t,n},nM=Object.assign(Object.create(ru),{_tag:"AddService"}),rM=(e,t)=>{const n=Object.create(nM);return n.key=e,n.service=t,n},sM=Object.assign(Object.create(ru),{_tag:"RemoveService"}),oM=e=>{const t=Object.create(sM);return t.key=e,t},iM=Object.assign(Object.create(ru),{_tag:"UpdateService"}),cM=(e,t)=>{const n=Object.create(iM);return n.key=e,n.update=t,n},aM=(e,t)=>{const n=new Map(e.unsafeMap);let r=Sk();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const i=n.get(s);n.delete(s),W(i,o)||(r=Sl(cM(s,()=>o))(r))}else n.delete(s),r=Sl(rM(s,o))(r);for(const[s]of n.entries())r=Sl(oM(s))(r);return r},Sl=l(2,(e,t)=>tM(e,t)),uM=l(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=ke(e);const s=new Map(t.unsafeMap);for(;Mr(r);){const i=rr(r),c=kr(r);switch(i._tag){case"Empty":{r=c;break}case"AddService":{s.set(i.key,i.service),r=c;break}case"AndThen":{r=Rt(Rt(c,i.second),i.first);break}case"RemoveService":{s.delete(i.key),r=c;break}case"UpdateService":{s.set(i.key,i.update(s.get(i.key))),n=!0,r=c;break}}}if(!n)return ro(s);const o=new Map;for(const[i]of t.unsafeMap)s.has(i)&&(o.set(i,s.get(i)),s.delete(i));for(const[i,c]of s)o.set(i,c);return ro(o)}),lM=Symbol.for("effect/DifferHashSetPatch");function np(e){return e}const Td={...Id.prototype,[lM]:{_Value:np,_Key:np,_Patch:np}},fM=Object.assign(Object.create(Td),{_tag:"Empty"}),dM=Object.create(fM),_k=()=>dM,hM=Object.assign(Object.create(Td),{_tag:"AndThen"}),pM=(e,t)=>{const n=Object.create(hM);return n.first=e,n.second=t,n},gM=Object.assign(Object.create(Td),{_tag:"Add"}),mM=e=>{const t=Object.create(gM);return t.value=e,t},yM=Object.assign(Object.create(Td),{_tag:"Remove"}),bM=e=>{const t=Object.create(yM);return t.value=e,t},SM=(e,t)=>{const[n,r]=fa([e,_k()],([s,o],i)=>Qm(i)(s)?[Xm(i)(s),o]:[s,Bp(mM(i))(o)])(t);return fa(r,(s,o)=>Bp(bM(o))(s))(n)},Bp=l(2,(e,t)=>pM(e,t)),_M=l(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=ke(e);for(;Mr(r);){const s=rr(r),o=kr(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=Rt(s.first)(Rt(s.second)(o));break}case"Add":{n=si(s.value)(n),r=o;break}case"Remove":n=Xm(s.value)(n),r=o}}return n}),wM=Symbol.for("effect/DifferReadonlyArrayPatch");function YS(e){return e}const su={...Id.prototype,[wM]:{_Value:YS,_Patch:YS}},$M=Object.assign(Object.create(su),{_tag:"Empty"}),EM=Object.create($M),wk=()=>EM,kM=Object.assign(Object.create(su),{_tag:"AndThen"}),CM=(e,t)=>{const n=Object.create(kM);return n.first=e,n.second=t,n},vM=Object.assign(Object.create(su),{_tag:"Append"}),IM=e=>{const t=Object.create(vM);return t.values=e,t},TM=Object.assign(Object.create(su),{_tag:"Slice"}),OM=(e,t)=>{const n=Object.create(TM);return n.from=e,n.until=t,n},RM=Object.assign(Object.create(su),{_tag:"Update"}),PM=(e,t)=>{const n=Object.create(RM);return n.index=e,n.patch=t,n},FM=e=>{let t=0,n=wk();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);W(o,e.differ.empty)||(n=_l(n,PM(t,o))),t=t+1}return t<e.oldValue.length&&(n=_l(n,OM(0,t))),t<e.newValue.length&&(n=_l(n,IM(N1(t)(e.newValue)))),n},_l=l(2,(e,t)=>CM(e,t)),xM=l(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=Pn(e);for(;ml(s);){const o=Bt(s),i=to(s);switch(o._tag){case"Empty":{s=i;break}case"AndThen":{i.unshift(o.first,o.second),s=i;break}case"Append":{for(const c of o.values)r.push(c);s=i;break}case"Slice":{r=r.slice(o.from,o.until),s=i;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=i;break}}}return r}),MM=Symbol.for("effect/Differ"),AM={[MM]:{_P:j,_V:j},pipe(){return N(this,arguments)}},Zi=e=>{const t=Object.create(AM);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},NM=()=>Zi({empty:Sk(),combine:(e,t)=>Sl(t)(e),diff:(e,t)=>aM(e,t),patch:(e,t)=>uM(t)(e)}),LM=()=>Zi({empty:_k(),combine:(e,t)=>Bp(t)(e),diff:(e,t)=>SM(e,t),patch:(e,t)=>_M(t)(e)}),DM=e=>Zi({empty:wk(),combine:(t,n)=>_l(t,n),diff:(t,n)=>FM({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>xM(t,n,e)}),$k=()=>qM((e,t)=>t),qM=e=>Zi({empty:j,combine:(t,n)=>t===j?n:n===j?t:r=>n(t(r)),diff:(t,n)=>W(t,n)?j:Hf(n),patch:(t,n)=>e(n,t(n))}),ha=255,Ek=8,Kp=e=>e&ha,Hp=e=>e>>Ek&ha,ou=(e,t)=>(e&ha)+((t&e&ha)<<Ek),UM=ou(0,0),jM=e=>ou(e,e),zM=e=>ou(e,0),WM=l(2,(e,t)=>ou(Kp(e)&~t,Hp(e))),BM=l(2,(e,t)=>e|t),KM=e=>~e>>>0&ha,HM=0,ec=1,JM=2,kk=4,Jp=16,Ck=32,VM=e=>Od(e,Ck),GM=l(2,(e,t)=>e|t),Vr=e=>vk(e)&&!YM(e),vk=e=>Od(e,ec),Od=l(2,(e,t)=>(e&t)!==0),Ik=(...e)=>e.reduce((t,n)=>t|n,0),QM=Ik(HM),XS=e=>Od(e,kk),YM=e=>Od(e,Jp),ts=l(2,(e,t)=>ou(e^t,t)),oi=l(2,(e,t)=>e&(KM(Kp(t))|Hp(t))|Kp(t)&Hp(t)),ZS=Zi({empty:UM,diff:(e,t)=>ts(e,t),combine:(e,t)=>BM(t)(e),patch:(e,t)=>oi(t,e)}),XM=jM,Tk=zM,e_=WM,Ok=(e,t)=>({_tag:"Par",left:e,right:t}),Yu=(e,t)=>({_tag:"Seq",left:e,right:t}),ZM=e=>{let t=ry(e),n=vi();for(;;){const[r,s]=Gx(t,[Rk(),vi()],([o,i],c)=>{const[a,u]=eA(c);return[oA(o,a),Hx(i,u)]});if(n=tA(n,r),Ir(s))return Qx(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},eA=e=>{let t=e,n=Rk(),r=vi(),s=vi();for(;;)switch(t._tag){case"Empty":{if(Ir(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=ao(t.right,r),t=t.left;break}case"Seq":{const o=t.left,i=t.right;switch(o._tag){case"Empty":{t=i;break}case"Par":{const c=o.left,a=o.right;t=Ok(Yu(c,i),Yu(a,i));break}case"Seq":{const c=o.left,a=o.right;t=Yu(c,Yu(a,i));break}case"Single":{t=o,s=ao(i,s);break}}break}case"Single":{if(n=sA(n,t),Ir(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},tA=(e,t)=>{if(Ir(e))return ry(rp(t));if(iA(t))return e;const n=dA(e.head),r=cA(t);return n.length===1&&r.length===1&&W(n[0],r[0])?ao(fA(e.head,rp(t)),e.tail):ao(rp(t),e)},nA=Symbol.for("effect/RequestBlock/RequestBlockParallel"),rA={_R:e=>e};class sy{map;[nA]=rA;constructor(t){this.map=t}}const Rk=()=>new sy(vd()),sA=(e,t)=>new sy(Lx(e.map,t.dataSource,n=>i1(zs(n,ia(t.blockedRequest)),()=>ke(t.blockedRequest)))),oA=(e,t)=>new sy(mk(e.map,t.map,(n,r,s)=>nf(n,s,Re(hk(n,s),{onNone:()=>r,onSome:o=>Me(r,o)})))),iA=e=>Nx(e.map),cA=e=>Array.from(pk(e.map)),rp=e=>lA(Dx(e.map,t=>ke(t))),aA=Symbol.for("effect/RequestBlock/RequestBlockSequential"),uA={_R:e=>e};class Pk{map;[aA]=uA;constructor(t){this.map=t}}const lA=e=>new Pk(e),fA=(e,t)=>new Pk(mk(t.map,e.map,(n,r,s)=>nf(n,s,Re(hk(n,s),{onNone:()=>xe(),onSome:o=>Me(o,r)})))),dA=e=>Array.from(pk(e.map)),hA=e=>Array.from(e.map),tc="Die",uo="Empty",Io="Fail",nc="Interrupt",Ii="Parallel",Ti="Sequential",Fk="effect/Cause",xk=Symbol.for(Fk),pA={_E:e=>e},rc={[xk]:pA,[G](){return f(M(Fk),K(M(EA(this))),$e(this))},[V](e){return oy(e)&&$A(this,e)},pipe(){return N(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:Ae(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:Ae(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:Ae(this.left),right:Ae(this.right)}}},toString(){return bs(this)},[fe](){return this.toJSON()}},Ar=(()=>{const e=Object.create(rc);return e._tag=uo,e})(),lo=e=>{const t=Object.create(rc);return t._tag=Io,t.error=e,t},Kt=e=>{const t=Object.create(rc);return t._tag=tc,t.defect=e,t},wn=e=>{const t=Object.create(rc);return t._tag=nc,t.fiberId=e,t},Nr=(e,t)=>{const n=Object.create(rc);return n._tag=Ii,n.left=e,n.right=t,n},ut=(e,t)=>{const n=Object.create(rc);return n._tag=Ti,n.left=e,n.right=t,n},oy=e=>q(e,xk),gA=e=>e._tag===uo,mA=e=>e._tag===Io,iy=e=>e._tag===tc,cy=e=>e._tag===uo?!0:Oi(e,!0,(t,n)=>{switch(n._tag){case uo:return F(t);case tc:case Io:case nc:return F(!1);default:return P()}}),ay=e=>_e(SA(e)),Rd=e=>xd(void 0,CA)(e),yA=e=>xr(Oi(e,xe(),(t,n)=>n._tag===Io?F(f(t,Rt(n.error))):P())),Mk=e=>xr(Oi(e,xe(),(t,n)=>n._tag===tc?F(f(t,Rt(n.defect))):P())),uy=e=>Oi(e,io(),(t,n)=>n._tag===nc?F(f(t,si(n.fiberId))):P()),Ak=e=>Pd(e,t=>t._tag===Io?F(t.error):P()),ly=e=>{const t=Ak(e);switch(t._tag){case"None":return H(e);case"Some":return z(t.value)}},bA=e=>Fd(e,{onEmpty:F(Ar),onFail:zs(lo),onDie:t=>F(Kt(t)),onInterrupt:t=>F(wn(t)),onSequential:OS(ut),onParallel:OS(Nr)}),SA=e=>Pd(e,t=>t._tag===nc?F(t.fiberId):P()),t_=e=>Fd(e,{onEmpty:Ar,onFail:()=>Ar,onDie:Kt,onInterrupt:wn,onSequential:ut,onParallel:Nr}),_A=e=>Fd(e,{onEmpty:Ar,onFail:Kt,onDie:Kt,onInterrupt:wn,onSequential:ut,onParallel:Nr}),Nk=l(2,(e,t)=>wA(e,n=>lo(t(n)))),wA=l(2,(e,t)=>Fd(e,{onEmpty:Ar,onFail:n=>t(n),onDie:n=>Kt(n),onInterrupt:n=>wn(n),onSequential:(n,r)=>ut(n,r),onParallel:(n,r)=>Nr(n,r)})),$A=(e,t)=>{let n=ke(e),r=ke(t);for(;Mr(n)&&Mr(r);){const[s,o]=f(rr(n),Oi([io(),xe()],([a,u],d)=>{const[h,p]=Vp(d);return F([f(a,la(h)),f(u,Me(p))])})),[i,c]=f(rr(r),Oi([io(),xe()],([a,u],d)=>{const[h,p]=Vp(d);return F([f(a,la(h)),f(u,Me(p))])}));if(!W(s,i))return!1;n=o,r=c}return!0},EA=e=>kA(ke(e),xe()),kA=(e,t)=>{for(;;){const[n,r]=f(e,Pm([io(),xe()],([o,i],c)=>{const[a,u]=Vp(c);return[f(o,la(a)),f(i,Me(u))]})),s=Ym(n)>0?f(t,Rt(n)):t;if(hd(r))return xr(s);e=r,t=s}throw new Error(Qf("Cause.flattenCauseLoop"))},Pd=l(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case Ti:case Ii:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return P()}),Vp=e=>{let t=e;const n=[];let r=io(),s=xe();for(;t!==void 0;)switch(t._tag){case uo:{if(n.length===0)return[r,s];t=n.pop();break}case Io:{if(r=si(r,ep(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case tc:{if(r=si(r,ep(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case nc:{if(r=si(r,ep(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case Ti:{switch(t.left._tag){case uo:{t=t.right;break}case Ti:{t=ut(t.left.left,ut(t.left.right,t.right));break}case Ii:{t=Nr(ut(t.left.left,t.right),ut(t.left.right,t.right));break}default:{s=Rt(s,t.right),t=t.left;break}}break}case Ii:{n.push(t.right),t=t.left;break}}throw new Error(Qf("Cause.evaluateCauseLoop"))},CA={emptyCase:vS,failCase:An,dieCase:An,interruptCase:vS,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},n_="SequentialCase",r_="ParallelCase",Fd=l(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:i})=>xd(e,void 0,{emptyCase:()=>n,failCase:(c,a)=>r(a),dieCase:(c,a)=>t(a),interruptCase:(c,a)=>s(a),sequentialCase:(c,a,u)=>i(a,u),parallelCase:(c,a,u)=>o(a,u)})),Oi=l(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const i=n(r,s);switch(r=_e(i)?i.value:r,s._tag){case Ti:{o.push(s.right),s=s.left;break}case Ii:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),xd=l(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const i=r.pop();switch(i._tag){case uo:{s.push(H(n.emptyCase(t)));break}case Io:{s.push(H(n.failCase(t,i.error)));break}case tc:{s.push(H(n.dieCase(t,i.defect)));break}case nc:{s.push(H(n.interruptCase(t,i.fiberId)));break}case Ti:{r.push(i.right),r.push(i.left),s.push(z({_tag:n_}));break}case Ii:{r.push(i.right),r.push(i.left),s.push(z({_tag:r_}));break}}}const o=[];for(;s.length>0;){const i=s.pop();switch(i._tag){case"Left":{switch(i.left._tag){case n_:{const c=o.pop(),a=o.pop(),u=n.sequentialCase(t,c,a);o.push(u);break}case r_:{const c=o.pop(),a=o.pop(),u=n.parallelCase(t,c,a);o.push(u);break}}break}case"Right":{o.push(i.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),bs=(e,t)=>Rd(e)?"All fibers interrupted without errors.":qk(e).map(function(n){return t?.renderErrorCause!==!0||n.cause===void 0?n.stack:`${n.stack} {
${Lk(n.cause,"  ")}
}`}).join(`
`),Lk=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${Lk(e.cause,`${t}  `)}
${t}}`),r};class sf extends globalThis.Error{span=void 0;constructor(t){const n=typeof t=="object"&&t!==null,r=Error.stackTraceLimit;Error.stackTraceLimit=1,super(Dk(t),n&&"cause"in t&&typeof t.cause<"u"?{cause:new sf(t.cause)}:void 0),this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=r,this.name=t instanceof Error?t.name:"Error",n&&(Ri in t&&(this.span=t[Ri]),Object.keys(t).forEach(s=>{s in this||(this[s]=t[s])})),this.stack=IA(`${this.name}: ${this.message}`,t instanceof Error&&t.stack?t.stack:"",this.span)}}const Dk=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(q(e,"toString")&&Ja(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return v$(e)},vA=/\((.*)\)/g,of=te("effect/Tracer/spanToTrace",()=>new WeakMap),IA=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length;o++){if(s[o].includes(" at new BaseEffectError")||s[o].includes(" at new YieldableError")){o++;continue}if(s[o].includes("Generator.next")||s[o].includes("effect_internal_function"))break;r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,i=0;for(;o&&o._tag==="Span"&&i<10;){const c=of.get(o);if(typeof c=="function"){const a=c();if(typeof a=="string"){const u=a.matchAll(vA);let d=!1;for(const[,h]of u)d=!0,r.push(`    at ${o.name} (${h})`);d||r.push(`    at ${o.name} (${a.replace(/^at /,"")})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=Fn(o.parent),i++}}return r.join(`
`)},Ri=Symbol.for("effect/SpanAnnotation"),qk=e=>xd(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new sf(n)],failCase:(t,n)=>[new sf(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),iu="Pending",Md="Done",TA="effect/Deferred",Uk=Symbol.for(TA),OA={_E:e=>e,_A:e=>e},RA=e=>({_tag:iu,joiners:e}),jk=e=>({_tag:Md,effect:e});class sc{self;called=!1;constructor(t){this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new sc(this.self)}}const zk=(e,t)=>{const n=new ft("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},PA=e=>{const t=new ft("RunBlocked");return t.effect_instruction_i0=e,t},fo=Symbol.for("effect/Effect");class FA{patch;op;_op=Em;constructor(t,n){this.patch=t,this.op=n}}class ft{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[fo]=eo;constructor(t){this._op=t}[V](t){return this===t}[G](){return $e(this,Yf(this))}pipe(){return N(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:Ae(this.effect_instruction_i0),effect_instruction_i1:Ae(this.effect_instruction_i1),effect_instruction_i2:Ae(this.effect_instruction_i2)}}toString(){return Oe(this.toJSON())}[fe](){return this.toJSON()}[Symbol.iterator](){return new sc(new Vi(this))}}class Wk{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[fo]=eo;constructor(t){this._op=t,this._tag=t}[V](t){return Ud(t)&&t._op==="Failure"&&W(this.effect_instruction_i0,t.effect_instruction_i0)}[G](){return f(ot(this._tag),K(M(this.effect_instruction_i0)),$e(this))}get cause(){return this.effect_instruction_i0}pipe(){return N(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return Oe(this.toJSON())}[fe](){return this.toJSON()}[Symbol.iterator](){return new sc(new Vi(this))}}class Bk{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[fo]=eo;constructor(t){this._op=t,this._tag=t}[V](t){return Ud(t)&&t._op==="Success"&&W(this.effect_instruction_i0,t.effect_instruction_i0)}[G](){return f(ot(this._tag),K(M(this.effect_instruction_i0)),$e(this))}get value(){return this.effect_instruction_i0}pipe(){return N(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:Ae(this.value)}}toString(){return Oe(this.toJSON())}[fe](){return this.toJSON()}[Symbol.iterator](){return new sc(new Vi(this))}}const mn=e=>q(e,fo),se=e=>{const t=new ft(O$);return t.effect_instruction_i0=e,t},fy=l(3,(e,t,n)=>Vt(r=>k(e,s=>k(Ln(U(()=>r(t(s)))),o=>U(()=>n(s,o)).pipe(rn({onFailure:i=>{switch(o._tag){case bt:return ze(ut(o.effect_instruction_i0,i));case St:return ze(i)}},onSuccess:()=>o})))))),tt=l(2,(e,t)=>k(e,()=>O(t))),on=e=>tt(e,void 0),Kk=function(){const e=new ft(Ga);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(Qf("you're not supposed to end up here"))}return e},pa=(e,t=Cn)=>{const n=new ft(zc);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,Ss(n,s=>mn(r)?r:ee)},Qr=(e,t=Cn)=>U(()=>pa(e,t)),Un=(e,t=Cn)=>Kk(e,function(){let n,r;function s(a){n?n(a):r===void 0&&(r=a)}const o=new ft(zc);o.effect_instruction_i0=a=>{n=a,r&&a(r)},o.effect_instruction_i1=t;let i,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,i=Pe(()=>this.effect_instruction_i0(s,c.signal))):i=Pe(()=>this.effect_instruction_i0(s)),i||c?Ss(o,a=>(c&&c.abort(),i??ee)):o}),cu=l(2,(e,t)=>{const n=new ft(pl);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),Pi=l(2,(e,t)=>cr(e,{onFailure:t,onSuccess:O})),Hk=l(3,(e,t,n)=>cu(e,r=>{const s=ly(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):ze(r);case"Right":return ze(s.right)}})),s_=Symbol.for("effect/OriginalAnnotation"),dy=(e,t)=>_e(t)?new Proxy(e,{has(n,r){return r===Ri||r===s_||r in n},get(n,r){return r===Ri?t.value:r===s_?e:n[r]}}):e,ga=e=>dr(e)&&!(Ri in e)?se(t=>ze(Kt(dy(e,Iy(t))))):ze(Kt(e)),Gp=e=>Jk(()=>Kt(new d2(e))),Fi=e=>cr(e,{onFailure:t=>O(z(t)),onSuccess:t=>O(H(t))}),Ln=e=>Vk(e,{onFailure:me,onSuccess:de}),Fe=e=>dr(e)&&!(Ri in e)?se(t=>ze(lo(dy(e,Iy(t))))):ze(lo(e)),au=e=>k(T(e),Fe),ze=e=>{const t=new Wk(bt);return t.effect_instruction_i0=e,t},Jk=e=>k(T(e),ze),uu=se(e=>O(e.id())),To=e=>se(t=>e(t.id())),k=l(2,(e,t)=>{const n=new ft(ql);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),xA=l(2,(e,t)=>k(e,n=>{const r=typeof t=="function"?t(n):t;return mn(r)?r:w$(r)?pa(s=>{r.then(o=>s(O(o)),o=>s(Fe(new qd(o,"An unknown error occurred in Effect.andThen"))))}):O(r)})),MA=e=>{const t=new ft("OnStep");return t.effect_instruction_i0=e,t},oc=e=>k(e,j),Vk=l(2,(e,t)=>rn(e,{onFailure:n=>O(t.onFailure(n)),onSuccess:n=>O(t.onSuccess(n))})),rn=l(2,(e,t)=>{const n=new ft(Ul);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),cr=l(2,(e,t)=>rn(e,{onFailure:n=>{if(Mk(n).length>0)return ze(_A(n));const s=yA(n);return s.length>0?t.onFailure(gd(s)):ze(n)},onSuccess:t.onSuccess})),Cr=l(2,(e,t)=>U(()=>{const n=ge(e),r=td(n.length);let s=0;return tt(yy({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),ho=l(2,(e,t)=>U(()=>{const n=ge(e);let r=0;return yy({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),rt=k(uu,e=>hy(e)),hy=e=>ze(wn(e)),xi=e=>{const t=new ft(Gi);return t.effect_instruction_i0=XM(ec),t.effect_instruction_i1=()=>e,t},py=l(2,(e,t)=>Vt(n=>k(Ln(n(e)),r=>cC(t,r)))),J=l(2,(e,t)=>k(e,n=>T(()=>t(n)))),gy=l(2,(e,t)=>cr(e,{onFailure:n=>au(()=>t.onFailure(n)),onSuccess:n=>T(()=>t.onSuccess(n))})),Ad=l(2,(e,t)=>rn(e,{onFailure:n=>{const r=ly(n);switch(r._tag){case"Left":return au(()=>t(r.left));case"Right":return ze(r.right)}},onSuccess:O})),AA=l(2,(e,t)=>ar(e,n=>oC(n)?ee:t(n.effect_instruction_i0))),ar=l(2,(e,t)=>Vt(n=>rn(n(e),{onFailure:r=>{const s=me(r);return rn(t(s),{onFailure:o=>me(ut(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=de(r);return pe(t(s),s)}}))),Ss=l(2,(e,t)=>ar(e,jd({onFailure:n=>Rd(n)?on(t(uy(n))):ee,onSuccess:()=>ee}))),my=e=>NA(e,j),NA=l(2,(e,t)=>cr(e,{onFailure:n=>ga(t(n)),onSuccess:O})),LA=se((e,t)=>O(t.runtimeFlags)),O=e=>{const t=new Bk(St);return t.effect_instruction_i0=e,t},U=e=>{const t=new ft(Ga);return t.commit=e,t},T=e=>{const t=new ft(T$);return t.effect_instruction_i0=e,t},Lr=l(e=>e.length===3||e.length===2&&!(dr(e[1])&&"onlyEffect"in e[1]),(e,t)=>k(e,n=>{const r=typeof t=="function"?t(n):t;return mn(r)?tt(r,n):w$(r)?pa(s=>{r.then(o=>s(O(n)),o=>s(Fe(new qd(o,"An unknown error occurred in Effect.tap"))))}):O(n)})),DA=e=>se(t=>{const n=t.getFiberRef(Yp),r=f(n,Ue(()=>t.scope()));return e(Oo(Yp,F(r)))}),zr=e=>{const t=new ft(Gi);return t.effect_instruction_i0=Tk(ec),t.effect_instruction_i1=()=>e,t},Vt=e=>Kk(e,function(){const t=new ft(Gi);return t.effect_instruction_i0=Tk(ec),t.effect_instruction_i1=n=>vk(n)?Pe(()=>this.effect_instruction_i0(xi)):Pe(()=>this.effect_instruction_i0(zr)),t}),ee=O(void 0),Gk=e=>{const t=new ft(Gi);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},lu=l(2,(e,t)=>k(t,n=>n?f(e,J(F)):O(P()))),yy=e=>{const t=new ft(jl);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},cf=e=>U(()=>{const t=new ft(Wc);return t.effect_instruction_i0=e(),t}),qA=function(){const e=arguments.length===1?arguments[0]:arguments[1].bind(arguments[0]);return cf(()=>e(f))},UA=(e,...t)=>Object.defineProperty(t.length===0?function(...n){return cf(()=>e.apply(this,n))}:function(...n){let r=cf(()=>e.apply(this,n));for(const s of t)r=s(r,...n);return r},"length",{value:e.length,configurable:!0}),jA=l(2,(e,t)=>{const n=new ft(Gi);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),fu=e=>{const t=new ft(gl);return typeof e?.priority<"u"?s2(t,e.priority):t},Nd=l(2,(e,t)=>k(e,n=>J(t,r=>[n,r]))),ns=l(2,(e,t)=>k(e,n=>tt(t,n))),pe=l(2,(e,t)=>k(e,()=>t)),Qk=l(3,(e,t,n)=>k(e,r=>J(t,s=>n(r,s)))),zA=Qr(()=>{const e=setInterval(()=>{},2147483647);return T(()=>clearInterval(e))}),ma=e=>k(uu,t=>f(e,vr(t))),vr=l(2,(e,t)=>k(e.interruptAsFork(t),()=>e.await)),WA={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return N(this,arguments)}},BA={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return N(this,arguments)}},KA={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return N(this,arguments)}},HA={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return N(this,arguments)}},Yk={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return N(this,arguments)}},Xk={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return N(this,arguments)}},JA={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return N(this,arguments)}},VA={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return N(this,arguments)}},GA="effect/FiberRef",QA=Symbol.for(GA),YA={_A:e=>e},du=e=>se(t=>de(t.getFiberRef(e))),ic=l(2,(e,t)=>k(du(e),t)),af=l(2,(e,t)=>XA(e,()=>[void 0,t])),XA=l(2,(e,t)=>se(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),O(r)})),Oo=l(3,(e,t,n)=>fy(ns(du(t),af(t,n)),()=>e,r=>af(t,r))),by=l(3,(e,t,n)=>ic(t,r=>Oo(e,t,n(r)))),$t=(e,t)=>cc(e,{differ:$k(),fork:t?.fork??j,join:t?.join}),ZA=e=>{const t=LM();return cc(e,{differ:t,fork:t.empty})},e2=e=>{const t=DM($k());return cc(e,{differ:t,fork:t.empty})},Zk=e=>{const t=NM();return cc(e,{differ:t,fork:t.empty})},cc=(e,t)=>({...Ya,[QA]:YA,initial:e,commit(){return du(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),t2=e=>cc(e,{differ:ZS,fork:ZS.empty}),Bn=te(Symbol.for("effect/FiberRef/currentContext"),()=>Zk(as())),Ro=te(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>$t(0)),eC=te(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>$t(2048)),tC=te(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>$t(vd())),n2=te(Symbol.for("effect/FiberRef/currentLogLevel"),()=>$t(Yk)),r2=te(Symbol.for("effect/FiberRef/currentLogSpan"),()=>$t(vi())),s2=l(2,(e,t)=>Oo(e,Ro,t)),o2=te(Symbol.for("effect/FiberRef/currentConcurrency"),()=>$t("unbounded")),i2=te(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>$t(!0)),Sy=te(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>$t(F(Xk))),c2=l(2,(e,t)=>Oo(e,Sy,t)),Qp=te(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>e2(cs())),Yp=te(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>$t(P(),{fork:()=>P(),join:(e,t)=>e})),Xu=te(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>$t(Ar,{fork:()=>Ar,join:(e,t)=>e})),nC=te(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>$t(!0)),Ld=te(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>$t(!0)),a2=te(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>$t(vd())),u2=te(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>$t(xe())),o_=Symbol.for("effect/Scope"),i_=Symbol.for("effect/CloseableScope"),rC=(e,t)=>e.addFinalizer(()=>on(t)),ya=(e,t)=>e.addFinalizer(t),Xp=(e,t)=>e.close(t),Dd=(e,t)=>e.fork(t),l2=e=>f2(j)(e),f2=l(2,(e,t)=>{const n=f(e,Ak,zs(t));switch(n._tag){case"None":return f(Mk(e),pd,Re({onNone:()=>{const r=ge(uy(e)).flatMap(s=>ge(ty(s)).map(o=>`#${o}`));return new h2(r?`Interrupted by fibers: ${r.join(", ")}`:void 0)},onSome:j}));case"Some":return n.value}}),_y=function(){class e extends globalThis.Error{commit(){return Fe(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[fe](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?bs(lo(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,BR),e}(),hu=(e,t)=>{class n extends _y{_tag=t}return Object.assign(n.prototype,e),n.prototype.name=t,n},c_=Symbol.for("effect/Cause/errors/RuntimeException"),d2=hu({[c_]:c_},"RuntimeException"),Zp=Symbol.for("effect/Cause/errors/InterruptedException"),h2=hu({[Zp]:Zp},"InterruptedException"),p2=e=>q(e,Zp),a_=Symbol.for("effect/Cause/errors/IllegalArgument"),g2=hu({[a_]:a_},"IllegalArgumentException"),u_=Symbol.for("effect/Cause/errors/NoSuchElement"),pu=hu({[u_]:u_},"NoSuchElementException"),l_=Symbol.for("effect/Cause/errors/Timeout"),m2=hu({[l_]:l_},"TimeoutException"),y2=e=>new m2(`Operation timed out after '${GE(e)}'`),f_=Symbol.for("effect/Cause/errors/UnknownException"),qd=function(){class e extends _y{_tag="UnknownException";error;constructor(n,r){super(r??"An unknown error occurred",{cause:n}),this.error=n}}return Object.assign(e.prototype,{[f_]:f_,name:"UnknownException"}),e}(),Ud=e=>mn(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),sC=e=>e._tag==="Failure",oC=e=>e._tag==="Success",b2=e=>{switch(e._tag){case bt:return ay(e.effect_instruction_i0);case St:return!1}},wl=l(2,(e,t)=>{switch(e._tag){case bt:return me(e.effect_instruction_i0);case St:return de(t)}}),sp=e=>wl(e,void 0),ii=(e,t)=>w2(e,t?.parallel?Nr:ut),Yo=e=>me(Kt(e)),ba=e=>me(lo(e)),me=e=>{const t=new Wk(bt);return t.effect_instruction_i0=e,t},wy=e=>me(wn(e)),$l=l(2,(e,t)=>{switch(e._tag){case bt:return me(e.effect_instruction_i0);case St:return de(t(e.effect_instruction_i0))}}),S2=l(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case bt:return me(f(e.effect_instruction_i0,Nk(t)));case St:return de(n(e.effect_instruction_i0))}}),jd=l(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case bt:return t(e.effect_instruction_i0);case St:return n(e.effect_instruction_i0)}}),eg=l(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case bt:return t(e.effect_instruction_i0);case St:return n(e.effect_instruction_i0)}}),de=e=>{const t=new Bk(St);return t.effect_instruction_i0=e,t},It=de(void 0),_2=l(2,(e,t)=>$y(e,t,{onSuccess:(n,r)=>[n,r],onFailure:ut})),iC=l(2,(e,t)=>$y(e,t,{onSuccess:(n,r)=>r,onFailure:ut})),$y=l(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case bt:switch(t._tag){case St:return me(e.effect_instruction_i0);case bt:return me(n(e.effect_instruction_i0,t.effect_instruction_i0))}case St:switch(t._tag){case St:return de(r(e.effect_instruction_i0,t.effect_instruction_i0));case bt:return me(t.effect_instruction_i0)}}}),w2=(e,t)=>{const n=so(e);return Mr(n)?f(kr(n),Pm(f(rr(n),$l(ke)),(r,s)=>f(r,$y(s,{onSuccess:(o,i)=>f(o,Rt(i)),onFailure:t}))),$l(xr),$l(r=>fn(r)),F):P()},ac=e=>({...Ya,[Uk]:OA,state:Co(RA([])),commit(){return jn(this)},blockingOn:e}),uc=()=>k(uu,e=>$2(e)),$2=e=>T(()=>ac(e)),jn=e=>Qr(t=>{const n=le(e.state);switch(n._tag){case Md:return t(n.effect);case iu:return n.joiners.push(t),I2(e,t)}},e.blockingOn),E2=l(2,(e,t)=>py(t,e)),lc=l(2,(e,t)=>T(()=>{const n=le(e.state);switch(n._tag){case Md:return!1;case iu:{vo(e.state,jk(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),cC=l(2,(e,t)=>lc(e,t)),k2=l(2,(e,t)=>lc(e,Fe(t))),aC=l(2,(e,t)=>lc(e,ze(t))),C2=e=>k(uu,t=>lc(e,hy(t))),Ey=l(2,(e,t)=>lc(e,hy(t))),v2=e=>T(()=>le(e.state)._tag===Md),gu=l(2,(e,t)=>lc(e,O(t))),mu=(e,t)=>{const n=le(e.state);if(n._tag===iu){vo(e.state,jk(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},I2=(e,t)=>T(()=>{const n=le(e.state);if(n._tag===iu){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),T2=se(e=>de(e.currentContext)),fc=()=>T2,dc=e=>k(fc(),e),ky=l(2,(e,t)=>Oo(Bn,t)(e)),Cy=l(2,(e,t)=>by(Bn,n=>jr(n,t))(e)),vy=l(2,(e,t)=>dc(n=>ky(e,t(n)))),Iy=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?F(t):P()},O2={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:It},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){},addLinks(){}},R2=e=>Object.assign(Object.create(O2),e),Es=Uk,ue=uc,Le=jn,P2=E2,_s=cC,uC=k2,Jc=aC,d_=C2,uf=v2,De=gu,F2=ac,Fs=mu,x2=Ud,hc=sC,Sa=oC,M2=b2,A2=ii,_a=Yo,yu=ba,yt=me,N2=wy,L2=$l,D2=S2,sr=jd,Ke=de,Ft=It,h_=_2,wa=iC,p_=Symbol.for("effect/MutableHashMap"),q2={[p_]:p_,[Symbol.iterator](){return new Ty(this)},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(Ae)}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}};class Ty{self;referentialIterator;bucketIterator;constructor(t){this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new U2(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new Ty(this.self)}}class U2{backing;constructor(t){this.backing=t}currentBucket;next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const j2=()=>{const e=Object.create(q2);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},vs=l(2,(e,t)=>{if(Dl(t)===!1)return e.referential.has(t)?F(e.referential.get(t)):P();const n=t[G](),r=e.buckets.get(n);return r===void 0?P():z2(e,r,t)}),z2=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[V](t[s][0])){const i=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),F(i)}return P()},vc=l(2,(e,t)=>_e(vs(e,t))),Ic=l(3,(e,t,n)=>{if(Dl(t)===!1)return e.referential.set(t,n),e;const r=t[G](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(W2(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),W2=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[V](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},g_=Symbol.for("effect/MutableList"),B2={[g_]:g_,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(Ae)}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},K2=e=>({value:e,removed:!1,prev:void 0,next:void 0}),H2=()=>{const e=Object.create(B2);return e.head=void 0,e.tail=void 0,e._length=0,e},lC=e=>Oy(e)===0,Oy=e=>e._length,J2=l(2,(e,t)=>{const n=K2(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),V2=e=>{const t=e.head;if(t!==void 0)return G2(e,t),t.value},G2=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},m_=Symbol.for("effect/MutableQueue"),Xe=Symbol.for("effect/mutable/MutableQueue/Empty"),Q2={[m_]:m_,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(Ae)}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},fC=e=>{const t=Object.create(Q2);return t.queue=H2(),t.capacity=e,t},Ry=e=>fC(e),zd=()=>fC(void 0),Py=e=>Oy(e.queue),Hs=e=>lC(e.queue),Y2=e=>e.capacity===void 0?1/0:e.capacity,Mi=l(2,(e,t)=>{const n=Oy(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(J2(t)(e.queue),!0)}),Fy=l(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=xe(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=Mi(r.value)(e);for(;r!=null&&!r.done;)s=Rt(r.value)(s),r=n.next();return xr(s)}),Tr=l(2,(e,t)=>lC(e.queue)?t:V2(e.queue)),Wd=l(2,(e,t)=>{let n=xe(),r=0;for(;r<t;){const s=Tr(Xe)(e);if(s===Xe)break;n=Rt(s)(n),r+=1}return xr(n)}),X2="effect/Clock",y_=Symbol.for(X2),Po=sn("effect/Clock"),Z2=2**31-1,b_={unsafeSchedule(e,t){const n=$i(t);if(n>Z2)return An;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},S_=function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;let t;return()=>(t===void 0&&(t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6))),t+BigInt(Math.round(performance.now()*1e6)))}(),eN=function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return S_;const t=S_()-e.bigint();return()=>t+e.bigint()}();class tN{[y_]=y_;unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return eN()}currentTimeMillis=T(()=>this.unsafeCurrentTimeMillis());currentTimeNanos=T(()=>this.unsafeCurrentTimeNanos());scheduler(){return O(b_)}sleep(t){return Un(n=>{const r=b_.unsafeSchedule(()=>n(ee),t);return on(T(r))})}}const nN=()=>new tN,dC="And",hC="Or",pC="InvalidData",gC="MissingData",mC="SourceUnavailable",yC="Unsupported",rN="effect/ConfigError",__=Symbol.for(rN),pc={_tag:"ConfigError",[__]:__},bC=(e,t)=>{const n=Object.create(pc);return n._op=dC,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},SC=(e,t)=>{const n=Object.create(pc);return n._op=hC,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},sN=(e,t,n={pathDelim:"."})=>{const r=Object.create(pc);return r._op=pC,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${f(this.path,Yi(n.pathDelim))}: "${this.message}")`}}),r},po=(e,t,n={pathDelim:"."})=>{const r=Object.create(pc);return r._op=gC,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${f(this.path,Yi(n.pathDelim))}: "${this.message}")`}}),r},oN=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(pc);return s._op=mC,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${f(this.path,Yi(r.pathDelim))}: "${this.message}")`}}),s},iN=(e,t,n={pathDelim:"."})=>{const r=Object.create(pc);return r._op=yC,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${f(this.path,Yi(n.pathDelim))}: "${this.message}")`}}),r},xs=l(2,(e,t)=>{switch(e._op){case dC:return bC(xs(e.left,t),xs(e.right,t));case hC:return SC(xs(e.left,t),xs(e.right,t));case pC:return sN([...t,...e.path],e.message);case gC:return po([...t,...e.path],e.message);case mC:return oN([...t,...e.path],e.message,e.cause);case yC:return iN([...t,...e.path],e.message)}}),cN={_tag:"Empty"},op=l(2,(e,t)=>{let n=ry(t),r=e;for(;ny(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=ao(s.first,ao(s.second,n.tail));break}case"MapName":{r=Ws(r,s.f),n=n.tail;break}case"Nested":{r=Wl(r,s.name),n=n.tail;break}case"Unnested":{if(f(Bc(r),p1(s.name)))r=to(r),n=n.tail;else return z(po(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return H(r)}),aN="Constant",uN="Fail",lN="Fallback",fN="Described",dN="Lazy",hN="MapOrFail",pN="Nested",gN="Primitive",mN="Sequence",yN="HashMap",bN="ZipWith";var w_={};const lf=(e,t)=>[...e,...t],SN="effect/ConfigProvider",$_=Symbol.for(SN),_N=sn("effect/ConfigProvider"),wN="effect/ConfigProviderFlat",E_=Symbol.for(wN),$N=e=>({[$_]:$_,pipe(){return N(this,arguments)},...e}),EN=e=>({[E_]:E_,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),kN=e=>$N({load:t=>k(bn(e,cs(),t,!1),n=>Re(Bc(n),{onNone:()=>Fe(po(cs(),`Expected a single value having structure: ${t}`)),onSome:O})),flattened:e}),CN=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=a=>f(a,Yi(t)),s=a=>a.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof w_=="object"?w_:{};return kN(EN({load:(a,u,d=!0)=>{const h=r(a),p=o(),g=h in p?F(p[h]):P();return f(g,Ad(()=>po(a,`Expected ${h} to exist in the process context`)),k(y=>RN(y,a,u,n,d)))},enumerateChildren:a=>T(()=>{const u=o(),p=Object.keys(u).map(g=>s(g.toUpperCase())).filter(g=>{for(let y=0;y<a.length;y++){const E=f(a,B$(y)),S=g[y];if(S===void 0||E!==S)return!1}return!0}).flatMap(g=>g.slice(a.length,a.length+1));return wx(p)}),patch:cN}))},vN=(e,t,n,r)=>{const s=FS(n.length,a=>a>=r.length?P():F([e(a),a+1])),o=FS(r.length,a=>a>=n.length?P():F([t(a),a+1])),i=lf(n,s),c=lf(r,o);return[i,c]},IN=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},bn=(e,t,n,r)=>{const s=n;switch(s._tag){case aN:return O(Pn(s.value));case fN:return U(()=>bn(e,t,s.config,r));case uN:return Fe(po(t,s.message));case lN:return f(U(()=>bn(e,t,s.first,r)),Pi(o=>s.condition(o)?f(bn(e,t,s.second,r),Pi(i=>Fe(SC(o,i)))):Fe(o)));case dN:return U(()=>bn(e,t,s.config(),r));case hN:return U(()=>f(bn(e,t,s.original,r),k(Cr(o=>f(s.mapOrFail(o),Ad(xs(IN(t,s.original))))))));case pN:return U(()=>bn(e,lf(t,Pn(s.name)),s.config,r));case gN:return f(op(t,e.patch),k(o=>f(e.load(o,s,r),k(i=>{if(i.length===0){const c=f(x1(o),Ue(()=>"<n/a>"));return Fe(po([],`Expected ${s.description} with name ${c}`))}return O(i)}))));case mN:return f(op(t,e.patch),k(o=>f(e.enumerateChildren(o),k(FN),k(i=>i.length===0?U(()=>J(bn(e,t,s.config,!0),Pn)):f(Cr(i,c=>bn(e,I1(t,`[${c}]`),s.config,!0)),J(c=>{const a=B1(c);return a.length===0?Pn(cs()):Pn(a)}))))));case yN:return U(()=>f(op(t,e.patch),k(o=>f(e.enumerateChildren(o),k(i=>f(i,Cr(c=>bn(e,lf(o,Pn(c)),s.valueConfig,r)),J(c=>c.length===0?Pn(vd()):f(PN(c),Ws(a=>Ax(PS(ge(i),a)))))))))));case bN:return U(()=>f(bn(e,t,s.left,r),Fi,k(o=>f(bn(e,t,s.right,r),Fi,k(i=>{if(pt(o)&&pt(i))return Fe(bC(o.left,i.left));if(pt(o)&&tr(i))return Fe(o.left);if(tr(o)&&pt(i))return Fe(i.left);if(tr(o)&&tr(i)){const c=f(t,Yi(".")),a=TN(t,c),[u,d]=vN(a,a,f(o.right,Ws(H)),f(i.right,Ws(H)));return f(u,PS(d),Cr(([h,p])=>f(Nd(h,p),J(([g,y])=>s.zip(g,y)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},TN=(e,t)=>n=>z(po(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),ON=(e,t)=>e.split(new RegExp(`\\s*${Kl(t)}\\s*`)),RN=(e,t,n,r,s)=>s?f(ON(e,r),Cr(o=>n.parse(o.trim())),Ad(xs(t))):f(n.parse(e),gy({onFailure:xs(t),onSuccess:Pn})),PN=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),FN=e=>f(Cr(e,MN),gy({onFailure:()=>cs(),onSuccess:oa(bi)}),Fi,J(t1)),xN=/^(\[(\d+)\])$/,MN=e=>{const t=e.match(xN);if(t!==null){const n=t[2];return f(n!==void 0&&n.length>0?F(n):P(),Qi(AN))}return P()},AN=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?P():F(t)},k_=Symbol.for("effect/Console"),Bd=sn("effect/Console"),NN={[k_]:k_,assert(e,...t){return T(()=>{console.assert(e,...t)})},clear:T(()=>{console.clear()}),count(e){return T(()=>{console.count(e)})},countReset(e){return T(()=>{console.countReset(e)})},debug(...e){return T(()=>{console.debug(...e)})},dir(e,t){return T(()=>{console.dir(e,t)})},dirxml(...e){return T(()=>{console.dirxml(...e)})},error(...e){return T(()=>{console.error(...e)})},group(e){return e?.collapsed?T(()=>console.groupCollapsed(e?.label)):T(()=>console.group(e?.label))},groupEnd:T(()=>{console.groupEnd()}),info(...e){return T(()=>{console.info(...e)})},log(...e){return T(()=>{console.log(...e)})},table(e,t){return T(()=>{console.table(e,t)})},time(e){return T(()=>console.time(e))},timeEnd(e){return T(()=>console.timeEnd(e))},timeLog(e,...t){return T(()=>{console.timeLog(e,...t)})},trace(...e){return T(()=>{console.trace(...e)})},warn(...e){return T(()=>{console.warn(...e)})},unsafe:console},LN="effect/Random",C_=Symbol.for(LN),DN=sn("effect/Random");class qN{seed;[C_]=C_;PRNG;constructor(t){this.seed=t,this.PRNG=new IR(t)}get next(){return T(()=>this.PRNG.number())}get nextBoolean(){return J(this.next,t=>t>.5)}get nextInt(){return T(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return J(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return T(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return UN(t,n=>this.nextIntBetween(0,n))}}const UN=(e,t)=>U(()=>f(T(()=>Array.from(e)),k(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return f(r,ho(s=>f(t(s),J(o=>jN(n,s-1,o)))),tt(so(n)))}))),jN=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},zN=e=>new qN(M(e)),v_=Symbol.for("effect/Tracer"),_C=e=>({[v_]:v_,...e}),bu=sn("effect/Tracer"),ur=sn("effect/ParentSpan"),I_=function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}}();class WN{name;parent;context;startTime;kind;_tag="Span";spanId;traceId="native";sampled=!0;status;attributes;events=[];links;constructor(t,n,r,s,o,i){this.name=t,this.parent=n,this.context=r,this.startTime=o,this.kind=i,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:I_(32),this.spanId=I_(16),this.links=Array.from(s)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}addLinks(t){this.links.push(...t)}}const BN=_C({span:(e,t,n,r,s,o)=>new WN(e,t,n,r,s,o),context:e=>e()}),Or=e=>{if(e?.captureStackTrace===!1)return e;if(e?.captureStackTrace!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},ff=Xi()("effect/Tracer/DisablePropagation",{defaultValue:An}),KN=f(as(),Zn(Po,nN()),Zn(Bd,NN),Zn(DN,zN(Math.random())),Zn(_N,CN()),Zn(bu,BN)),lr=te(Symbol.for("effect/DefaultServices/currentServices"),()=>Zk(KN)),HN=e=>{const t=pn(e);return Kd(n=>n.sleep(t))},wC=e=>se(t=>e(t.currentDefaultServices)),Kd=e=>wC(t=>e(t.unsafeMap.get(Po.key))),JN=Kd(e=>e.currentTimeMillis),VN=e=>wC(t=>e(t.unsafeMap.get(bu.key))),$C=HN,GN=JN,QN=Kd,YN=Po;function XN(e){return new ls(e)}function ZN(){return XN(new Map)}const T_=Symbol.for("effect/FiberRefs");class ls{locals;[T_]=T_;constructor(t){this.locals=t}pipe(){return N(this,arguments)}}const eL=(e,t,n,r=!1)=>{const s=e;let o=t,i=n,c=r,a;for(;a===void 0;)if(je(o)&&je(i)){const u=Bt(o)[0],d=to(o),h=Bt(i)[0],p=Bt(i)[1],g=to(i);u.startTimeMillis<h.startTimeMillis?(i=g,c=!0):u.startTimeMillis>h.startTimeMillis?o=d:u.id<h.id?(i=g,c=!0):u.id>h.id?o=d:a=[p,c]}else a=[s.initial,!0];return a},tL=l(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const i=s[0][1];if(!s[0][0][V](t)){if(!r.has(o)){if(W(i,o.initial))return;r.set(o,[[t,o.join(o.initial,i)]]);return}const c=r.get(o),[a,u]=eL(o,c,s);if(u){const d=o.diff(a,i),h=c[0][1],p=o.join(h,o.patch(d)(h));if(!W(h,p)){let g;const y=c[0][0];y[V](t)?g=[[y,p],...c.slice(1)]:g=[[t,p],...c],r.set(o,g)}}}}),new ls(r)}),nL=l(2,(e,t)=>{const n=new Map;return EC(e,n,t),new ls(n)}),EC=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],i=s.patch(s.fork)(o);W(o,i)?t.set(s,r):t.set(s,[[n,i],...r])})},kC=l(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new ls(n)}),CC=l(2,(e,t)=>e.locals.has(t)?F(Bt(e.locals.get(t))[1]):P()),$a=l(2,(e,t)=>f(CC(e,t),Ue(()=>t.initial))),tg=l(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new ls(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return ng(s,t,n,r),new ls(s)}),ng=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(je(s)){const[i,c]=Bt(s);if(i[V](t)){if(W(c,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},rL=l(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new ls(new Map(t));const r=new Map(e.locals);return n!==void 0&&EC(e,r,n),t.forEach(([s,o])=>{o.length===1?ng(r,o[0][0],s,o[0][1]):o.forEach(([i,c])=>{ng(r,i,s,c)})}),new ls(r)}),O_=CC,Hd=$a,sL=rL,oL=ZN,iL=WA,cL=BA,vC=KA,IC=HA,aL=Yk,xy=Xk,uL=JA,lL=VA,fL=f(bi,z$(e=>e.ordinal)),dL=s1(fL),hL=e=>{switch(e){case"All":return iL;case"Debug":return xy;case"Error":return vC;case"Fatal":return cL;case"Info":return aL;case"Trace":return uL;case"None":return lL;case"Warning":return IC}},TC=e=>e.replace(/[\s="]/g,"_"),My=e=>t=>`${TC(t.label)}=${e-t.startTime}ms`,pL=Qa,gL=KR;let Wr=class extends gL{};const Ai=Symbol.for("effect/Readable"),Ay=Symbol.for("effect/Ref"),Ny={_A:e=>e};class mL extends Wr{ref;commit(){return this.get}[Ay]=Ny;[Ai]=Ai;constructor(t){super(),this.ref=t,this.get=T(()=>le(this.ref))}get;modify(t){return T(()=>{const n=le(this.ref),[r,s]=t(n);return n!==s&&vo(s)(this.ref),r})}}const OC=e=>new mL(Co(e)),df=e=>T(()=>OC(e)),rs=e=>e.get,Ea=l(2,(e,t)=>e.modify(()=>[void 0,t])),yL=l(2,(e,t)=>e.modify(n=>[n,t])),RC=l(2,(e,t)=>e.modify(t)),rg=l(2,(e,t)=>e.modify(n=>[void 0,t(n)])),bL=Ay,Fo=df,ss=rs,SL=yL,Tc=RC,Su=Ea,_L=rg,PC=ur,wL=_C,$L=VN,FC="Empty",xC="Add",MC="Remove",AC="Update",NC="AndThen",EL={_tag:FC},Ly=(e,t)=>{const n=new Map(e.locals);let r=EL;for(const[s,o]of t.locals.entries()){const i=Bt(o)[1],c=n.get(s);if(c!==void 0){const a=Bt(c)[1];W(a,i)||(r=ip({_tag:AC,fiberRef:s,patch:s.diff(a,i)})(r))}else r=ip({_tag:xC,fiberRef:s,value:i})(r);n.delete(s)}for(const[s]of n.entries())r=ip({_tag:MC,fiberRef:s})(r);return r},ip=l(2,(e,t)=>({_tag:NC,first:e,second:t})),LC=l(3,(e,t,n)=>{let r=n,s=Pn(e);for(;je(s);){const o=Bt(s),i=to(s);switch(o._tag){case FC:{s=i;break}case xC:{r=tg(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=i;break}case MC:{r=kC(r,o.fiberRef),s=i;break}case AC:{const c=$a(r,o.fiberRef);r=tg(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(c)}),s=i;break}case NC:{s=Wl(o.first)(Wl(o.second)(i));break}}}return r}),DC="effect/MetricLabel",sg=Symbol.for(DC);class kL{key;value;[sg]=sg;_hash;constructor(t,n){this.key=t,this.value=n,this._hash=ot(DC+this.key+this.value)}[G](){return this._hash}[V](t){return vL(t)&&this.key===t.key&&this.value===t.value}pipe(){return N(this,arguments)}}const CL=(e,t)=>new kL(e,t),vL=e=>q(e,sg),IL=l(e=>mn(e[0]),function(){const e=arguments;return by(e[0],tC,typeof e[1]=="string"?nf(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>nf(n,r,s),t))}),TL=e=>J(e,F),qC=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),U(()=>{try{return O(Pe(t))}catch(r){return Fe(n?Pe(()=>n(r)):new qd(r,"An unknown error occurred in Effect.try"))}})},OL=l(2,(e,t)=>cu(e,n=>{const r=Pd(n,s=>iy(s)?F(s):P());switch(r._tag){case"None":return ze(n);case"Some":return t(r.value.defect)}})),RL=l(2,(e,t)=>rn(e,{onFailure:n=>{const r=t(n);switch(r._tag){case"None":return ze(n);case"Some":return r.value}},onSuccess:O})),PL=l(e=>mn(e[0]),(e,...t)=>{const n=t[t.length-1];let r;return t.length===2?r=Sm(t[0]):r=s=>{const o=q(s,"_tag")?s._tag:void 0;if(!o)return!1;for(let i=0;i<t.length-1;i++)if(t[i]===o)return!0;return!1},Hk(e,r,n)}),FL=QN,xL=FL(O),UC=l(2,(e,t)=>pe($C(t),e)),ML=e=>HC(e,zC,Ly),AL=e=>HC(e,Nd(zC,LA),([t,n],[r,s])=>[Ly(t,r),ts(n,s)]),jC=l(2,(e,t)=>cr(e,{onFailure:n=>O(t.onFailure(n)),onSuccess:n=>O(t.onSuccess(n))})),Dy=e=>{const t=k(k(e,()=>fu()),()=>t);return t},zC=se(e=>O(e.getFiberRefs())),WC=e=>jC(e,{onFailure:sa,onSuccess:sa}),NL=e=>rn(e,{onFailure:t=>BC(t,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>ee}),Jd=e=>(...t)=>{const n=$o(e);let r;for(let s=0,o=t.length;s<o;s++){const i=t[s];oy(i)&&(r!==void 0?r=ut(r,i):r=i,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=Ar),se(s=>(s.log(t,r,n),ee))},LL=Jd(),BC=Jd(xy),DL=Jd(IC),qL=Jd(vC),R_=l(2,(e,t)=>rn(e,{onFailure:n=>Jk(()=>t(n)),onSuccess:O})),UL=e=>f(uc(),k(t=>f(AL(e),py(t),zL,J(n=>pe(n,f(jn(t),k(([r,s])=>tt(Nd(KC(r[0]),Gk(r[1])),s)))))))),jL=e=>J(e,t=>!t),zL=e=>J(Fo(!0),t=>on(lu(e,SL(t,!1)))),KC=e=>GL((t,n)=>f(e,LC(t,n))),WL=e=>e.length>=1?Un((t,n)=>{try{e(n).then(r=>t(de(r)),r=>t(Yo(r)))}catch(r){t(Yo(r))}}):Un(t=>{try{e().then(n=>t(de(n)),n=>t(Yo(n)))}catch(n){t(Yo(n))}}),ka=l(3,(e,t,n)=>dc(r=>ky(e,Zn(r,t,n)))),qy=$C,Ca=O(P()),HC=l(3,(e,t,n)=>k(t,r=>k(e,s=>J(t,o=>[n(r,o),s])))),BL=l(2,(e,t)=>rn(e,{onFailure:n=>pe(t(n),ze(n)),onSuccess:O})),KL=$L,HL=KL(O),JL=e=>{let t,n;typeof e=="function"?t=e:(t=e.try,n=e.catch);const r=s=>n?au(()=>n(s)):Fe(new qd(s,"An unknown error occurred in Effect.tryPromise"));return t.length>=1?Un((s,o)=>{try{t(o).then(i=>s(de(i)),i=>s(r(i)))}catch(i){s(r(i))}}):Un(s=>{try{t().then(o=>s(de(o)),o=>s(r(o)))}catch(o){s(r(o))}})},VL=l(2,(e,t)=>k(e,n=>qC({try:()=>t.try(n),catch:t.catch}))),GL=e=>se(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),ee)),QL=l(2,(e,t)=>U(()=>t()?J(e,F):O(P()))),YL=e=>new Proxy({},{get(t,n,r){return(...s)=>k(e,o=>o[n](...s))}}),XL=e=>J(fc(),Ur(e)),ZL=function(){const e=arguments;return WC(k(JC,t=>T(()=>{if(typeof e[0]=="string")t.attribute(e[0],e[1]);else for(const n in e[0])t.attribute(n,e[0][n])})))},JC=k(fc(),e=>{const t=e.unsafeMap.get(ur.key);return t!==void 0&&t._tag==="Span"?O(t):Fe(new pu)}),VC=BigInt(0),GC=Qi(e=>Xt(e.context,ff)?e._tag==="Span"?GC(e.parent):P():F(e)),Uy=(e,t,n)=>{const r=!e.getFiberRef(nC)||n.context&&Xt(n.context,ff),s=e.getFiberRef(Bn),o=n.parent?F(n.parent):n.root?P():GC(Ur(s,ur));let i;if(r)i=R2({name:t,parent:o,context:Zn(n.context??as(),ff,!0)});else{const c=e.getFiberRef(lr),a=Xt(c,bu),u=Xt(c,YN),d=e.getFiberRef(Ld),h=e.getFiberRefs(),p=O_(h,a2),g=O_(h,u2),y=g._tag==="Some"?n.links!==void 0?[...fn(g.value),...n.links??[]]:fn(g.value):n.links??cs();i=a.span(t,o,n.context??as(),y,d?u.unsafeCurrentTimeNanos():VC,n.kind??"internal"),p._tag==="Some"&&qx(p.value,(E,S)=>i.attribute(S,E)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([E,S])=>i.attribute(E,S))}return typeof n.captureStackTrace=="function"&&of.set(i,n.captureStackTrace),i},eD=(e,t)=>(t=Or(t),se(n=>O(Uy(n,e,t)))),hf=(e,t,n,r)=>T(()=>{e.status._tag!=="Ended"&&(sC(t)&&of.has(e)&&e.attribute("code.stacktrace",of.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():VC,t))}),og=(e,...t)=>{const n=Or(t.length===1?void 0:t[0]),r=t[t.length-1];return se(s=>{const o=Uy(s,e,n),i=s.getFiberRef(Ld),c=Xt(s.getFiberRef(lr),Po);return ar(r(o),a=>hf(o,a,c,i))})},ig=l(2,(e,t)=>ka(e,ur,t)),tD=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Or(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return og(t,n,s=>ig(r,s))}return r=>og(t,n,s=>ig(r,s))},QC="Sequential",YC="Parallel",nD="ParallelN",_u={_tag:QC},rD={_tag:YC},sD=e=>({_tag:nD,parallelism:e}),oD=e=>e._tag===QC,iD=e=>e._tag===YC,va=_u,cg=rD,ag=sD,Ia=Ly,Ta=LC,Vd="effect/FiberStatus",go=Symbol.for(Vd),pf="Done",P_="Running",F_="Suspended",cD=ot(`${Vd}-${pf}`);let aD=class{[go]=go;_tag=pf;[G](){return cD}[V](t){return jy(t)&&t._tag===pf}};class uD{runtimeFlags;[go]=go;_tag=P_;constructor(t){this.runtimeFlags=t}[G](){return f(M(Vd),K(M(this._tag)),K(M(this.runtimeFlags)),$e(this))}[V](t){return jy(t)&&t._tag===P_&&this.runtimeFlags===t.runtimeFlags}}class lD{runtimeFlags;blockingOn;[go]=go;_tag=F_;constructor(t,n){this.runtimeFlags=t,this.blockingOn=n}[G](){return f(M(Vd),K(M(this._tag)),K(M(this.runtimeFlags)),K(M(this.blockingOn)),$e(this))}[V](t){return jy(t)&&t._tag===F_&&this.runtimeFlags===t.runtimeFlags&&W(this.blockingOn,t.blockingOn)}}const fD=new aD,dD=e=>new uD(e),hD=(e,t)=>new lD(e,t),jy=e=>q(e,go),pD=e=>e._tag===pf,gD=fD,XC=dD,mD=hD,yD=pD,bD=Symbol.for("effect/Micro"),gf=Symbol.for("effect/Micro/MicroExit"),x_=Symbol.for("effect/Micro/MicroCause"),SD={_E:j};class ZC extends globalThis.Error{_tag;traces;[x_];constructor(t,n,r){const s=`MicroCause.${t}`;let o,i,c;if(n instanceof globalThis.Error){o=`(${s}) ${n.name}`,i=n.message;const a=i.split(`
`).length;c=n.stack?`(${s}) ${n.stack.split(`
`).slice(0,a+3).join(`
`)}`:`${o}: ${i}`}else o=s,i=yi(n,0),c=`${o}: ${i}`;r.length>0&&(c+=`
    ${r.join(`
    `)}`),super(i),this._tag=t,this.traces=r,this[x_]=SD,this.name=o,this.stack=c}pipe(){return N(this,arguments)}toString(){return this.stack}[fe](){return this.stack}}class _D extends ZC{defect;constructor(t,n=[]){super("Die",t,n),this.defect=t}}const wD=(e,t=[])=>new _D(e,t);class $D extends ZC{constructor(t=[]){super("Interrupt","interrupted",t)}}const ED=(e=[])=>new $D(e),kD=e=>e._tag==="Interrupt",M_=Symbol.for("effect/Micro/MicroFiber"),CD={_A:j,_E:j};class vD{context;interruptible;[M_];_stack=[];_observers=[];_exit;_children;currentOpCount=0;constructor(t,n=!0){this.context=t,this.interruptible=n,this[M_]=CD}getRef(t){return aF(this.context,t)}addObserver(t){return this._exit?(t(this._exit),sa):(this._observers.push(t),()=>{const n=this._observers.indexOf(t);n>=0&&this._observers.splice(n,1)})}_interrupted=!1;unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(Hy))}unsafePoll(){return this._exit}evaluate(t){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(t);if(n===Zu)return;const r=A_.interruptChildren&&A_.interruptChildren(this);if(r!==void 0)return this.evaluate(yf(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(t){let n=!1,r=t;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(Jy).shouldYield(this)){n=!0;const s=r;r=yf(PD,()=>s)}if(r=r[ug](this),r===Zu){const s=this._yielded;return gf in s?(this._yielded=void 0,s):Zu}}}catch(s){return q(r,ug)?lg(s):lg(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(t){for(;;){const n=this._stack.pop();if(!n)return;const r=n[mf]&&n[mf](this);if(r)return{[t]:r};if(n[t])return n}}_yielded=void 0;yieldWith(t){return this._yielded=t,Zu}children(){return this._children??=new Set}}const A_=te("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),ev=Symbol.for("effect/Micro/identifier"),gt=Symbol.for("effect/Micro/args"),ug=Symbol.for("effect/Micro/evaluate"),Ni=Symbol.for("effect/Micro/successCont"),ci=Symbol.for("effect/Micro/failureCont"),mf=Symbol.for("effect/Micro/ensureCont"),Zu=Symbol.for("effect/Micro/Yield"),ID={_A:j,_E:j,_R:j},TD={...pL,_op:"Micro",[bD]:ID,pipe(){return N(this,arguments)},[Symbol.iterator](){return new $$(new Vi(this))},toJSON(){return{_id:"Micro",op:this[ev],...gt in this?{args:this[gt]}:void 0}},toString(){return Oe(this)},[fe](){return Oe(this)}};function OD(e){return lg("Micro.evaluate: Not implemented")}const Gd=e=>({...TD,[ev]:e.op,[ug]:e.eval??OD,[Ni]:e.contA,[ci]:e.contE,[mf]:e.ensure}),zy=e=>{const t=Gd(e);return function(){const n=Object.create(t);return n[gt]=e.single===!1?arguments:arguments[0],n}},tv=e=>{const t={...Gd(e),[gf]:gf,_tag:e.op,get[e.prop](){return this[gt]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[gt]}},[V](n){return MD(n)&&n._tag===e.op&&W(this[gt],n[gt])},[G](){return $e(this,K(ot(e.op))(M(this[gt])))}};return function(n){const r=Object.create(t);return r[gt]=n,r[Ni]=void 0,r[ci]=void 0,r[mf]=void 0,r}},Wy=tv({op:"Success",prop:"value",eval(e){const t=e.getCont(Ni);return t?t[Ni](this[gt],e):e.yieldWith(this)}}),nv=tv({op:"Failure",prop:"cause",eval(e){let t=e.getCont(ci);for(;kD(this[gt])&&t&&e.interruptible;)t=e.getCont(ci);return t?t[ci](this[gt],e):e.yieldWith(this)}}),RD=zy({op:"Yield",eval(e){let t=!1;return e.getRef(Jy).scheduleTask(()=>{t||e.evaluate(AD)},this[gt]??0),e.yieldWith(()=>{t=!0})}}),PD=RD(0),FD=Wy(void 0),By=zy({op:"WithMicroFiber",eval(e){return this[gt](e)}}),yf=l(2,(e,t)=>{const n=Object.create(xD);return n[gt]=e,n[Ni]=t,n}),xD=Gd({op:"OnSuccess",eval(e){return e._stack.push(this),this[gt]}}),MD=e=>q(e,gf),rv=Wy,Ky=nv,Hy=Ky(ED()),lg=e=>Ky(wD(e)),AD=rv(void 0),ND="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class sv{tasks=[];running=!1;scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,ND(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return t.currentOpCount>=t.getRef(qD)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const LD=l(2,(e,t)=>By(n=>{const r=n.context;return n.context=t(r),zD(e,()=>(n.context=r,FD))})),DD=l(2,(e,t)=>LD(e,jr(t)));class qD extends Xi()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class Jy extends Xi()("effect/Micro/currentScheduler",{defaultValue:()=>new sv}){}const UD=l(2,(e,t)=>{const n=Object.create(jD);return n[gt]=e,n[Ni]=t.onSuccess,n[ci]=t.onFailure,n}),jD=Gd({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[gt]}}),zD=l(2,(e,t)=>BD(n=>UD(n(e),{onFailure:r=>yf(t(Ky(r)),()=>nv(r)),onSuccess:r=>yf(t(rv(r)),()=>Wy(r))}))),ov=zy({op:"SetInterruptible",ensure(e){if(e.interruptible=this[gt],e._interrupted&&e.interruptible)return()=>Hy}}),WD=e=>By(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(ov(!1)),t._interrupted?Hy:e)),BD=e=>By(t=>t.interruptible?(t.interruptible=!1,t._stack.push(ov(!0)),e(WD)):e(j)),KD=(e,t)=>{const n=new vD(Jy.context(new sv));return n.evaluate(e),n};class iv{buckets=[];scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class HD{maxNextTickBeforeTimer;running=!1;tasks=new iv;constructor(t){this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(eC)?t.getFiberRef(Ro):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const cv=te(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new HD(2048));class av{tasks=new iv;deferred=!1;scheduleTask(t,n){this.deferred?cv.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(eC)?t.getFiberRef(Ro):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const Qd=te(Symbol.for("effect/FiberRef/currentScheduler"),()=>$t(cv)),uv=te(Symbol.for("effect/FiberRef/currentRequestMap"),()=>$t(new Map)),N_=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return ic(o2,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},Vy="InterruptSignal",Gy="Stateful",Qy="Resume",Yy="YieldNow",cp=e=>({_tag:Vy,cause:e}),El=e=>({_tag:Gy,onFiber:e}),Wo=e=>({_tag:Qy,effect:e}),JD=()=>({_tag:Yy}),VD="effect/FiberScope",bf=Symbol.for(VD);class GD{[bf]=bf;fiberId=Cn;roots=new Set;add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}class QD{fiberId;parent;[bf]=bf;constructor(t,n){this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(El(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const YD=e=>new QD(e.id(),e),wu=te(Symbol.for("effect/FiberScope/Global"),()=>new GD),XD="effect/Fiber",ZD=Symbol.for(XD),eq={_E:e=>e,_A:e=>e},tq="effect/Fiber",nq=Symbol.for(tq),lv=e=>e.await,rq=e=>e.inheritAll,sq=l(2,(e,t)=>f(ho(e,fv(t)),pe(f(e,ho(lv))))),fv=l(2,(e,t)=>e.interruptAsFork(t)),Li=e=>ns(oc(e.await),e.inheritAll);({...Ya});const Hr="effect/FiberCurrent",oq=()=>$o(globalThis[Hr]),iq="effect/Logger",cq=Symbol.for(iq),aq={_Message:e=>e,_Output:e=>e},$u=e=>({[cq]:aq,log:e,pipe(){return N(this,arguments)}}),uq=/^[^\s"=]*$/,lq=(e,t)=>({annotations:n,cause:r,date:s,fiberId:o,logLevel:i,message:c,spans:a})=>{const u=y=>y.match(uq)?y:e(y),d=(y,E)=>`${TC(y)}=${u(E)}`,h=(y,E)=>" "+d(y,E);let p=d("timestamp",s.toISOString());p+=h("level",i.label),p+=h("fiber",Cd(o));const g=Om(c);for(let y=0;y<g.length;y++)p+=h("message",yi(g[y],t));gA(r)||(p+=h("cause",bs(r,{renderErrorCause:!0})));for(const y of a)p+=" "+My(s.getTime())(y);for(const[y,E]of n)p+=h(y,yi(E,t));return p},fq=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,dq=$u(lq(fq)),dv=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return Ae(e)}},hq=(e,...t)=>{let n="";for(let r=0;r<t.length;r++)n+=`\x1B[${t[r]}m`;return n+e+"\x1B[0m"},pq=(e,...t)=>e,Sn={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},gq={None:[],All:[],Trace:[Sn.gray],Debug:[Sn.blue],Info:[Sn.green],Warning:[Sn.yellow],Error:[Sn.red],Fatal:[Sn.bgBrightRed,Sn.black]},mq={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},yq=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,hv=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null,bq=hv&&process.stdout.isTTY===!0,Sq=hv||"Deno"in globalThis,_q=e=>{const t=e?.mode??"auto",r=(t==="auto"?Sq?"tty":"browser":t)==="browser",s=typeof e?.colors=="boolean"?e.colors:bq||r,o=e?.formatDate??yq;return r?$q({colors:s,formatDate:o}):wq({colors:s,formatDate:o,stderr:e?.stderr===!0})},wq=e=>{const t=typeof process=="object"&&"isBun"in process&&process.isBun===!0,n=e.colors?hq:pq;return $u(({annotations:r,cause:s,context:o,date:i,fiberId:c,logLevel:a,message:u,spans:d})=>{const h=Hd(o,lr),p=Xt(h,Bd).unsafe,g=e.stderr===!0?p.error:p.log,y=Om(u);let E=n(`[${e.formatDate(i)}]`,Sn.white)+` ${n(a.label,...gq[a._tag])} (${Cd(c)})`;if(ny(d)){const _=i.getTime(),b=My(_);for(const C of d)E+=" "+b(C)}E+=":";let S=0;if(y.length>0){const _=dv(y[0]);typeof _=="string"&&(E+=" "+n(_,Sn.bold,Sn.cyan),S++)}if(g(E),t||p.group(),cy(s)||g(bs(s,{renderErrorCause:!0})),S<y.length)for(;S<y.length;S++)g(Zs(y[S]));if(gk(r)>0)for(const[_,b]of r)g(n(`${_}:`,Sn.bold,Sn.white),Zs(b));t||p.groupEnd()})},$q=e=>{const t=e.colors?"%c":"";return $u(({annotations:n,cause:r,context:s,date:o,fiberId:i,logLevel:c,message:a,spans:u})=>{const d=Hd(s,lr),h=Xt(d,Bd).unsafe,p=Om(a);let g=`${t}[${e.formatDate(o)}]`;const y=[];if(e.colors&&y.push("color:gray"),g+=` ${t}${c.label}${t} (${Cd(i)})`,e.colors&&y.push(mq[c._tag],""),ny(u)){const S=o.getTime(),_=My(S);for(const b of u)g+=" "+_(b)}g+=":";let E=0;if(p.length>0){const S=dv(p[0]);typeof S=="string"&&(g+=` ${t}${S}`,e.colors&&y.push("color:deepskyblue"),E++)}if(h.groupCollapsed(g,...y),cy(r)||h.error(bs(r,{renderErrorCause:!0})),E<p.length)for(;E<p.length;E++)h.log(Zs(p[E]));if(gk(n)>0)for(const[S,_]of n){const b=Zs(_);e.colors?h.log(`%c${S}:`,"color:gray",b):h.log(`${S}:`,b)}h.groupEnd()})},pv="effect/MetricBoundaries",fg=Symbol.for(pv);class Eq{values;[fg]=fg;constructor(t){this.values=t,this._hash=f(ot(pv),K(Va(this.values)))}_hash;[G](){return this._hash}[V](t){return kq(t)&&W(this.values,t.values)}pipe(){return N(this,arguments)}}const kq=e=>q(e,fg),Cq=e=>{const t=f(e,Rm(ke(Number.POSITIVE_INFINITY)),K1);return new Eq(t)},vq=e=>f(C1(e.count-1,t=>e.start*Math.pow(e.factor,t)),Ye,Cq),Iq="effect/MetricKeyType",gv=Symbol.for(Iq),mv="effect/MetricKeyType/Counter",dg=Symbol.for(mv),Tq="effect/MetricKeyType/Frequency",Oq=Symbol.for(Tq),Rq="effect/MetricKeyType/Gauge",Pq=Symbol.for(Rq),yv="effect/MetricKeyType/Histogram",hg=Symbol.for(yv),Fq="effect/MetricKeyType/Summary",xq=Symbol.for(Fq),bv={_In:e=>e,_Out:e=>e};class Mq{incremental;bigint;[gv]=bv;[dg]=dg;constructor(t,n){this.incremental=t,this.bigint=n,this._hash=ot(mv)}_hash;[G](){return this._hash}[V](t){return Sv(t)}pipe(){return N(this,arguments)}}class Aq{boundaries;[gv]=bv;[hg]=hg;constructor(t){this.boundaries=t,this._hash=f(ot(yv),K(M(this.boundaries)))}_hash;[G](){return this._hash}[V](t){return _v(t)&&W(this.boundaries,t.boundaries)}pipe(){return N(this,arguments)}}const Nq=e=>new Mq(e?.incremental??!1,e?.bigint??!1),Lq=e=>new Aq(e),Sv=e=>q(e,dg),Dq=e=>q(e,Oq),qq=e=>q(e,Pq),_v=e=>q(e,hg),Uq=e=>q(e,xq),jq="effect/MetricKey",wv=Symbol.for(jq),zq={_Type:e=>e},Wq=nd(W);class Xy{name;keyType;description;tags;[wv]=zq;constructor(t,n,r,s=[]){this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=f(ot(this.name+this.description),K(M(this.keyType)),K(Va(this.tags)))}_hash;[G](){return this._hash}[V](t){return Bq(t)&&this.name===t.name&&W(this.keyType,t.keyType)&&W(this.description,t.description)&&Wq(this.tags,t.tags)}pipe(){return N(this,arguments)}}const Bq=e=>q(e,wv),Kq=(e,t)=>new Xy(e,Nq(t),$o(t?.description)),Hq=(e,t,n)=>new Xy(e,Lq(t),$o(n)),Jq=l(2,(e,t)=>t.length===0?e:new Xy(e.name,e.keyType,e.description,yl(e.tags,t))),Vq="effect/MetricState",Eu=Symbol.for(Vq),$v="effect/MetricState/Counter",pg=Symbol.for($v),Ev="effect/MetricState/Frequency",gg=Symbol.for(Ev),kv="effect/MetricState/Gauge",mg=Symbol.for(kv),Cv="effect/MetricState/Histogram",yg=Symbol.for(Cv),vv="effect/MetricState/Summary",bg=Symbol.for(vv),ku={_A:e=>e};class Gq{count;[Eu]=ku;[pg]=pg;constructor(t){this.count=t}[G](){return f(M($v),K(M(this.count)),$e(this))}[V](t){return iU(t)&&this.count===t.count}pipe(){return N(this,arguments)}}const Qq=nd(W);class Yq{occurrences;[Eu]=ku;[gg]=gg;constructor(t){this.occurrences=t}_hash;[G](){return f(ot(Ev),K(Va(ge(this.occurrences.entries()))),$e(this))}[V](t){return cU(t)&&Qq(ge(this.occurrences.entries()),ge(t.occurrences.entries()))}pipe(){return N(this,arguments)}}class Xq{value;[Eu]=ku;[mg]=mg;constructor(t){this.value=t}[G](){return f(M(kv),K(M(this.value)),$e(this))}[V](t){return aU(t)&&this.value===t.value}pipe(){return N(this,arguments)}}class Zq{buckets;count;min;max;sum;[Eu]=ku;[yg]=yg;constructor(t,n,r,s,o){this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[G](){return f(M(Cv),K(M(this.buckets)),K(M(this.count)),K(M(this.min)),K(M(this.max)),K(M(this.sum)),$e(this))}[V](t){return uU(t)&&W(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return N(this,arguments)}}class eU{error;quantiles;count;min;max;sum;[Eu]=ku;[bg]=bg;constructor(t,n,r,s,o,i){this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=i}[G](){return f(M(vv),K(M(this.error)),K(M(this.quantiles)),K(M(this.count)),K(M(this.min)),K(M(this.max)),K(M(this.sum)),$e(this))}[V](t){return lU(t)&&this.error===t.error&&W(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return N(this,arguments)}}const tU=e=>new Gq(e),nU=e=>new Yq(e),rU=e=>new Xq(e),sU=e=>new Zq(e.buckets,e.count,e.min,e.max,e.sum),oU=e=>new eU(e.error,e.quantiles,e.count,e.min,e.max,e.sum),iU=e=>q(e,pg),cU=e=>q(e,gg),aU=e=>q(e,mg),uU=e=>q(e,yg),lU=e=>q(e,bg),fU="effect/MetricHook",dU=Symbol.for(fU),hU={_In:e=>e,_Out:e=>e},Cu=e=>({[dU]:hU,pipe(){return N(this,arguments)},...e}),L_=BigInt(0),pU=e=>{let t=e.keyType.bigint?L_:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=L_:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return Cu({get:()=>tU(t),update:r,modify:r})},gU=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return Cu({get:()=>nU(t),update:n,modify:n})},mU=(e,t)=>{let n=t;return Cu({get:()=>rU(n),update:r=>{n=r},modify:r=>{n=n+r}})},yU=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,i=0,c=Number.MAX_VALUE,a=Number.MIN_VALUE;f(t,oa(bi),Ws((h,p)=>{s[p]=h}));const u=h=>{let p=0,g=n;for(;p!==g;){const y=Math.floor(p+(g-p)/2),E=s[y];h<=E?g=y:p=y,g===p+1&&(h<=s[p]?g=p:p=g)}r[p]=r[p]+1,o=o+1,i=i+h,h<c&&(c=h),h>a&&(a=h)},d=()=>{const h=td(n);let p=0;for(let g=0;g<n;g++){const y=s[g],E=r[g];p=p+E,h[g]=[y,p]}return h};return Cu({get:()=>sU({buckets:d(),count:o,min:c,max:a,sum:i}),update:u,modify:u})},bU=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=f(s,oa(bi)),i=td(r);let c=0,a=0,u=0,d=Number.MAX_VALUE,h=Number.MIN_VALUE;const p=y=>{const E=[];let S=0;for(;S!==r-1;){const _=i[S];if(_!=null){const[b,C]=_,m=ca(y-b);UF(m,HE)&&qF(m,n)&&E.push(C)}S=S+1}return SU(t,o,oa(E,bi))},g=(y,E)=>{if(r>0){c=c+1;const S=c%r;i[S]=[E,y]}a=a+1,u=u+y,y<d&&(d=y),y>h&&(h=y)};return Cu({get:()=>oU({error:t,quantiles:p(Date.now()),count:a,min:d,max:h,sum:u}),update:([y,E])=>g(y,E),modify:([y,E])=>g(y,E)})},SU=(e,t,n)=>{const r=n.length;if(!je(t))return cs();const s=t[0],o=t.slice(1),i=D_(e,r,P(),0,s,n),c=Pn(i);return o.forEach(a=>{c.push(D_(e,r,i.value,i.consumed,a,i.rest))}),Ws(c,a=>[a.quantile,a.value])},D_=(e,t,n,r,s,o)=>{let i=e,c=t,a=n,u=r,d=s,h=o,p=e,g=t,y=n,E=r,S=s,_=o;for(;;){if(!je(h))return{quantile:d,value:P(),consumed:u,rest:[]};if(d===1)return{quantile:d,value:F(K$(h)),consumed:u+h.length,rest:[]};const b=Bt(h),C=A1(h,x=>x===b),m=d*c,w=i/2*m,$=u+C[0].length,v=Math.abs($-m);if($<m-w){p=i,g=c,y=Bc(h),E=$,S=d,_=C[1],i=p,c=g,a=y,u=E,d=S,h=_;continue}if($>m+w){const x=qe(a)?F(b):a;return{quantile:d,value:x,consumed:u,rest:h}}switch(a._tag){case"None":{p=i,g=c,y=Bc(h),E=$,S=d,_=C[1],i=p,c=g,a=y,u=E,d=S,h=_;continue}case"Some":{const x=Math.abs(m-a.value);if(v<x){p=i,g=c,y=Bc(h),E=$,S=d,_=C[1],i=p,c=g,a=y,u=E,d=S,h=_;continue}return{quantile:d,value:F(a.value),consumed:u,rest:h}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},_U="effect/MetricPair",wU=Symbol.for(_U),$U={_Type:e=>e},EU=(e,t)=>({[wU]:$U,metricKey:e,metricState:t,pipe(){return N(this,arguments)}}),kU="effect/MetricRegistry",q_=Symbol.for(kU);class CU{[q_]=q_;map=j2();snapshot(){const t=[];for(const[n,r]of this.map)t.push(EU(n,r.get()));return t}get(t){const n=f(this.map,vs(t),Fn);if(n==null){if(Sv(t.keyType))return this.getCounter(t);if(qq(t.keyType))return this.getGauge(t);if(Dq(t.keyType))return this.getFrequency(t);if(_v(t.keyType))return this.getHistogram(t);if(Uq(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=f(this.map,vs(t),Fn);if(n==null){const r=pU(t);f(this.map,vc(t))||f(this.map,Ic(t,r)),n=r}return n}getFrequency(t){let n=f(this.map,vs(t),Fn);if(n==null){const r=gU(t);f(this.map,vc(t))||f(this.map,Ic(t,r)),n=r}return n}getGauge(t){let n=f(this.map,vs(t),Fn);if(n==null){const r=mU(t,t.keyType.bigint?BigInt(0):0);f(this.map,vc(t))||f(this.map,Ic(t,r)),n=r}return n}getHistogram(t){let n=f(this.map,vs(t),Fn);if(n==null){const r=yU(t);f(this.map,vc(t))||f(this.map,Ic(t,r)),n=r}return n}getSummary(t){let n=f(this.map,vs(t),Fn);if(n==null){const r=bU(t);f(this.map,vc(t))||f(this.map,Ic(t,r)),n=r}return n}}const vU=()=>new CU,IU="effect/Metric",TU=Symbol.for(IU),OU={_Type:e=>e,_In:e=>e,_Out:e=>e},U_=te(Symbol.for("effect/Metric/globalMetricRegistry"),()=>vU()),Iv=function(e,t,n,r){const s=Object.assign(o=>Lr(o,i=>xU(s,i)),{[TU]:OU,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return N(this,arguments)}});return s},Yd=(e,t)=>Tv(Kq(e,t)),Tv=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=U_.get(e)),t;let o=n.get(s);return o!==void 0||(o=U_.get(Jq(e,s)),n.set(s,o)),o};return Iv(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},RU=(e,t,n)=>Tv(Hq(e,t,n)),PU=l(3,(e,t,n)=>FU(e,[CL(t,n)])),FU=l(2,(e,t)=>Iv(e.keyType,(n,r)=>e.unsafeUpdate(n,yl(t,r)),n=>e.unsafeValue(yl(t,n)),(n,r)=>e.unsafeModify(n,yl(t,r)))),xU=l(2,(e,t)=>ic(Qp,n=>T(()=>e.unsafeUpdate(t,n)))),MU="effect/Request",AU=Symbol.for(MU),NU={_E:e=>e,_A:e=>e},LU={...km,[AU]:NU},DU=function(){function e(t){t&&Object.assign(this,t)}return e.prototype=LU,e}(),qU=l(2,(e,t)=>ic(uv,n=>T(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,mu(r.result,t))}}))),UU="effect/Supervisor",Xd=Symbol.for(UU),Zy={_T:e=>e};class Zd{underlying;value0;[Xd]=Zy;constructor(t,n){this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new Zd(this,f(this.value,J(t)))}zip(t){return new eh(this,t)}}class eh{left;right;_tag="Zip";[Xd]=Zy;constructor(t,n){this.left=t,this.right=n}get value(){return Nd(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new Zd(this,f(this.value,J(t)))}zip(t){return new eh(this,t)}}const Ov=e=>q(e,Xd)&&Sm(e,"Zip");class jU{effect;[Xd]=Zy;constructor(t){this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new Zd(this,f(this.value,J(t)))}zip(t){return new eh(this,t)}onRun(t,n){return t()}}const zU=e=>new jU(e),th=te("effect/Supervisor/none",()=>zU(ee)),WU=Zi,Rv="Empty",Pv="AddSupervisor",Fv="RemoveSupervisor",xv="AndThen",Vc={_tag:Rv},kl=(e,t)=>({_tag:xv,first:e,second:t}),BU=(e,t)=>KU(t,ke(e)),KU=(e,t)=>{let n=e,r=t;for(;Mr(r);){const s=rr(r);switch(s._tag){case Rv:{r=kr(r);break}case Pv:{n=n.zip(s.supervisor),r=kr(r);break}case Fv:{n=Sg(n,s.supervisor),r=kr(r);break}case xv:{r=Rt(s.first)(Rt(s.second)(kr(r)));break}}}return n},Sg=(e,t)=>W(e,t)?th:Ov(e)?Sg(e.left,t).zip(Sg(e.right,t)):e,Sf=e=>W(e,th)?io():Ov(e)?f(Sf(e.left),la(Sf(e.right))):Ed(e),HU=(e,t)=>{if(W(e,t))return Vc;const n=Sf(e),r=Sf(t),s=f(r,JS(n),fa(Vc,(i,c)=>kl(i,{_tag:Pv,supervisor:c}))),o=f(n,JS(r),fa(Vc,(i,c)=>kl(i,{_tag:Fv,supervisor:c})));return kl(s,o)},JU=WU({empty:Vc,patch:BU,combine:kl,diff:HU}),VU=Yd("effect_fiber_started",{incremental:!0}),j_=Yd("effect_fiber_active"),GU=Yd("effect_fiber_successes",{incremental:!0}),QU=Yd("effect_fiber_failures",{incremental:!0}),YU=PU(RU("effect_fiber_lifetimes",vq({start:.5,factor:2,count:35})),"time_unit","milliseconds"),Oc="Continue",XU="Done",z_="Yield",ZU={_E:e=>e,_A:e=>e},el=e=>{throw new Error(`BUG: FiberRuntime - ${yi(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},yr=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),br=te("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),Rc={[ql]:(e,t,n)=>Pe(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>de(de(n)),[Ul]:(e,t,n)=>Pe(()=>t.effect_instruction_i2(n)),[Em]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),Vr(e.currentRuntimeFlags)&&e.isInterrupted()?me(e.getInterruptedCause()):de(n)),[jl]:(e,t,n)=>(Pe(()=>t.effect_instruction_i2(n)),Pe(()=>t.effect_instruction_i0())?(e.pushStack(t),Pe(()=>t.effect_instruction_i1())):ee),[Wc]:(e,t,n)=>{const r=Pe(()=>t.effect_instruction_i0.next(n));return r.done?de(r.value):(e.pushStack(t),OR(r.value))}},ej={[Vy]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),Vr(t)?me(r.cause):n),[Qy]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Gy]:(e,t,n,r)=>(r.onFiber(e,XC(t)),n),[Yy]:(e,t,n,r)=>k(fu(),()=>n)},tj=e=>ho(ZM(e),t=>Rr(hA(t),([n,r])=>{const s=new Map,o=[];for(const c of r){o.push(fn(c));for(const a of c)s.set(a.request,a)}const i=o.flat();return Oo($j(n.runAll(o),i,()=>i.forEach(c=>{c.listeners.interrupted=!0})),uv,s)},!1,!1)),nj=Jf();class Mv extends Wr{[ZD]=eq;[nq]=ZU;_fiberRefs;_fiberId;_queue=new Array;_children=null;_observers=new Array;_running=!1;_stack=[];_asyncInterruptor=null;_asyncBlockingOn=null;_exitValue=null;_steps=[];_isYielding=!1;currentRuntimeFlags;currentOpCount=0;currentSupervisor;currentScheduler;currentTracer;currentSpan;currentContext;currentDefaultServices;constructor(t,n,r){if(super(),this.currentRuntimeFlags=r,this._fiberId=t,this._fiberRefs=n,XS(r)){const s=this.getFiberRef(Qp);VU.unsafeUpdate(1,s),j_.unsafeUpdate(1,s)}this.refreshRefCache()}commit(){return Li(this)}id(){return this._fiberId}resume(t){this.tell(Wo(t))}get status(){return this.ask((t,n)=>n)}get runtimeFlags(){return this.ask((t,n)=>yD(n)?t.currentRuntimeFlags:n.runtimeFlags)}scope(){return YD(this)}get children(){return this.ask(t=>Array.from(t.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Xu)}fiberRefs(){return this.ask(t=>t.getFiberRefs())}ask(t){return U(()=>{const n=ac(this._fiberId);return this.tell(El((r,s)=>{mu(n,T(()=>t(r,s)))})),jn(n)})}tell(t){this._queue.push(t),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Un(t=>{const n=r=>t(O(r));return this.tell(El((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),T(()=>this.tell(El((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return se((t,n)=>{const r=t.id(),s=t.getFiberRefs(),o=n.runtimeFlags,i=this.getFiberRefs(),c=tL(s,r,i);t.setFiberRefs(c);const a=t.getFiberRef(H_),u=f(ts(o,a),e_(ec),e_(Jp));return Gk(u)})}get poll(){return T(()=>$o(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(t){return T(()=>this.tell(cp(wn(t))))}unsafeInterruptAsFork(t){this.tell(cp(wn(t)))}addObserver(t){this._exitValue!==null?t(this._exitValue):this._observers.push(t)}removeObserver(t){this._observers=this._observers.filter(n=>n!==t)}getFiberRefs(){return this.setFiberRef(H_,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(t){this._fiberRefs=kC(this._fiberRefs,t)}getFiberRef(t){return this._fiberRefs.locals.has(t)?this._fiberRefs.locals.get(t)[0][1]:t.initial}setFiberRef(t,n){this._fiberRefs=tg(this._fiberRefs,{fiberId:this._fiberId,fiberRef:t,value:n}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(lr),this.currentTracer=this.currentDefaultServices.unsafeMap.get(bu.key),this.currentSupervisor=this.getFiberRef(_j),this.currentScheduler=this.getFiberRef(Qd),this.currentContext=this.getFiberRef(Bn),this.currentSpan=this.currentContext.unsafeMap.get(ur.key)}setFiberRefs(t){this._fiberRefs=t,this.refreshRefCache()}addChild(t){this.getChildren().add(t)}removeChild(t){this.getChildren().delete(t)}transferChildren(t){const n=this._children;if(this._children=null,n!==null&&n.size>0)for(const r of n)r._exitValue===null&&t.add(this.currentRuntimeFlags,r)}drainQueueOnCurrentThread(){let t=!0;for(;t;){let n=Oc;const r=globalThis[Hr];globalThis[Hr]=this;try{for(;n===Oc;)n=this._queue.length===0?XU:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Hr]=r}this._queue.length>0&&!this._running?(this._running=!0,n===z_?(this.drainQueueLaterOnExecutor(),t=!1):t=!0):t=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(Ro))}drainQueueWhileRunning(t,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=ej[s._tag](this,t,r,s)}return r}isInterrupted(){return!cy(this.getFiberRef(Xu))}addInterruptedCause(t){const n=this.getFiberRef(Xu);this.setFiberRef(Xu,ut(n,t))}processNewInterruptSignal(t){this.addInterruptedCause(t),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let t=!1;for(const n of this._children)n.tell(cp(wn(this.id()))),t=!0;return t}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const t=this._children.values();this._children=null;let n=!1;return yy({while:()=>!n,body:()=>{const s=t.next();return s.done?T(()=>{n=!0}):on(s.value.await)},step:()=>{}})}return null}reportExitValue(t){if(XS(this.currentRuntimeFlags)){const n=this.getFiberRef(Qp),r=this.id().startTimeMillis,s=Date.now();switch(YU.unsafeUpdate(s-r,n),j_.unsafeUpdate(-1,n),t._tag){case St:{GU.unsafeUpdate(1,n);break}case bt:{QU.unsafeUpdate(1,n);break}}}if(t._tag==="Failure"){const n=this.getFiberRef(Sy);!Rd(t.cause)&&n._tag==="Some"&&this.log("Fiber terminated with an unhandled error",t.cause,n)}}setExitValue(t){this._exitValue=t,this.reportExitValue(t);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](t);this._observers=[]}getLoggers(){return this.getFiberRef(nh)}log(t,n,r){const s=_e(r)?r.value:this.getFiberRef(n2),o=this.getFiberRef(Av);if(dL(o,s))return;const i=this.getFiberRef(r2),c=this.getFiberRef(tC),a=this.getLoggers(),u=this.getFiberRefs();if(Ym(a)>0){const d=Xt(this.getFiberRef(lr),Po),h=new Date(d.unsafeCurrentTimeMillis());LR(u,()=>{for(const p of a)p.log({fiberId:this.id(),logLevel:s,message:t,cause:n,context:u,spans:i,annotations:c,date:h})})}}evaluateMessageWhileSuspended(t){switch(t._tag){case Yy:return z_;case Vy:return this.processNewInterruptSignal(t.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(me(t.cause)),this._asyncInterruptor=null),Oc;case Qy:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(t.effect),Oc;case Gy:return t.onFiber(this,this._exitValue!==null?gD:mD(this.currentRuntimeFlags,this._asyncBlockingOn)),Oc;default:return el(t)}}evaluateEffect(t){this.currentSupervisor.onResume(this);try{let n=Vr(this.currentRuntimeFlags)&&this.isInterrupted()?me(this.getInterruptedCause()):t;for(;n!==null;){const r=n,s=this.runLoop(r);if(s===yr){const o=br.currentOp;br.currentOp=null,o._op===gl?VM(this.currentRuntimeFlags)?(this.tell(JD()),this.tell(Wo(It)),n=null):n=It:o._op===zc&&(n=null)}else{this.currentRuntimeFlags=f(this.currentRuntimeFlags,GM(Jp));const o=this.interruptAllChildren();o!==null?n=k(o,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(Wo(s)),n=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(t){if(this._running)this.tell(Wo(t));else{this._running=!0;const n=globalThis[Hr];globalThis[Hr]=this;try{this.evaluateEffect(t)}finally{this._running=!1,globalThis[Hr]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(t){this.tell(Wo(t))}patchRuntimeFlags(t,n){const r=oi(t,n);return globalThis[Hr]=this,this.currentRuntimeFlags=r,r}initiateAsync(t,n){let r=!1;const s=o=>{r||(r=!0,this.tell(Wo(o)))};Vr(t)&&(this._asyncInterruptor=s);try{n(s)}catch(o){s(ze(Kt(o)))}}pushStack(t){this._stack.push(t),t._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const t=this._stack.pop();if(t)return t._op==="OnStep"&&this._steps.pop(),t}getNextSuccessCont(){let t=this.popStack();for(;t;){if(t._op!==pl)return t;t=this.popStack()}}getNextFailCont(){let t=this.popStack();for(;t;){if(t._op!==ql&&t._op!==jl&&t._op!==Wc)return t;t=this.popStack()}}[DR](t){return T(()=>ld(this.currentContext,t))}Left(t){return Fe(t.left)}None(t){return Fe(new pu)}Right(t){return de(t.right)}Some(t){return de(t.value)}Micro(t){return pa(n=>{let r=n;const s=KD(DD(t,this.currentContext));return s.addObserver(o=>{if(o._tag==="Success")return r(de(o.value));switch(o.cause._tag){case"Interrupt":return r(me(wn(Cn)));case"Fail":return r(Fe(o.cause.error));case"Die":return r(ga(o.cause.defect))}}),pa(o=>{r=i=>{o(ee)},s.unsafeInterrupt()})})}[T$](t){const n=Pe(()=>t.effect_instruction_i0()),r=this.getNextSuccessCont();return r!==void 0?(r._op in Rc||el(r),Rc[r._op](this,r,n)):(br.currentOp=de(n),yr)}[St](t){const n=t,r=this.getNextSuccessCont();return r!==void 0?(r._op in Rc||el(r),Rc[r._op](this,r,n.effect_instruction_i0)):(br.currentOp=n,yr)}[bt](t){const n=t.effect_instruction_i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case pl:case Ul:return Vr(this.currentRuntimeFlags)&&this.isInterrupted()?me(t_(n)):Pe(()=>r.effect_instruction_i1(n));case"OnStep":return Vr(this.currentRuntimeFlags)&&this.isInterrupted()?me(t_(n)):de(me(n));case Em:return this.patchRuntimeFlags(this.currentRuntimeFlags,r.patch),Vr(this.currentRuntimeFlags)&&this.isInterrupted()?me(ut(n,this.getInterruptedCause())):me(n);default:el(r)}else return br.currentOp=me(n),yr}[O$](t){return Pe(()=>t.effect_instruction_i0(this,XC(this.currentRuntimeFlags)))}Blocked(t){const n=this.getFiberRefs(),r=this.currentRuntimeFlags;if(this._steps.length>0){const s=[],o=this._steps[this._steps.length-1];let i=this.popStack();for(;i&&i._op!=="OnStep";)s.push(i),i=this.popStack();this.setFiberRefs(o.refs),this.currentRuntimeFlags=o.flags;const c=Ia(o.refs,n),a=ts(o.flags,r);return de(zk(t.effect_instruction_i0,se(u=>{for(;s.length>0;)u.pushStack(s.pop());return u.setFiberRefs(Ta(u.id(),u.getFiberRefs())(c)),u.currentRuntimeFlags=oi(a)(u.currentRuntimeFlags),t.effect_instruction_i1})))}return Vt(s=>k(qi(PA(t.effect_instruction_i0)),()=>s(t.effect_instruction_i1)))}RunBlocked(t){return tj(t.effect_instruction_i0)}[Gi](t){const n=t.effect_instruction_i0,r=this.currentRuntimeFlags,s=oi(r,n);if(Vr(s)&&this.isInterrupted())return me(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,n),t.effect_instruction_i1){const o=ts(s,r);return this.pushStack(new FA(o,t)),Pe(()=>t.effect_instruction_i1(r))}else return It}[ql](t){return this.pushStack(t),t.effect_instruction_i0}OnStep(t){return this.pushStack(t),t.effect_instruction_i0}[pl](t){return this.pushStack(t),t.effect_instruction_i0}[Ul](t){return this.pushStack(t),t.effect_instruction_i0}[zc](t){return this._asyncBlockingOn=t.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,t.effect_instruction_i0),br.currentOp=t,yr}[gl](t){return this._isYielding=!1,br.currentOp=t,yr}[jl](t){const n=t.effect_instruction_i0,r=t.effect_instruction_i1;return n()?(this.pushStack(t),r()):It}[Wc](t){return Rc[Wc](this,t,void 0)}[Ga](t){return Pe(()=>t.commit())}runLoop(t){let n=t;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&JM)!==0&&this.currentSupervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this.currentRuntimeFlags,n)),!this._isYielding){this.currentOpCount+=1;const r=this.currentScheduler.shouldYield(this);if(r!==!1){this._isYielding=!0,this.currentOpCount=0;const s=n;n=k(fu({priority:r}),()=>s)}}try{if(n=this.currentTracer.context(()=>nj!==n[fo]._V?Gp(`Cannot execute an Effect versioned ${n[fo]._V} with a Runtime of version ${Jf()}`):this[n._op](n),this),n===yr){const r=br.currentOp;return r._op===gl||r._op===zc?yr:(br.currentOp=null,r._op===St||r._op===bt?r:me(Kt(r)))}}catch(r){n!==yr&&!q(n,"_op")||!(n._op in this)?n=Gp(`Not a valid effect: ${yi(n)}`):p2(r)?n=me(ut(Kt(r),wn(Cn))):n=ga(r)}}}run=()=>{this.drainQueueOnCurrentThread()}}const Av=te("effect/FiberRef/currentMinimumLogLevel",()=>$t(hL("Info"))),rj=e=>$u(t=>{const n=Hd(t.context,lr);Xt(n,Bd).unsafe.log(e.log(t))}),Nv=te(Symbol.for("effect/Logger/defaultLogger"),()=>rj(dq)),Lv=te(Symbol.for("effect/Logger/tracerLogger"),()=>$u(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const i=Ur($a(n,Bn),ur);if(i._tag==="None"||i.value._tag==="ExternalSpan")return;const c=ld($a(n,lr),Po),a={};for(const[u,d]of e)a[u]=d;a["effect.fiberId"]=Mx(r),a["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(a["effect.cause"]=bs(t,{renderErrorCause:!0})),i.value.event(yi(Array.isArray(o)?o[0]:o),c.unsafeCurrentTimeNanos(),a)})),nh=te(Symbol.for("effect/FiberRef/currentLoggers"),()=>ZA(Ed(Nv,Lv))),eb=l(e=>mn(e[0]),(e,t)=>zr(Lr(e,n=>Dv(r=>t(n,r))))),Dv=e=>se(t=>{const n=t.getFiberRefs(),r=t.currentRuntimeFlags;return k(jv,s=>ya(s,o=>se(i=>{const c=i.getFiberRefs(),a=i.currentRuntimeFlags,u=Ia(c,n),d=ts(a,r),h=Ia(n,c);return i.setFiberRefs(Ta(u,i.id(),n)),Ui(jA(e(o),d),T(()=>{i.setFiberRefs(Ta(h,i.id(),i.getFiberRefs()))}))})))}),sj=e=>{if(Array.isArray(e)||_m(e))return[e,P()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),F(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},oj=(e,t,n)=>{const r=[];for(const s of e)r.push(Fi(s));return k(Di(r,j,{concurrency:n?.concurrency,batching:n?.batching,concurrentFinalizers:n?.concurrentFinalizers}),s=>{const o=P(),i=s.length,c=new Array(i),a=new Array(i);let u=!1;for(let d=0;d<i;d++){const h=s[d];h._tag==="Left"?(c[d]=F(h.left),u=!0):(a[d]=h.right,c[d]=o)}return u?t._tag==="Some"?Fe(t.value(c)):Fe(c):n?.discard?ee:t._tag==="Some"?O(t.value(a)):O(a)})},ij=(e,t,n)=>{const r=[];for(const s of e)r.push(Fi(s));return n?.discard?Di(r,j,{concurrency:n?.concurrency,batching:n?.batching,discard:!0,concurrentFinalizers:n?.concurrentFinalizers}):J(Di(r,j,{concurrency:n?.concurrency,batching:n?.batching,concurrentFinalizers:n?.concurrentFinalizers}),s=>t._tag==="Some"?t.value(s):s)},rh=(e,t)=>{const[n,r]=sj(e);return t?.mode==="validate"?oj(n,r,t):t?.mode==="either"?ij(n,r,t):t?.discard!==!0&&r._tag==="Some"?J(Di(n,j,t),r.value):Di(n,j,t)},cj=l(2,(e,t)=>Array.from({length:t},()=>e)),aj=l(e=>mn(e[0]),(e,t,n)=>rh(cj(e,t),n)),Di=l(e=>_m(e[0]),(e,t,n)=>se(r=>{const s=n?.batching===!0||n?.batching==="inherit"&&r.getFiberRef(i2);return n?.discard?N_(n.concurrency,()=>Bo(va,n?.concurrentFinalizers)(o=>s?Rr(e,(i,c)=>o(t(i,c)),!0,!1,1):ho(e,(i,c)=>o(t(i,c)))),()=>Bo(cg,n?.concurrentFinalizers)(o=>Rr(e,(i,c)=>o(t(i,c)),s,!1)),o=>Bo(ag(o),n?.concurrentFinalizers)(i=>Rr(e,(c,a)=>i(t(c,a)),s,!1,o))):N_(n?.concurrency,()=>Bo(va,n?.concurrentFinalizers)(o=>s?_g(e,1,(i,c)=>o(t(i,c)),!0):Cr(e,(i,c)=>o(t(i,c)))),()=>Bo(cg,n?.concurrentFinalizers)(o=>tb(e,(i,c)=>o(t(i,c)),s)),o=>Bo(ag(o),n?.concurrentFinalizers)(i=>_g(e,o,(c,a)=>i(t(c,a)),s)))})),tb=(e,t,n)=>U(()=>{const r=ge(e),s=new Array(r.length);return pe(Rr(r,(i,c)=>k(t(i,c),a=>T(()=>s[c]=a)),n,!1),O(s))}),Rr=(e,t,n,r,s)=>Vt(o=>DA(i=>se(c=>{let a=Array.from(e).reverse(),u=a.length;if(u===0)return ee;let d=0,h=!1;const p=s?Math.min(a.length,s):a.length,g=new Set,y=new Array,E=()=>g.forEach(x=>{x.currentScheduler.scheduleTask(()=>{x.unsafeInterruptAsFork(c.id())},0)}),S=new Array,_=new Array,b=new Array,C=()=>{const x=y.filter(({exit:X})=>X._tag==="Failure").sort((X,I)=>X.index<I.index?-1:X.index===I.index?0:1).map(({exit:X})=>X);return x.length===0&&x.push(It),x},m=(x,X=!1)=>{const I=zr(i(x)),A=lj(I,c,c.currentRuntimeFlags,wu);return c.currentScheduler.scheduleTask(()=>{X&&A.unsafeInterruptAsFork(c.id()),A.resume(I)},0),A},w=()=>{r||(u-=a.length,a=[]),h=!0,E()},$=n?MA:Ln,v=m(Un(x=>{const X=(A,Q)=>{A._op==="Blocked"?b.push(A):(y.push({index:Q,exit:A}),A._op==="Failure"&&!h&&w())},I=()=>{if(a.length>0){const A=a.pop();let Q=d++;const oe=()=>{const nt=a.pop();return Q=d++,k(fu(),()=>k($(o(t(nt,Q))),B))},B=nt=>a.length>0&&(X(nt,Q),a.length>0)?oe():O(nt),Ne=k($(o(t(A,Q))),B),Ee=m(Ne);S.push(Ee),g.add(Ee),h&&Ee.currentScheduler.scheduleTask(()=>{Ee.unsafeInterruptAsFork(c.id())},0),Ee.addObserver(nt=>{let dt;if(nt._op==="Failure"?dt=nt:dt=nt.effect_instruction_i0,_.push(Ee),g.delete(Ee),X(dt,Q),y.length===u)x(O(Ue(ii(C(),{parallel:!0}),()=>It)));else if(b.length+y.length===u){const Vn=C(),lR=b.map(kc=>kc.effect_instruction_i0).reduce(Ok);x(O(zk(lR,Rr([Ue(ii(Vn,{parallel:!0}),()=>It),...b.map(kc=>kc.effect_instruction_i1)],kc=>kc,n,!0,s))))}else I()})}};for(let A=0;A<p;A++)I()}));return on(ar(oc(o(Li(v))),jd({onFailure:x=>{w();const X=b.length+1,I=Math.min(typeof s=="number"?s:b.length,b.length),A=Array.from(b);return Un(Q=>{let oe=0,B=0;const Ne=(nt,dt)=>Vn=>{oe++,oe===X&&Q(de(me(x))),A.length>0&&dt&&Ee()},Ee=()=>{m(A.pop(),!0).addObserver(Ne(B,!0)),B++};v.addObserver(Ne(B,!1)),B++;for(let nt=0;nt<I;nt++)Ee()})},onSuccess:()=>Cr(_,x=>x.inheritAll)})))}))),_g=(e,t,n,r)=>U(()=>{const s=ge(e),o=new Array(s.length);return pe(Rr(s,(c,a)=>J(n(c,a),u=>o[a]=u),r,!1,t),O(o))}),uj=e=>se((t,n)=>O(nb(e,t,n.runtimeFlags))),qi=e=>fj(e,wu),nb=(e,t,n,r=null)=>{const s=_f(e,t,n,r);return s.resume(e),s},lj=(e,t,n,r=null)=>_f(e,t,n,r),_f=(e,t,n,r=null)=>{const s=dk(),o=t.getFiberRefs(),i=nL(o,s),c=new Mv(s,i,n),a=$a(i,Bn),u=c.currentSupervisor;return u.onStart(a,e,F(t),c),c.addObserver(h=>u.onEnd(h,c)),(r!==null?r:f(t.getFiberRef(Yp),Ue(()=>t.scope()))).add(n,c),c},fj=(e,t)=>se((n,r)=>O(nb(e,n,r.runtimeFlags,t))),W_=e=>dc(t=>Re(Ur(t,Kn),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return k(Dd(n,cg),r=>xo(e,r))}}})),B_=e=>t=>dc(n=>Re(Ur(n,Kn),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:k(Dd(r,ag(e)),s=>xo(t,s))})),Bo=(e,t)=>n=>dc(r=>Re(Ur(r,Kn),{onNone:()=>n(j),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?W_:e._tag==="Sequential"?K_:B_(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(W_));case"Sequential":return o(n(K_));case"ParallelN":return o(n(B_(s.strategy.parallelism)))}}else return n(j)}})),sh=e=>k(Kn,e),qv=e=>k(gc(),t=>ar(e(t),n=>t.close(n))),Uv=e=>k(gc(),t=>yj(e,t)),K_=e=>dc(t=>Re(Ur(t,Kn),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return k(Dd(n,va),r=>xo(e,r))}}})),dj=l(e=>mn(e[1]),(e,t,n)=>vu(e,t,(r,s)=>[r,s],n)),hj=l(e=>mn(e[1]),(e,t,n)=>n?.concurrent!==!0&&(n?.batching===void 0||n.batching===!1)?ns(e,t):vu(e,t,(r,s)=>r,n)),pj=l(e=>mn(e[1]),(e,t,n)=>n?.concurrent!==!0&&(n?.batching===void 0||n.batching===!1)?pe(e,t):vu(e,t,(r,s)=>s,n)),vu=l(e=>mn(e[1]),(e,t,n,r)=>J(rh([e,t],{concurrency:r?.concurrent?2:1,batching:r?.batching,concurrentFinalizers:r?.concurrentFinalizers}),([s,o])=>n(s,o))),Kn=sn("effect/Scope"),jv=Kn,gj=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.set({},t)},mj={[o_]:o_,[i_]:i_,pipe(){return N(this,arguments)},fork(e){return T(()=>{const t=zv(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n={},r=s=>t.close(s);return this.state.finalizers.set(n,r),gj(t,s=>T(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return U(()=>{if(this.state._tag==="Closed")return ee;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?ee:oD(this.strategy)?f(Cr(t,n=>Ln(n(e))),k(n=>f(ii(n),zs(sp),Ue(()=>It)))):iD(this.strategy)?f(tb(t,n=>Ln(n(e)),!1),k(n=>f(ii(n,{parallel:!0}),zs(sp),Ue(()=>It)))):f(_g(t,this.strategy.parallelism,n=>Ln(n(e)),!1),k(n=>f(ii(n,{parallel:!0}),zs(sp),Ue(()=>It))))})},addFinalizer(e){return U(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.set({},e),ee))}},zv=(e=_u)=>{const t=Object.create(mj);return t.strategy=e,t.state={_tag:"Open",finalizers:new Map},t},gc=(e=_u)=>T(()=>zv(e)),xo=l(2,(e,t)=>vy(e,jr(nu(Kn,t)))),yj=l(2,(e,t)=>f(e,xo(t),ar(n=>t.close(n)))),bj=e=>cc(e,{differ:JU,fork:Vc}),Sj=l(2,(e,t)=>on(eb(k(du(e),n=>tt(af(e,t),n)),n=>af(e,n)))),rb=l(2,(e,t)=>ic(e,n=>Sj(e,t(n)))),H_=t2(QM),_j=bj(th),Wv=l(3,(e,t,n)=>Kv(e,t,{onSelfWin:(r,s)=>k(r.await,o=>{switch(o._tag){case St:return k(r.inheritAll,()=>n.onSelfDone(o,s));case bt:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>k(r.await,o=>{switch(o._tag){case St:return k(r.inheritAll,()=>n.onOtherDone(o,s));case bt:return n.onOtherDone(o,s)}})})),wj=e=>Vt(t=>To(n=>k(qi(t(e)),r=>f(t(Li(r)),Ss(()=>f(r,fv(n))))))),Bv=l(2,(e,t)=>To(n=>Wv(e,t,{onSelfDone:(r,s)=>eg(r,{onFailure:o=>f(Li(s),R_(i=>Nr(o,i))),onSuccess:o=>f(s,vr(n),tt(o))}),onOtherDone:(r,s)=>eg(r,{onFailure:o=>f(Li(s),R_(i=>Nr(i,o))),onSuccess:o=>f(s,vr(n),tt(o))})}))),Kv=l(3,(e,t,n)=>se((r,s)=>{const o=s.runtimeFlags,i=Co(!0),c=_f(e,r,o,n.selfScope),a=_f(t,r,o,n.otherScope);return Un(u=>{c.addObserver(()=>J_(c,a,n.onSelfWin,i,u)),a.addObserver(()=>J_(a,c,n.onOtherWin,i,u)),c.startFork(e),a.startFork(t)},Ks(c.id(),a.id()))})),J_=(e,t,n,r,s)=>{Ex(!0,!1)(r)&&s(n(e,t))},Ui=l(2,(e,t)=>Vt(n=>rn(n(e),{onFailure:r=>rn(t,{onFailure:s=>ze(ut(r,s)),onSuccess:()=>ze(r)}),onSuccess:r=>tt(t,r)}))),$j=(e,t,n)=>To(r=>k(k(qi(xi(e)),s=>Un(o=>{const i=t.map(u=>u.listeners.count),c=()=>{i.every(u=>u===0)&&t.every(u=>u.result.state.current._tag==="Pending"?!0:!!(u.result.state.current._tag==="Done"&&Ud(u.result.state.current.effect)&&u.result.state.current.effect._tag==="Failure"&&ay(u.result.state.current.effect.cause)))&&(a.forEach(u=>u()),n?.(),o(ma(s)))};s.addObserver(u=>{a.forEach(d=>d()),o(u)});const a=t.map((u,d)=>{const h=p=>{i[d]=p,c()};return u.listeners.addObserver(h),()=>u.listeners.removeObserver(h)});return c(),T(()=>{a.forEach(u=>u())})})),()=>U(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return ho(s,o=>qU(o.request,wy(r)))}))),V_=(e,t)=>(t=Or(t),zr(se(n=>{const r=ld(n.getFiberRef(Bn),Kn),s=Uy(n,e,t),o=n.getFiberRef(Ld),i=Xt(n.getFiberRef(lr),Po);return tt(ya(r,c=>hf(s,c,i,o)),s)}))),Ej=e=>rb(lr,Zn(bu,e)),kj=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Or(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return k(V_(t,Or(n)),s=>ka(r,ur,s))}return r=>k(V_(t,Or(n)),s=>ka(r,ur,s))},Cj=Ar,mc=lo,ji=Kt,oh=wn,vj=Nr,Ij=ut,Tj=oy,Hv=mA,Oj=iy,Oa=ay,Js=Rd,Rj=uy,ih=ly,Jv=bA,ch=Nk,sb=l2,Vv=xd,Pj=g2,ah=pu,Gv=bs,Fj="effect/ScheduleInterval",wf=Symbol.for(Fj),Qv={[wf]:wf,startMillis:0,endMillis:0},ob=(e,t)=>e>t?Qv:{[wf]:wf,startMillis:e,endMillis:t},xj=l(2,(e,t)=>Mj(e,t)===e),Mj=l(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),Aj=e=>e.startMillis>=e.endMillis,Nj=l(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return ob(n,r)}),Lj=e=>ca(e.endMillis-e.startMillis),Dj=e=>ob(e,Number.POSITIVE_INFINITY),G_=ob,Yv=Qv,qj=xj,Uj=Aj,jj=Nj,zj=Lj,Wj=Dj,Bj="effect/ScheduleIntervals",Q_=Symbol.for(Bj),Xv=e=>({[Q_]:Q_,intervals:e}),Kj=l(2,(e,t)=>Hj(e.intervals,t.intervals,xe())),Hj=(e,t,n)=>{let r=e,s=t,o=n;for(;Mr(r)&&Mr(s);){const i=f(rr(r),jj(rr(s))),c=Uj(i)?o:f(o,Rt(i));f(rr(r),qj(rr(s)))?r=kr(r):s=kr(s),o=c}return Xv(xr(o))},wg=e=>f(e.intervals,pd,Ue(()=>Yv)).startMillis,Jj=e=>f(e.intervals,pd,Ue(()=>Yv)).endMillis,Vj=l(2,(e,t)=>wg(e)<wg(t)),Gj=e=>Mr(e.intervals),Qj=Xv,Yj=Kj,$g=wg,Eg=Jj,Xj=Vj,Zj=Gj,ib="Continue",Zv="Done",ez=e=>({_tag:ib,intervals:e}),tz=e=>({_tag:ib,intervals:Qj(ke(e))}),nz={_tag:Zv},rz=e=>e._tag===ib,sz=e=>e._tag===Zv,oz=ez,eI=tz,Ra=nz,Y_=rz,Pa=sz,tI=Kn,vn=rC,iz=ya,mt=Xp,uh=xo,cb=Dd,lh=gc,cz=Id,ab=function(){const e=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends _y{constructor(n){super(n?.message,n?.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}.BaseEffectError}(),az=e=>{const t={BaseEffectError:class extends ab{_tag=e}};return t.BaseEffectError.prototype.name=e,t.BaseEffectError},uz="effect/Schedule",nI=Symbol.for(uz),rI=e=>q(e,nI),lz="effect/ScheduleDriver",fz=Symbol.for(lz),dz={_Out:e=>e,_In:e=>e,_R:e=>e},hz={_Out:e=>e,_In:e=>e,_R:e=>e};class pz{initial;step;[nI]=dz;constructor(t,n){this.initial=t,this.step=n}pipe(){return N(this,arguments)}}class gz{schedule;ref;[fz]=hz;constructor(t,n){this.schedule=t,this.ref=n}get state(){return J(rs(this.ref),t=>t[1])}get last(){return k(rs(this.ref),([t,n])=>{switch(t._tag){case"None":return au(()=>new pu);case"Some":return O(t.value)}})}get reset(){return Ea(this.ref,[P(),this.schedule.initial])}next(t){return f(J(rs(this.ref),n=>n[1]),k(n=>f(GN,k(r=>f(U(()=>this.schedule.step(r,t,n)),k(([s,o,i])=>{const c=Ea(this.ref,[F(o),s]);if(Pa(i))return pe(c,Fe(P()));const a=$g(i.intervals)-r;return a<=0?tt(c,o):f(c,pe(qy(ca(a))),tt(o))}))))))}}const yc=(e,t)=>new pz(e,t),sI=l(2,(e,t)=>mz(e,n=>T(()=>t(n)))),mz=l(2,(e,t)=>$z(e,(n,r)=>J(t(n),s=>DF(r,pn(s))))),yz=l(2,(e,t)=>ub(e,(n,r)=>T(()=>t(n,r)))),ub=l(2,(e,t)=>yc(e.initial,(n,r,s)=>k(e.step(n,r,s),([o,i,c])=>Pa(c)?O([o,i,Ra]):J(t(r,i),a=>a?[o,i,c]:[o,i,Ra])))),bz=e=>sI(e,t=>t),oI=e=>f(df([P(),e.initial]),J(t=>new gz(e,t))),Sz=(e,t=2)=>{const n=pn(e);return bz(cI(Iu,r=>LF(n,Math.pow(t,r))))},iI=l(2,(e,t)=>_z(e,t,Yj)),_z=l(3,(e,t,n)=>yc([e.initial,t.initial],(r,s,o)=>f(Qk(e.step(r,s,o[0]),t.step(r,s,o[1]),(i,c)=>[i,c]),k(([[i,c,a],[u,d,h]])=>Y_(a)&&Y_(h)?kg(e,t,s,i,c,a.intervals,u,d,h.intervals,n):O([[i,u],[c,d],Ra]))))),kg=(e,t,n,r,s,o,i,c,a,u)=>{const d=u(o,a);return Zj(d)?O([[r,i],[s,c],oz(d)]):f(o,Xj(a))?k(e.step(Eg(o),n,r),([h,p,g])=>Pa(g)?O([[h,i],[p,c],Ra]):kg(e,t,n,h,p,g.intervals,i,c,a,u)):k(t.step(Eg(a),n,i),([h,p,g])=>Pa(g)?O([[r,h],[s,p],Ra]):kg(e,t,n,r,s,o,h,p,g.intervals,u))},cI=l(2,(e,t)=>wz(e,n=>T(()=>t(n)))),wz=l(2,(e,t)=>yc(e.initial,(n,r,s)=>k(e.step(n,r,s),([o,i,c])=>J(t(i),a=>[o,a,c])))),$z=l(2,(e,t)=>yc(e.initial,(n,r,s)=>k(e.step(n,r,s),([o,i,c])=>{if(Pa(c))return O([o,i,c]);const a=c.intervals,u=zj(G_(n,$g(a)));return J(t(i,u),d=>{const h=pn(d),p=$g(a),g=n+$i(h),y=g-p,E=Math.max(0,Eg(a)+y),S=G_(g,E);return[o,i,eI(S)]})}))),Ez=e=>yc(e.initial,(t,n,r)=>f(e.step(t,n,r),J(([s,o,i])=>[s,n,i]))),aI=e=>vz(Iu,t=>t<e),kz=e=>sI(Iu,()=>e),Cz=(e,t)=>yc(e,(n,r,s)=>T(()=>[t(s),s,eI(Wj(n))])),uI=l(2,(e,t)=>ub(e,(n,r)=>jL(t(n)))),lI=l(2,(e,t)=>ub(e,(n,r)=>t(n))),vz=l(2,(e,t)=>yz(e,(n,r)=>t(r))),Cl=Symbol.for("effect/Schedule/ScheduleDefect");class Iz{error;[Cl];constructor(t){this.error=t,this[Cl]=Cl}}const Tz=e=>q(e,Cl),$f=e=>Pi(e,t=>ga(new Iz(t))),fI=e=>cu(e,t=>Re(Pd(t,n=>iy(n)&&Tz(n.defect)?F(n.defect):P()),{onNone:()=>ze(t),onSome:n=>Fe(n.error)})),X_=l(2,(e,t)=>Rz(e,t,(n,r)=>Fe(n))),Oz=l(2,(e,t)=>{if(rI(t))return X_(e,t);const n=t.schedule??Ez(Iu),r=t.while?lI(n,i=>{const c=t.while(i);return typeof c=="boolean"?O(c):$f(c)}):n,s=t.until?uI(r,i=>{const c=t.until(i);return typeof c=="boolean"?O(c):$f(c)}):r,o=t.times?iI(s,aI(t.times)).pipe(cI(i=>i[0])):s;return fI(X_(e,o))}),Rz=l(3,(e,t,n)=>k(oI(t),r=>cr(e,{onFailure:s=>n(s,P()),onSuccess:s=>dI(e,r,n,s)}))),dI=(e,t,n,r)=>cr(t.next(r),{onFailure:()=>my(t.last),onSuccess:s=>cr(e,{onFailure:o=>n(o,F(s)),onSuccess:o=>dI(e,t,n,o)})}),Z_=l(2,(e,t)=>Fz(e,t,(n,r)=>Fe(n))),Pz=l(2,(e,t)=>{if(rI(t))return Z_(e,t);const n=t.schedule??Iu,r=t.while?lI(n,i=>{const c=t.while(i);return typeof c=="boolean"?O(c):$f(c)}):n,s=t.until?uI(r,i=>{const c=t.until(i);return typeof c=="boolean"?O(c):$f(c)}):r,o=t.times?iI(s,aI(t.times)):s;return fI(Z_(e,o))}),Fz=l(3,(e,t,n)=>k(oI(t),r=>hI(e,r,n))),hI=(e,t,n)=>Pi(e,r=>cr(t.next(r),{onFailure:()=>f(t.last,my,k(s=>n(r,s))),onSuccess:()=>hI(e,t,n)})),Iu=Cz(0,e=>e+1);class xz{permits;waiters=new Set;taken=0;constructor(t){this.permits=t}get free(){return this.permits-this.taken}take=t=>Qr(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(O(t)))};return this.waiters.add(r),T(()=>{this.waiters.delete(r)})}return this.taken+=t,n(O(t))});updateTaken=t=>se(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(Qd).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(Ro)),O(this.free)));release=t=>this.updateTaken(n=>n-t);releaseAll=this.updateTaken(t=>0);withPermits=t=>n=>Vt(r=>k(r(this.take(t)),s=>Ui(r(n),this.release(s))));withPermitsIfAvailable=t=>n=>Vt(r=>U(()=>this.free<t?Ca:(this.taken+=t,Ui(r(TL(n)),this.release(t)))))}const Gc=e=>new xz(e),Mz=e=>T(()=>Gc(e));class Az extends Wr{isOpen;waiters=[];scheduled=!1;constructor(t){super(),this.isOpen=t}commit(){return this.await}unsafeSchedule(t){return this.scheduled||this.waiters.length===0||(this.scheduled=!0,t.currentScheduler.scheduleTask(this.flushWaiters,t.getFiberRef(Ro))),ee}flushWaiters=()=>{this.scheduled=!1;const t=this.waiters;this.waiters=[];for(let n=0;n<t.length;n++)t[n](It)};open=se(t=>this.isOpen?ee:(this.isOpen=!0,this.unsafeSchedule(t)));unsafeOpen(){this.isOpen||(this.isOpen=!0,this.flushWaiters())}release=se(t=>this.isOpen?ee:this.unsafeSchedule(t));await=Qr(t=>this.isOpen?t(ee):(this.waiters.push(t),T(()=>{const n=this.waiters.indexOf(t);n!==-1&&this.waiters.splice(n,1)})));unsafeClose(){this.isOpen=!1}close=T(()=>{this.isOpen=!1});whenOpen=t=>pe(this.await,t)}const pI=e=>new Az(e??!1),Ef=l(2,(e,t)=>se((n,r)=>{const s=t,o=nb(e,n,r.runtimeFlags,wu);if(s.state._tag==="Open"){const i=()=>To(a=>W(a,o.id())?ee:on(ma(o))),c={};s.state.finalizers.set(c,i),o.addObserver(()=>{s.state._tag!=="Closed"&&s.state.finalizers.delete(c)})}else o.unsafeInterruptAsFork(n.id());return O(o)})),Nz=e=>sh(t=>Ef(e,t)),Lz=l(2,(e,t)=>f(Ln(e),Bv(Ln(t)),n=>oc(n))),Dz=l(2,(e,t)=>qz(e,{onTimeout:()=>y2(t),duration:t})),qz=l(2,(e,{duration:t,onTimeout:n})=>oc(Uz(e,{onTimeout:()=>au(n),onSuccess:O,duration:t}))),Uz=l(2,(e,{duration:t,onSuccess:n,onTimeout:r})=>To(s=>Vt(o=>Kv(o(e),xi(qy(t)),{onSelfWin:(i,c)=>k(i.await,a=>a._tag==="Success"?k(i.inheritAll,()=>tt(vr(c,s),n(a.value))):k(vr(c,s),()=>me(a.cause))),onOtherWin:(i,c)=>k(i.await,a=>a._tag==="Success"?k(i.inheritAll,()=>tt(vr(c,s),r())):k(vr(c,s),()=>me(a.cause))),otherScope:wu})))),jz="effect/Ref/SynchronizedRef",gI=Symbol.for(jz),mI={_A:e=>e};class zz extends Wr{ref;withLock;[gI]=mI;[Ay]=Ny;[Ai]=Ai;constructor(t,n){super(),this.ref=t,this.withLock=n,this.get=rs(this.ref)}get;commit(){return this.get}modify(t){return this.modifyEffect(n=>O(t(n)))}modifyEffect(t){return this.withLock(f(k(rs(this.ref),t),k(([n,r])=>tt(Ea(this.ref,r),n))))}}const Wz=e=>T(()=>yI(e)),yI=e=>{const t=OC(e),n=Gc(1);return new zz(t,n.withPermits(1))},Bz=Symbol.for("effect/ManagedRuntime"),Kz="Fold",Hz="Fresh",Jz="FromEffect",Vz="Scoped",Gz="Suspend",Qz="Provide",Yz="ProvideMerge",Xz="ZipWith",bI=lv,Zz=oq,ew=rq,Zt=ma,SI=vr,eW=sq,tw=Li,Tu=e=>function(){if(arguments.length===1){const t=arguments[0];return(n,...r)=>e(t,n,...r)}return e.apply(this,arguments)},fh=Tu((e,t,n)=>{const r=dk(),s=[[Bn,[[r,e.context]]]];n?.scheduler&&s.push([Qd,[[r,n.scheduler]]]);let o=sL(e.fiberRefs,{entries:s,forkAs:r});n?.updateRefs&&(o=n.updateRefs(o,r));const i=new Mv(r,o,e.runtimeFlags);let c=t;n?.scope&&(c=k(cb(n.scope,_u),u=>pe(rC(u,To(d=>W(d,i.id())?ee:vr(i,d))),ar(t,d=>mt(u,d)))));const a=i.currentSupervisor;return a!==th&&(a.onStart(e.context,c,P(),i),i.addObserver(u=>a.onEnd(u,i))),wu.add(e.runtimeFlags,i),n?.immediate===!1?i.resume(c):i.start(c),i}),tW=Tu((e,t)=>{const n=oW(e)(t);if(n._tag==="Failure")throw _I(n.effect_instruction_i0);return n.effect_instruction_i0});class nW extends Error{fiber;_tag="AsyncFiberException";constructor(t){super(`Fiber #${t.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`),this.fiber=t,this.name=this._tag,this.stack=this.message}}const rW=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new nW(e);return Error.stackTraceLimit=t,n},ap=Symbol.for("effect/Runtime/FiberFailure"),tl=Symbol.for("effect/Runtime/FiberFailure/Cause");class sW extends Error{[ap];[tl];constructor(t){const n=qk(t)[0];super(n?.message||"An error has occurred"),this[ap]=ap,this[tl]=t,this.name=n?`(FiberFailure) ${n.name}`:"FiberFailure",n?.stack&&(this.stack=n.stack)}toJSON(){return{_id:"FiberFailure",cause:this[tl].toJSON()}}toString(){return"(FiberFailure) "+bs(this[tl],{renderErrorCause:!0})}[fe](){return this.toString()}}const _I=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new sW(e);return Error.stackTraceLimit=t,n},wI=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return ba(t.left);case"Right":return de(t.right);case"Some":return de(t.value);case"None":return ba(pu())}},oW=Tu((e,t)=>{const n=wI(t);if(n)return n;const r=new av,s=fh(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||Yo(dy(rW(s),Iy(s)))}),iW=Tu((e,t,n)=>$I(e,t,n).then(r=>{switch(r._tag){case St:return r.effect_instruction_i0;case bt:throw _I(r.effect_instruction_i0)}})),$I=Tu((e,t,n)=>new Promise(r=>{const s=wI(t);s&&r(s);const o=fh(e)(t);o.addObserver(i=>{r(i)}),n?.signal!==void 0&&(n.signal.aborted?o.unsafeInterruptAsFork(o.id()):n.signal.addEventListener("abort",()=>{o.unsafeInterruptAsFork(o.id())},{once:!0}))}));class EI{context;runtimeFlags;fiberRefs;constructor(t,n,r){this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return N(this,arguments)}}const kI=e=>new EI(e.context,e.runtimeFlags,e.fiberRefs),cW=()=>se((e,t)=>O(new EI(e.getFiberRef(Bn),t.runtimeFlags,e.getFiberRefs()))),aW=Ik(ec,Ck,kk),Fa=kI({context:as(),runtimeFlags:aW,fiberRefs:oL()}),uW=l(2,(e,t)=>kI({context:t(e.context),runtimeFlags:e.runtimeFlags,fiberRefs:e.fiberRefs})),lW=fh(Fa),fW=iW(Fa),dW=tW(Fa),hW=l(2,(e,t)=>e.modifyEffect(t)),pW="effect/Layer",CI=Symbol.for(pW),gW={_RIn:e=>e,_E:e=>e,_ROut:e=>e},mo={[CI]:gW,pipe(){return N(this,arguments)}},mW="effect/Layer/MemoMap",up=Symbol.for(mW),yW=Xi()("effect/Layer/CurrentMemoMap",{defaultValue:()=>_W()}),vI=e=>q(e,CI),bW=e=>e._op_layer===Hz;class II{ref;[up];constructor(t){this.ref=t,this[up]=up}getOrElseMemoize(t,n){return f(hW(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,i]=s,c=f(o,k(([a,u])=>f(KC(a),tt(u))),ar(jd({onFailure:()=>ee,onSuccess:()=>ya(n,i)})));return O([c,r])}return f(df(0),k(o=>f(uc(),k(i=>f(df(()=>ee),J(c=>{const a=Vt(d=>f(gc(),k(h=>f(d(k(TI(t,h,!0),p=>ML(p(this)))),Ln,k(p=>{switch(p._tag){case bt:return f(aC(i,p.effect_instruction_i0),pe(Xp(h,p)),pe(ze(p.effect_instruction_i0)));case St:return f(Ea(c,g=>f(Xp(h,g),lu(RC(o,y=>[y===1,y-1])),on)),pe(rg(o,g=>g+1)),pe(ya(n,g=>f(T(()=>r.delete(t)),pe(rs(c)),k(y=>y(g))))),pe(gu(i,p.effect_instruction_i0)),tt(p.effect_instruction_i0[1]))}}))))),u=[f(jn(i),ar(eg({onFailure:()=>ee,onSuccess:()=>rg(o,d=>d+1)}))),d=>f(rs(c),k(h=>h(d)))];return[a,bW(t)?r:r.set(t,u)]}))))))}),oc)}}const SW=U(()=>J(Wz(new Map),e=>new II(e))),_W=()=>new II(yI(new Map)),wW=e=>sh(t=>Ou(e,t)),Ou=l(2,(e,t)=>k(SW,n=>$W(e,n,t))),$W=l(3,(e,t,n)=>k(TI(e,n),r=>ka(r(t),yW,t))),TI=(e,t,n=!1)=>{const r=e;switch(r._op_layer){case"Locally":return T(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return T(()=>s=>sh(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return T(()=>s=>f(s.getOrElseMemoize(r.layer,t),rn({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return T(()=>s=>f(r.layer,Ou(t)));case"FromEffect":return T(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return T(()=>s=>f(s.getOrElseMemoize(r.first,t),k(o=>f(s.getOrElseMemoize(r.second,t),ky(o)))));case"Scoped":return T(n?()=>s=>xo(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return T(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return T(()=>s=>f(s.getOrElseMemoize(r.first,t),Qk(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return T(()=>s=>f(s.getOrElseMemoize(r.first,t),vu(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},EW=()=>Ru(fc()),kW=e=>OI(mc(e)),OI=e=>Ru(ze(e)),lb=l(2,(e,t)=>IW(e,{onFailure:kW,onSuccess:t})),RI=l(2,(e,t)=>{const n=ud(e),r=n?e:t;return Ru(J(n?t:e,o=>nu(r,o)))});function Ru(e){const t=Object.create(mo);return t._op_layer=Jz,t.effect=e,t}const CW=e=>Uv(pe(sh(t=>f(e,Ou(t))),zA)),vW=l(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(mo);return r._op_layer=Kz,r.layer=e,r.failureK=t,r.successK=n,r}),IW=l(2,(e,{onFailure:t,onSuccess:n})=>vW(e,{onFailure:r=>{const s=ih(r);switch(s._tag){case"Left":return t(s.left);case"Right":return OI(s.right)}},onSuccess:n})),PI=l(2,(e,t)=>PW(e,t,(n,r)=>jr(n,r))),FI=(...e)=>{let t=e[0];for(let n=1;n<e.length;n++)t=PI(t,e[n]);return t},xI=l(2,(e,t)=>{const n=ud(e),r=n?e:t;return MI(J(n?t:e,o=>nu(r,o)))}),dh=e=>MI(f(e,tt(as()))),MI=e=>{const t=Object.create(mo);return t._op_layer=Vz,t.effect=e,t},TW=l(2,(e,t)=>{const n=ud(e);return Ru(O(nu(n?e:t,n?t:e)))}),AI=e=>{const t=Object.create(mo);return t._op_layer=Gz,t.evaluate=e,t},OW=l(2,(e,t)=>{const n=ud(e),r=n?e:t,s=n?t:e;return Ru(T(()=>nu(r,s())))}),RW=l(2,(e,t)=>AI(()=>{const n=Object.create(mo);return n._op_layer=Qz,n.first=Object.create(mo,{_op_layer:{value:Yz,enumerable:!0},first:{value:EW(),enumerable:!0},second:{value:Array.isArray(t)?FI(...t):t},zipK:{value:(r,s)=>f(r,jr(s))}}),n.second=e,n})),PW=l(3,(e,t,n)=>AI(()=>{const r=Object.create(mo);return r._op_layer=Xz,r.first=e,r.second=t,r.zipK=n,r})),FW=e=>{const t=sn("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return lb(RI(t,e),n=>Xt(n,t))},xW=e=>{const t=sn("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return lb(xI(t,e),n=>Xt(n,t))},nw=l(2,(e,t)=>qv(n=>k(Ou(t,n),r=>Cy(e,r)))),rw=l(2,(e,t)=>{const n=Ia(Fa.fiberRefs,t.fiberRefs),r=ts(Fa.runtimeFlags,t.runtimeFlags);return Vt(s=>se(o=>{const i=o.getFiberRef(Bn),c=o.getFiberRefs(),a=Ta(o.id(),c)(n),u=o.currentRuntimeFlags,d=oi(r)(u),h=Ia(a,c),p=ts(d,u);return o.setFiberRefs(a),o.currentRuntimeFlags=d,Ui(Cy(s(e),jr(i,t.context)),se(g=>(g.setFiberRefs(Ta(g.id(),g.getFiberRefs())(h)),g.currentRuntimeFlags=oi(p)(g.currentRuntimeFlags),ee)))}))}),MW=l(2,(e,t)=>Array.isArray(t)?nw(e,FI(...t)):vI(t)?nw(e,t):hF(t)?Cy(e,t):Bz in t?k(t.runtimeEffect,n=>rw(e,n)):rw(e,t)),AW=DU,sw=fo,pr=mn,lp=UL,fb=rh,wt=Di,NW=Un,fs=se,zn=Fe,Ht=ze,zi=ga,NI=Gp,L=qA,LW=WL,Se=O,ve=U,Z=T,ne=ee,DW=fu,db=Pi,ds=cu,LI=OL,qW=Hk,fp=RL,DI=PL,UW=WC,hb=NL,pb=Pz,Pu=qC,jW=VL,Qc=JL,zW=wj,Gr=rt,at=xi,qI=Ss,Xo=zr,hs=Vt,Pr=tt,Fu=on,ie=J,UI=gy,fr=Ad,st=eb,jI=fy,gr=Dv,Ms=Ui,zI=AA,WW=ar,hh=jv,Cg=qv,yo=Uv,WI=To,gb=uj,BI=qi,en=Ef,gn=Nz,BW=xL,mb=qy,yb=Dz,KI=fc,KW=vy,dn=MW,ai=ka,HW=YL,JW=XL,Ko=Fi,Ze=Ln,ph=py,VW=QL,D=k,ui=xA,Is=oc,dp=Bv,HI=Lz,JI=Wv,Dn=Lr,bc=BL,bb=Dy,ow=Oz,GW=by,QW=jC,xa=Vk,$n=rn,YW=cr,VI=LL,_n=BC,or=DL,vg=qL,Vs=IL,XW=c2,er=my,ws=cW,Sb=Mz,ZW=pI,$s=lW,GI=fW,os=dW,Ig=dj,_b=hj,Ie=pj,gh=vu,eB=HL,Tg=ZL,wb=JC,tB=eD,nB=og,Ct=tD,$b=kj,As=ig,Eb=function(e,...t){const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;if(Error.stackTraceLimit=n,typeof e!="string")return iw(e.length,function(...i){const c=Error.stackTraceLimit;Error.stackTraceLimit=2;const a=new Error;return Error.stackTraceLimit=c,cw({self:this,body:e,args:i,pipeables:t,spanName:"<anonymous>",spanOptions:{context:ff.context(!0)},errorDef:r,errorCall:a})});const s=e,o=t[0];return(i,...c)=>iw(i.length,{[s](...a){const u=Error.stackTraceLimit;Error.stackTraceLimit=2;const d=new Error;return Error.stackTraceLimit=u,cw({self:this,body:i,args:a,pipeables:c,spanName:s,spanOptions:o,errorDef:r,errorCall:d})}}[s])};function iw(e,t){return Object.defineProperty(t,"length",{value:e,configurable:!0})}function cw(e){let t,n;if(xR(e.body))t=cf(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(i){n=i,t=zi(i)}if(e.pipeables.length>0)try{for(const i of e.pipeables)t=i(t,...e.args)}catch(i){t=n?Ht(ut(Kt(n),Kt(i))):zi(i)}let r=!1;const s=()=>{if(r!==!1)return r;if(e.errorCall.stack){const i=e.errorDef.stack.trim().split(`
`),c=e.errorCall.stack.trim().split(`
`);let a=i.slice(2).join(`
`).trim();a.includes("(")||(a=a.replace(/at (.*)/,"at ($1)"));let u=c.slice(2).join(`
`).trim();return u.includes("(")||(u=u.replace(/at (.*)/,"at ($1)")),r=`${a}
${u}`,r}},o=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:s,...e.spanOptions};return Ct(t,e.spanName,o)}const Og=UA,kb=$t,rB=du,sB=ic,Cb=Bn,oB=Ro,iB=nh,QI=Qd,cB=nC,aB=Ld,uB=l(2,(e,t)=>Oo(Av,t)(e)),lB=e=>dh(rb(nh,si(e))),fB=e=>dh(rb(nh,Xm(e))),dB=l(2,(e,t)=>lb(fB(e),()=>lB(t))),hB=e=>dh(Ej(e)),pB=vI,gB=wW,mB=Ou,vb=RI,yB=CW,bB=PI,SB=xI,_B=dh,YI=TW,wB=OW,Ib=RW,$B=FW,EB=xW,kB=hB,CB="effect/QueueEnqueue",XI=Symbol.for(CB),vB="effect/QueueDequeue",Tb=Symbol.for(vB),IB="effect/QueueStrategy",Ob=Symbol.for(IB),TB="effect/BackingQueue",OB=Symbol.for(TB),Rb={_A:e=>e},RB={_A:e=>e},ZI={_In:e=>e},Pb={_Out:e=>e};class PB extends Wr{queue;takers;shutdownHook;shutdownFlag;strategy;[XI]=ZI;[Tb]=Pb;constructor(t,n,r,s,o){super(),this.queue=t,this.takers=n,this.shutdownHook=r,this.shutdownFlag=s,this.strategy=o}pipe(){return N(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return U(()=>Pi(this.unsafeSize(),()=>rt))}unsafeSize(){return le(this.shutdownFlag)?P():F(this.queue.length()-Py(this.takers)+this.strategy.surplusSize())}get isEmpty(){return J(this.size,t=>t<=0)}get isFull(){return J(this.size,t=>t>=this.capacity())}get shutdown(){return zr(se(t=>(f(this.shutdownFlag,vo(!0)),f(Rr(li(this.takers),n=>Ey(n,t.id()),!1,!1),pe(this.strategy.shutdown),lu(gu(this.shutdownHook,void 0)),on))))}get isShutdown(){return T(()=>le(this.shutdownFlag))}get awaitShutdown(){return jn(this.shutdownHook)}isActive(){return!le(this.shutdownFlag)}unsafeOffer(t){if(le(this.shutdownFlag))return!1;let n;if(this.queue.length()===0){const s=f(this.takers,Tr(Xe));s!==Xe?(Gs(s,t),n=!0):n=!1}else n=!1;if(n)return!0;const r=this.queue.offer(t);return Ns(this.strategy,this.queue,this.takers),r}offer(t){return U(()=>{if(le(this.shutdownFlag))return rt;let n;if(this.queue.length()===0){const s=f(this.takers,Tr(Xe));s!==Xe?(Gs(s,t),n=!0):n=!1}else n=!1;if(n)return O(!0);const r=this.queue.offer(t);return Ns(this.strategy,this.queue,this.takers),r?O(!0):this.strategy.handleSurplus([t],this.queue,this.takers,this.shutdownFlag)})}offerAll(t){return U(()=>{if(le(this.shutdownFlag))return rt;const n=ge(t),r=this.queue.length()===0?ge(QB(this.takers,n.length)):cs,[s,o]=f(n,J$(r.length));for(let c=0;c<r.length;c++){const a=r[c],u=s[c];Gs(a,u)}if(o.length===0)return O(!0);const i=this.queue.offerAll(o);return Ns(this.strategy,this.queue,this.takers),hd(i)?O(!0):this.strategy.handleSurplus(i,this.queue,this.takers,this.shutdownFlag)})}get take(){return se(t=>{if(le(this.shutdownFlag))return rt;const n=this.queue.poll(Xe);if(n!==Xe)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),O(n);{const r=ac(t.id());return f(U(()=>(f(this.takers,Mi(r)),Ns(this.strategy,this.queue,this.takers),le(this.shutdownFlag)?rt:jn(r))),Ss(()=>T(()=>YB(this.takers,r))))}})}get takeAll(){return U(()=>le(this.shutdownFlag)?rt:T(()=>{const t=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),so(t)}))}takeUpTo(t){return U(()=>le(this.shutdownFlag)?rt:T(()=>{const n=this.queue.pollUpTo(t);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),so(n)}))}takeBetween(t,n){return U(()=>eT(this,t,n,xe()))}}const eT=(e,t,n,r)=>n<t?O(r):f(WB(e,n),k(s=>{const o=t-s.length;return o===1?f(Rg(e),J(i=>f(r,Me(s),ia(i)))):o>1?f(Rg(e),k(i=>eT(e,o-1,n-s.length-1,f(r,Me(s),ia(i))))):O(f(r,Me(s)))})),FB=e=>f(T(()=>Ry(e)),k(t=>mh(yh(t),KB()))),xB=e=>f(T(()=>Ry(e)),k(t=>mh(yh(t),tT()))),MB=e=>f(T(()=>Ry(e)),k(t=>mh(yh(t),HB()))),Fb=()=>f(T(()=>zd()),k(e=>mh(yh(e),tT()))),AB=(e,t,n,r,s)=>new PB(e,t,n,r,s),mh=(e,t)=>f(uc(),J(n=>AB(e,zd(),n,Co(!1),t)));class NB{mutable;[OB]=RB;constructor(t){this.mutable=t}poll(t){return Tr(this.mutable,t)}pollUpTo(t){return Wd(this.mutable,t)}offerAll(t){return Fy(this.mutable,t)}offer(t){return Mi(this.mutable,t)}capacity(){return Y2(this.mutable)}length(){return Py(this.mutable)}}const yh=e=>new NB(e),LB=e=>e.size,DB=e=>e.isShutdown,qB=e=>e.shutdown,UB=l(2,(e,t)=>e.offer(t)),jB=l(2,(e,t)=>e.offerAll(t)),Rg=e=>e.take,zB=e=>e.takeAll,WB=l(2,(e,t)=>e.takeUpTo(t)),BB=l(3,(e,t,n)=>e.takeBetween(t,n)),KB=()=>new JB,tT=()=>new VB,HB=()=>new GB;class JB{[Ob]=Rb;putters=zd();surplusSize(){return Py(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!Hs(this.putters)&&!Hs(t);){const n=Tr(t,void 0),r=Tr(this.putters,void 0);r[2]&&Gs(r[1],!0),Gs(n,r[0])}}get shutdown(){return f(uu,k(t=>f(T(()=>li(this.putters)),k(n=>Rr(n,([r,s,o])=>o?f(Ey(s,t),on):ee,!1,!1)))))}handleSurplus(t,n,r,s){return se(o=>{const i=ac(o.id());return f(U(()=>(this.unsafeOffer(t,i),this.unsafeOnQueueEmptySpace(n,r),Ns(this,n,r),le(s)?rt:jn(i))),Ss(()=>T(()=>this.unsafeRemove(i))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=f(this.putters,Tr(Xe));if(s===Xe)r=!1;else{const o=t.offer(s[0]);o&&s[2]?Gs(s[1],!0):o||kf(this.putters,f(li(this.putters),Rt(s))),Ns(this,t,n)}}}unsafeOffer(t,n){const r=ge(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?f(this.putters,Mi([o,n,!0])):f(this.putters,Mi([o,n,!1]))}}unsafeRemove(t){kf(this.putters,f(li(this.putters),dd(([,n])=>n!==t)))}}let VB=class{[Ob]=Rb;surplusSize(){return 0}get shutdown(){return ee}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return O(!1)}unsafeOnQueueEmptySpace(t,n){}};class GB{[Ob]=Rb;surplusSize(){return 0}get shutdown(){return ee}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return T(()=>(this.unsafeOffer(n,t),Ns(this,n,r),!0))}unsafeOnQueueEmptySpace(t,n){}unsafeOffer(t,n){const r=n[Symbol.iterator]();let s,o=!0;for(;!(s=r.next()).done&&o;){if(t.capacity()===0)return;t.poll(Xe),o=t.offer(s.value)}}}const Gs=(e,t)=>mu(e,O(t)),kf=(e,t)=>f(e,Fy(t)),li=e=>f(e,Wd(Number.POSITIVE_INFINITY)),QB=(e,t)=>f(e,Wd(t)),YB=(e,t)=>{kf(e,f(li(e),dd(n=>t!==n)))},Ns=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=f(n,Tr(Xe));if(s!==Xe){const o=t.poll(Xe);o!==Xe?(Gs(s,o),e.unsafeOnQueueEmptySpace(t,n)):kf(n,f(li(n),Rt(s))),r=!0}else r=!1}r&&t.length()===0&&!Hs(n)&&e.onCompleteTakersWithEmptyQueue(n)},Xn=Symbol.for("effect/PubSub/AbsentValue"),nT=(e,t)=>n=>{n.has(e)||n.set(e,new Set),n.get(e).add(t)},XB=(e,t)=>n=>{if(!n.has(e))return;const r=n.get(e);r.delete(t),r.size===0&&n.delete(e)},ZB=e=>U(()=>{const t=rK(e);return lK(t,new yK)}),eK=e=>e.shutdown,tK=l(2,(e,t)=>e.publish(t)),nK=e=>e.subscribe,rK=e=>new iK(e?.replay?new _K(e.replay):void 0),sK=(e,t,n)=>J(uc(),r=>oK(e,t,e.subscribe(),zd(),r,Co(!1),n)),oK=(e,t,n,r,s,o,i)=>new aK(e,t,n,r,s,o,i,e.replayWindow());class iK{replayBuffer;publisherHead={value:Xn,subscribers:0,next:null};publisherTail=this.publisherHead;publisherIndex=0;subscribersIndex=0;capacity=Number.MAX_SAFE_INTEGER;constructor(t){this.replayBuffer=t}replayWindow(){return this.replayBuffer?new wK(this.replayBuffer):$K}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const n=this.publisherTail.subscribers;return n!==0&&(this.publisherTail.next={value:t,subscribers:n,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const n of t)this.publish(n);else this.replayBuffer&&this.replayBuffer.offerAll(t);return xe()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=Xn,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new cK(this,this.publisherTail,this.publisherIndex,!1)}}class cK{self;subscriberHead;subscriberIndex;unsubscribed;constructor(t,n,r,s){this.self=t,this.subscriberHead=n,this.subscriberIndex=r,this.unsubscribed=s}isEmpty(){if(this.unsubscribed)return!0;let t=!0,n=!0;for(;n;)this.subscriberHead===this.self.publisherTail?n=!1:this.subscriberHead.next.value!==Xn?(t=!1,n=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let n=!0,r=t;for(;n;)if(this.subscriberHead===this.self.publisherTail)n=!1;else{const s=this.subscriberHead.next.value;s!==Xn&&(r=s,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Xn,this.self.subscribersIndex+=1),n=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const n=[],r=Xn;let s=0;for(;s!==t;){const o=this.poll(r);o===r?s=t:(n.push(o),s+=1)}return so(n)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==Xn&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=Xn,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}class aK extends Wr{pubsub;subscribers;subscription;pollers;shutdownHook;shutdownFlag;strategy;replayWindow;[Tb]=Pb;constructor(t,n,r,s,o,i,c,a){super(),this.pubsub=t,this.subscribers=n,this.subscription=r,this.pollers=s,this.shutdownHook=o,this.shutdownFlag=i,this.strategy=c,this.replayWindow=a}commit(){return this.take}pipe(){return N(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!le(this.shutdownFlag)}get size(){return U(()=>le(this.shutdownFlag)?rt:O(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return le(this.shutdownFlag)?P():F(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return U(()=>le(this.shutdownFlag)?rt:O(this.subscription.size()===this.capacity()))}get isEmpty(){return J(this.size,t=>t===0)}get shutdown(){return zr(se(t=>(vo(this.shutdownFlag,!0),f(tb(xb(this.pollers),n=>Ey(n,t.id()),!1),pe(T(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),lu(gu(this.shutdownHook,void 0)),on))))}get isShutdown(){return T(()=>le(this.shutdownFlag))}get awaitShutdown(){return jn(this.shutdownHook)}get take(){return se(t=>{if(le(this.shutdownFlag))return rt;if(this.replayWindow.remaining>0){const r=this.replayWindow.take();return O(r)}const n=Hs(this.pollers)?this.subscription.poll(Xe):Xe;if(n===Xe){const r=ac(t.id());return f(U(()=>(f(this.pollers,Mi(r)),f(this.subscribers,nT(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),le(this.shutdownFlag)?rt:jn(r))),Ss(()=>T(()=>mK(this.pollers,r))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),O(n)})}get takeAll(){return U(()=>{if(le(this.shutdownFlag))return rt;const t=Hs(this.pollers)?hK(this.subscription):xe();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?O(Me(this.replayWindow.takeAll(),t)):O(t)})}takeUpTo(t){return U(()=>{if(le(this.shutdownFlag))return rt;let n;if(this.replayWindow.remaining>=t){const s=this.replayWindow.takeN(t);return O(s)}else this.replayWindow.remaining>0&&(n=this.replayWindow.takeAll(),t=t-n.length);const r=Hs(this.pollers)?pK(this.subscription,t):xe();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),O(n?Me(n,r):r)})}takeBetween(t,n){return U(()=>rT(this,t,n,xe()))}}const rT=(e,t,n,r)=>n<t?O(r):f(e.takeUpTo(n),k(s=>{const o=t-s.length;return o===1?f(e.take,J(i=>f(r,Me(s),ia(i)))):o>1?f(e.take,k(i=>rT(e,o-1,n-s.length-1,f(r,Me(s),ia(i))))):O(f(r,Me(s)))}));class uK{pubsub;subscribers;scope;shutdownHook;shutdownFlag;strategy;[XI]=ZI;[Tb]=Pb;constructor(t,n,r,s,o,i){this.pubsub=t,this.subscribers=n,this.scope=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=i}capacity(){return this.pubsub.capacity}get size(){return U(()=>le(this.shutdownFlag)?rt:T(()=>this.pubsub.size()))}unsafeSize(){return le(this.shutdownFlag)?P():F(this.pubsub.size())}get isFull(){return J(this.size,t=>t===this.capacity())}get isEmpty(){return J(this.size,t=>t===0)}get awaitShutdown(){return jn(this.shutdownHook)}get isShutdown(){return T(()=>le(this.shutdownFlag))}get shutdown(){return zr(se(t=>(f(this.shutdownFlag,vo(!0)),f(this.scope.close(wy(t.id())),pe(this.strategy.shutdown),lu(gu(this.shutdownHook,void 0)),on))))}publish(t){return U(()=>le(this.shutdownFlag)?rt:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),O(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,ke(t),this.shutdownFlag))}isActive(){return!le(this.shutdownFlag)}unsafeOffer(t){return le(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return U(()=>{if(le(this.shutdownFlag))return rt;const n=gK(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),hd(n)?O(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,n,this.shutdownFlag)})}get subscribe(){const t=Lr(rh([this.scope.fork(_u),sK(this.pubsub,this.subscribers,this.strategy)]),n=>n[0].addFinalizer(()=>n[1].shutdown));return J(eb(t,(n,r)=>n[0].close(r)),n=>n[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return N(this,arguments)}}const lK=(e,t)=>k(gc(),n=>J(uc(),r=>fK(e,new Map,n,r,Co(!1),t))),fK=(e,t,n,r,s,o)=>new uK(e,t,n,r,s,o),dK=(e,t)=>{mu(e,O(t))},sT=(e,t)=>f(e,Fy(t)),xb=e=>f(e,Wd(Number.POSITIVE_INFINITY)),hK=e=>e.pollUpTo(Number.POSITIVE_INFINITY),pK=(e,t)=>e.pollUpTo(t),gK=(e,t)=>e.publishAll(t),mK=(e,t)=>{sT(e,f(xb(e),dd(n=>n!==t)))};class yK{get shutdown(){return ee}handleSurplus(t,n,r,s){return O(!1)}unsafeOnPubSubEmptySpace(t,n){}unsafeCompletePollers(t,n,r,s){return bK(this,t,n,r,s)}unsafeCompleteSubscribers(t,n){return SK(this,t,n)}}const bK=(e,t,n,r,s)=>{let o=!0;for(;o&&!r.isEmpty();){const i=f(s,Tr(Xe));if(i===Xe)f(n,XB(r,s)),Hs(s)?o=!1:f(n,nT(r,s));else{const c=r.poll(Xe);c===Xe?sT(s,f(xb(s),Rt(i))):(dK(i,c),e.unsafeOnPubSubEmptySpace(t,n))}}},SK=(e,t,n)=>{for(const[r,s]of n)for(const o of s)e.unsafeCompletePollers(t,n,r,o)};class _K{capacity;constructor(t){this.capacity=t}head={value:Xn,next:null};tail=this.head;size=0;index=0;slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:Xn,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const n of t)this.offer(n)}}class wK{buffer;head;index;remaining;constructor(t){this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return xe();this.index<this.buffer.index&&this.fastForward();const n=Math.min(t,this.remaining),r=new Array(n);for(let s=0;s<n;s++){const o=this.head.value;this.head=this.head.next,r[s]=o}return this.remaining-=n,Ye(r)}takeAll(){return this.takeN(this.remaining)}}const $K={remaining:0,take:()=>{},takeN:()=>xe(),takeAll:()=>xe()},oT=ZB,Pg=eK,Mb=tK,aw=nK,Ma=FB,iT=xB,cT=MB,un=Fb,EK=LB,kK=DB,zt=qB,Be=UB,Ab=jB,Wi=Rg,CK=zB,aT=BB,uT="Continue",vK="Close",IK="Yield",TK="effect/ChannelChildExecutorDecision",uw=Symbol.for(TK),OK={[uw]:uw},lT=e=>{const t=Object.create(OK);return t._tag=uT,t},vl="ContinuationK",RK="ContinuationFinalizer",fT=Symbol.for("effect/ChannelContinuation"),dT={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};class Nb{onSuccess;onHalt;_tag=vl;[fT]=dT;constructor(t,n){this.onSuccess=t,this.onHalt=n}onExit(t){return hc(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}class PK{finalizer;_tag=RK;[fT]=dT;constructor(t){this.finalizer=t}}const hT="PullAfterNext",FK="PullAfterAllEnqueued",xK="effect/ChannelUpstreamPullStrategy",MK=Symbol.for(xK),AK={_A:e=>e},NK={[MK]:AK},pT=e=>{const t=Object.create(NK);return t._tag=hT,t.emitSeparator=e,t},gT="BracketOut",mT="Bridge",Lb="ConcatAll",yT="Emit",bT="Ensuring",ST="Fail",Db="Fold",_T="FromEffect",wT="PipeTo",$T="Provide",ET="Read",kT="Succeed",CT="SucceedNow",vT="Suspend",LK="effect/Channel",Cf=Symbol.for(LK),DK={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},At={[Cf]:DK,pipe(){return N(this,arguments)}},IT=e=>q(e,Cf)||pr(e),qK=l(2,(e,t)=>{const n=Object.create(At);return n._tag=gT,n.acquire=()=>e,n.finalizer=t,n}),TT=l(2,(e,t)=>{const n=Object.create(At);return n._tag=Db,n.channel=e,n.k=new Nb(Mo,t),n}),OT=(e,t,n)=>{const r=Object.create(At);return r._tag=Lb,r.combineInners=t,r.combineAll=n,r.onPull=()=>pT(P()),r.onEmit=()=>lT,r.value=()=>e,r.k=j,r},UK=l(4,(e,t,n,r)=>{const s=Object.create(At);return s._tag=Lb,s.combineInners=n,s.combineAll=r,s.onPull=()=>pT(P()),s.onEmit=()=>lT,s.value=()=>e,s.k=t,s}),qb=l(2,(e,t)=>{const n=Object.create(At);return n._tag=mT,n.input=t,n.channel=e,n}),Ub=l(2,(e,t)=>{const n=Object.create(At);return n._tag=bT,n.channel=e,n.finalizer=t,n}),xu=e=>et(mc(e)),et=e=>jK(()=>e),jK=e=>{const t=Object.create(At);return t._tag=ST,t.error=e,t},he=l(2,(e,t)=>{const n=Object.create(At);return n._tag=Db,n.channel=e,n.k=new Nb(t,et),n}),it=e=>{const t=Object.create(At);return t._tag=_T,t.effect=()=>e,t},Tt=l(2,(e,t)=>{const n=Object.create(At);return n._tag=wT,n.left=()=>e,n.right=()=>t,n}),Fg=l(2,(e,t)=>{const n=Object.create(At);return n._tag=$T,n.context=()=>t,n.inner=e,n}),bh=e=>Hn({onInput:e.onInput,onFailure:t=>vt(ih(t),{onLeft:e.onFailure,onRight:et}),onDone:e.onDone}),Hn=e=>{const t=Object.create(At);return t._tag=ET,t.more=e.onInput,t.done=new Nb(e.onDone,e.onFailure),t},Mo=e=>RT(()=>e),ps=e=>{const t=Object.create(At);return t._tag=CT,t.terminal=e,t},Sh=e=>{const t=Object.create(At);return t._tag=vT,t.channel=e,t},RT=e=>{const t=Object.create(At);return t._tag=kT,t.evaluate=e,t},Ot=ps(void 0),Te=e=>{const t=Object.create(At);return t._tag=yT,t.out=e,t},Mu="Done",Au="Emit",Sc="FromEffect",Nu="Read",zK=Symbol.for("effect/ChannelState"),WK={_E:e=>e,_R:e=>e},_h={[zK]:WK},Ho=()=>{const e=Object.create(_h);return e._tag=Mu,e},hp=()=>{const e=Object.create(_h);return e._tag=Au,e},Pc=e=>{const t=Object.create(_h);return t._tag=Sc,t.effect=e,t},pp=(e,t,n,r)=>{const s=Object.create(_h);return s._tag=Nu,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},vf=e=>e._tag===Sc,BK=e=>vf(e)?e.effect:ne,lw=e=>vf(e)?UW(e.effect):void 0,PT="PullFromChild",xg="PullFromUpstream",Mg="DrainChildExecutors",FT="Emit";class nl{childExecutor;parentSubexecutor;onEmit;_tag=PT;constructor(t,n,r){this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?gh(Ze(n),Ze(r),(s,o)=>f(s,wa(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class Ts{upstreamExecutor;createChild;lastDone;activeChildExecutors;combineChildResults;combineWithChildResult;onPull;onEmit;_tag=xg;constructor(t,n,r,s,o,i,c,a){this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c,this.onEmit=a}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?gh(o,Ze(i),(c,a)=>wa(c,a)):o!==void 0?o:i!==void 0?Ze(i):void 0,void 0);return s}enqueuePullFromChild(t){return new Ts(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class Zo{upstreamExecutor;lastDone;activeChildExecutors;upstreamDone;combineChildResults;combineWithChildResult;onPull;_tag=Mg;constructor(t,n,r,s,o,i,c){this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=i,this.onPull=c}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,i)=>o!==void 0&&i!==void 0?gh(o,Ze(i),(c,a)=>wa(c,a)):o!==void 0?o:i!==void 0?Ze(i):void 0,void 0);return s}enqueuePullFromChild(t){return new Zo(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class gp{value;next;_tag=FT;constructor(t,n){this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const KK="Pulled",HK="NoUpstream",JK="effect/ChannelUpstreamPullRequest",VK=Symbol.for(JK),GK={_A:e=>e},xT={[VK]:GK},fw=e=>{const t=Object.create(xT);return t._tag=KK,t.value=e,t},QK=e=>{const t=Object.create(xT);return t._tag=HK,t.activeDownstreamCount=e,t};class Ls{_activeSubexecutor=void 0;_cancelled=void 0;_closeLastSubstream=void 0;_currentChannel;_done=void 0;_doneStack=[];_emitted=void 0;_executeCloseLastSubstream;_input=void 0;_inProgressFinalizer=void 0;_providedEnv;constructor(t,n,r){this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=Ho();else switch(pr(this._currentChannel)&&(this._currentChannel=it(this._currentChannel)),this._currentChannel._tag){case gT:{t=this.runBracketOut(this._currentChannel);break}case mT:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>D(n.awaitRead(),()=>ve(()=>{const o=r.run();switch(o._tag){case Mu:return sr(r.getDone(),{onFailure:i=>n.error(i),onSuccess:i=>n.done(i)});case Au:return D(n.emit(r.getEmit()),()=>s());case Sc:return $n(o.effect,{onFailure:i=>n.error(i),onSuccess:()=>s()});case Nu:return jb(o,()=>s(),i=>n.error(i))}}));t=Pc(D(BI(at(s())),o=>Z(()=>this.addFinalizer(i=>D(Zt(o),()=>ve(()=>{const c=this.restorePipe(i,r);return c!==void 0?c:ne}))))))}break}case Lb:{const n=new Ls(this._currentChannel.value(),this._providedEnv,s=>Z(()=>{const o=this._closeLastSubstream===void 0?ne:this._closeLastSubstream;this._closeLastSubstream=f(o,Ie(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new Ts(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case yT:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:Ot,t=hp();break}case bT:{this.runEnsuring(this._currentChannel);break}case ST:{t=this.doneHalt(this._currentChannel.error());break}case Db:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case _T:{const n=this._providedEnv===void 0?this._currentChannel.effect():f(this._currentChannel.effect(),dn(this._providedEnv));t=Pc($n(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&vf(s)?s.effect:ne},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&vf(s)?s.effect:ne}}));break}case wT:{const n=this._input,r=new Ls(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:ne}),this._currentChannel=this._currentChannel.right();break}case $T:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>Z(()=>{this._providedEnv=n}));break}case ET:{const n=this._currentChannel;t=pp(this._input,j,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(_a(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case kT:{t=this.doneSucceed(this._currentChannel.evaluate());break}case CT:{t=this.doneSucceed(this._currentChannel.terminal);break}case vT:{this._currentChannel=this._currentChannel.channel();break}}}catch(n){this._currentChannel=et(ji(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?ne:yp(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===vl)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):ne}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=f(r,Ms(Z(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=f(o,Ms(Z(()=>this.clearInProgressFinalizer()))));const i=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(i===void 0&&n===void 0&&s===void 0))return f(Ze(mp(i)),Ig(Ze(mp(n))),Ig(Ze(mp(s))),ie(([[c,a],u])=>f(c,wa(a),wa(u))),Xo,D(c=>ve(()=>c)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=Ke(t),this._currentChannel=void 0,Ho();const n=this._doneStack[this._doneStack.length-1];if(n._tag===vl){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Ke(t),this._currentChannel=void 0,Ho();const s=yp(r.map(i=>i.finalizer),Ke(t));this.storeInProgressFinalizer(s);const o=f(s,Ms(Z(()=>this.clearInProgressFinalizer())),Xo,D(()=>Z(()=>this.doneSucceed(t))));return Pc(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=yt(t),this._currentChannel=void 0,Ho();const n=this._doneStack[this._doneStack.length-1];if(n._tag===vl){this._doneStack.pop();try{this._currentChannel=n.onHalt(t)}catch(i){this._currentChannel=et(ji(i))}return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=yt(t),this._currentChannel=void 0,Ho();const s=yp(r.map(i=>i.finalizer),yt(t));this.storeInProgressFinalizer(s);const o=f(s,Ms(Z(()=>this.clearInProgressFinalizer())),Xo,D(()=>Z(()=>this.doneHalt(t))));return Pc(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,Ho()}runBracketOut(t){const n=Xo($n(this.provide(t.acquire()),{onFailure:r=>Z(()=>{this._currentChannel=et(r)}),onSuccess:r=>Z(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=Te(r)})}));return Pc(n)}provide(t){return this._providedEnv===void 0?t:f(t,dn(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new PK(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case PT:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case xg:return this.pullFromUpstream(t);case Mg:return this.drainChildExecutors(t);case FT:return this._emitted=t.value,this._activeSubexecutor=t.next,hp()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=sr(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?ne:BK(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>f(n,wt(s=>f(Z(()=>s(t)),D(o=>o!==void 0?o:ne)),{discard:!0})));const r=f(t,sr({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case hT:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case FK:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return pp(t,j,o=>{const i=r(o);switch(i._tag){case uT:break;case vK:{this.finishWithDoneValue(t,n,i.value);break}case IK:{const c=n.enqueuePullFromChild(s);this.replaceSubexecutor(c);break}}this._activeSubexecutor=new gp(o,this._activeSubexecutor)},sr({onFailure:o=>{const i=this.handleSubexecutorFailure(t,n,o);return i===void 0?void 0:lw(i)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case xg:{const o=new Ts(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(Ke(r)),this.replaceSubexecutor(o);break}case Mg:{const o=new Zo(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(Ke(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(yt(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new Ts(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new nl(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return pp(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?ne:this._closeLastSubstream;return this._closeLastSubstream=void 0,f(this._executeCloseLastSubstream(r),Ie(n))},n=>{if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,f(this._executeCloseLastSubstream(i),ie(()=>{const c=new Ls(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);c._input=this._input;const[a,u]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(fw(n)));this._activeSubexecutor=new nl(c,new Ts(t.upstreamExecutor,t.createChild,t.lastDone,u,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),_e(a)&&(this._activeSubexecutor=new gp(a.value,this._activeSubexecutor))}))}const r=new Ls(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(fw(n)));this._activeSubexecutor=new nl(r,new Ts(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),_e(s)&&(this._activeSubexecutor=new gp(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new Zo(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const i=this._closeLastSubstream;return this._closeLastSubstream=void 0,f(this._executeCloseLastSubstream(i),ie(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(f(n,L2(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:lw(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>Se(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,i=>t.upstreamExecutor.close(i))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,i]=this.applyUpstreamPullStrategy(!0,r,t.onPull(QK(r.reduce((c,a)=>a!==void 0?c+1:c,0))));return this.replaceSubexecutor(new Zo(t.upstreamExecutor,t.lastDone,i,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),_e(o)?(this._emitted=o.value,hp()):void 0}const s=new Zo(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new nl(n.childExecutor,s,n.onEmit))}}const mp=e=>e!==void 0?e:ne,yp=(e,t)=>f(wt(e,n=>Ze(n(t))),ie(n=>f(A2(n),Ue(()=>Ft))),D(n=>ve(()=>n))),jb=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return NI("Unexpected end of input for channel execution");const i=o.upstream.run();switch(i._tag){case Au:{const c=o.onEmit(o.upstream.getEmit());return r.length===0?c===void 0?ve(t):f(c,$n({onFailure:n,onSuccess:t})):c===void 0?ve(()=>s()):f(c,$n({onFailure:n,onSuccess:()=>s()}))}case Mu:{const c=o.onDone(o.upstream.getDone());return r.length===0?c===void 0?ve(t):f(c,$n({onFailure:n,onSuccess:t})):c===void 0?ve(()=>s()):f(c,$n({onFailure:n,onSuccess:()=>s()}))}case Sc:return r.push(o),f(o.onEffect(i.effect),ds(c=>ve(()=>{const a=o.onDone(yt(c));return a===void 0?ne:a})),$n({onFailure:n,onSuccess:()=>s()}));case Nu:return r.push(o),r.push(i),ve(()=>s())}};return s()},MT=l(2,(e,t)=>{const n=(r,s,o)=>jI(Z(()=>new Ls(e,void 0,j)),i=>ve(()=>Il(i.run(),i).pipe(ph(r),Ie(Le(r)),_b(Le(s)))),(i,c)=>{const a=i.close(c);return a===void 0?ne:bc(a,u=>vn(o,Ht(u)))});return hs(r=>fb([cb(t,va),ue(),ue()]).pipe(D(([s,o,i])=>r(n(o,i,s)).pipe(en(t),D(c=>t.addFinalizer(a=>{const u=hc(a)?Rj(a.cause):void 0;return uf(o).pipe(D(d=>d?De(i,void 0).pipe(Ie(bI(c)),Ie(ew(c))):De(i,void 0).pipe(Ie(u&&Ym(u)>0?SI(c,xx(u)):Zt(c)),Ie(ew(c)))))}).pipe(Ie(r(Le(o)))))))))}),Il=(e,t)=>{const n=e;switch(n._tag){case Sc:return f(n.effect,D(()=>Il(t.run(),t)));case Au:return Il(t.run(),t);case Mu:return ve(()=>t.getDone());case Nu:return jb(n,()=>Il(t.run(),t),Ht)}},AT="Done",YK="Await",XK="effect/ChannelMergeDecision",ZK=Symbol.for(XK),NT={[ZK]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},e3=e=>{const t=Object.create(NT);return t._tag=AT,t.effect=e,t},Ag=e=>{const t=Object.create(NT);return t._tag=YK,t.f=e,t},LT="BothRunning",DT="LeftDone",qT="RightDone",t3="effect/ChannelMergeState",dw=Symbol.for(t3),zb={[dw]:dw},bp=(e,t)=>{const n=Object.create(zb);return n._tag=LT,n.left=e,n.right=t,n},hw=e=>{const t=Object.create(zb);return t._tag=DT,t.f=e,t},pw=e=>{const t=Object.create(zb);return t._tag=qT,t.f=e,t},UT="BackPressure",jT="BufferSliding",n3="effect/ChannelMergeStrategy",gw=Symbol.for(n3),zT={[gw]:gw},r3=e=>{const t=Object.create(zT);return t._tag=UT,t},s3=e=>{const t=Object.create(zT);return t._tag=jT,t},o3=l(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case UT:return t();case jT:return n()}}),Vo="Empty",Lc="Emit",Dc="Error",qc="Done",WT=e=>({_tag:Vo,notifyProducer:e}),Sp=e=>({_tag:Lc,notifyConsumers:e}),i3=e=>({_tag:Dc,cause:e}),c3=e=>({_tag:qc,done:e});class a3{ref;constructor(t){this.ref=t}awaitRead(){return Is(Tc(this.ref,t=>t._tag===Vo?[Le(t.notifyProducer),t]:[ne,t]))}get close(){return WI(t=>this.error(oh(t)))}done(t){return Is(Tc(this.ref,n=>{switch(n._tag){case Vo:return[Le(n.notifyProducer),n];case Lc:return[wt(n.notifyConsumers,r=>De(r,z(t)),{discard:!0}),c3(t)];case Dc:return[Gr,n];case qc:return[Gr,n]}}))}emit(t){return D(ue(),n=>Is(Tc(this.ref,r=>{switch(r._tag){case Vo:return[Le(r.notifyProducer),r];case Lc:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[De(s,H(t)),o.length===0?WT(n):Sp(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case Dc:return[Gr,r];case qc:return[Gr,r]}})))}error(t){return Is(Tc(this.ref,n=>{switch(n._tag){case Vo:return[Le(n.notifyProducer),n];case Lc:return[wt(n.notifyConsumers,r=>Jc(r,t),{discard:!0}),i3(t)];case Dc:return[Gr,n];case qc:return[Gr,n]}}))}get take(){return this.takeWith(t=>yt(ch(t,z)),t=>Ke(t),t=>yu(H(t)))}takeWith(t,n,r){return D(ue(),s=>Is(Tc(this.ref,o=>{switch(o._tag){case Vo:return[Ie(De(o.notifyProducer,void 0),xa(Le(s),{onFailure:t,onSuccess:vt({onLeft:r,onRight:n})})),Sp([s])];case Lc:return[xa(Le(s),{onFailure:t,onSuccess:vt({onLeft:r,onRight:n})}),Sp([...o.notifyConsumers,s])];case Dc:return[Se(t(o.cause)),o];case qc:return[Se(r(o.done)),o]}})))}}const Wb=()=>f(ue(),D(e=>Fo(WT(e))),ie(e=>new a3(e))),Ng=(e,t,n)=>he(it(Fo(()=>ne)),r=>f(it(Xo(Dn(e,s=>Su(r,o=>n(s,o))))),he(t),Ub(s=>D(ss(r),o=>o(s))))),If=l(2,(e,t)=>UK(e,t,()=>{},()=>{})),Bb=e=>{const t=Hn({onInput:()=>t,onFailure:et,onDone:Mo});return Tt(e,t)},BT=l(2,(e,t)=>Ub(e,()=>t)),u3=e=>he(e,j),wh=e=>In(e.takeWith(et,t=>he(Te(t),()=>wh(e)),Mo)),KT=()=>bh({onInput:e=>he(Te(e),()=>KT()),onFailure:xu,onDone:ps}),HT=l(2,(e,t)=>he(e,n=>RT(()=>t(n)))),l3=l(2,(e,t)=>f3(e,ch(t))),f3=l(2,(e,t)=>TT(e,n=>et(t(n)))),$h=l(2,(e,t)=>{const n=bh({onInput:r=>he(Te(t(r)),()=>n),onFailure:xu,onDone:ps});return Tt(e,n)}),d3=l(2,(e,t)=>{const n=Hn({onInput:r=>f(it(t(r)),he(Te),he(()=>n)),onFailure:et,onDone:ps});return Tt(e,n)}),h3=l(3,(e,t,n)=>Kb(r=>L(function*(){const s=yield*Wb(),o=wh(s),i=yield*Ma(n);yield*vn(r,zt(i));const c=yield*ue(),a=n===Number.POSITIVE_INFINITY?h=>j:(yield*Sb(n)).withPermits;yield*(yield*o.pipe(Tt(e),fi(r))).pipe($n({onFailure:h=>Be(i,Ht(h)),onSuccess:vt({onLeft:h=>Ie(at(a(n)(ne)),Fu(Be(i,Se(z(h))))),onRight:h=>L(function*(){const p=yield*ue(),g=yield*ue();yield*Be(i,ie(Le(p),H)),yield*De(g,void 0).pipe(Ie(hs(y=>Ze(y(Le(c))).pipe(HI(Ze(y(t(h)))),D(j))).pipe(bc(y=>Jc(c,y)),ph(p))),a(1),en(r)),yield*Le(g)})})}),bb,at,en(r));const d=In(xa(Is(Wi(i)),{onFailure:et,onSuccess:vt({onLeft:ps,onRight:h=>he(Te(h),()=>d)})}));return qb(d,s)}))),p3=e=>t=>g3(e)(t,sa),g3=({bufferSize:e=16,concurrency:t,mergeStrategy:n=r3()})=>(r,s)=>Kb(o=>L(function*(){const i=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,c=yield*Wb(),a=wh(c),u=yield*Ma(e);yield*vn(o,zt(u));const d=yield*un();yield*vn(o,zt(d));const h=yield*Fo(P()),p=yield*ue(),g=(yield*Sb(i)).withPermits,y=yield*fi(Tt(a,r),o);function E(_){return _.pipe(D(vt({onLeft:b=>Se(F(b)),onRight:b=>Pr(Be(u,Se(H(b))),P())})),ow({until:b=>_e(b)}),D(b=>_L(h,Re({onNone:()=>F(b.value),onSome:C=>F(s(C,b.value))}))),ds(b=>Oa(b)?Ht(b):Be(u,Ht(b)).pipe(Ie(De(p,void 0)),Fu)))}yield*y.pipe($n({onFailure:_=>Be(u,Ht(_)).pipe(Ie(Se(!1))),onSuccess:vt({onLeft:_=>JI(at(Le(p)),at(g(i)(ne)),{onSelfDone:(b,C)=>Pr(Zt(C),!1),onOtherDone:(b,C)=>Ie(Zt(C),ss(h).pipe(D(Re({onNone:()=>Be(u,Se(z(_))),onSome:m=>Be(u,Se(z(s(m,_))))})),Pr(!1)))}),onRight:_=>o3(n,{onBackPressure:()=>L(function*(){const b=yield*ue(),C=Cg(w=>fi(Tt(a,_),w).pipe(D($=>dp(Ze(E($)),Ze(at(Le(p))))),D(j)));return yield*De(b,void 0).pipe(Ie(C),g(1),en(o)),yield*Le(b),!(yield*uf(p))}),onBufferSliding:()=>L(function*(){const b=yield*ue(),C=yield*ue(),m=yield*EK(d);yield*Wi(d).pipe(D(v=>De(v,void 0)),VW(()=>m>=i)),yield*Be(d,b);const w=Cg(v=>fi(Tt(a,_),v).pipe(D(x=>Ze(E(x)).pipe(dp(Ze(at(Le(p)))),dp(Ze(at(Le(b)))))),D(j)));return yield*De(C,void 0).pipe(Ie(w),g(1),en(o)),yield*Le(C),!(yield*uf(p))})})})}),ow({while:_=>_}),en(o));const S=f(Wi(u),Is,xa({onFailure:et,onSuccess:vt({onLeft:ps,onRight:_=>he(Te(_),()=>S)})}),In);return qb(S,c)})),JT=l(3,(e,t,n)=>p3(n)($h(e,t))),VT=l(2,(e,t)=>{function n(r){return L(function*(){const s=yield*Wb(),o=wh(s),i=yield*fi(Tt(o,e),r),c=yield*fi(Tt(o,t.other),r);function a(d,h,p){return(g,y,E)=>{function S(_){const b=_;return b._tag===AT?Se(it(Ie(Zt(h),b.effect))):ie(bI(h),sr({onFailure:C=>it(b.f(yt(C))),onSuccess:vt({onLeft:C=>it(b.f(Ke(C))),onRight:C=>Lu(Te(C),u(E(b.f)))})}))}return sr(d,{onFailure:_=>S(g(yt(_))),onSuccess:vt({onLeft:_=>S(g(Ke(_))),onRight:_=>Se(he(Te(_),()=>he(it(en(at(p),r)),b=>u(y(b,h)))))})})}}function u(d){switch(d._tag){case LT:{const h=at(tw(d.left)),p=at(tw(d.right));return In(JI(h,p,{onSelfDone:(g,y)=>Ie(Zt(y),a(g,d.right,i)(t.onSelfDone,bp,E=>hw(E))),onOtherDone:(g,y)=>Ie(Zt(y),a(g,d.left,c)(t.onOtherDone,(E,S)=>bp(S,E),E=>pw(E)))}))}case DT:return In(ie(Ze(c),sr({onFailure:h=>it(d.f(yt(h))),onSuccess:vt({onLeft:h=>it(d.f(Ke(h))),onRight:h=>he(Te(h),()=>u(hw(d.f)))})})));case qT:return In(ie(Ze(i),sr({onFailure:h=>it(d.f(yt(h))),onSuccess:vt({onLeft:h=>it(d.f(Ke(h))),onRight:h=>he(Te(h),()=>u(pw(d.f)))})})))}}return it(fs(d=>{const h=fs(y=>(y.transferChildren(d.scope()),ne)),p=at(i).pipe(Ms(h),en(r)),g=at(c).pipe(Ms(h),en(r));return gh(p,g,(y,E)=>bp(y,E))})).pipe(he(u),qb(s))})}return Kb(n)}),GT=l(2,(e,t)=>Sh(()=>{let n;const r=bh({onInput:o=>he(Te(o),()=>r),onFailure:o=>(n=S3(o),et(ji(n))),onDone:ps}),s=Hn({onInput:o=>f(Te(o),he(()=>s)),onFailure:o=>Oj(o)&&_3(o.defect)&&W(o.defect,n)?xu(o.defect.error):et(o),onDone:ps});return Tt(Tt(Tt(e,r),t),s)})),m3=e=>Cg(t=>MT(e,t)),y3=e=>m3(Bb(e)),QT=e=>In(hs(t=>ie(lh(),n=>qK(bc(t(uh(e,n)),r=>mt(n,yt(r))),(r,s)=>mt(n,s))))),YT=e=>XT(ie(hh,t=>he(it(e(t)),Te))),fi=l(2,(e,t)=>Ig(Z(()=>new Ls(e,void 0,j)),ws()).pipe(Dn(([n,r])=>iz(t,s=>{const o=n.close(s);return o!==void 0?dn(o,r):ne})),Xo,ie(([n])=>ve(()=>Lg(n.run(),n))))),Lg=(e,t)=>{const n=e;switch(n._tag){case Mu:return sr(t.getDone(),{onFailure:Ht,onSuccess:r=>Se(z(r))});case Au:return Se(H(t.getEmit()));case Sc:return f(n.effect,D(()=>Lg(t.run(),t)));case Nu:return jb(n,()=>Lg(t.run(),t),r=>Ht(r))}},In=e=>u3(it(e)),XT=e=>OT(QT(e),(t,n)=>t,(t,n)=>t),Kb=e=>OT(YT(e),(t,n)=>t,(t,n)=>t),mw=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Or(e?arguments[2]:arguments[1]),r=fb([tB(t,n),KI(),BW,rB(aB)]);if(e){const s=arguments[0];return Ng(r,([o,i])=>Fg(s,Zn(i,ur,o)),([o,,i,c],a)=>hf(o,a,i,c))}return s=>Ng(r,([o,i])=>Fg(s,Zn(i,ur,o)),([o,,i,c],a)=>hf(o,a,i,c))},Eh=e=>ZT(0,e.length,e),ZT=(e,t,n)=>e===t?Ot:f(Te(f(n,es(e))),he(()=>ZT(e+1,t,n))),b3=l(e=>IT(e[1]),(e,t,n)=>n?.concurrent?VT(e,{other:t,onSelfDone:r=>Ag(s=>ve(()=>h_(r,s))),onOtherDone:r=>Ag(s=>ve(()=>h_(s,r)))}):he(e,r=>HT(t,s=>[r,s]))),Lu=l(e=>IT(e[1]),(e,t,n)=>n?.concurrent?HT(b3(e,t,{concurrent:!0}),r=>r[1]):he(e,()=>t)),Dg=Symbol.for("effect/Channel/ChannelException"),S3=e=>({_tag:"ChannelException",[Dg]:Dg,error:e}),_3=e=>q(e,Dg),qg=Symbol.for("effect/Sink"),w3={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};class kh{channel;[qg]=w3;constructor(t){this.channel=t}pipe(){return N(this,arguments)}}const $3=()=>new kh(e0(xe())),e0=e=>Hn({onInput:t=>e0(f(e,Me(t))),onFailure:et,onDone:()=>Mo(e)}),E3=new kh(Bb(KT())),k3=e=>{const t=Hn({onInput:n=>f(it(e(n)),he(()=>t)),onFailure:et,onDone:()=>Ot});return new kh(t)},C3=e=>new kh(it(e)),t0=e=>pr(e)?t0(C3(e)):e.channel,v3=e3,I3=Ag,Hb=fh,T3=$I,n0=uW,O3=Sz,R3=kz,P3="Left",F3="Right",x3="Both",M3="Either",A3={_tag:P3},N3={_tag:F3},r0={_tag:x3},L3={_tag:M3},D3=e=>{switch(e){case"left":return A3;case"right":return N3;case"both":return r0;case"either":return L3;default:return e}},q3=r0;class s0{value;constructor(t){this.value=t}}const o0=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),i0=e=>e.newValue,c0=(e,t)=>{e.isChanged=!0,e.newValue=t},U3=e=>{e.ref.versioned=new s0(e.newValue)},j3=e=>e.ref.versioned!==e.expected,z3=e=>e.isChanged,Tf="Invalid",Jb="ReadWrite",W3="ReadOnly",a0=e=>{for(const t of e)U3(t[1])},u0=e=>{let t=W3;for(const[,n]of e)if(t=j3(n)?Tf:z3(n)?Jb:t,t===Tf)return t;return t},B3=e=>{const t=new Map;for(const[,n]of e){for(const r of n.ref.todos)t.set(r[0],r[1]);n.ref.todos=new Map}return t},K3=e=>{const t=Array.from(e.entries()).sort((n,r)=>n[0]-r[0]);for(const[n,r]of t)r()},H3=(e,t,n)=>{let r=!1;for(const[,s]of t)s.ref.todos.has(e)||(s.ref.todos.set(e,n),r=!0);return r},l0="WithSTMRuntime",Ug="OnFailure",yw="OnRetry",jg="OnSuccess",J3="Provide",f0="Sync",d0="Succeed",h0="Retry",p0="Fail",g0="Die",m0="Interrupt",di="Fail",hi="Die",pi="Interrupt",Qs="Succeed",_c="Retry",Vb="Done",Gb="Suspend",Tl="Done",zg="Interrupted",Of="Running",Ch="effect/STM/State",bo=Symbol.for(Ch),Qb=e=>q(e,bo),y0=e=>e._tag===Of,V3=e=>e._tag===Tl,rl=e=>({[bo]:bo,_tag:Tl,exit:e,[G](){return f(M(Ch),K(M(Tl)),K(M(e)),$e(this))},[V](t){return Qb(t)&&t._tag===Tl&&W(e,t.exit)}}),G3=f(M(Ch),K(M(zg)),K(M("interrupted"))),Q3={[bo]:bo,_tag:zg,[G](){return G3},[V](e){return Qb(e)&&e._tag===zg}},Y3=f(M(Ch),K(M(Of)),K(M("running"))),X3={[bo]:bo,_tag:Of,[G](){return Y3},[V](e){return Qb(e)&&e._tag===Of}},sl=e=>{switch(e._tag){case di:return rl(yu(e.error));case hi:return rl(_a(e.defect));case pi:return rl(N2(e.fiberId));case Qs:return rl(Ke(e.value));case _c:throw new Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},wc="effect/TExit",$c=Symbol.for(wc),Du={_A:e=>e,_E:e=>e},qu=e=>q(e,$c),Z3=e=>e._tag===Qs,eH=e=>e._tag===_c,tH=e=>({[$c]:Du,_tag:di,error:e,[G](){return f(M(wc),K(M(di)),K(M(e)),$e(this))},[V](t){return qu(t)&&t._tag===di&&W(e,t.error)}}),nH=e=>({[$c]:Du,_tag:hi,defect:e,[G](){return f(M(wc),K(M(hi)),K(M(e)),$e(this))},[V](t){return qu(t)&&t._tag===hi&&W(e,t.defect)}}),rH=e=>({[$c]:Du,_tag:pi,fiberId:e,[G](){return f(M(wc),K(M(pi)),K(M(e)),$e(this))},[V](t){return qu(t)&&t._tag===pi&&W(e,t.fiberId)}}),bw=e=>({[$c]:Du,_tag:Qs,value:e,[G](){return f(M(wc),K(M(Qs)),K(M(e)),$e(this))},[V](t){return qu(t)&&t._tag===Qs&&W(e,t.value)}}),sH=f(M(wc),K(M(_c)),K(M("retry"))),oH={[$c]:Du,_tag:_c,[G](){return sH},[V](e){return qu(e)&&eH(e)}},iH=e=>({_tag:Vb,exit:e}),b0=e=>({_tag:Gb,journal:e}),Sw={ref:0},cH=()=>{const e=Sw.ref+1;return Sw.ref=e,e},aH="effect/STM",uH=Symbol.for(aH),ol={_R:e=>e,_E:e=>e,_A:e=>e};class Br{effect_instruction_i0;_op=Ga;effect_instruction_i1=void 0;effect_instruction_i2=void 0;[sw];[Op];[qg];[Cf];get[uH](){return ol}constructor(t){this.effect_instruction_i0=t,this[sw]=eo,this[Op]=ol,this[qg]=ol,this[Cf]=ol}[V](t){return this===t}[G](){return $e(this,Yf(this))}[Symbol.iterator](){return new sc(new Vi(this))}commit(){return lH(this,sa)}pipe(){return N(this,arguments)}}const lH=(e,t,n)=>se(r=>{const s=r.id(),o=r.getFiberRef(Cb),i=r.getFiberRef(QI),c=r.getFiberRef(oB),a=dH(s,e,o,i,c);switch(a._tag){case Vb:return t(a.exit),a.exit;case Gb:{const u=cH(),d={value:X3},h=NW(p=>S0(s,e,u,d,o,i,c,p));return hs(p=>f(p(h),ds(g=>{let y=d.value;return y0(y)&&(d.value=Q3),y=d.value,V3(y)?(t(y.exit),y.exit):Ht(g)})))}}}),fH=(e,t,n,r,s,o)=>{const i=new Map,c=new _0(t,i,e,r).run(),a=u0(i);if(a===Jb)a0(i);else if(a===Tf)throw new Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(c._tag){case Qs:return n.value=sl(c),Yr(Ke(c.value),i,s,o);case di:{n.value=sl(c);const u=mc(c.error);return Yr(yt(u),i,s,o)}case hi:{n.value=sl(c);const u=ji(c.defect);return Yr(yt(u),i,s,o)}case pi:{n.value=sl(c);const u=oh(e);return Yr(yt(u),i,s,o)}case _c:return b0(i)}},dH=(e,t,n,r,s)=>{const o=new Map,i=new _0(t,o,e,n).run(),c=u0(o);if(c===Jb&&Z3(i))a0(o);else if(c===Tf)throw new Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(i._tag){case Qs:return Yr(Ke(i.value),o,r,s);case di:{const a=mc(i.error);return Yr(yt(a),o,r,s)}case hi:{const a=ji(i.defect);return Yr(yt(a),o,r,s)}case pi:{const a=oh(e);return Yr(yt(a),o,r,s)}case _c:return b0(o)}},S0=(e,t,n,r,s,o,i,c)=>{if(y0(r.value)){const a=fH(e,t,r,s,o,i);switch(a._tag){case Vb:{hH(a.exit,c);break}case Gb:{H3(n,a.journal,()=>S0(e,t,n,r,s,o,i,c));break}}}},Yr=(e,t,n,r)=>{const s=B3(t);return s.size>0&&n.scheduleTask(()=>K3(s),r),iH(e)},hH=(e,t)=>{t(e)};class _0{self;journal;fiberId;contStack=[];env;constructor(t,n,r,s){this.self=t,this.journal=n,this.fiberId=r,this.env=s}getEnv(){return this.env}pushStack(t){this.contStack.push(t)}popStack(){return this.contStack.pop()}nextSuccess(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==jg;)t=this.popStack();return t}nextFailure(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Ug;)t=this.popStack();return t}nextRetry(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==yw;)t=this.popStack();return t}run(){let t=this.self,n;for(;n===void 0&&t!==void 0;)try{const r=t;if(r)switch(r._op){case"Tag":{t=vh((s,o,i)=>ld(i,r));break}case"Left":{t=Wg(r.left);break}case"None":{t=Wg(new ah);break}case"Right":{t=ht(r.right);break}case"Some":{t=ht(r.value);break}case"Commit":{switch(r.effect_instruction_i0){case g0:{n=nH(Pe(()=>r.effect_instruction_i1()));break}case p0:{const s=this.nextFailure();s===void 0?n=tH(Pe(()=>r.effect_instruction_i1())):t=Pe(()=>s.effect_instruction_i2(Pe(()=>r.effect_instruction_i1())));break}case h0:{const s=this.nextRetry();s===void 0?n=oH:t=Pe(()=>s.effect_instruction_i2());break}case m0:{n=rH(this.fiberId);break}case l0:{t=Pe(()=>r.effect_instruction_i1(this));break}case jg:case Ug:case yw:{this.pushStack(r),t=r.effect_instruction_i1;break}case J3:{const s=this.env;this.env=Pe(()=>r.effect_instruction_i2(s)),t=f(r.effect_instruction_i1,yH(w0(()=>this.env=s)));break}case d0:{const s=r.effect_instruction_i1,o=this.nextSuccess();o===void 0?n=bw(s):t=Pe(()=>o.effect_instruction_i2(s));break}case f0:{const s=Pe(()=>r.effect_instruction_i1()),o=this.nextSuccess();o===void 0?n=bw(s):t=Pe(()=>o.effect_instruction_i2(s));break}}break}}}catch(r){t=gH(r)}return n}}const pH=l(2,(e,t)=>{const n=new Br(Ug);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),gH=e=>mH(()=>e),mH=e=>{const t=new Br(g0);return t.effect_instruction_i1=e,t},vh=e=>Qn(t=>ht(e(t.journal,t.fiberId,t.getEnv()))),yH=l(2,(e,t)=>SH(e,{onFailure:n=>_w(t,Wg(n)),onSuccess:n=>_w(t,ht(n))})),Wg=e=>bH(()=>e),bH=e=>{const t=new Br(p0);return t.effect_instruction_i1=e,t},Ih=l(2,(e,t)=>{const n=new Br(jg);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),SH=l(2,(e,{onFailure:t,onSuccess:n})=>f(e,Aa(H),pH(r=>f(t(r),Aa(z))),Ih(r=>{switch(r._tag){case"Left":return ht(r.left);case"Right":return n(r.right)}}))),Qn=e=>{const t=new Br(l0);return t.effect_instruction_i1=e,t},Kr=e=>{const t=new Br(m0);return t.effect_instruction_i1=e,t},Aa=l(2,(e,t)=>f(e,Ih(n=>w0(()=>t(n))))),Fc=new Br(h0),ht=e=>{const t=new Br(d0);return t.effect_instruction_i1=e,t},w0=e=>{const t=new Br(f0);return t.effect_instruction_i1=e,t},_w=l(2,(e,t)=>f(e,Ih(()=>t))),ww="BackPressure",Bg="Dropping",$w="Sliding",Ew=ht(void 0),_H="effect/TRef",wH=Symbol.for(_H),$H={_A:e=>e};class EH{[wH]=$H;todos;versioned;constructor(t){this.versioned=new s0(t),this.todos=new Map}modify(t){return vh(n=>{const r=Yb(this,n),[s,o]=t(i0(r));return c0(r,o),s})}pipe(){return N(this,arguments)}}const kH=e=>vh(t=>{const n=new EH(e);return t.set(n,o0(n,!0)),n}),Yb=(e,t)=>{if(t.has(e))return t.get(e);const n=o0(e,!1);return t.set(e,n),n},Sr=l(2,(e,t)=>i0(Yb(e,t))),_r=l(3,(e,t,n)=>{const r=Yb(e,n);c0(r,t)}),CH="effect/TQueue/TEnqueue",vH=Symbol.for(CH),IH="effect/TQueue/TDequeue",TH=Symbol.for(IH),OH={_tag:Bg},RH={_Out:e=>e},PH={_In:e=>e};class FH{ref;requestedCapacity;strategy;[TH]=RH;[vH]=PH;constructor(t,n,r){this.ref=t,this.requestedCapacity=n,this.strategy=r}capacity(){return this.requestedCapacity}size=Qn(t=>{const n=Sr(this.ref,t.journal);return n===void 0?Kr(t.fiberId):ht(n.length)});isFull=Aa(this.size,t=>t===this.requestedCapacity);isEmpty=Aa(this.size,t=>t===0);shutdown=Qn(t=>(_r(this.ref,void 0,t.journal),Ew));isShutdown=vh(t=>Sr(this.ref,t)===void 0);awaitShutdown=Ih(this.isShutdown,t=>t?Ew:Fc);offer(t){return Qn(n=>{const r=f(this.ref,Sr(n.journal));if(r===void 0)return Kr(n.fiberId);if(r.length<this.requestedCapacity)return r.push(t),_r(this.ref,r,n.journal),ht(!0);switch(this.strategy._tag){case ww:return Fc;case Bg:return ht(!1);case $w:return r.length===0||(r.shift(),r.push(t),_r(this.ref,r,n.journal)),ht(!0)}})}offerAll(t){return Qn(n=>{const r=Array.from(t),s=Sr(this.ref,n.journal);if(s===void 0)return Kr(n.fiberId);if(s.length+r.length<=this.requestedCapacity)return _r(this.ref,[...s,...r],n.journal),ht(!0);switch(this.strategy._tag){case ww:return Fc;case Bg:{const o=r.slice(0,this.requestedCapacity-s.length);return _r(this.ref,[...s,...o],n.journal),ht(!1)}case $w:{const o=r.slice(0,this.requestedCapacity-s.length),i=s.length+o.length-this.requestedCapacity,c=s.slice(i);return _r(this.ref,[...c,...o],n.journal),ht(!0)}}})}peek=Qn(t=>{const n=Sr(this.ref,t.journal);return n===void 0?Kr(t.fiberId):n.length===0?Fc:ht(n[0])});peekOption=Qn(t=>{const n=Sr(this.ref,t.journal);return n===void 0?Kr(t.fiberId):ht($o(n[0]))});take=Qn(t=>{const n=Sr(this.ref,t.journal);if(n===void 0)return Kr(t.fiberId);if(n.length===0)return Fc;const r=n.shift();return _r(this.ref,n,t.journal),ht(r)});takeAll=Qn(t=>{const n=Sr(this.ref,t.journal);return n===void 0?Kr(t.fiberId):(_r(this.ref,[],t.journal),ht(n))});takeUpTo(t){return Qn(n=>{const r=Sr(this.ref,n.journal);if(r===void 0)return Kr(n.fiberId);const[s,o]=WE(Ye(r),t);return _r(this.ref,Array.from(o),n.journal),ht(Array.from(s))})}}const xH=l(2,(e,t)=>e.offer(t)),MH=e=>e.peek,AH=e=>e.take,NH=()=>LH(Number.MAX_SAFE_INTEGER,OH),LH=(e,t)=>Aa(kH([]),n=>new FH(n,e,t)),DH=xH,qH=MH,UH=AH,jH=NH,zH=e=>Object.assign(e,{chunk(n){return this(Se(n))},die(n){return this(zi(n))},dieMessage(n){return this(NI(n))},done(n){return this(ve(()=>D2(n,{onFailure:F,onSuccess:ke})))},end(){return this(zn(P()))},fail(n){return this(zn(F(n)))},fromEffect(n){return this(UI(n,{onFailure:F,onSuccess:ke}))},fromEffectChunk(n){return this(f(n,fr(F)))},halt(n){return this(Ht(f(n,ch(F))))},single(n){return this(Se(ke(n)))}}),WH=(e,t)=>{let n=!1,r=[],s=!1;function o(a){if(n)return!1;if(a.length<=5e4)r.push.apply(r,a);else for(let u=0;u<a.length;u++)r.push(a[0]);return s||(s=!0,t.scheduleTask(i,0)),!0}function i(){s=!1,r.length>0&&(e.unsafeOffer(r),r=[])}function c(a){n||(n=!0,a._tag==="Success"&&r.push(a.value),i(),e.unsafeOffer(a._tag==="Success"?Ft:a))}return{single(a){return n?!1:(r.push(a),s||(s=!0,t.scheduleTask(i,0)),!0)},array:o,chunk(a){return o(fn(a))},done:c,end(){n||(n=!0,i(),e.unsafeOffer(Ft))},halt(a){return c(yt(a))},fail(a){return c(yu(a))},die(a){return c(_a(a))},dieMessage(a){return c(_a(new Error(a)))}}},BH="effect/Take",KH=Symbol.for(BH),HH={_A:e=>e,_E:e=>e};class Th{exit;[KH]=HH;constructor(t){this.exit=t}pipe(){return N(this,arguments)}}const Kg=e=>new Th(Ke(e)),JH=e=>ve(()=>e.exit),Hg=new Th(yu(P())),$0=e=>new Th(yt(f(e,ch(F)))),VH=e=>xa(e,{onFailure:t=>Re(Jv(t),{onNone:()=>Hg,onSome:$0}),onSuccess:Kg}),GH=e=>new Th(Ke(ke(e))),E0=()=>zn(P()),QH=e=>fr(Ht(e),F),YH="effect/Stream",k0=Symbol.for(YH),XH={_R:e=>e,_E:e=>e,_A:e=>e};class we{channel;[k0]=XH;constructor(t){this.channel=t}pipe(){return N(this,arguments)}}const Uu=e=>q(e,k0)||pr(e),Xb=4096,ZH=e=>{if(e==="unbounded")return un();if(typeof e=="number"||e===void 0)return Ma(e??16);switch(e.strategy){case"dropping":return iT(e.bufferSize??16);case"sliding":return cT(e.bufferSize??16);default:return Ma(e.bufferSize??16)}},e5=e=>{if(e?.bufferSize==="unbounded"||e?.bufferSize===void 0&&e?.strategy===void 0)return un();switch(e?.strategy){case"sliding":return cT(e.bufferSize??16);default:return iT(e?.bufferSize??16)}},t5=(e,t)=>st(e5(t),zt).pipe(Dn(n=>sB(QI,r=>e(WH(n,r)))),ie(n=>{const r=he(Wi(n),s=>x2(s)?Sa(s)?Ot:et(s.cause):Lu(Te(Ye(s)),r));return r}),XT,v0),n5=(e,t)=>f(st(ZH(t),n=>zt(n)),D(n=>f(ws(),D(r=>f(e(zH(s=>f(VH(s),D(o=>Be(n,o)),Fu,T3(r)).then(o=>{if(hc(o)&&!Oa(o.cause))throw sb(o.cause)}))),Ie(Fo(!1)),D(s=>f(ss(s),ie(o=>o?E0():f(Wi(n),D(JH),zI(()=>f(Su(s,!0),Ie(zt(n)))))))))))),tS,ju(Zb)),r5=l(2,(e,t)=>s5(e,n=>vt(ih(n),{onLeft:t,onRight:l5}))),s5=l(2,(e,t)=>new we(f(ye(e),TT(n=>ye(t(n)))))),o5=l(2,(e,t)=>new we(f(ye(e),Lu(ye(t))))),i5=e=>zu(zi(e)),c5=new we(Ot),Rf=l(2,(e,t)=>new we(f(ye(e),BT(t)))),a5=l(2,(e,t)=>new we(Ub(ye(e),t))),u5=e=>I0(zn(F(e))),l5=e=>zu(Ht(e)),f5=l(2,(e,t)=>O0(e,dd(t))),d5=l(2,(e,t)=>{const n=r=>{const s=r.next();return s.done?Hn({onInput:o=>n(o[Symbol.iterator]()),onFailure:et,onDone:Mo}):f(t(s.value),ie(o=>o?f(Te(ke(s.value)),he(()=>n(r))):n(r)),In)};return new we(Sh(()=>f(ye(e),Tt(n(xe()[Symbol.iterator]())))))}),h5=l(2,(e,t)=>O0(e,jE(t))),ju=l(e=>Uu(e[0]),(e,t,n)=>{const r=n?.bufferSize??16;return n?.switch?Jg(n?.concurrency,()=>kw(e,1,r,t),s=>kw(e,s,r,t)):Jg(n?.concurrency,()=>new we(If(ye(e),s=>f(s,zE(o=>ye(t(o))),kF(Ot,(o,i)=>f(o,Lu(i)))))),s=>new we(f(ye(e),If(Eh),JT(o=>ye(t(o)),n))))}),Jg=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},kw=l(4,(e,t,n,r)=>new we(f(ye(e),If(Eh),JT(s=>ye(r(s)),{concurrency:t,mergeStrategy:s3(),bufferSize:n})))),Oh=l(e=>Uu(e[0]),(e,t)=>ju(e,j,t)),p5=e=>{const t=Hn({onInput:n=>he(Eh(n),()=>t),onFailure:et,onDone:()=>Ot});return new we(f(ye(e),Tt(t)))},g5=e=>{const t=(r,s)=>{const[o,i]=f(r,$F(a=>!Sa(a))),c=f(pd(i),Re({onNone:()=>s,onSome:sr({onFailure:a=>Re(Jv(a),{onNone:()=>Ot,onSome:et}),onSuccess:()=>Ot})}));return f(Te(f(o,jE(a=>Sa(a)?F(a.value):P()))),he(()=>c))},n=Hn({onInput:r=>t(r,n),onFailure:r=>et(r),onDone:()=>Ot});return new we(f(ye(e),Tt(n)))},C0=e=>p5(g5(f(e,Pf(t=>t.exit)))),v0=e=>new we(e),ye=e=>{if("channel"in e)return e.channel;if(pr(e))return ye(zu(e));throw new TypeError("Expected a Stream.")},m5=e=>new we(hd(e)?Ot:Te(e)),zu=e=>f(e,fr(F),I0),I0=e=>new we(In(QW(e,{onFailure:Re({onNone:()=>Ot,onSome:xu}),onSuccess:t=>Te(ke(t))}))),T0=(e,t)=>{const n=t?.maxChunkSize??Xb;if(t?.scoped){const s=ie(aw(e),o=>Na(o,{maxChunkSize:n,shutdown:!0}));return t.shutdown?ie(s,Rf(Pg(e))):s}const r=ju(tS(aw(e)),s=>Na(s,{maxChunkSize:n}));return t?.shutdown?Rf(r,Pg(e)):r},y5=e=>nS(()=>fd(e)?m5(e):b5(e[Symbol.iterator]())),b5=(e,t=Xb)=>f(Z(()=>{let n=[];const r=s=>f(Z(()=>{let o=s.next();if(t===1)return o.done?Ot:f(Te(ke(o.value)),he(()=>r(s)));n=[];let i=0;for(;o.done===!1&&(n.push(o.value),i=i+1,!(i>=t));)o=s.next();return i>0?f(Te(Ye(n)),he(()=>r(s))):Ot}),In);return new we(r(e))}),P0),Na=(e,t)=>f(aT(e,1,t?.maxChunkSize??Xb),ds(n=>f(kK(e),D(r=>r&&Oa(n)?E0():QH(n)))),Zb,t?.shutdown?Rf(zt(e)):j),S5=(...e)=>{const t=e.length===1?e[0].evaluate:e[0],n=e.length===1?e[0].onError:e[1],r=e.length===1?e[0].releaseLockOnEnd===!0:!1;return rS(ie(st(Z(()=>t().getReader()),s=>r?Z(()=>s.releaseLock()):LW(()=>s.cancel())),s=>I5(D(Qc({try:()=>s.read(),catch:o=>F(n(o))}),({done:o,value:i})=>o?zn(P()):Se(i)))))},_5=(...e)=>y5(e),Pf=l(2,(e,t)=>new we(f(ye(e),$h(zE(t))))),O0=l(2,(e,t)=>new we(f(ye(e),$h(t)))),w5=l(2,(e,t)=>new we(f(ye(e),d3(t)))),Vg=l(2,(e,t)=>{const n=r=>{const s=r.next();if(s.done)return Hn({onInput:o=>n(o[Symbol.iterator]()),onFailure:et,onDone:Mo});{const o=s.value;return In(ie(t(o),i=>he(Te(ke(i)),()=>n(r))))}};return new we(f(ye(e),Tt(Sh(()=>n(xe()[Symbol.iterator]())))))}),$5=l(3,(e,t,n)=>new we(f(ye(e),If(Eh),h3(n,t),$h(ke)))),E5=l(2,(e,t)=>new we(f(ye(e),l3(t)))),k5=l(e=>Uu(e[1]),(e,t,n)=>C5(e,t,{onSelf:j,onOther:j,haltStrategy:n?.haltStrategy})),C5=l(3,(e,t,n)=>{const r=n.haltStrategy?D3(n.haltStrategy):q3,s=o=>i=>o||!Sa(i)?v3(ve(()=>i)):I3(c=>ve(()=>c));return new we(VT(ye(Pf(e,n.onSelf)),{other:ye(Pf(t,n.onOther)),onSelfDone:s(r._tag==="Either"||r._tag==="Left"),onOtherDone:s(r._tag==="Either"||r._tag==="Right")}))}),v5=l(2,(e,t)=>new we(f(ye(e),Fg(t)))),Zb=e=>A5(e,t=>f(ie(t,n=>F([n,t])),db(Re({onNone:()=>Se(P()),onSome:zn})))),I5=e=>Zb(f(e,ie(ke))),eS=l(2,(e,t)=>ye(e).pipe(GT(t0(t)),y3)),T5=e=>eS(e,$3()),O5=e=>eS(e,E3),R0=l(2,(e,t)=>eS(e,k3(t))),tS=e=>new we(BT(QT(f(e,ie(ke))),ne)),R5=e=>new we(YT(t=>e(t).pipe(ie(ke)))),nS=e=>new we(Sh(()=>ye(e()))),P5=l(2,(e,t)=>{if(!Number.isInteger(t))return i5(new Pj(`${t} must be an integer`));const n=r=>bh({onInput:s=>{const o=f(s,wi(Math.min(r,Number.POSITIVE_INFINITY))),i=Math.max(0,r-o.length);return i>0?f(Te(o),he(()=>n(i))):Te(o)},onFailure:xu,onDone:Mo});return new we(f(ye(e),GT(0<t?n(t):Ot)))}),F5=l(2,(e,t)=>Vg(e,n=>Pr(t(n),n))),x5=l(e=>Uu(e[0]),(e,t)=>ie(ws(),n=>M5(e,n,t))),M5=l(e=>Uu(e[0]),(e,t,n)=>{const r=Hb(t);let s,o;const i=ZW(!1);return new ReadableStream({start(c){o=r(R0(e,a=>i.whenOpen(Z(()=>{i.unsafeClose();for(const u of a)c.enqueue(u);s(),s=void 0})))),o.addObserver(a=>{a._tag==="Failure"?c.error(sb(a.cause)):c.close()})},pull(){return new Promise(c=>{s=c,os(i.open)})},cancel(){if(o)return GI(Fu(Zt(o)))}},n?.strategy)}),A5=(e,t)=>nS(()=>{const n=r=>In(ie(t(r),Re({onNone:()=>Ot,onSome:([s,o])=>he(Te(s),()=>n(o))})));return new we(n(e))}),P0=e=>Oh(zu(e)),rS=e=>Oh(tS(e)),N5=e=>Oh(R5(t=>e(t))),L5=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=Or(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return new we(mw(ye(r),t,n))}return r=>new we(mw(ye(r),t,n))},D5=(e,t,n)=>t5(r=>st(Z(()=>e.addEventListener(t,r.single,n)),()=>Z(()=>e.removeEventListener(t,r.single,n))),{bufferSize:typeof n=="object"?n.bufferSize:void 0}),q5=Ng,F0="effect/Redacted",Ol=te("effect/Redacted/redactedRegistry",()=>new WeakMap),x0=Symbol.for(F0),U5={[x0]:{_A:e=>e},pipe(){return N(this,arguments)},toString(){return"<redacted>"},toJSON(){return"<redacted>"},[fe](){return"<redacted>"},[G](){return f(M(F0),K(M(Ol.get(this))),$e(this))},[V](e){return j5(e)&&W(Ol.get(this),Ol.get(e))}},j5=e=>q(e,x0),z5=e=>{const t=Object.create(U5);return Ol.set(t,e),t},Cw=Symbol.for("effect/Encoding/errors/Decode"),_p=(e,t)=>{const n={_tag:"DecodeException",[Cw]:Cw,input:e};return Jt(t)&&(n.message=t),n},W5=new TextEncoder,vw=e=>{const t=e.length;let n="",r;for(r=2;r<t;r+=3)n+=wr[e[r-2]>>2],n+=wr[(e[r-2]&3)<<4|e[r-1]>>4],n+=wr[(e[r-1]&15)<<2|e[r]>>6],n+=wr[e[r]&63];return r===t+1&&(n+=wr[e[r-2]>>2],n+=wr[(e[r-2]&3)<<4],n+="=="),r===t&&(n+=wr[e[r-2]>>2],n+=wr[(e[r-2]&3)<<4|e[r-1]>>4],n+=wr[(e[r-1]&15)<<2],n+="="),n},B5=e=>{const t=K5(e),n=t.length;if(n%4!==0)return z(_p(t,`Length must be a multiple of 4, but is ${n}`));const r=t.indexOf("=");if(r!==-1&&(r<n-2||r===n-2&&t[n-1]!=="="))return z(_p(t,"Found a '=' character, but it is not at the end"));try{const s=t.endsWith("==")?2:t.endsWith("=")?1:0,o=new Uint8Array(3*(n/4)-s);for(let i=0,c=0;i<n;i+=4,c+=3){const a=il(t.charCodeAt(i))<<18|il(t.charCodeAt(i+1))<<12|il(t.charCodeAt(i+2))<<6|il(t.charCodeAt(i+3));o[c]=a>>16,o[c+1]=a>>8&255,o[c+2]=a&255}return H(o)}catch(s){return z(_p(t,s instanceof Error?s.message:"Invalid input"))}},K5=e=>e.replace(/[\n\r]/g,"");function il(e){if(e>=Iw.length)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);const t=Iw[e];if(t===255)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}const wr=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Iw=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],H5=e=>vw(typeof e=="string"?W5.encode(e):e),J5=e=>B5(e),Gg=Symbol.for("effect/FiberHandle"),V5=e=>q(e,Gg),G5={[Gg]:Gg,toString(){return Oe(this.toJSON())},toJSON(){return{_id:"FiberHandle",state:this.state}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},Q5=e=>{const t=Object.create(G5);return t.state={_tag:"Open",fiber:void 0},t.deferred=e,t},Y5=()=>st(ie(ue(),e=>Q5(e)),e=>fs(t=>{const n=e.state;return n._tag==="Closed"?ne:(e.state={_tag:"Closed"},n.fiber?ph(Fu(SI(n.fiber,Ks(t.id(),Rl))),e.deferred):_s(e.deferred,Ft))})),M0=-1,Rl=fk(M0,0),X5=Vv(void 0,{emptyCase:An,failCase:An,dieCase:An,interruptCase:(e,t)=>Qm(ty(t),M0),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),Z5=l(e=>V5(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(Ks(n?.interruptAs??Cn,Rl));return}else if(e.state.fiber!==void 0){if(n?.onlyIfMissing===!0){t.unsafeInterruptAsFork(Ks(n?.interruptAs??Cn,Rl));return}else if(e.state.fiber===t)return;e.state.fiber.unsafeInterruptAsFork(Ks(n?.interruptAs??Cn,Rl)),e.state.fiber=void 0}e.state.fiber=t,t.addObserver(r=>{e.state._tag==="Open"&&t===e.state.fiber&&(e.state.fiber=void 0),hc(r)&&(n?.propagateInterruption===!0?!X5(r.cause):!Js(r.cause))&&Fs(e.deferred,r)})}),eJ=function(){let e;return()=>(e===void 0&&(e=$s(Gr)),e)}(),Tw=function(){const e=arguments[0];if(pr(arguments[1]))return Ow(e,arguments[1],arguments[2]);const t=arguments[1];return n=>Ow(e,n,t)},Ow=(e,t,n)=>WI(r=>e.state._tag==="Closed"?Gr:e.state.fiber!==void 0&&n?.onlyIfMissing===!0?Z(eJ):Dn(BI(t),s=>Z5(e,s,{...n,interruptAs:r}))),Qg=Symbol.for("effect/FiberSet"),tJ=e=>q(e,Qg),nJ={[Qg]:Qg,[Symbol.iterator](){return this.state._tag==="Closed"?w1():this.state.backing[Symbol.iterator]()},toString(){return Oe(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[fe](){return this.toJSON()},pipe(){return N(this,arguments)}},rJ=(e,t)=>{const n=Object.create(nJ);return n.state={_tag:"Open",backing:e},n.deferred=t,n},A0=()=>st(ie(ue(),e=>rJ(new Set,e)),e=>fs(t=>{const n=e.state;if(n._tag==="Closed")return ne;e.state={_tag:"Closed"};const r=n.backing;return eW(r,Ks(t.id(),L0)).pipe(ph(e.deferred))})),N0=-1,L0=fk(N0,0),sJ=Vv(void 0,{emptyCase:An,failCase:An,dieCase:An,interruptCase:(e,t)=>Qm(ty(t),N0),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),Yg=l(e=>tJ(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(Ks(n?.interruptAs??Cn,L0));return}else if(e.state.backing.has(t))return;e.state.backing.add(t),t.addObserver(r=>{e.state._tag!=="Closed"&&(e.state.backing.delete(t),hc(r)&&(n?.propagateInterruption===!0?!sJ(r.cause):!Js(r.cause))&&Fs(e.deferred,r))})}),oJ=e=>Le(e.deferred),iJ="effect/GroupBy",D0=Symbol.for(iJ),cJ={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},aJ=e=>q(e,D0),uJ=l(e=>aJ(e[0]),(e,t,n)=>ju(e.grouped,([r,s])=>t(r,C0(Na(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:n?.bufferSize??16})),lJ=e=>({[D0]:cJ,pipe(){return N(this,arguments)},grouped:e}),fJ=l(e=>typeof e[0]!="function",(e,t,n)=>n?.key?uJ(dJ(e,n.key,{bufferSize:n.bufferSize}),(r,s)=>Vg(s,t)):Jg(n?.concurrency,()=>Vg(e,t),r=>n?.unordered?ju(e,s=>zu(t(s)),{concurrency:r}):$5(e,r,t))),dJ=l(e=>typeof e[0]!="function",(e,t,n)=>{const r=(s,o)=>Hn({onInput:i=>he(it(wt(hJ(i,t),([c,a])=>{const u=s.get(c);return u===void 0?f(Ma(n?.bufferSize??16),D(d=>f(Z(()=>{s.set(c,d)}),Ie(Be(o,GH([c,d]))),Ie(f(Be(d,Kg(a)),fp(h=>Js(h)?F(ne):P())))))):fp(Be(u,Kg(a)),d=>Js(d)?F(ne):P())},{discard:!0})),()=>r(s,o)),onFailure:i=>it(Be(o,$0(i))),onDone:()=>f(it(f(wt(s.entries(),([i,c])=>f(Be(c,Hg),fp(a=>Js(a)?F(ne):P())),{discard:!0}),Ie(Be(o,Hg)))))});return lJ(N5(s=>L(function*(){const o=new Map,i=yield*un();return yield*vn(s,zt(i)),yield*ye(e).pipe(Tt(r(o,i)),Bb,MT(s),en(s),Pr(C0(Na(i,{shutdown:!0}))))})))}),hJ=l(2,(e,t)=>{const n=[],r=e[Symbol.iterator](),s=new Map;let o;for(;(o=r.next())&&!o.done;){const i=o.value,c=t(i);if(s.has(c))s.get(c).push(i);else{const a=[i];n.push([c,a]),s.set(c,a)}}return Ye(n.map(i=>[i[0],Ye(i[1])]))});class Et{path;actual;issue;_tag="Pointer";constructor(t,n,r){this.path=t,this.actual=n,this.issue=r}}class Rw{actual;message;_tag="Unexpected";constructor(t,n){this.actual=t,this.message=n}}class xc{ast;message;_tag="Missing";actual=void 0;constructor(t,n){this.ast=t,this.message=n}}class Je{ast;actual;issues;output;_tag="Composite";constructor(t,n,r,s){this.ast=t,this.actual=n,this.issues=r,this.output=s}}class wp{ast;actual;kind;issue;_tag="Refinement";constructor(t,n,r,s){this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class $p{ast;actual;kind;issue;_tag="Transformation";constructor(t,n,r,s){this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Wt{ast;actual;message;_tag="Type";constructor(t,n,r){this.ast=t,this.actual=n,this.message=r}}class Pw{ast;actual;message;_tag="Forbidden";constructor(t,n,r){this.ast=t,this.actual=n,this.message=r}}const Xg=Symbol.for("effect/Schema/ParseErrorTypeId"),pJ=e=>q(e,Xg);class gJ extends az("ParseError"){[Xg]=Xg;get message(){return this.toString()}toString(){return Pl.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[fe](){return this.toJSON()}}const Rh=e=>new gJ({issue:e}),gs=H,Ph=z,Dt=D$,Xr=l(2,(e,t)=>Dt(e)?vt(e,{onLeft:z,onRight:t}):D(e,t)),an=l(2,(e,t)=>Dt(e)?e1(e,t):ie(e,t)),Yc=l(2,(e,t)=>Dt(e)?Tm(e,t):fr(e,t)),mJ=l(2,(e,t)=>Dt(e)?ZR(e,{onLeft:t.onFailure,onRight:t.onSuccess}):UI(e,t)),q0=l(2,(e,t)=>Dt(e)?vt(e,{onLeft:t,onRight:H}):db(e,t)),Fh=(e,t)=>t===void 0||Fr(t)?e:e===void 0?t:{...e,...t},U0=(e,t,n)=>{const r=_t(e,t);return(s,o)=>r(s,Fh(n,o))},sS=(e,t,n)=>{const r=U0(e,t,n);return(s,o)=>q$(r(s,o),Rh)},j0=(e,t,n)=>{const r=_t(e,t);return(s,o)=>r(s,{...Fh(n,o),isEffectAllowed:!0})},yJ=(e,t)=>sS(e.ast,!0,t),bJ=(e,t)=>U0(e.ast,!0,t),xh=(e,t)=>j0(e.ast,!0,t),SJ=(e,t)=>sS(e.ast,!1,t),Wu=(e,t)=>j0(e.ast,!1,t),_J=yJ,wJ=xh,Mh=(e,t)=>sS(Qe(e.ast),!0,t),ct=(e,t)=>{const n=_t(Qe(e.ast),!0);return(r,s)=>tr(n(r,{exact:!0,...Fh(t,s)}))},z0=SJ,$J=Wu,EJ=te(Symbol.for("effect/ParseResult/decodeMemoMap"),()=>new WeakMap),kJ=te(Symbol.for("effect/ParseResult/encodeMemoMap"),()=>new WeakMap),_t=(e,t)=>{const n=t?EJ:kJ,r=n.get(e);if(r)return r;const s=CJ(e,t),o=fP(e),i=_e(o)?(u,d)=>s(u,Fh(d,o.value)):s,c=dP(e),a=t&&_e(c)?(u,d)=>jc(q0(i(u,d),c.value),e,u,d):i;return n.set(e,a),a},Ep=e=>Fn(aP(e)),kp=e=>Fn(uP(e)),CJ=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=_t(e.from,!0);return(r,s)=>{s=s??Xh;const o=s?.errors==="all",i=Xr(q0(n(r,s),c=>{const a=new wp(e,r,"From",c);return o&&pP(e)&&J0(c)?Re(e.filter(r,s,e),{onNone:()=>z(a),onSome:u=>z(new Je(e,r,[a,new wp(e,r,"Predicate",u)]))}):z(a)}),c=>Re(e.filter(c,s,e),{onNone:()=>H(c),onSome:a=>z(new wp(e,r,"Predicate",a))}));return jc(i,e,r,s)}}else{const n=_t(Qe(e),!0),r=_t(B0(e.from),!1);return(s,o)=>jc(Xr(n(s,o),i=>r(i,o)),e,s,o)}case"Transformation":{const n=IJ(e.transformation,t),r=t?_t(e.from,!0):_t(e.to,!1),s=t?_t(e.to,!0):_t(e.from,!1);return(o,i)=>jc(Xr(Yc(r(o,i),c=>new $p(e,o,t?"Encoded":"Type",c)),c=>Xr(Yc(n(c,i??Xh,e,o),a=>new $p(e,o,"Transformation",a)),a=>Yc(s(a,i),u=>new $p(e,o,t?"Type":"Encoded",u)))),e,o,i)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>jc(n(r,s??Xh,e),e,r,s)}case"Literal":return cn(e,n=>n===e.literal);case"UniqueSymbol":return cn(e,n=>n===e.symbol);case"UndefinedKeyword":return cn(e,gR);case"NeverKeyword":return cn(e,mR);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return H;case"StringKeyword":return cn(e,Jt);case"NumberKeyword":return cn(e,Fr);case"BooleanKeyword":return cn(e,Xs);case"BigIntKeyword":return cn(e,Vf);case"SymbolKeyword":return cn(e,Nl);case"ObjectKeyword":return cn(e,dr);case"Enums":return cn(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=IE(e);return cn(e,r=>Jt(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(u=>_t(u.type,t)),r=e.rest.map(u=>_t(u.type,t));let s=e.elements.filter(u=>!u.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,i=e.elements.length>0?e.elements.map((u,d)=>d).join(" | "):"never",c=Ep(e),a=kp(e);return(u,d)=>{if(!T1(u))return z(new Wt(e,u));const h=d?.errors==="all",p=[];let g=0;const y=[],E=u.length;for(let C=E;C<=o-1;C++){const m=new Et(C,u,new xc(s[C-E]));if(h){p.push([g++,m]);continue}else return z(new Je(e,u,m,y))}if(e.rest.length===0)for(let C=e.elements.length;C<=E-1;C++){const m=new Et(C,u,new Rw(u[C],`is unexpected, expected: ${i}`));if(h){p.push([g++,m]);continue}else return z(new Je(e,u,m,y))}let S=0,_;for(;S<n.length;S++)if(E<S+1){if(e.elements[S].isOptional)continue}else{const C=n[S],m=C(u[S],d);if(Dt(m)){if(pt(m)){const w=new Et(S,u,m.left);if(h){p.push([g++,w]);continue}else return z(new Je(e,u,w,On(y)))}y.push([g++,m.right])}else{const w=g++,$=S;_||(_=[]),_.push(({es:v,output:x})=>D(Ko(m),X=>{if(pt(X)){const I=new Et($,u,X.left);return h?(v.push([w,I]),ne):z(new Je(e,u,I,On(x)))}return x.push([w,X.right]),ne}))}}if(je(r)){const[C,...m]=r;for(;S<E-m.length;S++){const w=C(u[S],d);if(Dt(w))if(pt(w)){const $=new Et(S,u,w.left);if(h){p.push([g++,$]);continue}else return z(new Je(e,u,$,On(y)))}else y.push([g++,w.right]);else{const $=g++,v=S;_||(_=[]),_.push(({es:x,output:X})=>D(Ko(w),I=>{if(pt(I)){const A=new Et(v,u,I.left);return h?(x.push([$,A]),ne):z(new Je(e,u,A,On(X)))}else return X.push([$,I.right]),ne}))}}for(let w=0;w<m.length;w++)if(S+=w,!(E<S+1)){const $=m[w](u[S],d);if(Dt($)){if(pt($)){const v=new Et(S,u,$.left);if(h){p.push([g++,v]);continue}else return z(new Je(e,u,v,On(y)))}y.push([g++,$.right])}else{const v=g++,x=S;_||(_=[]),_.push(({es:X,output:I})=>D(Ko($),A=>{if(pt(A)){const Q=new Et(x,u,A.left);return h?(X.push([v,Q]),ne):z(new Je(e,u,Q,On(I)))}return I.push([v,A.right]),ne}))}}}const b=({es:C,output:m})=>ml(C)?z(new Je(e,u,On(C),On(m))):H(On(m));if(_&&_.length>0){const C=_;return ve(()=>{const m={es:Nc(p),output:Nc(y)};return D(wt(C,w=>w(m),{concurrency:c,batching:a,discard:!0}),()=>b(m))})}return b({output:y,es:p})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return cn(e,yR);const n=[],r={},s=[];for(const d of e.propertySignatures)n.push([_t(d.type,t),d]),r[d.name]=null,s.push(d.name);const o=e.indexSignatures.map(d=>[_t(d.parameter,t),_t(d.type,t),d.parameter]),i=Ut.make(e.indexSignatures.map(d=>d.parameter).concat(s.map(d=>Nl(d)?new bP(d):new Jl(d)))),c=_t(i,t),a=Ep(e),u=kp(e);return(d,h)=>{if(!_R(d))return z(new Wt(e,d));const p=h?.errors==="all",g=[];let y=0;const E=h?.onExcessProperty==="error",S=h?.onExcessProperty==="preserve",_={};let b;if(E||S){b=Nn(d);for(const $ of b){const v=c($,h);if(Dt(v)&&pt(v))if(E){const x=new Et($,d,new Rw(d[$],`is unexpected, expected: ${String(i)}`));if(p){g.push([y++,x]);continue}else return z(new Je(e,d,x,_))}else _[$]=d[$]}}let C;const m=h?.exact===!0;for(let $=0;$<n.length;$++){const v=n[$][1],x=v.name,X=Object.prototype.hasOwnProperty.call(d,x);if(!X){if(v.isOptional)continue;if(m){const Q=new Et(x,d,new xc(v));if(p){g.push([y++,Q]);continue}else return z(new Je(e,d,Q,_))}}const I=n[$][0],A=I(d[x],h);if(Dt(A)){if(pt(A)){const Q=new Et(x,d,X?A.left:new xc(v));if(p){g.push([y++,Q]);continue}else return z(new Je(e,d,Q,_))}_[x]=A.right}else{const Q=y++,oe=x;C||(C=[]),C.push(({es:B,output:Ne})=>D(Ko(A),Ee=>{if(pt(Ee)){const nt=new Et(oe,d,X?Ee.left:new xc(v));return p?(B.push([Q,nt]),ne):z(new Je(e,d,nt,Ne))}return Ne[oe]=Ee.right,ne}))}}for(let $=0;$<o.length;$++){const v=o[$],x=v[0],X=v[1],I=Y$(d,v[2]);for(const A of I){const Q=x(A,h);if(Dt(Q)&&tr(Q)){const oe=X(d[A],h);if(Dt(oe))if(pt(oe)){const B=new Et(A,d,oe.left);if(p){g.push([y++,B]);continue}else return z(new Je(e,d,B,_))}else Object.prototype.hasOwnProperty.call(r,A)||(_[A]=oe.right);else{const B=y++,Ne=A;C||(C=[]),C.push(({es:Ee,output:nt})=>D(Ko(oe),dt=>{if(pt(dt)){const Vn=new Et(Ne,d,dt.left);return p?(Ee.push([B,Vn]),ne):z(new Je(e,d,Vn,nt))}else return Object.prototype.hasOwnProperty.call(r,A)||(nt[A]=dt.right),ne}))}}}}const w=({es:$,output:v})=>{if(ml($))return z(new Je(e,d,On($),v));if(h?.propertyOrder==="original"){const x=b||Nn(d);for(const I of s)x.indexOf(I)===-1&&x.push(I);const X={};for(const I of x)Object.prototype.hasOwnProperty.call(v,I)&&(X[I]=v[I]);return H(X)}return H(v)};if(C&&C.length>0){const $=C;return ve(()=>{const v={es:Nc(g),output:Object.assign({},_)};return D(wt($,x=>x(v),{concurrency:a,batching:u,discard:!0}),()=>w(v))})}return w({es:g,output:_})}}case"Union":{const n=W0(e.types,t),r=Nn(n.keys),s=r.length,o=e.types.length,i=new Map;for(let u=0;u<o;u++)i.set(e.types[u],_t(e.types[u],t));const c=Ep(e)??1,a=kp(e);return(u,d)=>{const h=[];let p=0,g=[];if(s>0)if(Gf(u))for(let S=0;S<s;S++){const _=r[S],b=n.keys[_].buckets;if(Object.prototype.hasOwnProperty.call(u,_)){const C=String(u[_]);if(Object.prototype.hasOwnProperty.call(b,C))g=g.concat(b[C]);else{const{candidates:m,literals:w}=n.keys[_],$=Ut.make(w),v=m.length===o?new kn([new Ge(_,$,!1,!0)],[]):Ut.make(m);h.push([p++,new Je(v,u,new Et(_,u,new Wt($,u[_])))])}}else{const{candidates:C,literals:m}=n.keys[_],w=new Ge(_,Ut.make(m),!1,!0),$=C.length===o?new kn([w],[]):Ut.make(C);h.push([p++,new Je($,u,new Et(_,u,new xc(w)))])}}else{const S=n.candidates.length===o?e:Ut.make(n.candidates);h.push([p++,new Wt(S,u)])}n.otherwise.length>0&&(g=g.concat(n.otherwise));let y;for(let S=0;S<g.length;S++){const _=g[S],b=i.get(_)(u,d);if(Dt(b)&&(!y||y.length===0)){if(tr(b))return b;h.push([p++,b.left])}else{const C=p++;y||(y=[]),y.push(m=>ve(()=>"finalResult"in m?ne:D(Ko(b),w=>(tr(w)?m.finalResult=w:m.es.push([C,w.left]),ne))))}}const E=S=>ml(S)?S.length===1&&S[0][1]._tag==="Type"?z(S[0][1]):z(new Je(e,u,On(S))):z(new Wt(e,u));if(y&&y.length>0){const S=y;return ve(()=>{const _={es:Nc(h)};return D(wt(S,b=>b(_),{concurrency:c,batching:a,discard:!0}),()=>"finalResult"in _?_.finalResult:E(_.es))})}return E(h)}}case"Suspend":{const n=Fm(()=>_t(_i(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},cn=(e,t)=>n=>t(n)?H(n):z(new Wt(e,n)),Uc=(e,t)=>{switch(e._tag){case"Declaration":{const n=Eo(e);if(_e(n))return Uc(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?Ap(s.type):Qe(s.type);Kc(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=t?Ap(s.type):Qe(s.type);Kc(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return Uc(e.from,t);case"Suspend":return Uc(e.f(),t);case"Transformation":return Uc(t?e.from:e.to,t)}return[]},W0=(e,t)=>{const n={},r=[],s=[];for(let o=0;o<e.length;o++){const i=e[o],c=Uc(i,t);if(c.length>0){s.push(i);for(let a=0;a<c.length;a++){const[u,d]=c[a],h=String(d.literal);n[u]=n[u]||{buckets:{},literals:[],candidates:[]};const p=n[u].buckets;if(Object.prototype.hasOwnProperty.call(p,h)){if(a<c.length-1)continue;p[h].push(i),n[u].literals.push(d),n[u].candidates.push(i)}else{p[h]=[i],n[u].literals.push(d),n[u].candidates.push(i);break}}}else r.push(i)}return{keys:n,otherwise:r,candidates:s}},B0=e=>ni(e)?B0(e.from):e,jc=(e,t,n,r)=>{if(r?.isEffectAllowed===!0||Dt(e))return e;const s=new av,o=$s(e,{scheduler:s});s.flush();const i=o.unsafePoll();if(i){if(Sa(i))return H(i.value);const c=i.cause;return Hv(c)?z(c.error):z(new Pw(t,n,Gv(c)))}return z(new Pw(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))},vJ=([e],[t])=>e>t?1:e<t?-1:0;function On(e){return e.sort(vJ).map(t=>t[1])}const IJ=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return H;case"TypeLiteralTransformation":return n=>{let r=H(n);for(const s of e.propertySignatureTransformations){const[o,i]=t?[s.from,s.to]:[s.to,s.from],c=t?s.decode:s.encode;r=an(r,u=>{const d=c(Object.prototype.hasOwnProperty.call(u,o)?F(u[o]):P());return delete u[o],_e(d)&&(u[i]=d.value),u})}return r}}},Nt=(e,t=[])=>({value:e,forest:t}),Pl={formatIssue:e=>an(Go(e),TJ),formatIssueSync:e=>{const t=Pl.formatIssue(e);return Dt(t)?n1(t):os(t)},formatError:e=>Pl.formatIssue(e.issue),formatErrorSync:e=>Pl.formatIssueSync(e.issue)},TJ=e=>e.value+K0(`
`,e.forest),K0=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const i=o===r-1;n+=e+(i?"":"")+" "+s.value,n+=K0(e+(r>1&&!i?"  ":"   "),s.forest)}return n},OJ=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},RJ=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},H0=e=>"ast"in e?F(e.ast):P(),Zg=H(void 0),PJ=e=>H0(e).pipe(Qi(iP),Re({onNone:()=>Zg,onSome:t=>{const n=t(e);return Jt(n)?H({message:n,override:!1}):pr(n)?ie(n,r=>({message:r,override:!1})):Jt(n.message)?H({message:n.message,override:n.override}):ie(n.message,r=>({message:r,override:n.override}))}})),oS=e=>t=>t._tag===e,J0=oS("Composite"),Fw=oS("Refinement"),xw=oS("Transformation"),Xc=e=>Xr(PJ(e),t=>t!==void 0?!t.override&&(J0(e)||Fw(e)&&e.kind==="From"||xw(e)&&e.kind!=="Transformation")?xw(e)||Fw(e)?Xc(e.issue):Zg:H(t.message):Zg),V0=e=>H0(e).pipe(Qi(lP),a1(t=>t(e)),Fn);function FJ(e){return yE(e).pipe(Zr(()=>gE(e)),Zr(()=>mE(e)),Zr(()=>rd(e)),Ue(()=>`{ ${e.from} | filter }`))}function xJ(e){return e.message!==void 0?e.message:`Expected ${ni(e.ast)?FJ(e.ast):String(e.ast)}, actual ${En(e.actual)}`}const MJ=e=>an(Xc(e),t=>t??V0(e)??xJ(e)),cl=e=>V0(e)??String(e.ast),AJ=e=>e.message??"is forbidden",NJ=e=>e.message??"is unexpected",LJ=e=>{const t=cP(e.ast);if(_e(t)){const n=t.value();return Jt(n)?H(n):n}return H(e.message??"is missing")},Go=e=>{switch(e._tag){case"Type":return an(MJ(e),Nt);case"Forbidden":return H(Nt(cl(e),[Nt(AJ(e))]));case"Unexpected":return H(Nt(NJ(e)));case"Missing":return an(LJ(e),Nt);case"Transformation":return Xr(Xc(e),t=>t!==void 0?H(Nt(t)):an(Go(e.issue),n=>Nt(cl(e),[Nt(OJ(e.kind),[n])])));case"Refinement":return Xr(Xc(e),t=>t!==void 0?H(Nt(t)):an(Go(e.issue),n=>Nt(cl(e),[Nt(RJ(e.kind),[n])])));case"Pointer":return an(Go(e.issue),t=>Nt(Z$(e.path),[t]));case"Composite":return Xr(Xc(e),t=>{if(t!==void 0)return H(Nt(t));const n=cl(e);return X$(e.issues)?an(wt(e.issues,Go),r=>Nt(n,r)):an(Go(e.issues),r=>Nt(n,[r]))})}},Mw=Symbol.for("effect/Pool"),DJ={_E:e=>e,_A:e=>e},G0=e=>Vt(t=>k(fc(),n=>{const r=Xt(n,Kn),s=vy(e.acquire,a=>jr(n,a)),o=new jJ(r,s,e.concurrency??1,e.min,e.max,e.strategy,Math.min(Math.max(e.targetUtilization??1,.1),1)),i=Lr(qi(t(o.resize)),a=>r.addFinalizer(()=>ma(a))),c=Lr(qi(t(e.strategy.run(o))),a=>r.addFinalizer(()=>ma(a)));return O(o).pipe(ns(r.addFinalizer(()=>o.shutdown)),ns(i),ns(c))})),qJ=e=>G0({...e,min:e.size,max:e.size,strategy:zJ()}),UJ=e=>k(e.timeToLiveStrategy==="creation"?WJ(e.timeToLive):BJ(e.timeToLive),t=>G0({...e,strategy:t}));class jJ extends Wr{scope;acquire;concurrency;minSize;maxSize;strategy;targetUtilization;[Mw];isShuttingDown=!1;semaphore;items=new Set;available=new Set;availableLatch=pI(!1);invalidated=new Set;waiters=0;constructor(t,n,r,s,o,i,c){super(),this.scope=t,this.acquire=n,this.concurrency=r,this.minSize=s,this.maxSize=o,this.strategy=i,this.targetUtilization=c,this[Mw]=DJ,this.semaphore=Gc(r*o)}allocate=fy(gc(),t=>this.acquire.pipe(xo(t),Ln,k(n=>{const r={exit:n,finalizer:cu(t.close(n),KJ),refCount:0,disableReclaim:!1};return this.items.add(r),this.available.add(r),tt(n._tag==="Success"?this.strategy.onAcquire(r):pe(r.finalizer,this.strategy.onAcquire(r)),r)})),(t,n)=>n._tag==="Failure"?t.close(n):ee);get currentUsage(){let t=this.waiters;for(const n of this.items)t+=n.refCount;return t}get targetSize(){if(this.isShuttingDown)return 0;const t=this.currentUsage/this.targetUtilization,n=Math.ceil(t/this.concurrency);return Math.min(Math.max(this.minSize,n),this.maxSize)}get activeSize(){return this.items.size-this.invalidated.size}resizeLoop=U(()=>{if(this.activeSize>=this.targetSize)return ee;const t=this.targetSize-this.activeSize;return this.strategy.reclaim(this).pipe(k(Re({onNone:()=>this.allocate,onSome:O})),aj(t,{concurrency:t}),ns(this.availableLatch.open),k(n=>n.some(r=>r.exit._tag==="Failure")?ee:this.resizeLoop))});resizeSemaphore=Gc(1);resize=this.resizeSemaphore.withPermits(1)(this.resizeLoop);getPoolItem=Vt(t=>t(this.semaphore.take(1)).pipe(pe(Kn),k(n=>U(()=>{if(this.waiters++,this.isShuttingDown)return rt;if(this.targetSize>this.activeSize){const r=this;return k(this.resizeSemaphore.withPermitsIfAvailable(1)(Ef(xi(this.resize),this.scope)),function s(){return r.isShuttingDown?rt:r.available.size>0?O(Rp(r.available)):(r.availableLatch.unsafeClose(),k(r.availableLatch.await,s))})}return O(Rp(this.available))}).pipe(Ui(T(()=>this.waiters--)),Lr(r=>r.exit._tag==="Failure"?(this.items.delete(r),this.invalidated.delete(r),this.available.delete(r),this.semaphore.release(1)):(r.refCount++,this.available.delete(r),r.refCount<this.concurrency&&this.available.add(r),n.addFinalizer(()=>pe(U(()=>(r.refCount--,this.invalidated.has(r)?this.invalidatePoolItem(r):(this.available.add(r),It))),this.semaphore.release(1))))),Ss(()=>this.semaphore.release(1))))));commit(){return this.get}get=k(U(()=>this.isShuttingDown?rt:this.getPoolItem),t=>t.exit);invalidate(t){return U(()=>{if(this.isShuttingDown)return ee;for(const n of this.items)if(n.exit._tag==="Success"&&n.exit.value===t)return n.disableReclaim=!0,zr(this.invalidatePoolItem(n));return ee})}invalidatePoolItem(t){return U(()=>{if(this.items.has(t)){if(t.refCount===0)return this.items.delete(t),this.available.delete(t),this.invalidated.delete(t),pe(t.finalizer,Ef(xi(this.resize),this.scope))}else return ee;return this.invalidated.add(t),this.available.delete(t),ee})}get shutdown(){return U(()=>{if(this.isShuttingDown)return ee;this.isShuttingDown=!0;const t=this.items.size,n=Gc(t);return ho(this.items,r=>r.refCount>0?(r.finalizer=ns(r.finalizer,n.release(1)),this.invalidated.add(r),n.take(1)):(this.items.delete(r),this.available.delete(r),this.invalidated.delete(r),r.finalizer)).pipe(pe(this.semaphore.releaseAll),pe(this.availableLatch.open),pe(n.take(t)))})}pipe(){return N(this,arguments)}}const zJ=()=>({run:e=>ee,onAcquire:e=>ee,reclaim:e=>Ca}),WJ=e=>Kd(t=>J(Fb(),n=>{const r=$i(e),s=new WeakMap;return j({run:o=>{const i=c=>U(()=>{if(!o.items.has(c)||o.invalidated.has(c))return ee;const a=t.unsafeCurrentTimeMillis(),u=s.get(c),d=r-(a-u);return d>0?UC(i(c),d):o.invalidatePoolItem(c)});return n.take.pipe(Lr(i),Dy)},onAcquire:o=>U(()=>(s.set(o,t.unsafeCurrentTimeMillis()),n.offer(o))),reclaim:o=>Ca})})),BJ=e=>J(Fb(),t=>j({run:n=>{const r=U(()=>n.activeSize-n.targetSize<=0?ee:t.take.pipe(Lr(o=>n.invalidatePoolItem(o)),pe(r)));return r.pipe(UC(e),Dy)},onAcquire:n=>t.offer(n),reclaim(n){return U(()=>{if(n.invalidated.size===0)return Ca;const r=y1($1(n.invalidated,s=>!s.disableReclaim));return r._tag==="None"?Ca:(n.invalidated.delete(r.value),r.value.refCount<n.concurrency&&n.available.add(r.value),tt(t.offer(r.value),r))})}})),KJ=e=>se(t=>{const n=t.getFiberRef(Sy);return n._tag==="Some"&&t.log("Unhandled error in pool finalizer",e,n),ee}),HJ=dB,JJ=uB,VJ=Nv,GJ=_q,QJ=Lv,em=Symbol.for("effect/Mailbox"),Aw=Symbol.for("effect/Mailbox/ReadonlyMailbox"),Os=xe(),Nw=de(Os),al=de(!1),ul=de(!0),Lw=[Os,!0];class YJ extends Wr{scheduler;capacity;strategy;[em]=em;[Aw]=Aw;state={_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set};messages=[];messagesChunk=xe();constructor(t,n,r){super(),this.scheduler=t,this.capacity=n,this.strategy=r}offer(t){return U(()=>{if(this.state._tag!=="Open")return al;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return al;case"suspend":return this.capacity<=0&&this.state.takers.size>0?(this.messages.push(t),this.releaseTaker(),ul):this.offerRemainingSingle(t);case"sliding":return this.unsafeTake(),this.messages.push(t),ul}return this.messages.push(t),this.scheduleReleaseTaker(),ul})}unsafeOffer(t){return this.state._tag!=="Open"?!1:this.messages.length+this.messagesChunk.length>=this.capacity?this.strategy==="sliding"?(this.unsafeTake(),this.messages.push(t),!0):this.capacity<=0&&this.state.takers.size>0?(this.messages.push(t),this.releaseTaker(),!0):!1:(this.messages.push(t),this.scheduleReleaseTaker(),!0)}offerAll(t){return U(()=>{if(this.state._tag!=="Open")return O(so(t));const n=this.unsafeOfferAllArray(t);return n.length===0?Nw:this.strategy==="dropping"?O(Ye(n)):this.offerRemainingArray(n)})}unsafeOfferAll(t){return Ye(this.unsafeOfferAllArray(t))}unsafeOfferAllArray(t){if(this.state._tag!=="Open")return ge(t);if(this.capacity===Number.POSITIVE_INFINITY||this.strategy==="sliding")return this.messages.length>0&&(this.messagesChunk=Me(this.messagesChunk,Ye(this.messages))),this.strategy==="sliding"?this.messagesChunk=this.messagesChunk.pipe(Me(so(t)),EF(this.capacity)):fd(t)?this.messagesChunk=Me(this.messagesChunk,t):this.messages=ge(t),this.scheduleReleaseTaker(),[];const n=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(n===0)return ge(t);const r=[];let s=0;for(const o of t)s<n?this.messages.push(o):r.push(o),s++;return this.scheduleReleaseTaker(),r}fail(t){return this.done(ba(t))}failCause(t){return this.done(me(t))}unsafeDone(t){return this.state._tag!=="Open"?!1:this.state.offers.size===0&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(t),!0):(this.state={...this.state,_tag:"Closing",exit:t},!0)}shutdown=T(()=>{if(this.state._tag==="Done")return!0;this.messages=[],this.messagesChunk=Os;const t=this.state.offers;if(this.finalize(this.state._tag==="Open"?It:this.state.exit),t.size>0){for(const n of t)n._tag==="Single"?n.resume(al):n.resume(de(Ye(n.remaining.slice(n.offset))));t.clear()}return!0});done(t){return T(()=>this.unsafeDone(t))}end=this.done(It);clear=U(()=>{if(this.state._tag==="Done")return wl(this.state.exit,Os);const t=this.unsafeTakeAll();return this.releaseCapacity(),O(t)});takeAll=U(()=>{if(this.state._tag==="Done")return wl(this.state.exit,Lw);const t=this.unsafeTakeAll();return t.length===0?pe(this.awaitTake,this.takeAll):O([t,this.releaseCapacity()])});takeN(t){return U(()=>{if(this.state._tag==="Done")return wl(this.state.exit,Lw);if(t<=0)return O([Os,!1]);t=Math.min(t,this.capacity);let n;if(t<=this.messagesChunk.length)n=wi(this.messagesChunk,t),this.messagesChunk=Er(this.messagesChunk,t);else if(t<=this.messages.length+this.messagesChunk.length)this.messagesChunk=Me(this.messagesChunk,Ye(this.messages)),this.messages=[],n=wi(this.messagesChunk,t),this.messagesChunk=Er(this.messagesChunk,t);else return pe(this.awaitTake,this.takeN(t));return O([n,this.releaseCapacity()])})}unsafeTake(){if(this.state._tag==="Done")return iC(this.state.exit,ba(new ah));let t;if(this.messagesChunk.length>0)t=gd(this.messagesChunk),this.messagesChunk=Er(this.messagesChunk,1);else if(this.messages.length>0)t=this.messages[0],this.messagesChunk=Er(Ye(this.messages),1),this.messages=[];else return this.capacity<=0&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?de(this.messages.pop()):void 0):void 0;return this.releaseCapacity(),de(t)}take=U(()=>this.unsafeTake()??pe(this.awaitTake,this.take));await=Qr(t=>this.state._tag==="Done"?t(this.state.exit):(this.state.awaiters.add(t),T(()=>{this.state._tag!=="Done"&&this.state.awaiters.delete(t)})));unsafeSize(){const t=this.messages.length+this.messagesChunk.length;return this.state._tag==="Done"?P():F(t)}size=T(()=>this.unsafeSize());commit(){return this.takeAll}pipe(){return N(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return Oe(this)}[fe](){return Oe(this)}offerRemainingSingle(t){return Qr(n=>{if(this.state._tag!=="Open")return n(al);const r={_tag:"Single",message:t,resume:n};return this.state.offers.add(r),T(()=>{this.state._tag==="Open"&&this.state.offers.delete(r)})})}offerRemainingArray(t){return Qr(n=>{if(this.state._tag!=="Open")return n(de(Ye(t)));const r={_tag:"Array",remaining:t,offset:0,resume:n};return this.state.offers.add(r),T(()=>{this.state._tag==="Open"&&this.state.offers.delete(r)})})}releaseCapacity(){if(this.state._tag==="Done")return this.state.exit._tag==="Success";if(this.state.offers.size===0)return this.state._tag==="Closing"&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(this.state.exit),this.state.exit._tag==="Success"):!1;let t=this.capacity-this.messages.length-this.messagesChunk.length;for(const n of this.state.offers){if(t===0)return!1;if(n._tag==="Single")this.messages.push(n.message),t--,n.resume(ul),this.state.offers.delete(n);else{for(;n.offset<n.remaining.length;n.offset++){if(t===0)return!1;this.messages.push(n.remaining[n.offset]),t--}n.resume(Nw),this.state.offers.delete(n)}}return!1}awaitTake=Qr(t=>this.state._tag==="Done"?t(this.state.exit):(this.state.takers.add(t),T(()=>{this.state._tag!=="Done"&&this.state.takers.delete(t)})));scheduleRunning=!1;scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}releaseTaker=()=>{if(this.scheduleRunning=!1,this.state._tag==="Done")return;if(this.state.takers.size===0)return;const t=Rp(this.state.takers);this.state.takers.delete(t),t(It)};unsafeTakeAll(){if(this.messagesChunk.length>0){const t=this.messages.length>0?Me(this.messagesChunk,Ye(this.messages)):this.messagesChunk;return this.messagesChunk=Os,this.messages=[],t}else if(this.messages.length>0){const t=Ye(this.messages);return this.messages=[],t}else if(this.state._tag!=="Done"&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,ke(this.messages.pop());return Os}finalize(t){if(this.state._tag==="Done")return;const n=this.state;this.state={_tag:"Done",exit:t};for(const r of n.takers)r(t);n.takers.clear();for(const r of n.awaiters)r(t);n.awaiters.clear()}}const XJ=e=>se(t=>O(new YJ(t.currentScheduler,typeof e=="number"?e:e?.capacity??Number.POSITIVE_INFINITY,typeof e=="number"?"suspend":e?.strategy??"suspend"))),ZJ=e=>{const t=he(e.takeAll,([n,r])=>r?n.length===0?Ot:Te(n):Lu(Te(n),t));return t},eV=em,tV=e=>q(e,eV),Q0=XJ,nV=ZJ,rV=Symbol.for("@effect/matcher/Matcher"),sV={[rV]:{_input:j,_filters:j,_result:j,_return:j},_tag:"ValueMatcher",add(e){return this.value._tag==="Right"?this:e._tag==="When"&&e.guard(this.provided)===!0?tm(this.provided,H(e.evaluate(this.provided))):e._tag==="Not"&&e.guard(this.provided)===!1?tm(this.provided,H(e.evaluate(this.provided))):this},pipe(){return N(this,arguments)}};function tm(e,t){const n=Object.create(sV);return n.provided=e,n.value=t,n}const oV=(e,t)=>({_tag:"When",guard:e,evaluate:t}),iV=e=>tm(e,z(e)),cV=e=>(...t)=>{const n=t[t.length-1],r=t.slice(0,-1),s=r.length===1?o=>o[e]===r[0]:o=>r.includes(o[e]);return o=>o.add(oV(s,n))},aV=cV("_tag"),uV=e=>{if(e._tag==="ValueMatcher")return e.value;const t=e.cases.length;if(t===1){const n=e.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?H(n.evaluate(r)):z(r)}return n=>{for(let r=0;r<t;r++){const s=e.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return H(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return H(s.evaluate(n))}return z(n)}},Dw="effect/Match/exhaustive: absurd",lV=e=>{const t=uV(e);if(D$(t)){if(t._tag==="Right")return t.right;throw new Error(Dw)}return n=>{const r=t(n);if(r._tag==="Right")return r.right;throw new Error(Dw)}},fV=iV,Cp=aV,dV=lV,hV=qJ,pV=UJ,qw=z5,gV=l(e=>dr(e[0]),(e,...t)=>{const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}),mV=l(e=>dr(e[0]),(e,...t)=>{const n={...e};for(const r of t)delete n[r];return n}),Bi=Symbol.for("effect/Schema");function Ce(e){return class{[Bi]=nm;static ast=e;static annotations(n){return Ce(Jn(this.ast,n))}static pipe(){return N(this,arguments)}static toString(){return String(e)}static Type;static Encoded;static Context;static[Bi]=nm}}const nm={_A:e=>e,_I:e=>e,_R:e=>e},Uw={schemaId:nP,message:sE,missingMessage:Mm,identifier:Am,title:hr,description:Xa,examples:oE,default:iE,documentation:rP,jsonSchema:cE,arbitrary:aE,pretty:uE,equivalence:Nm,concurrency:lE,batching:fE,parseIssueTitle:dE,parseOptions:hE,decodingFallback:pE},Ao=e=>{if(!e)return{};const t={...e};for(const n in Uw)if(n in e){const r=Uw[n];t[r]=e[n],delete t[n]}return t},Jn=(e,t)=>_i(e,Ao(t));const Ah=e=>String(e.ast),Nh=e=>Ce(Ap(e.ast)),So=e=>Ce(Qe(e.ast)),iS=(e,t)=>{const n=Wu(e,t);return(r,s)=>Yc(n(r,s),Rh)},Bu=iS,La=(e,t)=>{const n=xh(e,t);return(r,s)=>Yc(n(r,s),Rh)},yV=(e,t)=>{const n=bJ(e,t);return(r,s)=>Tm(n(r,s),Rh)},ll=La,Ku=yV,ms=e=>q(e,Bi)&&dr(e[Bi]);function bV(e){return Dm(e)?Ut.make(AP(e,t=>new Jl(t))):new Jl(e[0])}function Y0(e,t=bV(e)){return class extends Ce(t){static annotations(r){return Y0(this.literals,Jn(this.ast,r))}static literals=[...e]}}function ce(...e){return je(e)?Y0(e):Dh}const SV=(e,t,n)=>cS(e,new od(e.map(r=>r.ast),(...r)=>t.decode(...r.map(Ce)),(...r)=>t.encode(...r.map(Ce)),Ao(n))),_V=(e,t)=>{const n=()=>(s,o,i)=>e(s)?gs(s):Ph(new Wt(i,s)),r=n;return cS([],new od([],n,r,Ao(t)))};function cS(e,t){return class extends Ce(t){static annotations(r){return cS(this.typeParameters,Jn(this.ast,r))}static typeParameters=[...e]}}const Lh=function(){if(Array.isArray(arguments[0])){const n=arguments[0],r=arguments[1],s=arguments[2];return SV(n,r,s)}const e=arguments[0],t=arguments[1];return _V(e,t)},jw=Symbol.for("effect/SchemaId/Brand"),X0=(e,t)=>n=>uO(n,new tu(n.ast,function(o,i,c){const a=e.either(o);return pt(a)?F(new Wt(c,o,a.left.map(u=>u.message).join(", "))):P()},Ao({schemaId:jw,[jw]:{constructor:e},...t})));class Z0 extends Ce(Vl){}class Ds extends Ce(wP){}class wV extends Ce(yP){}class Dh extends Ce(id){}class zw extends Ce(bE){}class Gt extends Ce(SE){}class R extends Ce(Pp){}class Pt extends Ce(Fp){}class _o extends Ce(xp){}const $V=e=>Ut.make(e.map(t=>t.ast));function eO(e,t=$V(e)){return class extends Ce(t){static annotations(r){return eO(this.members,Jn(this.ast,r))}static members=[...e]}}function ae(...e){return Dm(e)?eO(e):je(e)?e[0]:Dh}const aS=e=>ae(e,Z0),EV=(e,t)=>new ad(e.map(n=>ms(n)?new ko(n.ast,!1):n.ast),t.map(n=>ms(n)?new cd(n.ast):n.ast),!0);function tO(e,t,n=EV(e,t)){return class extends Ce(n){static annotations(s){return tO(this.elements,this.rest,Jn(this.ast,s))}static elements=[...e];static rest=[...t]}}function nO(e,t){return class extends tO([],[e],t){static annotations(r){return nO(this.value,Jn(this.ast,r))}static value=e}}const We=e=>nO(e),rm=e=>e?'"?:"':'":"';class qh extends ko{isReadonly;defaultValue;_tag="PropertySignatureDeclaration";constructor(t,n,r,s,o){super(t,n,s),this.isReadonly=r,this.defaultValue=o}toString(){const t=rm(this.isOptional),n=String(this.type);return`PropertySignature<${t}, ${n}, never, ${t}, ${n}>`}}class kV extends ko{isReadonly;fromKey;constructor(t,n,r,s,o){super(t,n,s),this.isReadonly=r,this.fromKey=o}}class Ff extends ko{isReadonly;defaultValue;constructor(t,n,r,s,o){super(t,n,s),this.isReadonly=r,this.defaultValue=o}}const CV=e=>e===void 0?"never":Jt(e)?JSON.stringify(e):String(e);class xf{from;to;decode;encode;_tag="PropertySignatureTransformation";constructor(t,n,r,s){this.from=t,this.to=n,this.decode=r,this.encode=s}toString(){return`PropertySignature<${rm(this.to.isOptional)}, ${this.to.type}, ${CV(this.from.fromKey)}, ${rm(this.from.isOptional)}, ${this.from.type}>`}}const rO=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new qh(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new xf(e.from,new Ff(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},sO=Symbol.for("effect/PropertySignature"),uS=e=>q(e,sO);class Uh{ast;[Bi];[sO]=null;_TypeToken;_Key;_EncodedToken;_HasDefault;constructor(t){this.ast=t}pipe(){return N(this,arguments)}annotations(t){return new Uh(rO(this.ast,Ao(t)))}toString(){return String(this.ast)}}const Mf=e=>new Uh(e);class jh extends Uh{from;constructor(t,n){super(t),this.from=n}annotations(t){return new jh(rO(this.ast,Ao(t)),this.from)}}const oO=e=>new jh(new qh(e.ast,!1,!0,{},void 0),e),lS=l(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":return Mf(new qh(n.type,n.isOptional,n.isReadonly,n.annotations,t));case"PropertySignatureTransformation":return Mf(new xf(n.from,new Ff(n.to.type,n.to.isOptional,n.to.isReadonly,n.to.annotations,t),n.decode,n.encode))}}),Ww=(e,t)=>Re(e,{onNone:()=>F(t()),onSome:n=>F(n===void 0?t():n)}),Af=e=>VP(e,Af,t=>{const n=Af(t.to);if(n)return new nr(t.from,n,t.transformation)}),vV=l(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":{const r=Qe(n.type);return Mf(new xf(new kV(n.type,n.isOptional,n.isReadonly,n.annotations),new Ff(Af(r)??r,!1,!0,{},n.defaultValue),s=>Ww(s,t),j))}case"PropertySignatureTransformation":{const r=n.to.type;return Mf(new xf(n.from,new Ff(Af(r)??r,!1,n.to.isReadonly,n.to.annotations,n.to.defaultValue),s=>Ww(n.decode(s),t),n.encode))}}}),iO=l(2,(e,t)=>e.pipe(vV(t.decoding),lS(t.constructor))),hn=e=>{const t=e.ast===Vl||e.ast===id?Vl:aS(e).ast;return new jh(new qh(t,!0,!0,{},void 0),e)},IV=OE([Mm]),TV=(e,t)=>{const n=Nn(e),r=[];if(n.length>0){const o=[],i=[],c=[];for(let a=0;a<n.length;a++){const u=n[a],d=e[u];if(uS(d)){const h=d.ast;switch(h._tag){case"PropertySignatureDeclaration":{const p=h.type,g=h.isOptional,y=h.annotations;o.push(new Ge(u,p,g,!0,IV(h))),i.push(new Ge(u,Qe(p),g,!0,y)),r.push(new Ge(u,p,g,!0,y));break}case"PropertySignatureTransformation":{const p=h.from.fromKey??u;o.push(new Ge(p,h.from.type,h.from.isOptional,!0,h.from.annotations)),i.push(new Ge(u,h.to.type,h.to.isOptional,!0,h.to.annotations)),c.push(new qP(p,u,h.decode,h.encode));break}}}else o.push(new Ge(u,d.ast,!1,!0)),i.push(new Ge(u,Qe(d.ast),!1,!0)),r.push(new Ge(u,d.ast,!1,!0))}if(je(c)){const a=[],u=[];for(const d of t){const{indexSignatures:h,propertySignatures:p}=US(d.key.ast,d.value.ast);p.forEach(g=>{o.push(g),i.push(new Ge(g.name,Qe(g.type),g.isOptional,g.isReadonly,g.annotations))}),h.forEach(g=>{a.push(g),u.push(new Za(g.parameter,Qe(g.type),g.isReadonly))})}return new nr(new kn(o,a,{[ti]:"Struct (Encoded side)"}),new kn(i,u,{[ti]:"Struct (Type side)"}),new Yl(c))}}const s=[];for(const o of t){const{indexSignatures:i,propertySignatures:c}=US(o.key.ast,o.value.ast);c.forEach(a=>r.push(a)),i.forEach(a=>s.push(a))}return new kn(r,s)},cO=(e,t)=>{const n=Nn(e);for(const r of n){const s=e[r];if(t[r]===void 0&&uS(s)){const o=s.ast,i=o._tag==="PropertySignatureDeclaration"?o.defaultValue:o.to.defaultValue;i!==void 0&&(t[r]=i())}}return t};function fS(e,t,n=TV(e,t)){return class extends Ce(n){static annotations(s){return fS(this.fields,this.records,Jn(this.ast,s))}static fields={...e};static records=[...t];static make=(s,o)=>{const i=cO(e,{...s});return Wh(o)?i:Mh(this)(i)};static pick(...s){return Y(gV(e,...s))}static omit(...s){return Y(mV(e,...s))}}}function Y(e,...t){return fS(e,t)}const OV=e=>ce(e).pipe(oO,lS(()=>e)),re=(e,t)=>Y({_tag:OV(e),...t});function aO(e,t,n){return class extends fS({},[{key:e,value:t}],n){static annotations(s){return aO(e,t,Jn(this.ast,s))}static key=e;static value=t}}const zh=e=>aO(e.key,e.value),RV=(...e)=>t=>Ce(Yn(t.ast,e)),PV=(...e)=>t=>Ce(WP(t.ast,e)),FV=l(2,(e,t)=>{const n=Ps(Qe(e.ast),t),r=Ce(n.isOptional?BP(n.type):n.type);return Ec(e.pipe(RV(t)),r,{strict:!0,decode:o=>o[t],encode:o=>n.isOptional&&o===void 0?{}:{[t]:o}})});function uO(e,t){return class extends Ce(t){static annotations(r){return uO(this.from,Jn(this.ast,r))}static make=(r,s)=>Wh(s)?r:Mh(this)(r);static from=e}}const xV=e=>Ce(Jo(e.ast)),Mc=(e,t,n)=>{if(Ql(e)&&Ql(t)){const r=[...e.propertySignatures];for(const s of t.propertySignatures){const o=s.name,i=r.findIndex(c=>c.name===o);if(i===-1)r.push(s);else{const{isOptional:c,type:a}=r[i];r[i]=new Ge(o,Nf(a,s.type,n.concat(o)),c,!0)}}return new kn(r,e.indexSignatures.concat(t.indexSignatures))}throw new Error(tE(e,t,n))},MV=KP([Am]),Ac=(e,t)=>t.map(n=>new tu(n,e.filter,MV(e))),Nf=(e,t,n)=>Ut.make($r([e],[t],n)),ks=e=>eu(e)?e.types:[e],$r=(e,t,n)=>Bl(e,r=>Bl(t,s=>{switch(s._tag){case"Literal":{if(Jt(s.literal)&&Gl(r)||Fr(s.literal)&&NS(r)||Xs(s.literal)&&LS(r))return[s];break}case"StringKeyword":{if(s===Pp){if(Gl(r)||Kc(r)&&Jt(r.literal))return[r];if(ni(r))return Ac(r,$r(ks(r.from),[s],n))}else if(r===Pp)return[s];break}case"NumberKeyword":{if(s===Fp){if(NS(r)||Kc(r)&&Fr(r.literal))return[r];if(ni(r))return Ac(r,$r(ks(r.from),[s],n))}else if(r===Fp)return[s];break}case"BooleanKeyword":{if(s===xp){if(LS(r)||Kc(r)&&Xs(r.literal))return[r];if(ni(r))return Ac(r,$r(ks(r.from),[s],n))}else if(r===xp)return[s];break}case"Union":return $r(ks(r),s.types,n);case"Suspend":return[new Si(()=>Nf(r,s.f(),n))];case"Refinement":return Ac(s,$r(ks(r),ks(s.from),n));case"TypeLiteral":{switch(r._tag){case"Union":return $r(r.types,[s],n);case"Suspend":return[new Si(()=>Nf(r.f(),s,n))];case"Refinement":return Ac(r,$r(ks(r.from),[s],n));case"TypeLiteral":return[Mc(r,s,n)];case"Transformation":{const o=r.transformation,i=Mc(r.from,s,n),c=Mc(r.to,Qe(s),n);switch(o._tag){case"TypeLiteralTransformation":return[new nr(i,c,new Yl(o.propertySignatureTransformations))];case"ComposeTransformation":return[new nr(i,c,kE)];case"FinalTransformation":return[new nr(i,c,new EE((a,u,d,h)=>an(o.decode(a,u,d,h),p=>({...a,...p})),(a,u,d,h)=>an(o.encode(a,u,d,h),p=>({...a,...p}))))]}}}break}case"Transformation":{if(NP(r)){if(qS(s.transformation)&&qS(r.transformation))return[new nr(Mc(r.from,s.from,n),Mc(r.to,s.to,n),new Yl(s.transformation.propertySignatureTransformations.concat(r.transformation.propertySignatureTransformations)))]}else return $r([s],[r],n);break}}throw new Error(tE(r,s,n))})),lO=l(2,(e,t)=>Ce(Nf(e.ast,t.ast,[]))),Da=e=>Ce(new Si(()=>e().ast)),fO=Symbol.for("effect/SchemaId/Refine");function dO(e,t,n){return class extends Ce(n){static annotations(s){return dO(this.from,this.filter,Jn(this.ast,s))}static[fO]=e;static from=e;static filter=t;static make=(s,o)=>Wh(o)?s:Mh(this)(s)}}const Bw=(e,t,n)=>{if(Xs(e))return e?P():F(new Wt(t,n));if(Jt(e))return F(new Wt(t,n,e));if(e!==void 0){if("_tag"in e)return F(e);const r=new Wt(t,n,e.message);return F(je(e.path)?new Et(e.path,n,r):r)}return P()},AV=(e,t,n)=>{if(J1(e))return Bw(e,t,n);if(je(e)){const r=V$(e,s=>Bw(s,t,n));if(je(r))return F(r.length===1?r[0]:new Je(t,n,r))}return P()};function hO(e,t){return n=>{function r(o,i,c){return AV(e(o,i,c),c,o)}const s=new tu(n.ast,r,Ao(t));return dO(n,r,s)}}function pO(e,t,n){return class extends Ce(n){static annotations(s){return pO(this.from,this.to,Jn(this.ast,s))}static from=e;static to=t}}const Ki=l(e=>ms(e[0])&&ms(e[1]),(e,t,n)=>pO(e,t,new nr(e.ast,t.ast,new EE(n.decode,n.encode)))),Ec=l(e=>ms(e[0])&&ms(e[1]),(e,t,n)=>Ki(e,t,{strict:!0,decode:(r,s,o,i)=>gs(n.decode(r,i)),encode:(r,s,o,i)=>gs(n.encode(r,i))})),NV=Z1,LV=e=>t=>t.pipe(hO(n=>Number.isSafeInteger(n),{schemaId:NV,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e})),DV=eP,qV=(e,t,n)=>r=>r.pipe(hO(s=>s>=e&&s<=t,{schemaId:DV,title:`between(${e}, ${t})`,description:`a number between ${e} and ${t}`,jsonSchema:{minimum:e,maximum:t},...n}));class Lf extends Pt.pipe(LV({identifier:"Int"})){}const gO=(e,t,n,r)=>mJ(e,{onFailure:s=>new Je(n,r,s),onSuccess:t});class dS extends Lh(bR,{identifier:"Uint8ArrayFromSelf",pretty:()=>t=>`new Uint8Array(${JSON.stringify(Array.from(t))})`,arbitrary:()=>t=>t.uint8Array(),equivalence:()=>nd(W)}){}class UV extends Pt.pipe(qV(0,255,{identifier:"Uint8",description:"a 8-bit unsigned integer"})){}class jV extends Ec(We(UV).annotations({description:"an array of 8-bit unsigned integers to be decoded into a Uint8Array"}),dS,{strict:!0,decode:t=>Uint8Array.from(t),encode:t=>Array.from(t)}).annotations({identifier:"Uint8Array"}){}const zV=(e,t,n)=>Ki(R.annotations({description:"a string to be decoded into a Uint8Array"}),dS,{strict:!0,decode:(r,s,o)=>Tm(t(r),i=>new Wt(o,r,i.message)),encode:r=>gs(n(r))}).annotations({identifier:e}),WV=zV("Uint8ArrayFromBase64",J5,H5),BV=Y({_tag:ce("None")}).annotations({description:"NoneEncoded"}),KV=e=>Y({_tag:ce("Some"),value:e}).annotations({description:`SomeEncoded<${Ah(e)}>`}),HV=e=>ae(BV,KV(e)).annotations({description:`OptionEncoded<${Ah(e)}>`}),mO=e=>e._tag==="None"?P():F(e.value),JV=(e,t)=>n=>n.oneof(t,n.record({_tag:n.constant("None")}),n.record({_tag:n.constant("Some"),value:e(n)})).map(mO),VV=e=>Re({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),Kw=e=>(t,n,r)=>o1(t)?qe(t)?gs(P()):gO(e(t.value,n),F,r,t):Ph(new Wt(r,t)),GV=e=>Lh([e],{decode:t=>Kw(xh(t)),encode:t=>Kw(Wu(t))},{description:`Option<${Ah(e)}>`,pretty:VV,arbitrary:JV,equivalence:f1}),QV={_tag:"None"},YV=e=>({_tag:"Some",value:e});function yO(e){const t=e;return Ec(HV(t),GV(So(t)),{strict:!0,decode:r=>mO(r),encode:r=>Re(r,{onNone:()=>QV,onSome:YV})})}const XV=e=>ms(e)||uS(e),bO=e=>Nn(e).every(t=>XV(e[t])),hS=e=>"fields"in e?e.fields:hS(e[fO]),pS=e=>bO(e)?Y(e):ms(e)?e:Y(hS(e)),gS=e=>bO(e)?e:hS(e),No=e=>(t,n)=>gi({kind:"Class",identifier:e,schema:pS(t),fields:gS(t),Base:cz,annotations:n}),SO=e=>lS(oO(ce(e)),()=>e),mr=e=>(t,n,r)=>{class s extends ab{}s.prototype.name=t;const o=gS(n),i=pS(n),c={_tag:SO(t)},a=Zc(c,o),u="message"in a;class d extends gi({kind:"TaggedError",identifier:t,schema:lO(i,Y(c)),fields:a,Base:s,annotations:r,disableToString:!0}){static _tag=t}return u||Object.defineProperty(d.prototype,"message",{get(){return`{ ${Nn(o).map(h=>`${xm(h)}: ${En(this[h])}`).join(", ")} }`},enumerable:!1,configurable:!0}),d},Zc=(e,t)=>{const n={...e};for(const r of Nn(t)){if(r in e)throw new Error(rE(r));n[r]=t[r]}return n};function Wh(e){return Xs(e)?e:e?.disableValidation??!1}const Hw=te("effect/Schema/astCache",()=>new WeakMap),ZV=e=>e===void 0?[]:Array.isArray(e)?e:[e],gi=({Base:e,annotations:t,disableToString:n,fields:r,identifier:s,kind:o,schema:i})=>{const c=Symbol.for(`effect/Schema/${o}/${s}`),[a,u,d]=ZV(t),h=So(i),p=h.annotations({identifier:s,...a}),g=h.annotations({[ti]:`${s} (Type side)`,...a}),y=i.annotations({[ti]:`${s} (Constructor)`,...a}),E=i.annotations({[ti]:`${s} (Encoded side)`,...d}),S=i.annotations({[sd]:s,...d,...a,...u}),_=C=>q(C,c)&&ct(g)(C),b=class extends e{constructor(C={},m=!1){C={...C},o!=="Class"&&delete C._tag,C=cO(r,C),Wh(m)||(C=Mh(y)(C)),super(C,!0)}static[Bi]=nm;static get ast(){let C=Hw.get(this);if(C)return C;const m=Lh([i],{decode:()=>(w,$,v)=>w instanceof this||_(w)?gs(w):Ph(new Wt(v,w)),encode:()=>(w,$)=>w instanceof this?gs(w):an(Wu(g)(w,$),v=>new this(v,!0))},{identifier:s,pretty:w=>$=>`${s}(${w($)})`,arbitrary:w=>$=>w($).map(v=>new this(v)),equivalence:j,[Hl]:p.ast,...a});return C=Ec(E,m,{strict:!0,decode:w=>new this(w,!0),encode:j}).annotations({[Hl]:S.ast,...u}).ast,Hw.set(this,C),C}static pipe(){return N(this,arguments)}static annotations(C){return Ce(this.ast).annotations(C)}static toString(){return`(${String(E)} <-> ${s})`}static make(...C){return new this(...C)}static fields={...r};static identifier=s;static extend(C){return(m,w)=>{const $=gS(m),v=pS(m),x=Zc(r,$);return gi({kind:o,identifier:C,schema:lO(i,v),fields:x,Base:this,annotations:w})}}static transformOrFail(C){return(m,w,$)=>{const v=Zc(r,m);return gi({kind:o,identifier:C,schema:Ki(i,So(Y(v)),w),fields:v,Base:this,annotations:$})}}static transformOrFailFrom(C){return(m,w,$)=>{const v=Zc(r,m);return gi({kind:o,identifier:C,schema:Ki(Nh(i),Y(v),w),fields:v,Base:this,annotations:$})}}get[c](){return c}};return n!==!0&&Object.defineProperty(b.prototype,"toString",{value(){return`${s}({ ${Nn(r).map(C=>`${xm(C)}: ${En(this[C])}`).join(", ")} })`},configurable:!0,writable:!0}),b},e4=Y({_tag:ce("None")}).annotations({identifier:"FiberIdNoneEncoded"}),t4=Y({_tag:ce("Runtime"),id:Lf,startTimeMillis:Lf}).annotations({identifier:"FiberIdRuntimeEncoded"}),n4=Y({_tag:ce("Composite"),left:Da(()=>sm),right:Da(()=>sm)}).annotations({identifier:"FiberIdCompositeEncoded"}),sm=ae(e4,t4,n4).annotations({identifier:"FiberIdEncoded"}),r4=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Df),om=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${om(e.right)}, ${om(e.left)})`}},Df=e=>{switch(e._tag){case"None":return Cn;case"Runtime":return Px(e.id,e.startTimeMillis);case"Composite":return Fx(Df(e.left),Df(e.right))}},s4=e=>Y({_tag:ce("Die"),defect:e}),o4=Y({_tag:ce("Empty")}),i4=e=>Y({_tag:ce("Fail"),error:e}),c4=Y({_tag:ce("Interrupt"),fiberId:sm});let a4=0;const im=(e,t)=>{const n=e,r=t,s=Da(()=>o),o=ae(o4,i4(n),s4(r),c4,Y({_tag:ce("Sequential"),left:s,right:s}),Y({_tag:ce("Parallel"),left:s,right:s})).annotations({title:`CauseEncoded<${Ah(e)}>`,[sd]:`CauseEncoded${a4++}`});return o},u4=(e,t)=>n=>n.letrec(r=>({Empty:n.record({_tag:n.constant("Empty")}),Fail:n.record({_tag:n.constant("Fail"),error:e(n)}),Die:n.record({_tag:n.constant("Die"),defect:t(n)}),Interrupt:n.record({_tag:n.constant("Interrupt"),fiberId:r4(n)}),Sequential:n.record({_tag:n.constant("Sequential"),left:r("Cause"),right:r("Cause")}),Parallel:n.record({_tag:n.constant("Parallel"),left:r("Cause"),right:r("Cause")}),Cause:n.oneof(r("Empty"),r("Fail"),r("Die"),r("Interrupt"),r("Sequential"),r("Parallel"))})).Cause.map(qs),l4=e=>t=>{const n=r=>{switch(r._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(r.error)})`;case"Die":return`Cause.die(${Gv(r)})`;case"Interrupt":return`Cause.interrupt(${om(r.fiberId)})`;case"Sequential":return`Cause.sequential(${n(r.left)}, ${n(r.right)})`;case"Parallel":return`Cause.parallel(${n(r.left)}, ${n(r.right)})`}};return n(t)},Jw=e=>(t,n,r)=>Tj(t)?gO(e(ei(t),n),qs,r,t):Ph(new Wt(r,t)),f4=({defect:e,error:t})=>Lh([t,e],{decode:(n,r)=>Jw(xh(im(n,r))),encode:(n,r)=>Jw(Wu(im(n,r)))},{title:`Cause<${t.ast}>`,pretty:l4,arbitrary:u4});function qs(e){switch(e._tag){case"Empty":return Cj;case"Fail":return mc(e.error);case"Die":return ji(e.defect);case"Interrupt":return oh(Df(e.fiberId));case"Sequential":return Ij(qs(e.left),qs(e.right));case"Parallel":return vj(qs(e.left),qs(e.right))}}function ei(e){switch(e._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:e.error};case"Die":return{_tag:"Die",defect:e.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:e.fiberId};case"Sequential":return{_tag:"Sequential",left:ei(e.left),right:ei(e.right)};case"Parallel":return{_tag:"Parallel",left:ei(e.left),right:ei(e.right)}}}const d4=({defect:e,error:t})=>{const n=t,r=e;return Ec(im(n,r),f4({error:So(n),defect:So(r)}),{strict:!1,decode:o=>qs(o),encode:o=>ei(o)})};class qa extends Ec(zw,zw,{strict:!0,decode:t=>{if(dr(t)&&"message"in t&&typeof t.message=="string"){const n=new Error(t.message,{cause:t});return"name"in t&&typeof t.name=="string"&&(n.name=t.name),n.stack="stack"in t&&typeof t.stack=="string"?t.stack:"",n}return String(t)},encode:t=>t instanceof Error?{name:t.name,message:t.message}:Dk(t)}).annotations({identifier:"Defect"}){}const _O=Symbol.for("effect/Schema/Serializable/symbol"),h4=e=>iS(e[_O])(e),Hu=Symbol.for("effect/Schema/Serializable/symbolResult"),Vw=e=>e[Hu].failure,Gw=e=>e[Hu].success,p4=l(2,(e,t)=>Bu(e[Hu].failure)(t)),g4=l(2,(e,t)=>Bu(e[Hu].success)(t)),Lt=e=>(t,n,r)=>{const s=Zc({_tag:SO(t)},n.payload);return class extends gi({kind:"TaggedRequest",identifier:t,schema:Y(s),fields:s,Base:AW,annotations:r}){static _tag=t;static success=n.success;static failure=n.failure;get[_O](){return this.constructor}get[Hu](){return{failure:n.failure,success:n.success}}}},wO=e=>Rn(e.ast,[]),m4=Mt(Nm),Rn=(e,t)=>{const n=m4(e);if(_e(n))switch(e._tag){case"Declaration":return n.value(...e.typeParameters.map(r=>Rn(r,t)));case"Refinement":return n.value(Rn(e.from,t));default:return n.value()}switch(e._tag){case"NeverKeyword":throw new Error(V1(e,t));case"Transformation":return Rn(e.to,t);case"Declaration":case"Literal":case"StringKeyword":case"TemplateLiteral":case"UniqueSymbol":case"SymbolKeyword":case"UnknownKeyword":case"AnyKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"UndefinedKeyword":case"VoidKeyword":case"Enums":case"ObjectKeyword":return W;case"Refinement":return Rn(e.from,t);case"Suspend":{const r=Fm(()=>Rn(e.f(),t));return(s,o)=>r()(s,o)}case"TupleType":{const r=e.elements.map((o,i)=>Rn(o.type,t.concat(i))),s=e.rest.map(o=>Rn(o.type,t));return Us((o,i)=>{const c=o.length;if(c!==i.length)return!1;let a=0;for(;a<Math.min(c,e.elements.length);a++)if(!r[a](o[a],i[a]))return!1;if(je(s)){const[u,...d]=s;for(;a<c-d.length;a++)if(!u(o[a],i[a]))return!1;for(let h=0;h<d.length;h++)if(a+=h,!d[h](o[a],i[a]))return!1}return!0})}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return W;const r=e.propertySignatures.map(o=>Rn(o.type,t.concat(o.name))),s=e.indexSignatures.map(o=>Rn(o.type,t));return Us((o,i)=>{const c=Object.keys(o),a=Object.getOwnPropertySymbols(o);for(let h=0;h<r.length;h++){const p=e.propertySignatures[h],g=p.name,y=Object.prototype.hasOwnProperty.call(o,g),E=Object.prototype.hasOwnProperty.call(i,g);if(p.isOptional&&y!==E||y&&E&&!r[h](o[g],i[g]))return!1}let u,d;for(let h=0;h<s.length;h++){const p=e.indexSignatures[h],g=no(p.parameter),y=Lm(g);if(y){if(u=u||Object.getOwnPropertySymbols(i),a.length!==u.length)return!1}else if(d=d||Object.keys(i),c.length!==d.length)return!1;const E=y?a:c;for(let S=0;S<E.length;S++){const _=E[S];if(!Object.prototype.hasOwnProperty.call(i,_)||!s[h](o[_],i[_]))return!1}}return!0})}case"Union":{const r=W0(e.types,!0),s=Nn(r.keys),o=s.length;return Us((i,c)=>{let a=[];if(o>0&&Gf(i))for(let d=0;d<o;d++){const h=s[d],p=r.keys[h].buckets;if(Object.prototype.hasOwnProperty.call(i,h)){const g=String(i[h]);Object.prototype.hasOwnProperty.call(p,g)&&(a=a.concat(p[g]))}}r.otherwise.length>0&&(a=a.concat(r.otherwise));const u=a.map(d=>[Rn(d,t),ct({ast:d})]);for(let d=0;d<u.length;d++){const[h,p]=u[d];if(p(i)&&p(c)&&h(i,c))return!0}return!1})}}},y4=n5,b4=r5,S4=c5,_4=Rf,w4=a5,$4=u5,wo=f5,$O=d5,E4=h5,Ua=Oh,k4=v0,EO=T0,Hi=Na,C4=S5,Lo=Pf,v4=w5,I4=fJ,T4=E5,O4=k5,R4=v5,P4=T5,qn=O5,F4=R0,kO=nS,qf=P5,is=F5,x4=x5,Qw=P0,M4=rS,A4=L5,Bh=D5,Yw=Symbol.for("effect/Subscribable"),N4=gI,L4="effect/SubscriptionRef",D4=Symbol.for(L4),q4={_A:e=>e};class U4 extends Wr{ref;pubsub;semaphore;[Ai]=Ai;[Yw]=Yw;[bL]=Ny;[N4]=mI;[D4]=q4;constructor(t,n,r){super(),this.ref=t,this.pubsub=n,this.semaphore=r,this.get=ss(this.ref)}commit(){return this.get}get;get changes(){return f(ss(this.ref),D(t=>ie(T0(this.pubsub,{scoped:!0}),n=>o5(_5(t),n))),this.semaphore.withPermits(1),rS)}modify(t){return this.modifyEffect(n=>Se(t(n)))}modifyEffect(t){return f(ss(this.ref),D(t),D(([n,r])=>f(Su(this.ref,r),Pr(n),_b(Mb(this.pubsub,r)))),this.semaphore.withPermits(1))}}const j4=e=>ss(e.ref),z4=e=>f(fb([oT(),Fo(e),Sb(1)]),ie(([t,n,r])=>new U4(n,t,r))),W4=l(2,(e,t)=>f(Su(e.ref,t),_b(Mb(e.pubsub,t)),e.semaphore.withPermits(1))),B4=j4,CO=z4,ea=W4,vO=e=>t=>v4(t,n=>f(e(n),ie(()=>n))),Uf=l(2,(e,t)=>f(e.changes,wo(t),qf(1),P4,ie(gd))),K4=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,H4=e=>HJ(VJ,GJ({formatDate:t=>`${K4(t)} ${e}`})),J4={};var V4={};const IO=()=>typeof process<"u"&&V4!==void 0||J4!==void 0?!1:!!(typeof globalThis<"u"&&globalThis.__DEV__),G4=e=>{const t=e?.toString();if(t!=="[object Object]")return t;try{return JSON.stringify(e,null,2)}catch(n){return console.log(e),"Error while printing error: "+n}},cm=e=>e!==void 0&&e.toLowerCase()!=="false"&&e.toLowerCase()!=="0",qt=(e,...t)=>{if(console.error(e,...t),IO())debugger;throw new Error(`This should never happen: ${e}`)};var Rs;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(Rs||(Rs={}));const Q4=Symbol.for("@effect/opentelemetry/Tracer/OtelSpan");Rs.INTERNAL,Rs.CLIENT,Rs.SERVER,Rs.PRODUCER,Rs.CONSUMER;const Y4=D(wb,e=>Q4 in e?Se(e.span):zn(new ah)),TO=Y4,fl=(e,t,n=" ")=>e.split(`
`).map(r=>n.repeat(t)+r).join(`
`),Xw=e=>e!==void 0,Zw={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var e$={};const ja=e=>{if(typeof process<"u"&&e$!==void 0)return e$[e];if(Zw!==void 0)return Zw[e]};ja("LS_TRACE_VERBOSE")!==void 0||ja("VITE_LS_TRACE_VERBOSE");const za=cm(ja("LS_DEV"))||cm(ja("VITE_LS_DEV"));cm(ja("CI"));function OO(e){debugger;throw new Error(`A case was not handled for value: ${X4(G4(e),1e3)}`)}const X4=(e,t)=>e.length>t?e.slice(0,t)+"...":e,Do=e=>L(function*(){const t=yield*lh();return yield*gr(n=>mt(t,n)),yield*e(t).pipe(uh(t))}),Z4=(...e)=>gr(()=>VI(...e)),kt=e=>bc(e,t=>L(function*(){if(Js(t))return;const n=yield*TO.pipe(DI("NoSuchElementException",s=>Se(void 0))),r=t.toString().split(`
`)[0];yield*vg(r,t).pipe(s=>n===void 0?s:Vs({spanId:n.spanContext().spanId,traceId:n.spanContext().traceId})(s))})),ln=(e,t)=>GW(VI(e).pipe(Vs(t??{})),iB,()=>Ed(QJ)),t$=({label:e,duration:t})=>n=>L(function*(){const r=yield*ws();let s=!1;const o=mb(t).pipe(Dn(()=>(s=!0,or(`${e}: Took longer than ${t}ms`))),dn(r),$s),i=Date.now(),c=yield*n.pipe(Ze,qI(Eb(function*(){const a=Date.now();yield*Zt(o),s&&(yield*or(`${e}: Interrupted after ${a-i}ms`))})));if(s){const a=Date.now();yield*or(`${e}: Actual duration: ${a-i}ms`)}return yield*Zt(o),yield*c}),RO=()=>{const e=Zz();return e._tag==="None"||e.value.currentSpan===void 0?"No current fiber":""},eG=()=>console.log(RO());globalThis.getSpanTrace=RO;globalThis.logSpanTrace=eG;const PO=(e,t)=>{class n extends ab{_tag=t}return n.prototype[e]=e,n.prototype.name=t,n},n$=Symbol.for("@effect/platform/Cookies"),r$=Symbol.for("@effect/platform/Cookies/Cookie"),tG={[n$]:n$,...Zf,toJSON(){return{_id:"@effect/platform/Cookies",cookies:E1(this.cookies,e=>e.toJSON())}},pipe(){return N(this,arguments)}},nG=e=>{const t=Object.create(tG);return t.cookies=e,t},rG=e=>{const t={};for(const n of e)t[n.name]=n;return nG(t)},sG=e=>{const t=typeof e=="string"?[e]:e,n=[];for(const r of t){const s=oG(r.trim());_e(s)&&n.push(s.value)}return rG(n)};function oG(e){const t=e.split(";").map(c=>c.trim()).filter(c=>c!=="");if(t.length===0)return P();const n=t[0].indexOf("=");if(n===-1)return P();const r=t[0].slice(0,n);if(!iG.test(r))return P();const s=t[0].slice(n+1),o=cG(s);if(t.length===1)return F(Object.assign(Object.create(s$),{name:r,value:o,valueEncoded:s}));const i={};for(let c=1;c<t.length;c++){const a=t[c],u=a.indexOf("="),d=u===-1?a:a.slice(0,u).trim(),h=u===-1?void 0:a.slice(u+1).trim();switch(d.toLowerCase()){case"domain":{if(h===void 0)break;const p=h.trim().replace(/^\./,"");p&&(i.domain=p);break}case"expires":{if(h===void 0)break;const p=new Date(h);isNaN(p.getTime())||(i.expires=p);break}case"max-age":{if(h===void 0)break;const p=parseInt(h,10);isNaN(p)||(i.maxAge=jm(p));break}case"path":{if(h===void 0)break;h[0]==="/"&&(i.path=h);break}case"priority":{if(h===void 0)break;switch(h.toLowerCase()){case"low":i.priority="low";break;case"medium":i.priority="medium";break;case"high":i.priority="high";break}break}case"httponly":{i.httpOnly=!0;break}case"secure":{i.secure=!0;break}case"partitioned":{i.partitioned=!0;break}case"samesite":{if(h===void 0)break;switch(h.toLowerCase()){case"lax":i.sameSite="lax";break;case"strict":i.sameSite="strict";break;case"none":i.sameSite="none";break}break}}}return F(Object.assign(Object.create(s$),{name:r,value:o,valueEncoded:s,options:Object.keys(i).length>0?i:void 0}))}const iG=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,s$={[r$]:r$,...Zf,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}},cG=e=>{try{return decodeURIComponent(e)}catch{return e}},o$=Symbol.for("@effect/platform/Headers"),Wa=Object.assign(Object.create(null),{[o$]:o$,[ed](e){return um(this,Hd(e,xO))}}),Kh=e=>Object.assign(Object.create(Wa),e),FO=Object.create(Wa),mS=e=>{if(e===void 0)return FO;if(Symbol.iterator in e){const n=Object.create(Wa);for(const[r,s]of e)n[r.toLowerCase()]=s;return n}const t=Object.create(Wa);for(const[n,r]of Object.entries(e))Array.isArray(r)?t[n.toLowerCase()]=r.join(", "):r!==void 0&&(t[n.toLowerCase()]=r);return t},aG=e=>Object.setPrototypeOf(e,Wa),am=l(3,(e,t,n)=>{const r=Kh(e);return r[t.toLowerCase()]=n,r}),uG=l(2,(e,t)=>Kh({...e,...mS(t)})),lG=l(2,(e,t)=>{const n=Kh(e);return Object.assign(n,t),n}),fG=l(2,(e,t)=>{const n=Kh(e),r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&delete n[o]}else for(const o in e)s.test(o)&&delete n[o]};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),um=l(2,(e,t)=>{const n={...e},r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&(n[o]=qw(e[o]))}else for(const o in e)s.test(o)&&(n[o]=qw(e[o]))};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),xO=te("@effect/platform/Headers/currentRedactedNames",()=>kb(["authorization","cookie","set-cookie","x-api-key"])),dG=Symbol.for("@effect/platform/HttpClientError"),MO=dG;class AO extends PO(MO,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class Cs extends PO(MO,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){const t=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${t})`:`${this.reason} error (${t})`}}const yS=e=>{const t=NO(e),n=[];for(let r=0;r<t.length;r++)if(Array.isArray(t[r][0])){const[s,o]=t[r];n.push([`${s[0]}[${s.slice(1).join("][")}]`,o])}else n.push(t[r]);return n},NO=e=>{const t=Symbol.iterator in e?ge(e):Object.entries(e),n=[];for(const[r,s]of t)if(Array.isArray(s))for(let o=0;o<s.length;o++)s[o]!==void 0&&n.push([r,String(s[o])]);else if(typeof s=="object"){const o=NO(s);for(const[i,c]of o)n.push([[r,...typeof i=="string"?[i]:i],c])}else s!==void 0&&n.push([r,String(s)]);return n},hG=[],pG=l(2,(e,t)=>{const n=yS(t),r=n.map(([s])=>s);return Rm(G$(e,([s])=>r.includes(s)),n)}),gG=(e,t,n)=>{try{const r=new URL(e,mG());for(let s=0;s<t.length;s++){const[o,i]=t[s];i!==void 0&&r.searchParams.append(o,i)}return n._tag==="Some"&&(r.hash=n.value),H(r)}catch(r){return z(r)}},mG=()=>{if("location"in globalThis&&globalThis.location!==void 0&&globalThis.location.origin!==void 0&&globalThis.location.pathname!==void 0)return location.origin+location.pathname},ta=Symbol.for("@effect/platform/HttpIncomingMessage"),yG=(e,t)=>{const n=e.headers["content-type"]??"";let r;if(n.includes("application/json"))try{r=os(e.json)}catch{}else if(n.includes("text/")||n.includes("urlencoded"))try{r=os(e.text)}catch{}const s={...t,headers:Zs(e.headers),remoteAddress:e.remoteAddress.toJSON()};return r!==void 0&&(s.body=r),s},bG=e=>aG({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${e.parent._tag==="Some"?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),vp=Symbol.for("@effect/platform/HttpBody");class SG{[vp];constructor(){this[vp]=vp}[fe](){return this.toJSON()}toString(){return Oe(this)}}class _G extends SG{_tag="Empty";toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}const wG=new _G,i$=Symbol.for("@effect/platform/HttpClientRequest"),$G={[i$]:i$,...Zf,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:Zs(this.headers),body:this.body.toJSON()}},pipe(){return N(this,arguments)}};function Dr(e,t,n,r,s,o){const i=Object.create($G);return i.method=e,i.url=t,i.urlParams=n,i.hash=r,i.headers=s,i.body=o,i}const EG=Dr("GET","",hG,P(),FO,wG),qo=e=>(t,n)=>PG(EG,{method:e,url:t,...n??void 0}),kG=qo("GET"),CG=qo("POST"),vG=qo("PUT"),IG=qo("PATCH"),TG=qo("DELETE"),OG=qo("HEAD"),RG=qo("OPTIONS"),PG=l(2,(e,t)=>{let n=e;return t.method&&(n=MG(n,t.method)),t.url&&(n=AG(n,t.url)),t.headers&&(n=LO(n,t.headers)),t.urlParams&&(n=NG(n,t.urlParams)),t.hash&&(n=LG(n,t.hash)),t.body&&(n=DG(n,t.body)),t.accept&&(n=DO(n,t.accept)),t.acceptJson&&(n=xG(n)),n}),FG=l(3,(e,t,n)=>Dr(e.method,e.url,e.urlParams,e.hash,am(e.headers,t,n),e.body)),LO=l(2,(e,t)=>Dr(e.method,e.url,e.urlParams,e.hash,uG(e.headers,t),e.body)),DO=l(2,(e,t)=>FG(e,"Accept",t)),xG=DO("application/json"),MG=l(2,(e,t)=>Dr(t,e.url,e.urlParams,e.hash,e.headers,e.body)),AG=l(2,(e,t)=>{if(typeof t=="string")return Dr(e.method,t,e.urlParams,e.hash,e.headers,e.body);const n=new URL(t.toString()),r=yS(n.searchParams),s=n.hash?F(n.hash.slice(1)):P();return n.search="",n.hash="",Dr(e.method,n.toString(),r,s,e.headers,e.body)}),NG=l(2,(e,t)=>Dr(e.method,e.url,pG(e.urlParams,t),e.hash,e.headers,e.body)),LG=l(2,(e,t)=>Dr(e.method,e.url,e.urlParams,F(t),e.headers,e.body)),DG=l(2,(e,t)=>{let n=e.headers;if(t._tag==="Empty"||t._tag==="FormData")n=fG(n,["Content-type","Content-length"]);else{const r=t.contentType;r&&(n=am(n,"content-type",r));const s=t.contentLength;s&&(n=am(n,"content-length",s.toString()))}return Dr(e.method,e.url,e.urlParams,e.hash,n,t)}),na=Symbol.for("@effect/platform/HttpClientResponse"),qG=(e,t)=>new UG(e,t);class UG extends NR{request;source;[ta];[na];constructor(t,n){super(),this.request=t,this.source=n,this[ta]=ta,this[na]=na}toJSON(){return yG(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return mS(this.source.headers)}cachedCookies;get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=sG(this.source.headers.getSetCookie())}get remoteAddress(){return P()}get stream(){return this.source.body?C4(()=>this.source.body,t=>new Cs({request:this.request,response:this,reason:"Decode",cause:t})):$4(new Cs({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return jW(this.text,{try:t=>t===""?null:JSON.parse(t),catch:t=>new Cs({request:this.request,response:this,reason:"Decode",cause:t})})}textBody;get text(){return this.textBody??=Qc({try:()=>this.source.text(),catch:t=>new Cs({request:this.request,response:this,reason:"Decode",cause:t})}).pipe(lp,os)}get urlParamsBody(){return D(this.text,t=>Pu({try:()=>yS(new URLSearchParams(t)),catch:n=>new Cs({request:this.request,response:this,reason:"Decode",cause:n})}))}formDataBody;get formData(){return this.formDataBody??=Qc({try:()=>this.source.formData(),catch:t=>new Cs({request:this.request,response:this,reason:"Decode",cause:t})}).pipe(lp,os)}arrayBufferBody;get arrayBuffer(){return this.arrayBufferBody??=Qc({try:()=>this.source.arrayBuffer(),catch:t=>new Cs({request:this.request,response:this,reason:"Decode",cause:t})}).pipe(lp,os)}}const c$=Symbol.for("@effect/platform/HttpClient"),qO=sn("@effect/platform/HttpClient"),jG=te(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>kb(An)),zG=te(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>kb(!0)),WG=Xi()("@effect/platform/HttpClient/SpanNameGenerator",{defaultValue:()=>e=>`http.client ${e.method}`}),BG={[c$]:c$,pipe(){return N(this,arguments)},...Zf,toJSON(){return{_id:"@effect/platform/HttpClient"}},get(e,t){return this.execute(kG(e,t))},head(e,t){return this.execute(OG(e,t))},post(e,t){return this.execute(CG(e,t))},put(e,t){return this.execute(vG(e,t))},patch(e,t){return this.execute(IG(e,t))},del(e,t){return this.execute(TG(e,t))},options(e,t){return this.execute(RG(e,t))}},UO=(e,t)=>{const n=Object.create(BG);return n.preprocess=t,n.postprocess=e,n.execute=function(r){return e(t(r))},n},jf=te("@effect/platform/HttpClient/responseRegistry",()=>{if("FinalizationRegistry"in globalThis&&globalThis.FinalizationRegistry){const t=new FinalizationRegistry(n=>{n.abort()});return{register(n,r){t.register(n,r,n)},unregister(n){t.unregister(n)}}}const e=new Map;return{register(t,n){e.set(t,setTimeout(()=>n.abort(),5e3))},unregister(t){const n=e.get(t);n!==void 0&&(clearTimeout(n),e.delete(t))}}}),KG=e=>UO(t=>D(t,n=>fs(r=>{const s=new AbortController,o=gG(n.url,n.urlParams,n.hash);if(o._tag==="Left")return zn(new AO({request:n,reason:"InvalidUrl",cause:o.left}));const i=o.right;if(!r.getFiberRef(cB)||r.getFiberRef(jG)(n))return hs(u=>$n(u(e(n,i,s.signal,r)),{onSuccess(d){return jf.register(d,s),Se(new a$(d,s))},onFailure(d){return Oa(d)&&s.abort(),Ht(d)}}));const a=Xt(r.currentContext,WG);return nB(a(n),{kind:"client",captureStackTrace:!1},u=>{u.attribute("http.request.method",n.method),u.attribute("server.address",i.origin),i.port!==""&&u.attribute("server.port",+i.port),u.attribute("url.full",i.toString()),u.attribute("url.path",i.pathname),u.attribute("url.scheme",i.protocol.slice(0,-1));const d=i.search.slice(1);d!==""&&u.attribute("url.query",d);const h=r.getFiberRef(xO),p=um(n.headers,h);for(const g in p)u.attribute(`http.request.header.${g}`,String(p[g]));return n=r.getFiberRef(zG)?LO(n,bG(u)):n,hs(g=>g(e(n,i,s.signal,r)).pipe(As(u),$n({onSuccess:y=>{u.attribute("http.response.status_code",y.status);const E=um(y.headers,h);for(const S in E)u.attribute(`http.response.header.${S}`,String(E[S]));return jf.register(y,s),Se(new a$(y,s))},onFailure(y){return Oa(y)&&s.abort(),Ht(y)}})))})})),Se);class a${original;controller;constructor(t,n){this.original=t,this.controller=n}[na]=na;[ta]=ta;applyInterrupt(t){return ve(()=>(jf.unregister(this.original),qI(t,()=>Z(()=>{this.controller.abort()}))))}get request(){return this.original.request}get status(){return this.original.status}get headers(){return this.original.headers}get cookies(){return this.original.cookies}get remoteAddress(){return this.original.remoteAddress}get formData(){return this.applyInterrupt(this.original.formData)}get text(){return this.applyInterrupt(this.original.text)}get json(){return this.applyInterrupt(this.original.json)}get urlParamsBody(){return this.applyInterrupt(this.original.urlParamsBody)}get arrayBuffer(){return this.applyInterrupt(this.original.arrayBuffer)}get stream(){return kO(()=>(jf.unregister(this.original),w4(this.original.stream,t=>(M2(t)&&this.controller.abort(),ne))))}toJSON(){return this.original.toJSON()}[fe](){return this.original[fe]()}}const{del:m8,execute:y8,get:b8,head:S8,options:_8,patch:w8,post:$8,put:E8}=HW(qO),HG=l(2,(e,t)=>{const n=e;return UO(r=>t(n.postprocess(r)),n.preprocess)}),JG=e=>vb(qO,D(KI(),t=>ie(e,n=>HG(n,KW(r=>jr(t,r)))))),VG="@effect/platform/FetchHttpClient/Fetch",GG="@effect/platform/FetchHttpClient/FetchOptions",QG=KG((e,t,n,r)=>{const s=r.getFiberRef(Cb),o=s.unsafeMap.get(VG)??globalThis.fetch,i=s.unsafeMap.get(GG)??{},c=i.headers?lG(mS(i.headers),e.headers):e.headers,a=u=>ie(Qc({try:()=>o(t,{...i,method:e.method,headers:c,body:u,duplex:e.body._tag==="Stream"?"half":void 0,signal:n}),catch:d=>new AO({request:e,reason:"Transport",cause:d})}),d=>qG(e,d));switch(e.body._tag){case"Raw":case"Uint8Array":return a(e.body.body);case"FormData":return a(e.body.formData);case"Stream":return D(x4(e.body.stream),a)}return a(void 0)}),YG=JG(Se(QG)),XG=YG;class Ys extends DE("@effect/platform/Transferable/Collector")(){}const bS=()=>{let e=[];const t=s=>{e.push(...s)},n=()=>e,r=()=>{const s=e;return e=[],s};return Ys.of({unsafeAddAll:t,addAll:s=>Z(()=>t(s)),unsafeRead:n,read:Z(n),unsafeClear:r,clear:Z(r)})},ZG=Z(bS),e6=e=>D(JW(Ys),Re({onNone:()=>ne,onSome:t=>t.addAll(e)})),jO=l(2,(e,t)=>Ki(Nh(e),e,{strict:!0,decode:gs,encode:n=>Pr(e6(t(n)),n)})),Hh=jO(Gt,e=>[e]),mi=jO(dS,e=>[e.buffer]),t6=Symbol.for("@effect/platform/WorkerError"),lm=t6,n6=e=>q(e,lm);class tn extends mr()("WorkerError",{reason:ce("spawn","decode","send","unknown","encode"),cause:qa}){[lm]=lm;static Cause=d4({error:this,defect:qa});static encodeCause=z0(this.Cause);static decodeCause=_J(this.Cause);get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}}const u$=Symbol.for("@effect/platform/Worker/PlatformWorker"),SS=sn("@effect/platform/Worker/PlatformWorker"),l$=Symbol.for("@effect/platform/Worker/WorkerManager"),Ba=sn("@effect/platform/Worker/WorkerManager"),zO=sn("@effect/platform/Worker/Spawner"),r6=L(function*(){const e=yield*SS;let t=0;return Ba.of({[l$]:l$,spawn({encode:n,initialMessage:r}){return L(function*(){const s=t++;let o=0;const i=new Map,c=bS(),a=n?S=>Ie(c.clear,ai(n(S),Ys,c)):Se,u=yield*ue(),d=yield*e.spawn(s);yield*d.run(S=>S[0]===0?P2(u,ne):h(S[1])).pipe(zI(S=>wt(i.values(),_=>Es in _?Jc(_,S):_.failCause(S))),bc(or),pb(R3(1e3)),Vs({package:"@effect/platform",module:"Worker"}),at,gn),yield*gr(()=>Ie(wt(i.values(),S=>Es in S?d_(S):S.end,{discard:!0}),Z(()=>i.clear())));const h=S=>ve(()=>{const _=i.get(S[0]);if(!_)return ne;switch(S[1]){case 0:return Es in _?De(_,S[2][0]):_.offerAll(S[2]);case 1:return S.length===2?Es in _?d_(_):_.end:Es in _?De(_,S[2][0]):Ie(_.offerAll(S[2]),_.end);case 2:case 3:{if(S[1]===2)return Es in _?uC(_,S[2]):_.fail(S[2]);const b=tn.decodeCause(S[2]);return Es in _?Jc(_,b):_.failCause(b)}}}),p=(S,_)=>fs(b=>{const C=b.getFiberRef(Cb),m=Ur(C,PC).pipe(l1($=>$._tag==="Span")),w=o++;return _.pipe(Dn($=>(i.set(w,$),a(S).pipe(Dn(v=>d.send([w,0,v,m._tag==="Some"?[m.value.traceId,m.value.spanId,m.value.sampled]:void 0],c.unsafeRead())),ds(v=>tV($)?$.failCause(v):Jc($,v))))),ie($=>({id:w,mailbox:$})))}),g=({id:S},_)=>{const b=Z(()=>i.delete(S));return hc(_)?Ie(er(d.send([S,1])),b):b},y=S=>k4(q5(p(S,Q0()),({mailbox:_})=>nV(_),g)),E=S=>jI(p(S,ue()),({mailbox:_})=>Le(_),g);return yield*Le(u),r&&(yield*Z(r).pipe(D(E),fr(S=>new tn({reason:"spawn",cause:S})))),{id:s,execute:y,executeEffect:E}})}})}),s6=vb(Ba,r6),o6=e=>L(function*(){const n=yield*(yield*Ba).spawn({...e,encode(o){return fr(h4(o),i=>new tn({reason:"encode",cause:i}))}}),r=o=>{const i=ll(Gw(o)),c=ll(Vw(o));return f(n.execute(o),b4(a=>D(c(a),zn)),I4(i))},s=o=>{const i=ll(Gw(o)),c=ll(Vw(o));return YW(n.executeEffect(o),{onFailure:a=>D(c(a),zn),onSuccess:i})};return j({id:n.id,execute:r,executeEffect:s})}),i6=e=>L(function*(){const t=yield*Ba,n=new Set,r=f(o6(e),Dn(i=>Z(()=>n.add(i))),Dn(i=>gr(()=>Z(()=>n.delete(i)))),e.onCreate?Dn(e.onCreate):j,ai(Ba,t)),s=yield*"timeToLive"in e?pV({acquire:r,min:e.minSize,max:e.maxSize,concurrency:e.concurrency,targetUtilization:e.targetUtilization,timeToLive:e.timeToLive}):hV({acquire:r,size:e.size,concurrency:e.concurrency,targetUtilization:e.targetUtilization}),o={backing:s,broadcast:i=>wt(n,c=>c.executeEffect(i),{concurrency:"unbounded",discard:!0}),execute:i=>M4(ie(s.get,c=>c.execute(i))),executeEffect:i=>yo(D(s.get,c=>c.executeEffect(i)))};return yield*yo(s.get),o}),c6=e=>YI(zO,e),a6=()=>e=>SS.of({[u$]:u$,spawn(t){return L(function*(){const n=yield*zO;let r;const s=[];return{run:c=>hs(a=>L(function*(){const u=yield*hh,d=yield*e.setup({worker:n(t),scope:u});r=d,yield*vn(u,Z(()=>{r=void 0}));const h=(yield*ws()).pipe(n0(LE(tI))),p=yield*A0(),g=Hb(h);if(yield*e.listen({port:d,scope:u,emit(y){Yg(p,g(c(y)))},deferred:p.deferred}),s.length>0){for(const[y,E]of s)d.postMessage([0,y],E);s.length=0}return yield*a(oJ(p))}).pipe(yo)),send:(c,a)=>Pu({try:()=>{r===void 0?s.push([c,a]):r.postMessage([0,c],a)},catch:u=>new tn({reason:"send",cause:u})})}})}}),u6=a6,l6=SS,f6=s6,d6=i6,h6=c6,p6=Symbol.for("@effect/platform/Runner/PlatformRunner"),WO=sn("@effect/platform/Runner/PlatformRunner"),BO=Xi()("@effect/platform/WorkerRunner/CloseLatch",{defaultValue:()=>F2(Cn)}),g6=vb(BO,ue()),m6=Og(function*(e,t){const n=yield*fs(Se),r=yield*WO,s=yield*BO,o=yield*r.start(s),i=new Map;yield*Le(s).pipe(WW(()=>(n.currentScheduler.scheduleTask(()=>{n.unsafeInterruptAsFork(n.id())},0),ne)),gn),yield*o.run((c,[a,u,d,h])=>{if(u===1){const p=i.get(a);return p?Zt(p):ne}return fs(p=>(i.set(a,p),t?.decode?t.decode(d):Se(d))).pipe(D(p=>{const g=bS(),y=e(p);let E=pr(y)?D(y,S=>f(t?.encodeOutput?ai(t.encodeOutput(p,S),Ys,g):Se(S),D(_=>o.send(c,[a,0,[_]],g.unsafeRead())))):f(y,F4(S=>{if(t?.encodeOutput===void 0){const _=fn(S);return o.send(c,[a,0,_])}return g.unsafeClear(),f(wt(S,_=>t.encodeOutput(p,_)),ai(Ys,g),D(_=>o.send(c,[a,0,_],g.unsafeRead())))}),ui(o.send(c,[a,1])));return h&&(E=As(E,{_tag:"ExternalSpan",traceId:h[0],spanId:h[1],sampled:h[2],context:as()})),hs(S=>S(E).pipe(qW(n6,_=>o.send(c,[a,3,tn.encodeCause(mc(_))])),ds(_=>vt(ih(_),{onLeft:b=>(g.unsafeClear(),f(t?.encodeError?ai(t.encodeError(p,b),Ys,g):Se(b),D(C=>o.send(c,[a,2,C],g.unsafeRead())),ds(C=>o.send(c,[a,3,tn.encodeCause(C)])))),onRight:b=>o.send(c,[a,3,tn.encodeCause(b)])}))))}),Ms(Z(()=>i.delete(a))))})}),y6=(e,t)=>L(function*(){const n=yield*hh;let r=as();const s=La(e);return yield*m6(o=>{const i=t[o._tag](o);return pB(i)?D(mB(i,n),c=>Z(()=>{r=jr(r,c)})):pr(i)?dn(i,r):R4(i,r)},{decode(o){return fr(s(o),i=>new tn({reason:"decode",cause:i}))},encodeError(o,i){return fr(p4(o,i),c=>new tn({reason:"encode",cause:c}))},encodeOutput(o,i){return ds(g4(o,i),c=>new tn({reason:"encode",cause:c}))}})}),b6=(e,t)=>_B(y6(e,t)).pipe(Ib(g6)),f$=p6,KO=WO,S6=b6,_6=e=>(t,n)=>{const r=[];return fm(e.ast,t,n,"",r),r},fm=(e,t,n,r,s)=>{if(wO({ast:e})(t,n)===!1)if(eu(e))if(w6(e)){s.push({path:r,a:t,b:n,ast:e});return}else for(const i of e.types)try{fm(i,t,n,r,s);return}catch{}else if(Ql(e)){const i=Hc(e);for(const c of i)fm(c.type,t[c.name],n[c.name],`${r}.${c.name.toString()}`,s)}else s.push({path:r,a:t,b:n,ast:e})},w6=e=>{if(eu(e))return e.types.every(t=>Ql(t)===!1?!1:Hc(t).some(r=>r.name.toString()==="_tag"))},_S=(e,t)=>(n,r)=>L(function*(){const s=yield*ZG;return[yield*Bu(e,t)(n,r).pipe(ai(Ys,s)),s.unsafeRead()]}),$6=e=>Ki(So(e),Nh(e),{decode:$J(e),encode:wJ(e)});$6(WV);const Ji=ae(R,Pt,_o,wV,We(Da(()=>Ji)),zh({key:R,value:Da(()=>Ji)})).annotations({title:"JsonValue"}),xt=Symbol("WebChannel"),Ka=re("WebChannel.DebugPing",{message:R,payload:hn(R)}),zf=re("WebChannel.Ping",{requestId:R}),Wf=re("WebChannel.Pong",{requestId:R}),E6=ae(zf,Wf),d$=e=>({send:ae(e.send,Ka,zf,Wf),listen:ae(e.listen,Ka,zf,Wf)}),Ju=e=>q(e,"send")&&q(e,"listen")?d$(e):d$({send:e,listen:e}),Jh=e=>t=>t.pipe($O(Eb(function*(n){return n._tag==="Right"&&ct(Ka)(n.right)?(yield*_n(`WebChannel:ping [${e}] ${n.right.message}`,n.right.payload),!1):!0}))),HO=({channelName:e,schema:t})=>Do(n=>L(function*(){const r=Ju(t),s=new BroadcastChannel(e);yield*gr(()=>Pu(()=>s.close()).pipe(hb));const o=u=>L(function*(){const d=yield*Bu(r.send)(u);s.postMessage(d)}),i=Bh(s,"message").pipe(Lo(u=>Ku(r.listen)(u.data)),Jh(e)),c=yield*ue().pipe(st(_s(Ft))),a=!1;return{[xt]:xt,send:o,listen:i,closedDeferred:c,shutdown:mt(n,Ke("shutdown")),schema:r,supportsTransferables:a}}).pipe(Ct(`WebChannel:broadcastChannel(${e})`))),h$=({listenWindow:e,sendWindow:t,targetOrigin:n="*",ids:r,schema:s})=>Do(o=>L(function*(){const i=Ju(s),c={sendTotal:0,listenTotal:0,targetOrigin:n,ids:r},a=Y({message:i.listen,from:ce(r.other),to:ce(r.own)}).annotations({title:"webmesh.WindowMessageListen"}),u=Y({message:i.send,from:ce(r.own),to:ce(r.other)}).annotations({title:"webmesh.WindowMessageSend"}),d=y=>L(function*(){c.sendTotal++;const[E,S]=yield*_S(u)({message:y,from:r.own,to:r.other});t.postMessage(E,n,S)}),h=Bh(e,"message").pipe(wo(y=>ct(Nh(a))(y.data)),Lo(y=>(c.listenTotal++,Ku(i.listen)(y.data.message))),Jh("window")),p=yield*ue().pipe(st(_s(Ft))),g=!0;return{[xt]:xt,send:d,listen:h,closedDeferred:p,shutdown:mt(o,Ke("shutdown")),schema:i,supportsTransferables:g,debugInfo:c}}).pipe(Ct("WebChannel:windowChannel"))),JO=({port:e,schema:t,debugId:n})=>Do(r=>L(function*(){const s=Ju(t),o=n===void 0?"messagePort":`messagePort:${n}`,i=d=>L(function*(){const[h,p]=yield*_S(s.send)(d);e.postMessage(h,p)}),c=Bh(e,"message").pipe(Lo(d=>Ku(s.listen)(d.data)),Jh(o));e.start();const a=yield*ue().pipe(st(_s(Ft))),u=!0;return yield*gr(()=>Pu(()=>e.close()).pipe(hb)),{[xt]:xt,send:i,listen:c,closedDeferred:a,shutdown:mt(r,Ke("shutdown")),schema:s,supportsTransferables:u}}).pipe(Ct("WebChannel:messagePortChannel")));te("livestore:sameThreadChannels",()=>new Map);const p$=({port:e,schema:t,debugId:n})=>Do(r=>L(function*(){const s=Ju(t),o=n===void 0?"messagePort":`messagePort:${n}`,i=new Map,c=re("ChannelRequest",{id:R,payload:ae(s.listen,s.send)}).annotations({title:"webmesh.ChannelRequest"}),a=re("ChannelRequestAck",{reqId:R}).annotations({title:"webmesh.ChannelRequestAck"}),u=ae(c,a).annotations({title:"webmesh.ChannelMessage"}),d={sendTotal:0,sendPending:0,listenTotal:0,id:n},h=E=>L(function*(){d.sendTotal++,d.sendPending++;const S=crypto.randomUUID(),[_,b]=yield*_S(u)({_tag:"ChannelRequest",id:S,payload:E}),C=yield*ue();i.set(S,C),e.postMessage(_,b),yield*C,i.delete(S),d.sendPending--}),p=Bh(e,"message").pipe(Lo(E=>Ku(u)(E.data)),is(E=>L(function*(){E._tag==="Right"&&(E.right._tag==="ChannelRequestAck"?yield*De(i.get(E.right.reqId),void 0):E.right._tag==="ChannelRequest"&&(d.listenTotal++,e.postMessage(z0(u)({_tag:"ChannelRequestAck",reqId:E.right.id}))))})),E4(E=>E._tag==="Left"?F(E):E.right._tag==="ChannelRequest"?F(H(E.right.payload)):P()),E=>E,Jh(o));e.start();const g=yield*ue().pipe(st(_s(Ft))),y=!0;return yield*gr(()=>Pu(()=>e.close()).pipe(hb)),{[xt]:xt,send:h,listen:p,closedDeferred:g,shutdown:mt(r,Ke("shutdown")),schema:s,supportsTransferables:y,debugInfo:d}}).pipe(Ct("WebChannel:messagePortChannelWithAck"))),g$=(e,t)=>L(function*(){const n=yield*un().pipe(st(zt)),r={current:void 0};if(yield*e.listen.pipe(t?.heartbeat?$O(Eb(function*(o){if(o._tag==="Right"&&ct(E6)(o.right)){if(o.right._tag==="WebChannel.Ping")yield*e.send(Wf.make({requestId:o.right.requestId}));else{const{deferred:i,requestId:c}=r.current??qt("No pending ping");c!==o.right.requestId&&qt("Received pong for unexpected requestId",c,o.right.requestId),yield*De(i,void 0)}return!1}return!0})):j,vO(o=>Ab(n,o)),qn,gn),t?.heartbeat){const{interval:o,timeout:i}=t.heartbeat;yield*L(function*(){for(;;){yield*mb(o);const c=crypto.randomUUID();yield*e.send(zf.make({requestId:c}));const a=yield*ue();r.current={deferred:a,requestId:c},yield*a.pipe(yb(i),DI("TimeoutException",()=>e.shutdown))}}).pipe(Ct("WebChannel:heartbeat"),gn)}const s=Hi(n,{maxChunkSize:1});return{[xt]:xt,send:e.send,listen:s,closedDeferred:e.closedDeferred,shutdown:e.shutdown,schema:e.schema,supportsTransferables:e.supportsTransferables,debugInfo:{innerDebugInfo:e.debugInfo,listenQueueSize:n}}}),k6=e=>t=>{if(q(console,"createTask")===!1)return t;const n=L(function*(){const s=yield*eB;return wL({span:(o,...i)=>{const c=s.span(o,...i),a=e(o);return c.runInTask=u=>a.run(u),c},context:(o,i)=>{const c=Ur(PC)(i.currentContext);if(c._tag==="None")return s.context(o,i);const a=c.value;if(a._tag==="ExternalSpan")return s.context(o,i);const u=a;return"runInTask"in u&&typeof u.runInTask=="function"?u.runInTask(()=>s.context(o,i)):s.context(o,i)}})}),r=f(n,ie(kB),$B);return dn(t,r)},C6=u6()({setup({scope:e,worker:t}){const n="port"in t?t.port:t;return Pr(vn(e,Z(()=>{n.postMessage([1])})),n)},listen({deferred:e,emit:t,port:n,scope:r}){function s(i){t(i.data)}function o(i){Fs(e,new tn({reason:"unknown",cause:i.error??i.message}))}return n.addEventListener("message",s),n.addEventListener("error",o),"start"in n&&n.start(),vn(r,Z(()=>{n.removeEventListener("message",s),n.removeEventListener("error",o)}))}}),v6=YI(l6,C6),I6=Ib(f6,v6),T6=e=>bB(I6,h6(e)),O6=T6,dm=te("@effect/platform-browser/Worker/cachedPorts",()=>new Set);function R6(e){dm.add(e.ports[0])}typeof self<"u"&&"onconnect"in self&&(self.onconnect=R6);const P6=e=>KO.of({[f$]:f$,start:Og(function*(t){const n=yield*Q0();let r=0;const s=new Map,o=(c,a,u)=>Z(()=>{(s.get(c)?.[0]??e).postMessage([1,a],{transfer:u})}),i=Og(function*(c){const a=yield*hh,u=(yield*at(ws())).pipe(n0(LE(tI))),d=yield*A0(),h=Hb(u);function p(b){b._tag==="Failure"&&!Js(b.cause)&&Fs(t,_a(sb(b.cause)))}function g(b){return function(C){const m=C.data;if(m[0]===0){const w=c(b,m[1]);if(pr(w)){const $=h(w);$.addObserver(p),Yg(d,$)}}else{const w=s.get(b);if(w){if(s.size===1)return Fs(t,Ft)}else return;s.delete(b),$s(mt(w[1],Ft))}}}function y(b){Fs(t,new tn({reason:"decode",cause:b.data}))}function E(b){Fs(t,new tn({reason:"unknown",cause:b.data}))}function S(b){const C=cb(a,va).pipe(D(m=>{const w=r++;s.set(w,[b,m]);const $=g(w);return b.addEventListener("message",$),b.addEventListener("messageerror",y),"start"in b&&b.start(),b.postMessage([0]),vn(m,Z(()=>{b.removeEventListener("message",$),b.removeEventListener("messageerror",E),b.close()}))}),h);C.addObserver(p),Yg(d,C)}e.addEventListener("error",E);let _;if("onconnect"in e){_=e.onconnect,e.onconnect=function(b){const C=b.ports[0];S(C)};for(const b of dm)S(b);dm.clear(),yield*vn(a,Z(()=>e.close()))}else S(e);yield*vn(a,Z(()=>{e.removeEventListener("error",E),"onconnect"in e&&(e.onconnect=_)}))});return j({run:i,send:o,disconnects:n})})}),F6=wB(KO,()=>P6(self)),x6=F6,M6=PE(),A6=X0(M6)(Lf),N6=PE(),hm=X0(N6)(Lf),Bf=0,Qt=Y({global:hm,client:A6}).annotations({title:"LiveStore.EventSequenceNumber"}),Ha=e=>e.client===0?`e${e.global}`:`e${e.global}+${e.client}`,L6=(e,t)=>t?{seqNum:{global:e.global,client:e.client+1},parentSeqNum:e}:{seqNum:{global:e.global+1,client:Bf},parentSeqNum:{global:e.global,client:Bf}},D6=Y({mergeCounter:Pt,eventNum:Qt});Y({fileName:R},{key:R,value:Gt}).annotations({title:"LiveStore.PersistenceInfo"});const Ip=Y({done:Pt,total:Pt}),q6=ae(Y({stage:ce("loading")}),Y({stage:ce("migrating"),progress:Ip}),Y({stage:ce("rehydrating"),progress:Ip}),Y({stage:ce("syncing"),progress:Ip}),Y({stage:ce("done")})).annotations({title:"BootStatus"});class be extends mr()("LiveStore.UnexpectedError",{cause:qa,note:hn(R),payload:hn(Gt)}){static mapToUnexpectedError=t=>t.pipe(fr(n=>ct(be)(n)?n:new be({cause:n})),LI(n=>new be({cause:n})));static mapToUnexpectedErrorStream=t=>t.pipe(T4(n=>ct(be)(n)?n:new be({cause:n})))}class U6 extends mr()("LiveStore.IntentionalShutdownCause",{reason:ce("devtools-reset","devtools-import","adapter-reset","manual")}){}class k8 extends mr()("LiveStore.StoreInterrupted",{reason:R}){}class C8 extends mr()("LiveStore.SqliteError",{query:hn(Y({sql:R,bindValues:ae(zh({key:R,value:Gt}),We(Gt))})),code:hn(ae(Pt,R)),cause:qa,note:hn(R)}){}const j6=Y({tableName:R,hashes:Y({expected:Pt,actual:hn(Pt)})}),z6=Y({migrations:We(j6)});Y({name:R,args:Gt,seqNum:Qt,parentSeqNum:Qt,clientId:R,sessionId:R}).annotations({title:"LiveStoreEvent.AnyDecoded"});const W6=Y({name:R,args:Gt,seqNum:Qt,parentSeqNum:Qt,clientId:R,sessionId:R}).annotations({title:"LiveStoreEvent.AnyEncoded"}),B6=Y({name:R,args:Gt,seqNum:hm,parentSeqNum:hm,clientId:R,sessionId:R}).annotations({title:"LiveStoreEvent.AnyEncodedGlobal"}),K6=Y({name:R,args:Gt});class Tn extends No("LiveStoreEvent.EncodedWithMeta")({name:R,args:Gt,seqNum:Qt,parentSeqNum:Qt,clientId:R,sessionId:R,meta:Y({sessionChangeset:ae(re("sessionChangeset",{data:jV,debug:Gt.pipe(hn)}),re("no-op",{}),re("unset",{})),syncMetadata:yO(Ji)}).pipe(xV,hn,iO({constructor:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:P()}),decoding:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:P()})}))}){toJSON=()=>({seqNum:`${Ha(this.seqNum)}  ${Ha(this.parentSeqNum)} (${this.clientId}, ${this.sessionId})`,name:this.name,args:this.args});rebase=(t,n)=>new Tn({...this,...L6(t,n)});static fromGlobal=(t,n)=>new Tn({...t,seqNum:{global:t.seqNum,client:Bf},parentSeqNum:{global:t.parentSeqNum,client:Bf},meta:{sessionChangeset:{_tag:"unset"},syncMetadata:n}});toGlobal=()=>({...this,seqNum:this.seqNum.global,parentSeqNum:this.parentSeqNum.global})}class v8 extends mr()("IsOfflineError",{}){}class I8 extends mr()("InvalidPushError",{reason:ae(re("Unexpected",{message:R}),re("ServerAhead",{minimumExpectedNum:Pt,providedNum:Pt}))}){}class T8 extends mr()("InvalidPullError",{message:R}){}class H6 extends mr()("LeaderAheadError",{minimumExpectedNum:Qt,providedNum:Qt}){}class Vh extends No("SyncState")({pending:We(Tn),upstreamHead:Qt,localHead:Qt}){toJSON=()=>({pending:this.pending.map(t=>t.toJSON()),upstreamHead:Ha(this.upstreamHead),localHead:Ha(this.localHead)})}class VO extends re("upstream-rebase",{rollbackEvents:We(Tn),newEvents:We(Tn)}){}class GO extends re("upstream-advance",{newEvents:We(Tn)}){}class J6 extends re("local-push",{newEvents:We(Tn)}){}class V6 extends ae(VO,GO,J6){}class QO extends ae(VO,GO){}class wS extends No("MergeContext")({payload:V6,syncState:Vh}){toJSON=()=>({payload:fV(this.payload).pipe(Cp("local-push",()=>({_tag:"local-push",newEvents:this.payload.newEvents.map(n=>n.toJSON())})),Cp("upstream-advance",()=>({_tag:"upstream-advance",newEvents:this.payload.newEvents.map(n=>n.toJSON())})),Cp("upstream-rebase",n=>({_tag:"upstream-rebase",newEvents:n.newEvents.map(r=>r.toJSON()),rollbackEvents:n.rollbackEvents.map(r=>r.toJSON())})),dV),syncState:this.syncState.toJSON()})}class G6 extends No("MergeResultAdvance")({_tag:ce("advance"),newSyncState:Vh,newEvents:We(Tn),confirmedEvents:We(Tn),mergeContext:wS}){toJSON=()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(t=>t.toJSON()),confirmedEvents:this.confirmedEvents.map(t=>t.toJSON()),mergeContext:this.mergeContext.toJSON()})}class Q6 extends No("MergeResultRebase")({_tag:ce("rebase"),newSyncState:Vh,newEvents:We(Tn),rollbackEvents:We(Tn),mergeContext:wS}){toJSON=()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(t=>t.toJSON()),rollbackEvents:this.rollbackEvents.map(t=>t.toJSON()),mergeContext:this.mergeContext.toJSON()})}class Y6 extends No("MergeResultReject")({_tag:ce("reject"),expectedMinimumId:Qt,mergeContext:wS}){toJSON=()=>({_tag:this._tag,expectedMinimumId:Ha(this.expectedMinimumId),mergeContext:this.mergeContext.toJSON()})}class X6 extends No("MergeResultUnexpectedError")({_tag:ce("unexpected-error"),cause:be}){}class O8 extends ae(G6,Q6,Y6,X6){}const Z6="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Kf=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=Z6[n[e]&63];return t};const eQ=re("RequestSessions",{}),tQ=re("SessionInfo",{storeId:R,clientId:R,sessionId:R,schemaAlias:R,isLeader:_o}),nQ=ae(eQ,tQ),YO="0.3.0",rQ=Y({isConnected:_o,timestampMs:Pt,latchClosed:_o}),Fl=R,sQ=R,xl=ce(YO),XO=(e,t)=>re(e,{liveStoreVersion:xl,...t}).annotations({identifier:e}),oQ=(e,t)=>XO(e,{clientId:sQ,...t}),He=(e,t)=>oQ(e,{requestId:Fl,...t}),$S=(e,t)=>{const n=re(`${e}.Response.Success`,{requestId:Fl,liveStoreVersion:xl,...t.success}).annotations({identifier:`${e}.Response.Success`}),r=t.error?re(`${e}.Response.Error`,{requestId:Fl,liveStoreVersion:xl,...t.error}).annotations({identifier:`${e}.Response.Error`}):Dh;return{Request:re(`${e}.Request`,{requestId:Fl,liveStoreVersion:xl,...t.payload}).annotations({identifier:`${e}.Request`}),Response:ae(n,r),Success:n,Error:r}};class R8 extends He("LSD.Leader.ResetAllDataReq",{mode:ce("all-data","only-app-db")}){}class iQ extends He("LSD.Leader.DatabaseFileInfoReq",{}){}class m$ extends Y({fileSize:Pt,persistenceInfo:Y({fileName:R},{key:R,value:Gt})}){}class cQ extends He("LSD.Leader.DatabaseFileInfoRes",{state:m$,eventlog:m$}){}class aQ extends He("LSD.Leader.NetworkStatusSubscribe",{subscriptionId:R}){}class uQ extends He("LSD.Leader.NetworkStatusUnsubscribe",{subscriptionId:R}){}class lQ extends He("LSD.Leader.NetworkStatusRes",{networkStatus:rQ,subscriptionId:R}){}class fQ extends He("LSD.Leader.SyncingInfoReq",{}){}class dQ extends Y({enabled:_o,metadata:zh({key:R,value:Gt})}){}class hQ extends He("LSD.Leader.SyncingInfoRes",{syncingInfo:dQ}){}class pQ extends He("LSD.Leader.SyncHistorySubscribe",{subscriptionId:R}){}class gQ extends He("LSD.Leader.SyncHistoryUnsubscribe",{subscriptionId:R}){}class mQ extends He("LSD.Leader.SyncHistoryRes",{eventEncoded:B6,metadata:yO(Ji),subscriptionId:R}){}class yQ extends He("LSD.Leader.SyncHeadSubscribe",{subscriptionId:R}){}class bQ extends He("LSD.Leader.SyncHeadUnsubscribe",{subscriptionId:R}){}class SQ extends He("LSD.Leader.SyncHeadRes",{local:Qt,upstream:Qt,subscriptionId:R}){}class _Q extends He("LSD.Leader.SnapshotReq",{}){}class wQ extends He("LSD.Leader.SnapshotRes",{snapshot:mi}){}const ZO=$S("LSD.Leader.LoadDatabaseFile",{payload:{data:mi},success:{},error:{cause:ae(re("unsupported-file",{}),re("unsupported-database",{}),re("unexpected-error",{cause:qa}))}});class $Q extends XO("LSD.Leader.SyncPull",{payload:QO}){}class EQ extends He("LSD.Leader.CommitEventReq",{eventEncoded:K6}){}class kQ extends He("LSD.Leader.CommitEventRes",{}){}class CQ extends He("LSD.Leader.EventlogReq",{}){}class vQ extends He("LSD.Leader.EventlogRes",{eventlog:mi}){}class IQ extends He("LSD.Leader.Ping",{}){}class TQ extends He("LSD.Leader.Pong",{}){}class eR extends He("LSD.Leader.Disconnect",{}){}const tR=$S("LSD.Leader.SetSyncLatch",{payload:{closeLatch:_o},success:{}}),nR=$S("LSD.Leader.ResetAllData",{payload:{mode:ce("all-data","only-app-db")},success:{}}),OQ=ae(_Q,ZO.Request,CQ,nR.Request,aQ,uQ,eR,EQ,IQ,iQ,pQ,gQ,fQ,yQ,bQ,tR.Request).annotations({identifier:"LSD.Leader.MessageToApp"});ae(wQ,ZO.Response,vQ,eR,$Q,lQ,kQ,TQ,cQ,mQ,hQ,SQ,nR.Success,tR.Success).annotations({identifier:"LSD.Leader.MessageFromApp"});const RQ=ae(re("node",{url:R}),re("web",{}),re("browser-extension",{}));RQ.pipe(FV("_tag"),So);const PQ={client:{session:({storeId:e,clientId:t,sessionId:n})=>`client-session-${e}-${t}-${n}`,leader:({storeId:e,clientId:t})=>`client-leader-${e}-${t}`}},Vu=R.pipe(hn,iO({constructor:()=>Kf(10),decoding:()=>Kf(10)})),Uo={id:Vu,target:R,source:R,channelName:R,hops:We(R)},rR=Z0.pipe(hn);class Ml extends re("DirectChannelRequest",{...Uo,remainingHops:We(R).pipe(hn),channelVersion:Pt,reqId:aS(R),sourceId:R}){}class sR extends re("DirectChannelResponseSuccess",{...Uo,reqId:R,port:Hh,remainingHops:We(R),channelVersion:Pt}){}class ES extends re("DirectChannelResponseNoTransferables",{...Uo,reqId:R,remainingHops:We(R)}){}class oR extends re("ProxyChannelRequest",{...Uo,remainingHops:rR,channelIdCandidate:R}){}class iR extends re("ProxyChannelResponseSuccess",{...Uo,reqId:R,remainingHops:We(R),combinedChannelId:R,channelIdCandidate:R}){}class cR extends re("ProxyChannelPayload",{...Uo,remainingHops:rR,payload:Gt,combinedChannelId:R}){}class aR extends re("ProxyChannelPayloadAck",{...Uo,reqId:R,remainingHops:We(R),combinedChannelId:R}){}class pm extends re("NetworkEdgeAdded",{id:Vu,source:R,target:R}){}class gm extends re("NetworkTopologyRequest",{id:Vu,hops:We(R),source:R,target:ce("-")}){}class mm extends re("NetworkTopologyResponse",{id:Vu,reqId:R,remainingHops:We(R),nodeName:R,edges:We(R),source:R,target:ce("-")}){}const Al=re("BroadcastChannelPacket",{id:Vu,channelName:R,payload:Gt,hops:We(R),source:R,target:ce("-")});class ym extends ae(Ml,sR,ES){}class uR extends ae(oR,iR,cR,aR){}class kS extends ae(ym,uR,pm,gm,mm,Al){}class dl extends re("DirectChannelPing",{}){}class hl extends re("DirectChannelPong",{}){}class FQ extends mr()("EdgeAlreadyExistsError",{target:R}){}const ra=e=>({packetId:e.id,"span.label":e.id+(q(e,"reqId")&&e.reqId!==void 0?` for ${e.reqId}`:""),...e._tag!=="DirectChannelResponseSuccess"&&e._tag!=="ProxyChannelPayload"?{packet:e}:{}});Y({channelName:R,source:R,mode:ae(ce("proxy"),ce("direct"))});const xQ=ue,MQ=({nodeName:e,incomingPacketsQueue:t,target:n,checkTransferableEdges:r,channelName:s,schema:o,sendPacket:i,channelVersion:c,scope:a,sourceId:u})=>L(function*(){const d=yield*xQ(),h=yield*TO.pipe(db(()=>Se(void 0))),p={send:ae(o.send,dl,hl),listen:ae(o.listen,dl,hl)},g={current:{_tag:"Initial"}},y=({packet:b,respondToSender:C})=>L(function*(){const m=g.current;if(h?.addEvent(`process:${b._tag}`,{channelState:m._tag,packetId:b.id,packetReqId:b.reqId,packetChannelVersion:q("channelVersion")(b)?b.channelVersion:void 0}),m._tag==="Initial")return qt();if(b._tag==="DirectChannelResponseNoTransferables")return yield*uC(d,b),"close";if(b.channelVersion>c)return h?.addEvent(`incoming packet has higher version (${b.channelVersion}), closing channel`),yield*mt(a,Ke("higher-version-expected")),"close";if(b.channelVersion<c){const w=Ml.make({source:e,sourceId:u,target:n,channelName:s,channelVersion:c,hops:[],remainingHops:b.hops,reqId:void 0});h?.addEvent(`incoming packet has lower version (${b.channelVersion}), sending request to reconnect (${w.id})`),yield*i(w);return}if(m._tag==="Established"&&b._tag==="DirectChannelRequest")return b.sourceId===m.otherSourceId?void 0:(h?.addEvent("force-new-channel"),yield*mt(a,Ke("force-new-channel")),"close");switch(b._tag){case"DirectChannelRequest":{if(m._tag!=="RequestSent")return;if(b.reqId!==m.reqPacketId){const $=Ml.make({source:e,sourceId:u,target:n,channelName:s,channelVersion:c,hops:[],remainingHops:b.hops,reqId:b.id});h?.addEvent(`Re-sending new request (${$.id}) for incoming request (${b.id})`),yield*i($)}if(e>n){h?.addEvent("winner side: creating direct channel and sending response");const $=new MessageChannel,v=yield*p$({port:$.port1,schema:p,debugId:c}).pipe(ui(g$));yield*C(sR.make({reqId:b.id,target:n,source:e,channelName:b.channelName,hops:[],remainingHops:b.hops.slice(0,-1),port:$.port2,channelVersion:c})),g.current={_tag:"winner:ResponseSent",channel:v,otherSourceId:b.sourceId},yield*v.listen.pipe(Ua(),wo(ct(dl)),qf(1),qn),yield*v.send(hl.make({})),h?.addEvent("winner side: established"),g.current={_tag:"Established",otherSourceId:b.sourceId},yield*De(d,v)}else h?.addEvent("loser side: waiting for response"),g.current={_tag:"loser:WaitingForResponse",otherSourceId:b.sourceId};break}case"DirectChannelResponseSuccess":{if(m._tag!=="loser:WaitingForResponse")return qt(`Expected to find direct channel response from ${n}, but was in ${m._tag} state`);const w=yield*p$({port:b.port,schema:p,debugId:c}).pipe(ui(g$)),$=yield*w.listen.pipe(Ua(),wo(ct(hl)),qf(1),qn,gb);yield*w.send(dl.make({})).pipe(yb(10),pb({times:2})),yield*$,h?.addEvent("loser side: established"),g.current={_tag:"Established",otherSourceId:m.otherSourceId},yield*De(d,w);return}default:return OO(b)}}).pipe(Ct(`handleMessagePacket:${b._tag}:${b.source}${b.target}`,{attributes:ra(b)}));yield*L(function*(){for(;;){const b=yield*Wi(t);if((yield*y(b))==="close")return}}).pipe(at,kt,gn);const E=g.current;return E._tag!=="Initial"?qt(`Expected channel to be in Initial state, but was in ${E._tag} state`):(yield*L(function*(){const b=Ml.make({source:e,sourceId:u,target:n,channelName:s,channelVersion:c,hops:[],reqId:void 0});g.current={_tag:"RequestSent",reqPacketId:b.id};const C=r(b);if(C!==void 0)return yield*ln(`No transferable edges found for ${b.source}${b.target}`),yield*zn(C);yield*i(b),h?.addEvent(`initial edge request sent (${b.id})`)}),yield*d)}).pipe($b(`makeDirectChannel:${c}`)),AQ=({schema:e,newEdgeAvailablePubSub:t,channelName:n,checkTransferableEdges:r,nodeName:s,incomingPacketsQueue:o,target:i,sendPacket:c})=>Do(a=>L(function*(){const u=Kf(),d=yield*un(),h=yield*jH(),p=yield*ue(),g={pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1,innerChannelRef:{current:void 0}};yield*L(function*(){const C=yield*ue();for(;;){g.connectCounter++;const v=g.connectCounter;yield*ln(`Connecting#${v}`);const x=yield*lh();yield*gr(Q=>mt(x,Q));const X=yield*EO(t).pipe(is(Q=>ln(`new-conn:${Q}`)),qf(1),qn,Pr("new-edge"),gb),I=MQ({nodeName:s,sourceId:u,incomingPacketsQueue:o,target:i,checkTransferableEdges:r,channelName:n,schema:e,channelVersion:v,sendPacket:c,scope:x}).pipe(uh(x),en(x),XW(P())),A=yield*HI(I,X.pipe(zW));if(A==="new-edge")yield*mt(x,yu("new-edge"));else{const Q=yield*A.pipe(Ze);if(Q._tag==="Failure")yield*mt(x,Q),Hv(Q.cause)&&ct(ES)(Q.cause.error)&&(yield*X.pipe(Ze));else{const oe=Q.value;yield*De(C,{channel:oe,makeDirectChannelScope:x,channelVersion:v});break}}}const{channel:m,makeDirectChannelScope:w,channelVersion:$}=yield*C;yield*ln(`Connected#${$}`),g.isConnected=!0,g.innerChannelRef.current=m,yield*De(p,void 0),yield*m.listen.pipe(Ua(),vO(v=>Ab(d,v)),qn,kt,en(w)),yield*L(function*(){for(;;){const[v,x]=yield*qH(h);yield*m.send(v),yield*De(x,void 0),yield*UH(h)}}).pipe(en(w)),yield*m.closedDeferred,yield*mt(w,Ke("channel-closed")),yield*ln(`Disconnected#${$}`),g.isConnected=!1,g.innerChannelRef.current=void 0}).pipe(yo,bb,kt,gn);const y=yield*wb.pipe(er),E=C=>L(function*(){const m=yield*ue();g.pendingSends++,g.totalSends++,yield*DH(h,[C,m]),yield*m,g.pendingSends--}).pipe(yo,As(y)),S=Hi(d,{maxChunkSize:1}).pipe(Lo(H)),_=yield*ue().pipe(st(_s(Ft)));return{webChannel:{[xt]:xt,send:E,listen:S,closedDeferred:_,supportsTransferables:!0,schema:e,debugInfo:g,shutdown:mt(a,Ke("shutdown"))},initialEdgeDeferred:p}})),NQ=({queue:e,nodeName:t,newEdgeAvailablePubSub:n,sendPacket:r,target:s,channelName:o,schema:i})=>Do(c=>L(function*(){const a={current:{_tag:"Initial"}},u={kind:"proxy-channel",pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1},d=Kf(5);yield*Tg({channelIdCandidate:d});const h=yield*wb.pipe(er),p=yield*CO(!1),g=L(function*(){return yield*Uf(p,A=>A!==!1)}),y=I=>L(function*(){yield*ln(`Connected (${I})`).pipe(As(h)),a.current={_tag:"Established",listenSchema:i.listen,listenQueue:C,ackMap:m,combinedChannelId:I},yield*ea(p,a.current),u.isConnected=!0}),E=ve(()=>r(oR.make({channelName:o,hops:[],source:t,target:s,channelIdCandidate:d}))),S=I=>[d,I].sort().join("_"),_=yield*un().pipe(st(zt)),b=({packet:I,respondToSender:A})=>L(function*(){const oe=`target:${I.source}, channelName:${I.channelName}`,B=a.current;switch(I._tag){case"ProxyChannelRequest":{const Ne=S(I.channelIdCandidate);B._tag==="Established"?B.combinedChannelId===Ne||(yield*or(`[${t}] Received ProxyChannelRequest with different channel ID (${Ne}) while established with ${B.combinedChannelId}. Re-establishing.`),yield*ea(p,!1),a.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*ln("Reconnecting (received conflicting ProxyChannelRequest)").pipe(As(h)),u.isConnected=!1,u.connectCounter++,yield*E):B._tag==="Initial"&&(yield*ea(p,!1),a.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*ln("Connecting (received ProxyChannelRequest)").pipe(As(h)),u.isConnected=!1,u.connectCounter++),yield*A(iR.make({reqId:I.id,remainingHops:I.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:Ne,channelIdCandidate:d}));return}case"ProxyChannelResponseSuccess":{if(B._tag!=="Pending"){if(B._tag==="Established"&&B.combinedChannelId!==I.combinedChannelId)return qt(`ProxyChannel[${oe}]: Expected proxy channel to have the same combinedChannelId as the packet:
${B.combinedChannelId} (channel) === ${I.combinedChannelId} (packet)`);if(B._tag==="Established")return;yield*or(`[${t}] Ignoring ResponseSuccess ${I.id} received in unexpected state ${B._tag}`);return}const Ne=S(I.channelIdCandidate);if(Ne!==I.combinedChannelId)return yield*zi(`ProxyChannel[${oe}]: Expected proxy channel to have the same combinedChannelId as the packet:
${Ne} (channel) === ${I.combinedChannelId} (packet)`);yield*y(I.combinedChannelId);const Ee=a.current;if(Ee._tag==="Established"){const nt=yield*CK(_);for(const dt of nt){if(Ee.combinedChannelId!==dt.combinedChannelId){yield*or(`[${t}] Discarding buffered payload ${dt.id}: Combined channel ID mismatch during drain. Expected ${Ee.combinedChannelId}, got ${dt.combinedChannelId}`);continue}const Vn=yield*La(Ee.listenSchema)(dt.payload);yield*Ee.listenQueue.pipe(Be(Vn))}}else yield*vg(`[${t}] State is not Established immediately after setStateToEstablished was called. Cannot drain buffer. State: ${Ee._tag}`);return}case"ProxyChannelPayload":{if(B._tag==="Established"&&B.combinedChannelId!==I.combinedChannelId)return yield*zi(`ProxyChannel[${oe}]: Expected proxy channel to have the same combinedChannelId as the packet:
${B.combinedChannelId} (channel) === ${I.combinedChannelId} (packet)`);if(yield*A(aR.make({reqId:I.id,remainingHops:I.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:B._tag==="Established"?B.combinedChannelId:I.combinedChannelId})),B._tag==="Established"){const Ne=yield*La(B.listenSchema)(I.payload);yield*B.listenQueue.pipe(Be(Ne))}else yield*Be(_,I);return}case"ProxyChannelPayloadAck":{if(B._tag!=="Established"){yield*ln(`Not yet connected to ${s}. dropping message`),yield*or(`[${t}] Received Ack but not established (State: ${B._tag}). Dropping Ack for ${I.reqId}`);return}const Ne=B.ackMap.get(I.reqId)??qt(`[ProxyChannel[${oe}]] Expected ack for ${I.reqId}`);yield*De(Ne,void 0),B.ackMap.delete(I.reqId);return}default:return OO(I)}}).pipe(Ct(`handleProxyPacket:${I._tag}:${I.source}->${I.target}`,{attributes:ra(I)}));yield*Hi(e).pipe(is(b),qn,kt,gn);const C=yield*un();yield*ln("Connecting");const m=new Map;{if(a.current._tag!=="Initial")return qt("Expected proxy channel to be Initial");a.current={_tag:"Pending",initiatedVia:"outgoing-request"},yield*E;const I=yield*EO(n).pipe(is(()=>E),qn,gn),{combinedChannelId:A}=yield*g;yield*Zt(I),yield*y(A)}const w=I=>L(function*(){const A=yield*iS(i.send)(I),Q=yield*Y5(),oe=yield*ue();u.pendingSends++,u.totalSends++;const B=L(function*(){const{combinedChannelId:Ee}=yield*Uf(p,dt=>dt!==!1);yield*L(function*(){const dt=yield*ue(),Vn=cR.make({channelName:o,payload:A,hops:[],source:t,target:s,combinedChannelId:Ee});m.set(Vn.id,dt),yield*r(Vn),yield*dt,yield*De(oe,void 0),u.pendingSends--}).pipe(yb(100),pb(O3(10)),er)}).pipe(bc(vg)),Ne=yield*p.changes.pipe(wo(Ee=>Ee===!1),is(()=>Tw(Q,B)),qn,gb);yield*Tw(Q,B),yield*oe,yield*Zt(Ne)}).pipe(yo,Ct("sendAckWithRetry:ProxyChannelPayload"),As(h)),$=Hi(C).pipe(Lo(H)),v=yield*ue().pipe(st(_s(Ft))),x=yield*ws();return{[xt]:xt,send:w,listen:$,closedDeferred:v,supportsTransferables:!1,schema:i,shutdown:mt(c,Ft),debugInfo:u,debug:{ping:(I="ping")=>w(Ka.make({message:I})).pipe(dn(x),kt,$s)}}}).pipe($b("makeProxyChannel")));class CS{values=new Map;timeoutHandle;timeoutMs;constructor({timeout:t}){this.timeoutMs=$i(t)}static make=t=>L(function*(){const n=new CS({timeout:t});return yield*gr(()=>Z(()=>n.onShutdown())),n});add(t){this.values.set(t,Date.now()),this.scheduleCleanup()}has(t){return this.values.has(t)}delete(t){this.values.delete(t)}scheduleCleanup(){this.timeoutHandle===void 0&&(this.timeoutHandle=setTimeout(()=>{this.cleanup(),this.timeoutHandle=void 0},this.timeoutMs))}cleanup(){const t=Date.now();for(const[n,r]of this.values.entries())t-r>=this.timeoutMs&&this.values.delete(n)}onShutdown=()=>clearTimeout(this.timeoutHandle)}const LQ=e=>L(function*(){const t=new Map,n=yield*CS.make(JE(1)),r=yield*oT().pipe(st(Pg)),s=new Map,o=yield*un().pipe(st(zt)),i=new Map,c=new Map,a=m=>{if(m._tag==="DirectChannelRequest"&&(t.size===0||t.get(m.target)?.channel.supportsTransferables===!1)||![...t.values()].some(w=>w.channel.supportsTransferables===!0))return ES.make({reqId:m.id,channelName:m.channelName,source:m.target,target:m.source,remainingHops:m.hops,hops:[]})},u=m=>L(function*(){if(ct(pm)(m)){yield*ln("NetworkEdgeAdded",{packet:m,nodeName:e}),yield*Mb(r,m.target);const w=Array.from(t).filter(([$])=>$!==m.source).map(([$,v])=>v.channel);yield*wt(w,$=>$.send(m),{concurrency:"unbounded"});return}if(ct(Al)(m)){const w=Array.from(t).filter(([x])=>!m.hops.includes(x)).map(([x,X])=>X.channel),$={...m,hops:[...m.hops,e]};if(yield*wt(w,x=>x.send($),{concurrency:"unbounded"}),m.source===e)return;const v=c.get(m.channelName);v!==void 0&&(yield*Be(v,m));return}if(ct(gm)(m)){if(m.source!==e){const v=m.hops.at(-1)??qt(`${e}: Expected hops for packet`,m),x=t.get(v).channel,X=mm.make({reqId:m.id,source:m.source,target:m.target,remainingHops:m.hops.slice(0,-1),nodeName:e,edges:Array.from(t.keys())});yield*x.send(X)}const w=Array.from(t).filter(([v])=>!m.hops.includes(v)).map(([v,x])=>x.channel),$={...m,hops:[...m.hops,e]};yield*wt(w,v=>v.send($),{concurrency:"unbounded"});return}if(ct(mm)(m)){if(m.source===e)i.get(m.reqId).set(m.nodeName,new Set(m.edges));else{const $=m.remainingHops.at(-1)??qt(`${e}: Expected remaining hops for packet`,m);yield*(t.get($)?.channel??qt(`${e}: Expected edge channel (${$}) for packet`,m,"Available edges:",Array.from(t.keys()))).send({...m,remainingHops:m.remainingHops.slice(0,-1)})}return}if(t.has(m.target)){const w=t.get(m.target).channel,$=m.source===e?[]:[...m.hops,e];yield*Tg({hasDirectEdge:!0}),yield*w.send({...m,hops:$})}else if(m.remainingHops!==void 0){const w=m.remainingHops.at(-1)??qt(`${e}: Expected remaining hops for packet`,m),$=t.get(w)?.channel;if($===void 0){yield*or(`${e}: Expected to find hop target ${w} in edges. Dropping packet.`,m);return}yield*$.send({...m,remainingHops:m.remainingHops.slice(0,-1),hops:[...m.hops,e]})}else{const w=m.source===e?[]:[...m.hops,e],$=Array.from(t).filter(([x])=>x!==m.source).map(([x,X])=>({name:x,channel:X.channel}));w.length===0&&$.length===0&&za&&(yield*or(e,"no route found to",m.target,m._tag,"TODO handle better"));const v={...m,hops:w};yield*Tg({edgesToForwardTo:$.map(({name:x})=>x)}),yield*wt($,({channel:x})=>x.send(v),{concurrency:"unbounded"})}}).pipe(Ct(`sendPacket:${m._tag}:${m.source}${m.target}`,{attributes:ra(m)}),er),d=({target:m,edgeChannel:w,replaceIfExists:$=!1})=>L(function*(){if(t.has(m))if($)yield*h(m).pipe(er);else return yield*new FQ({target:m});const v=yield*w.listen.pipe(Ua(),is(X=>L(function*(){const I=yield*La(kS)(X);if(!n.has(I.id))switch(n.add(I.id),I._tag){case"NetworkEdgeAdded":case"NetworkTopologyRequest":case"NetworkTopologyResponse":{yield*u(I);break}default:if(I.target===e){const A=`target:${I.source}, channelName:${I.channelName}`;if(!s.has(A)){const B=yield*un().pipe(st(zt));s.set(A,{queue:B,debugInfo:void 0})}const Q=s.get(A).queue,oe=B=>w.send(B).pipe(Ct(`respondToSender:${B._tag}:${B.source}${B.target}`,{attributes:ra(B)}),er);ct(uR)(I)?yield*Be(Q,{packet:I,respondToSender:oe}):ct(ym)(I)&&(yield*Be(Q,{packet:I,respondToSender:oe})),(I._tag==="ProxyChannelRequest"||I._tag==="DirectChannelRequest")&&(yield*Be(o,{channelName:I.channelName,source:I.source,mode:I._tag==="ProxyChannelRequest"?"proxy":"direct"}))}else{if(ct(ym)(I)){const A=a(I);if(A!==void 0)return yield*ln(`No transferable edges found for ${I.source}${I.target}`),yield*w.send(A).pipe(Ct(`sendNoTransferableResponse:${I.source}${I.target}`,{attributes:ra(A)}))}yield*u(I)}}})),qn,at,er,kt,gn);t.set(m,{channel:w,listenFiber:v});const x=pm.make({source:e,target:m});yield*u(x).pipe(er)}).pipe(Vs({"addEdge:target":m,nodeName:e}),Ct(`addEdge:${e}${m}`,{attributes:{supportsTransferables:w.supportsTransferables}})),h=m=>L(function*(){t.has(m)||(yield*new ah(`No edge found for ${m}`)),yield*Zt(t.get(m).listenFiber),t.delete(m)}),p=({target:m,channelName:w})=>Z(()=>s.has(`target:${m}, channelName:${w}`)),g=({target:m,channelName:w,schema:$,mode:v,timeout:x=jm(1),closeExisting:X=!1})=>L(function*(){const I=Ju($),A=`target:${m}, channelName:${w}`;if(s.has(A)){const oe=s.get(A).debugInfo?.channel;oe&&(X?(yield*oe.shutdown,s.delete(A)):qt(`Channel ${A} already exists`,oe))}if(s.has(A)===!1){const oe=yield*un().pipe(st(zt));s.set(A,{queue:oe,debugInfo:void 0})}const Q=s.get(A).queue;if(yield*gr(()=>Z(()=>s.delete(A))),v==="direct"){const oe=yield*un().pipe(st(zt));yield*aT(Q,1,10).pipe(Dn(Ee=>Ab(oe,Ee)),bb,at,kt,gn);const{webChannel:B,initialEdgeDeferred:Ne}=yield*AQ({nodeName:e,incomingPacketsQueue:oe,newEdgeAvailablePubSub:r,target:m,channelName:w,schema:I,sendPacket:u,checkTransferableEdges:a});return s.set(A,{queue:Q,debugInfo:{channel:B,target:m}}),yield*Ne,B}else{const oe=yield*NQ({nodeName:e,newEdgeAvailablePubSub:r,target:m,channelName:w,schema:I,queue:Q,sendPacket:u});return s.set(A,{queue:Q,debugInfo:{channel:oe,target:m}}),oe}}).pipe($b(`makeChannel:${e}${m}(${w})`,{attributes:{target:m,channelName:w,mode:v,timeout:x}}),Vs({nodeName:e,target:m,channelName:w}));let y=!1;const E=kO(()=>{if(y)return qt("listenForChannel already started");y=!0;const m=$=>`${$.channelName}:${$.source}:${$.mode}`,w=new Set;return Hi(o).pipe(wo($=>{const v=m($);return w.has(v)?!1:(w.add(v),!0)}))}),S=({channelName:m,schema:w})=>Do($=>L(function*(){if(c.has(m))return qt(`Broadcast channel ${m} already exists`,c.get(m));const v={},x=yield*un().pipe(st(zt));c.set(m,x);const X=Q=>L(function*(){const oe=yield*Bu(w)(Q),B=Al.make({channelName:m,payload:oe,source:e,target:"-",hops:[]});yield*u(B)}),I=Hi(x).pipe(wo(ct(Al)),Lo(Q=>Ku(w)(Q.payload))),A=yield*ue().pipe(st(_s(Ft)));return{[xt]:xt,send:X,listen:I,closedDeferred:A,supportsTransferables:!1,schema:{listen:w,send:w},shutdown:mt($,Ft),debugInfo:v}})),_=Z(()=>new Set(t.keys())),b=yield*ws();return{nodeName:e,addEdge:d,removeEdge:h,hasChannel:p,makeChannel:g,listenForChannel:E,makeBroadcastChannel:S,edgeKeys:_,debug:{print:()=>{console.log("Webmesh debug info for node:",e),console.log("Edges:",t.size);for(const[m,w]of t)console.log(`  ${m}: supportsTransferables=${w.channel.supportsTransferables}`);console.log("Channels:",s.size);for(const[m,w]of s)console.log(fl(m,2),`
`,Object.entries({target:w.debugInfo?.target,supportsTransferables:w.debugInfo?.channel.supportsTransferables,...w.debugInfo?.channel.debugInfo}).map(([$,v])=>fl(`${$}=${v}`,4)).join(`
`),"    ",w.debugInfo?.channel,`
`,fl(`Queue: ${w.queue.unsafeSize().pipe(Fn)}`,4),w.queue);console.log("Broadcast channels:",c.size);for(const[m,w]of c)console.log(fl(m,2))},ping:m=>{L(function*(){const w=$=>Ka.make({message:`ping from ${e} via ${$}`,payload:m});for(const[$,v]of t)yield*_n(`sending ping via edge ${$}`),yield*v.channel.send(w(`edge ${$}`));for(const[$,v]of s){if(v.debugInfo===void 0){yield*_n(`channel ${$} has no debug info`);continue}yield*_n(`sending ping via channel ${$}`),yield*v.debugInfo.channel.send(w(`channel ${$}`))}}).pipe(dn(b),kt,$s)},requestTopology:(m=1e3)=>L(function*(){const w=gm.make({source:e,target:"-",hops:[]}),$=new Map;$.set(e,new Set(t.keys())),i.set(w.id,$),yield*u(w),yield*_n(`Waiting ${m}ms for topology response`),yield*mb(m),yield*_n(`Topology response (from ${e}):`);for(const[v,x]of $)yield*_n(`  node '${v}' has edge to: ${Array.from(x.values()).join(", ")}`)}).pipe(dn(b),kt,GI)}}}).pipe(Ct(`makeMeshNode:${e}`),Vs({"makeMeshNode.nodeName":e}));let Gh=class extends Lt()("DevtoolsWebCommon.CreateConnection",{payload:{from:R,port:Hh},success:Y({}),failure:Dh}){};class F8 extends ae(Gh){}HO({channelName:"session-info",schema:nQ});const DQ={sharedWorker:({storeId:e})=>`shared-worker-${e}`,browserExtension:{contentscriptMain:e=>`contentscript-main-${e}`,contentscriptIframe:e=>`contentscript-iframe-${e}`}},y$=re("ClientSessionContentscriptMainReq",{storeId:R,clientId:R,sessionId:R}),b$=re("ClientSessionContentscriptMainRes",{tabId:Pt});ve(()=>h$({listenWindow:window,sendWindow:window,schema:{listen:y$,send:b$},ids:{own:"contentscript-main-static",other:"client-session-static"}})),ve(()=>h$({listenWindow:window,sendWindow:window,schema:{listen:b$,send:y$},ids:{own:"client-session-static",other:"contentscript-main-static"}}));const qQ=({node:e,target:t,worker:n})=>L(function*(){const r=new MessageChannel,s=yield*ue();za&&(yield*Z4(`@livestore/devtools-web-common: closing message channel ${e.nodeName}  ${t}`)),yield*n.execute(Gh.make({from:e.nodeName,port:r.port1})).pipe(is(()=>De(s,!0)),qn,kt,gn),yield*s;const o=yield*JO({port:r.port2,schema:kS});yield*e.addEdge({target:t,edgeChannel:o,replaceIfExists:!0}),za&&(yield*_n(`@livestore/devtools-web-common: initiated connection: ${e.nodeName}  ${t}`))}).pipe(be.mapToUnexpectedError);class Gu extends DE("@livestore/devtools-web-common:CacheService")(){static layer=({nodeName:t})=>L(function*(){const n=yield*LQ(t);return globalThis.__debugWebmeshNode=n,{node:n}}).pipe(SB(Gu))}const UQ=({from:e,port:t})=>y4(n=>L(function*(){const{node:r}=yield*Gu,s=yield*JO({port:t,schema:kS});yield*r.addEdge({target:e,edgeChannel:s,replaceIfExists:!0}),za&&(yield*_n(`@livestore/devtools-web-common: accepted edge: ${r.nodeName}  ${e}`)),n.single({}),yield*ln({connectedTo:[...r.edgeKeys]})}).pipe(er)).pipe(A4(`@livestore/devtools-web-common:worker:create-connection:${e}`));class jQ extends ae(U6,be){}const zQ=e=>HO({channelName:`livestore.shutdown.${e}`,schema:jQ}),WQ=Y({type:ce("opfs"),directory:hn(R)}),BQ=ae(WQ);zh({key:R,value:Ji});var S$;(function(e){class t extends Lt()("InitialMessage",{payload:{port:Hh,storeId:R,clientId:R},success:Ds,failure:be}){}e.InitialMessage=t;class n extends ae(t){}e.Request=n})(S$||(S$={}));var Yt;(function(e){class t extends Lt()("InitialMessage",{payload:{storageOptions:BQ,devtoolsEnabled:_o,storeId:R,clientId:R,debugInstanceId:R,syncPayload:aS(Ji)},success:Ds,failure:be}){}e.InitialMessage=t;class n extends Lt()("BootStatusStream",{payload:{},success:q6,failure:be}){}e.BootStatusStream=n;class r extends Lt()("PushToLeader",{payload:{batch:We(W6)},success:Ds,failure:ae(be,H6)}){}e.PushToLeader=r;class s extends Lt()("PullStream",{payload:{cursor:D6},success:Y({payload:QO,mergeCounter:Pt}),failure:be}){}e.PullStream=s;class o extends Lt()("Export",{payload:{},success:mi,failure:be}){}e.Export=o;class i extends Lt()("ExportEventlog",{payload:{},success:mi,failure:be}){}e.ExportEventlog=i;class c extends Lt()("GetRecreateSnapshot",{payload:{},success:Y({snapshot:mi,migrationsReport:z6}),failure:be}){}e.GetRecreateSnapshot=c;class a extends Lt()("GetLeaderHead",{payload:{},success:Qt,failure:be}){}e.GetLeaderHead=a;class u extends Lt()("GetLeaderSyncState",{payload:{},success:Vh,failure:be}){}e.GetLeaderSyncState=u;class d extends Lt()("Shutdown",{payload:{},success:Ds,failure:be}){}e.Shutdown=d;class h extends Lt()("ExtraDevtoolsMessage",{payload:{message:OQ},success:Ds,failure:be}){}e.ExtraDevtoolsMessage=h,e.Request=ae(t,n,r,s,o,i,c,a,u,d,h,Gh)})(Yt||(Yt={}));var bm;(function(e){class t extends re("FromClientSession",{initialMessage:Yt.InitialMessage}){}e.InitialMessagePayloadFromClientSession=t;class n extends Lt()("InitialMessage",{payload:{payload:ae(t,re("FromWebBridge",{})),liveStoreVersion:ce(YO)},success:Ds,failure:be}){}e.InitialMessage=n;class r extends Lt()("UpdateMessagePort",{payload:{port:Hh},success:Ds,failure:be}){}e.UpdateMessagePort=r;class s extends ae(n,r,Yt.BootStatusStream,Yt.PushToLeader,Yt.PullStream,Yt.Export,Yt.GetRecreateSnapshot,Yt.ExportEventlog,Yt.GetLeaderHead,Yt.GetLeaderSyncState,Yt.Shutdown,Yt.ExtraDevtoolsMessage,Gh){}e.Request=s})(bm||(bm={}));IO()&&(globalThis.__debugLiveStoreUtils={blobUrl:e=>URL.createObjectURL(new Blob([e],{type:"application/octet-stream"})),runSync:e=>os(e),runFork:e=>$s(e)});const KQ=L(function*(){const e=yield*CO(void 0),t=yield*ue().pipe(ui(Fo)),n=Uf(e,Xw).pipe(ie(c=>c.worker)),r=c=>n.pipe(ui(a=>a.executeEffect(c)),at,t$({label:`@livestore/adapter-web:shared-worker:forwardRequest:${c._tag}`,duration:500}),fr(a=>ct(be)(a)?a:pJ(a)||ct(tn)(a)?new be({cause:a}):a),LI(a=>new be({cause:a})),kt),s=c=>L(function*(){yield*_n(`forwardRequestStream: ${c._tag}`);const{worker:a,scope:u}=yield*Uf(e,Xw),d=a.execute(c),h=yield*ue();yield*vn(u,De(h,void 0));const p=L(function*(){return yield*h,S4}).pipe(Qw);return O4(d,p,{haltStrategy:"either"})}).pipe(at,be.mapToUnexpectedError,kt,Qw,_4(_n(`shutting down stream for ${c._tag}`)),be.mapToUnexpectedErrorStream),o=L(function*(){const c=yield*B4(e);c!==void 0&&(yield*ea(e,void 0),yield*DW(),yield*mt(c.scope,Ft).pipe(t$({label:"@livestore/adapter-web:shared-worker:close-previous-worker",duration:500})))}).pipe(Ct("@livestore/adapter-web:shared-worker:resetCurrentWorkerCtx")),i=L(function*(){yield*_n("reset");const c=yield*ue();yield*Su(t,c),yield*o});return S6(bm.Request,{InitialMessage:c=>L(function*(){if(c.payload._tag==="FromWebBridge")return;const a=yield*ss(t),u=yield*uf(a),d=c.payload.initialMessage;if(u){const h=yield*Le(a),p=Yt.InitialMessage.pipe(PV("devtoolsEnabled","debugInstanceId"));if(wO(p)(d,h.initialMessage)===!1){const y=_6(p)(h.initialMessage,d);yield*new be({cause:"Initial message already sent and was different now",payload:{diff:y,previousInitialMessage:h.initialMessage,newInitialMessage:d}})}}else yield*De(a,c.payload)}),UpdateMessagePort:({port:c})=>L(function*(){const a=yield*t.get.pipe(ui(Le));yield*o;const u=yield*lh();yield*L(function*(){yield*(yield*zQ(a.initialMessage.storeId)).listen.pipe(Ua(),is(()=>i),qn,kt,gn);const h=yield*gB(O6(()=>c)),p=yield*d6({size:1,concurrency:100,initialMessage:()=>a.initialMessage}).pipe(dn(h),Ct("@livestore/adapter-web:shared-worker:makeWorkerProxyFromPort")),{node:g}=yield*Gu,{storeId:y,clientId:E}=a.initialMessage;yield*qQ({node:g,worker:p,target:PQ.client.leader({storeId:y,clientId:E})}).pipe(kt,gn),yield*ea(e,{worker:p,scope:u})}).pipe(kt,uh(u),en(u))}).pipe(Ct("@livestore/adapter-web:shared-worker:updateMessagePort"),be.mapToUnexpectedError,kt),BootStatusStream:s,PushToLeader:r,PullStream:s,Export:r,GetRecreateSnapshot:r,ExportEventlog:r,Setup:r,GetLeaderSyncState:r,GetLeaderHead:r,Shutdown:r,ExtraDevtoolsMessage:r,"DevtoolsWebCommon.CreateConnection":UQ})}).pipe(EB),HQ=()=>{const e=self.name.replace("livestore-shared-worker-","");KQ.pipe(Ib(x6),yB,yo,kt,Vs({thread:self.name}),dn(H4(self.name)),dn(XG),dn(Gu.layer({nodeName:DQ.sharedWorker({storeId:e})})),za?k6(t=>console.createTask(t)):j,t=>t,JJ(xy),$s)};HQ();
